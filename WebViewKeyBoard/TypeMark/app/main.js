/*! Typora 22-06-2016 */
define("app/main",["jquery/jquery","jquery-localize-master/dist/jquery.localize","bootstrape/js/bootstrap","./document/File","exoskeleton-master/exoskeleton","./editor/UndoManager","./document/StringUtils","./document/Node","./editor/polyfill","./window/FileHelper","./editor/EditHelper","./window/FileInfoPanel","./editor/KeyMaster","./editor/Editor","./document/MarkParser","./editor/Inline","./editor/Emoji","./document/Node2Mark","./document/Node2HTML","./document/NodeOperation","rangy/rangy-core","./editor/Fences","codemirror/lib/codemirror","autoComplete","codemirror/addon/selection/mark-selection","codemirror/addon/edit/closebrackets","codemirror/addon/edit/closetag","codemirror/addon/mode/overlay","./editor/MathBlock","codemirror/addon/display/placeholder","codemirror/mode/stex/stex","./editor/MathInline","rangy/rangy-classapplier","./editor/Brush","./editor/Stylize","./editor/Selection","./editor/TableEdit","./editor/ImageEdit","./editor/UserOp","./editor/ConvertUtils","./editor/DocMenu","./editor/SearchPanel","./editor/Word","./document/Export","./document/Node2Native","./editor/SourceView","codemirror/addon/selection/active-line","codemirror/addon/edit/visiblespace","./editor/QuickOpenPanel"],function(a,b){function c(a){window.getMarkdown=function(){return a.getMarkdown()}}window.jQuery||(window.$=a("jquery/jquery"),window.jQuery=window.$,$.fn.textExcludeSVG=function(){return this.clone().find("svg").remove().end().text()},$.fn.textWithoutNbps=function(){return this.text().replace(/\u00A0/g," ").replace()}),a("jquery-localize-master/dist/jquery.localize.js"),a("bootstrape/js/bootstrap.js");var d=a("./document/File"),e=a("./editor/Editor");setTimeout(function(){$("[data-localize]").localize("app",{pathPrefix:"pathPrefix"})},20),window.File=d,b.init=function(){var b=new e("#write",d);c(b),window.editor=b,d.isNodeHtml&&a.async(window.debugMode?["pdf/pdf-designer.js","pdf/pdf.js"]:["lib.asar/pdf/pdf-designer.min.js","lib.asar/pdf/pdf.min.js"])}}),define("jquery/jquery",[],function(a,b,c){!function(a,b){"object"==typeof c&&"object"==typeof c.exports?c.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(a){var b=a.length,c=_.type(a);return"function"===c||_.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}function d(a,b,c){if(_.isFunction(b))return _.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return _.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(hb.test(b))return _.filter(b,a,c);b=_.filter(b,a)}return _.grep(a,function(a){return U.call(b,a)>=0!==c})}function e(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function f(a){var b=ob[a]={};return _.each(a.match(nb)||[],function(a,c){b[c]=!0}),b}function g(){Z.removeEventListener("DOMContentLoaded",g,!1),a.removeEventListener("load",g,!1),_.ready()}function h(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=_.expando+Math.random()}function i(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(ub,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:tb.test(c)?_.parseJSON(c):c}catch(e){}sb.set(a,b,c)}else c=void 0;return c}function j(){return!0}function k(){return!1}function l(){try{return Z.activeElement}catch(a){}}function m(a,b){return _.nodeName(a,"table")&&_.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function n(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function o(a){var b=Kb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function p(a,b){for(var c=0,d=a.length;d>c;c++)rb.set(a[c],"globalEval",!b||rb.get(b[c],"globalEval"))}function q(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(rb.hasData(a)&&(f=rb.access(a),g=rb.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)_.event.add(b,e,j[e][c])}sb.hasData(a)&&(h=sb.access(a),i=_.extend({},h),sb.set(b,i))}}function r(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&_.nodeName(a,b)?_.merge([a],c):c}function s(a,b){var c=b.nodeName.toLowerCase();"input"===c&&yb.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}function t(b,c){var d,e=_(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:_.css(e[0],"display");return e.detach(),f}function u(a){var b=Z,c=Ob[a];return c||(c=t(a,b),"none"!==c&&c||(Nb=(Nb||_("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=Nb[0].contentDocument,b.write(),b.close(),c=t(a,b),Nb.detach()),Ob[a]=c),c}function v(a,b,c){var d,e,f,g,h=a.style;return c=c||Rb(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||_.contains(a.ownerDocument,a)||(g=_.style(a,b)),Qb.test(g)&&Pb.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function w(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}function x(a,b){if(b in a)return b;for(var c=b[0].toUpperCase()+b.slice(1),d=b,e=Xb.length;e--;)if(b=Xb[e]+c,b in a)return b;return d}function y(a,b,c){var d=Tb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function z(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=_.css(a,c+wb[f],!0,e)),d?("content"===c&&(g-=_.css(a,"padding"+wb[f],!0,e)),"margin"!==c&&(g-=_.css(a,"border"+wb[f]+"Width",!0,e))):(g+=_.css(a,"padding"+wb[f],!0,e),"padding"!==c&&(g+=_.css(a,"border"+wb[f]+"Width",!0,e)));return g}function A(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Rb(a),g="border-box"===_.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=v(a,b,f),(0>e||null==e)&&(e=a.style[b]),Qb.test(e))return e;d=g&&(Y.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+z(a,b,c||(g?"border":"content"),d,f)+"px"}function B(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=rb.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&xb(d)&&(f[g]=rb.access(d,"olddisplay",u(d.nodeName)))):(e=xb(d),"none"===c&&e||rb.set(d,"olddisplay",e?c:_.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function C(a,b,c,d,e){return new C.prototype.init(a,b,c,d,e)}function D(){return setTimeout(function(){Yb=void 0}),Yb=_.now()}function E(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=wb[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function F(a,b,c){for(var d,e=(cc[b]||[]).concat(cc["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function G(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},n=a.style,o=a.nodeType&&xb(a),p=rb.get(a,"fxshow");c.queue||(h=_._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,_.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[n.overflow,n.overflowX,n.overflowY],j=_.css(a,"display"),k="none"===j?rb.get(a,"olddisplay")||u(a.nodeName):j,"inline"===k&&"none"===_.css(a,"float")&&(n.display="inline-block")),c.overflow&&(n.overflow="hidden",l.always(function(){n.overflow=c.overflow[0],n.overflowX=c.overflow[1],n.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],$b.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(o?"hide":"show")){if("show"!==e||!p||void 0===p[d])continue;o=!0}m[d]=p&&p[d]||_.style(a,d)}else j=void 0;if(_.isEmptyObject(m))"inline"===("none"===j?u(a.nodeName):j)&&(n.display=j);else{p?"hidden"in p&&(o=p.hidden):p=rb.access(a,"fxshow",{}),f&&(p.hidden=!o),o?_(a).show():l.done(function(){_(a).hide()}),l.done(function(){var b;rb.remove(a,"fxshow");for(b in m)_.style(a,b,m[b])});for(d in m)g=F(o?p[d]:0,d,l),d in p||(p[d]=g.start,o&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function H(a,b){var c,d,e,f,g;for(c in a)if(d=_.camelCase(c),e=b[d],f=a[c],_.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=_.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function I(a,b,c){var d,e,f=0,g=bc.length,h=_.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Yb||D(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:_.extend({},b),opts:_.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Yb||D(),duration:c.duration,tweens:[],createTween:function(b,c){var d=_.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(H(k,j.opts.specialEasing);g>f;f++)if(d=bc[f].call(j,a,k,j.opts))return d;return _.map(k,F,j),_.isFunction(j.opts.start)&&j.opts.start.call(a,j),_.fx.timer(_.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function J(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(nb)||[];if(_.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function K(a,b,c,d){function e(h){var i;return f[h]=!0,_.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===vc;return e(b.dataTypes[0])||!f["*"]&&e("*")}function L(a,b){var c,d,e=_.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&_.extend(!0,a,d),a}function M(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function N(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function O(a,b,c,d){var e;if(_.isArray(b))_.each(b,function(b,e){c||zc.test(a)?d(a,e):O(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==_.type(b))d(a,b);else for(e in b)O(a+"["+e+"]",b[e],c,d)}function P(a){return _.isWindow(a)?a:9===a.nodeType&&a.defaultView}var Q=[],R=Q.slice,S=Q.concat,T=Q.push,U=Q.indexOf,V={},W=V.toString,X=V.hasOwnProperty,Y={},Z=a.document,$="2.1.1",_=function(a,b){return new _.fn.init(a,b)},ab=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,bb=/^-ms-/,cb=/-([\da-z])/gi,db=function(a,b){return b.toUpperCase()};_.fn=_.prototype={jquery:$,constructor:_,selector:"",length:0,toArray:function(){return R.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:R.call(this)},pushStack:function(a){var b=_.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return _.each(this,a,b)},map:function(a){return this.pushStack(_.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(R.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:T,sort:Q.sort,splice:Q.splice},_.extend=_.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||_.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(_.isPlainObject(d)||(e=_.isArray(d)))?(e?(e=!1,f=c&&_.isArray(c)?c:[]):f=c&&_.isPlainObject(c)?c:{},g[b]=_.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},_.extend({expando:"jQuery"+($+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===_.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!_.isArray(a)&&a-parseFloat(a)>=0},isPlainObject:function(a){return"object"!==_.type(a)||a.nodeType||_.isWindow(a)?!1:a.constructor&&!X.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?V[W.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=_.trim(a),a&&(1===a.indexOf("use strict")?(b=Z.createElement("script"),b.text=a,Z.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(bb,"ms-").replace(cb,db)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;g>f&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;g>f&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(ab,"")},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?_.merge(d,"string"==typeof a?[a]:a):T.call(d,a)),d},inArray:function(a,b,c){return null==b?-1:U.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;g>f;f++)e=b(a[f],f,d),null!=e&&i.push(e);else for(f in a)e=b(a[f],f,d),null!=e&&i.push(e);return S.apply([],i)},guid:1,proxy:function(a,b){var c,d,e;return"string"==typeof b&&(c=a[b],b=a,a=c),_.isFunction(a)?(d=R.call(arguments,2),e=function(){return a.apply(b||this,d.concat(R.call(arguments)))},e.guid=a.guid=a.guid||_.guid++,e):void 0},now:Date.now,support:Y}),_.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){V["[object "+b+"]"]=b.toLowerCase()});var eb=function(a){function b(a,b,c,d){var e,f,g,h,i,j,l,n,o,p;if((b?b.ownerDocument||b:O)!==G&&F(b),b=b||G,c=c||[],!a||"string"!=typeof a)return c;if(1!==(h=b.nodeType)&&9!==h)return[];if(I&&!d){if(e=sb.exec(a))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&M(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return _.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&v.getElementsByClassName&&b.getElementsByClassName)return _.apply(c,b.getElementsByClassName(g)),c}if(v.qsa&&(!J||!J.test(a))){if(n=l=N,o=b,p=9===h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=z(a),(l=b.getAttribute("id"))?n=l.replace(ub,"\\$&"):b.setAttribute("id",n),n="[id='"+n+"'] ",i=j.length;i--;)j[i]=n+m(j[i]);o=tb.test(a)&&k(b.parentNode)||b,p=j.join(",")}if(p)try{return _.apply(c,o.querySelectorAll(p)),c}catch(q){}finally{l||b.removeAttribute("id")}}}return B(a.replace(ib,"$1"),b,c,d)}function c(){function a(c,d){return b.push(c+" ")>w.cacheLength&&delete a[b.shift()],a[c+" "]=d}var b=[];return a}function d(a){return a[N]=!0,a}function e(a){var b=G.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function f(a,b){for(var c=a.split("|"),d=a.length;d--;)w.attrHandle[c[d]]=b}function g(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||W)-(~a.sourceIndex||W);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function h(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function i(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function j(a){return d(function(b){return b=+b,d(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function k(a){return a&&typeof a.getElementsByTagName!==V&&a}function l(){}function m(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function n(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=Q++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[P,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if(i=b[N]||(b[N]={}),(h=i[d])&&h[0]===P&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function o(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function p(a,c,d){for(var e=0,f=c.length;f>e;e++)b(a,c[e],d);return d}function q(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function r(a,b,c,e,f,g){return e&&!e[N]&&(e=r(e)),f&&!f[N]&&(f=r(f,g)),d(function(d,g,h,i){var j,k,l,m=[],n=[],o=g.length,r=d||p(b||"*",h.nodeType?[h]:h,[]),s=!a||!d&&b?r:q(r,m,a,h,i),t=c?f||(d?a:o||e)?[]:g:s;if(c&&c(s,t,h,i),e)for(j=q(t,n),e(j,[],h,i),k=j.length;k--;)(l=j[k])&&(t[n[k]]=!(s[n[k]]=l));if(d){if(f||a){if(f){for(j=[],k=t.length;k--;)(l=t[k])&&j.push(s[k]=l);f(null,t=[],j,i)}for(k=t.length;k--;)(l=t[k])&&(j=f?bb.call(d,l):m[k])>-1&&(d[j]=!(g[j]=l))}}else t=q(t===g?t.splice(o,t.length):t),f?f(null,g,t,i):_.apply(g,t)})}function s(a){for(var b,c,d,e=a.length,f=w.relative[a[0].type],g=f||w.relative[" "],h=f?1:0,i=n(function(a){return a===b},g,!0),j=n(function(a){return bb.call(b,a)>-1},g,!0),k=[function(a,c,d){return!f&&(d||c!==C)||((b=c).nodeType?i(a,c,d):j(a,c,d))}];e>h;h++)if(c=w.relative[a[h].type])k=[n(o(k),c)];else{if(c=w.filter[a[h].type].apply(null,a[h].matches),c[N]){for(d=++h;e>d&&!w.relative[a[d].type];d++);return r(h>1&&o(k),h>1&&m(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ib,"$1"),c,d>h&&s(a.slice(h,d)),e>d&&s(a=a.slice(d)),e>d&&m(a))}k.push(c)}return o(k)}function t(a,c){var e=c.length>0,f=a.length>0,g=function(d,g,h,i,j){var k,l,m,n=0,o="0",p=d&&[],r=[],s=C,t=d||f&&w.find.TAG("*",j),u=P+=null==s?1:Math.random()||.1,v=t.length;for(j&&(C=g!==G&&g);o!==v&&null!=(k=t[o]);o++){if(f&&k){for(l=0;m=a[l++];)if(m(k,g,h)){i.push(k);break}j&&(P=u)}e&&((k=!m&&k)&&n--,d&&p.push(k))}if(n+=o,e&&o!==n){for(l=0;m=c[l++];)m(p,r,g,h);if(d){if(n>0)for(;o--;)p[o]||r[o]||(r[o]=Z.call(i));r=q(r)}_.apply(i,r),j&&!d&&r.length>0&&n+c.length>1&&b.uniqueSort(i)}return j&&(P=u,C=s),p};return e?d(g):g}var u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N="sizzle"+-new Date,O=a.document,P=0,Q=0,R=c(),S=c(),T=c(),U=function(a,b){return a===b&&(E=!0),0},V="undefined",W=1<<31,X={}.hasOwnProperty,Y=[],Z=Y.pop,$=Y.push,_=Y.push,ab=Y.slice,bb=Y.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},cb="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",db="[\\x20\\t\\r\\n\\f]",eb="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",fb=eb.replace("w","w#"),gb="\\["+db+"*("+eb+")(?:"+db+"*([*^$|!~]?=)"+db+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+fb+"))|)"+db+"*\\]",hb=":("+eb+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+gb+")*)|.*)\\)|)",ib=new RegExp("^"+db+"+|((?:^|[^\\\\])(?:\\\\.)*)"+db+"+$","g"),jb=new RegExp("^"+db+"*,"+db+"*"),kb=new RegExp("^"+db+"*([>+~]|"+db+")"+db+"*"),lb=new RegExp("="+db+"*([^\\]'\"]*?)"+db+"*\\]","g"),mb=new RegExp(hb),nb=new RegExp("^"+fb+"$"),ob={ID:new RegExp("^#("+eb+")"),CLASS:new RegExp("^\\.("+eb+")"),TAG:new RegExp("^("+eb.replace("w","w*")+")"),ATTR:new RegExp("^"+gb),PSEUDO:new RegExp("^"+hb),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+db+"*(even|odd|(([+-]|)(\\d*)n|)"+db+"*(?:([+-]|)"+db+"*(\\d+)|))"+db+"*\\)|)","i"),bool:new RegExp("^(?:"+cb+")$","i"),needsContext:new RegExp("^"+db+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+db+"*((?:-\\d)?\\d*)"+db+"*\\)|)(?=[^-]|$)","i")},pb=/^(?:input|select|textarea|button)$/i,qb=/^h\d$/i,rb=/^[^{]+\{\s*\[native \w/,sb=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tb=/[+~]/,ub=/'|\\/g,vb=new RegExp("\\\\([\\da-f]{1,6}"+db+"?|("+db+")|.)","ig"),wb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{_.apply(Y=ab.call(O.childNodes),O.childNodes),Y[O.childNodes.length].nodeType}catch(xb){_={apply:Y.length?function(a,b){$.apply(a,ab.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}v=b.support={},y=b.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},F=b.setDocument=function(a){var b,c=a?a.ownerDocument||a:O,d=c.defaultView;return c!==G&&9===c.nodeType&&c.documentElement?(G=c,H=c.documentElement,I=!y(c),d&&d!==d.top&&(d.addEventListener?d.addEventListener("unload",function(){F()},!1):d.attachEvent&&d.attachEvent("onunload",function(){F()})),v.attributes=e(function(a){return a.className="i",!a.getAttribute("className")}),v.getElementsByTagName=e(function(a){return a.appendChild(c.createComment("")),!a.getElementsByTagName("*").length}),v.getElementsByClassName=rb.test(c.getElementsByClassName)&&e(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),v.getById=e(function(a){return H.appendChild(a).id=N,!c.getElementsByName||!c.getElementsByName(N).length}),v.getById?(w.find.ID=function(a,b){if(typeof b.getElementById!==V&&I){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},w.filter.ID=function(a){var b=a.replace(vb,wb);return function(a){return a.getAttribute("id")===b}}):(delete w.find.ID,w.filter.ID=function(a){var b=a.replace(vb,wb);return function(a){var c=typeof a.getAttributeNode!==V&&a.getAttributeNode("id");return c&&c.value===b}}),w.find.TAG=v.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==V?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},w.find.CLASS=v.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==V&&I?b.getElementsByClassName(a):void 0},K=[],J=[],(v.qsa=rb.test(c.querySelectorAll))&&(e(function(a){a.innerHTML="<select msallowclip=''><option selected=''></option></select>",a.querySelectorAll("[msallowclip^='']").length&&J.push("[*^$]="+db+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||J.push("\\["+db+"*(?:value|"+cb+")"),a.querySelectorAll(":checked").length||J.push(":checked")}),e(function(a){var b=c.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&J.push("name"+db+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||J.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),J.push(",.*:")})),(v.matchesSelector=rb.test(L=H.matches||H.webkitMatchesSelector||H.mozMatchesSelector||H.oMatchesSelector||H.msMatchesSelector))&&e(function(a){v.disconnectedMatch=L.call(a,"div"),L.call(a,"[s!='']:x"),K.push("!=",hb)}),J=J.length&&new RegExp(J.join("|")),K=K.length&&new RegExp(K.join("|")),b=rb.test(H.compareDocumentPosition),M=b||rb.test(H.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},U=b?function(a,b){if(a===b)return E=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!v.sortDetached&&b.compareDocumentPosition(a)===d?a===c||a.ownerDocument===O&&M(O,a)?-1:b===c||b.ownerDocument===O&&M(O,b)?1:D?bb.call(D,a)-bb.call(D,b):0:4&d?-1:1)}:function(a,b){if(a===b)return E=!0,0;var d,e=0,f=a.parentNode,h=b.parentNode,i=[a],j=[b];if(!f||!h)return a===c?-1:b===c?1:f?-1:h?1:D?bb.call(D,a)-bb.call(D,b):0;if(f===h)return g(a,b);for(d=a;d=d.parentNode;)i.unshift(d);for(d=b;d=d.parentNode;)j.unshift(d);for(;i[e]===j[e];)e++;return e?g(i[e],j[e]):i[e]===O?-1:j[e]===O?1:0},c):G},b.matches=function(a,c){return b(a,null,null,c)},b.matchesSelector=function(a,c){if((a.ownerDocument||a)!==G&&F(a),c=c.replace(lb,"='$1']"),!(!v.matchesSelector||!I||K&&K.test(c)||J&&J.test(c)))try{var d=L.call(a,c);if(d||v.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return b(c,G,null,[a]).length>0},b.contains=function(a,b){return(a.ownerDocument||a)!==G&&F(a),M(a,b)},b.attr=function(a,b){(a.ownerDocument||a)!==G&&F(a);var c=w.attrHandle[b.toLowerCase()],d=c&&X.call(w.attrHandle,b.toLowerCase())?c(a,b,!I):void 0;return void 0!==d?d:v.attributes||!I?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null},b.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},b.uniqueSort=function(a){var b,c=[],d=0,e=0;if(E=!v.detectDuplicates,D=!v.sortStable&&a.slice(0),a.sort(U),E){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return D=null,a},x=b.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=x(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=x(b);return c},w=b.selectors={cacheLength:50,createPseudo:d,match:ob,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(vb,wb),a[3]=(a[3]||a[4]||a[5]||"").replace(vb,wb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||b.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&b.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return ob.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&mb.test(c)&&(b=z(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(vb,wb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=R[a+" "];return b||(b=new RegExp("(^|"+db+")"+a+"("+db+"|$)"))&&R(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==V&&a.getAttribute("class")||"")})},ATTR:function(a,c,d){return function(e){var f=b.attr(e,a);return null==f?"!="===c:c?(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&f.indexOf(d)>-1:"$="===c?d&&f.slice(-d.length)===d:"~="===c?(" "+f+" ").indexOf(d)>-1:"|="===c?f===d||f.slice(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[N]||(q[N]={}),j=k[a]||[],n=j[0]===P&&j[1],m=j[0]===P&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[P,n,m];break}}else if(s&&(j=(b[N]||(b[N]={}))[a])&&j[0]===P)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[N]||(l[N]={}))[a]=[P,m]),l!==b)););return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,c){var e,f=w.pseudos[a]||w.setFilters[a.toLowerCase()]||b.error("unsupported pseudo: "+a);return f[N]?f(c):f.length>1?(e=[a,a,"",c],w.setFilters.hasOwnProperty(a.toLowerCase())?d(function(a,b){for(var d,e=f(a,c),g=e.length;g--;)d=bb.call(a,e[g]),a[d]=!(b[d]=e[g])}):function(a){return f(a,0,e)}):f}},pseudos:{not:d(function(a){var b=[],c=[],e=A(a.replace(ib,"$1"));return e[N]?d(function(a,b,c,d){for(var f,g=e(a,null,d,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,d,f){return b[0]=a,e(b,null,f,c),!c.pop()}}),has:d(function(a){return function(c){return b(a,c).length>0}}),contains:d(function(a){return function(b){return(b.textContent||b.innerText||x(b)).indexOf(a)>-1}}),lang:d(function(a){return nb.test(a||"")||b.error("unsupported lang: "+a),a=a.replace(vb,wb).toLowerCase(),function(b){var c;do if(c=I?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===H},focus:function(a){return a===G.activeElement&&(!G.hasFocus||G.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!w.pseudos.empty(a)},header:function(a){return qb.test(a.nodeName)},input:function(a){return pb.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:j(function(){return[0]}),last:j(function(a,b){return[b-1]}),eq:j(function(a,b,c){return[0>c?c+b:c]}),even:j(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:j(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:j(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:j(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},w.pseudos.nth=w.pseudos.eq;for(u in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[u]=h(u);for(u in{submit:!0,reset:!0})w.pseudos[u]=i(u);return l.prototype=w.filters=w.pseudos,w.setFilters=new l,z=b.tokenize=function(a,c){var d,e,f,g,h,i,j,k=S[a+" "];if(k)return c?0:k.slice(0);for(h=a,i=[],j=w.preFilter;h;){(!d||(e=jb.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=kb.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ib," ")}),h=h.slice(d.length));for(g in w.filter)!(e=ob[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return c?h.length:h?b.error(a):S(a,i).slice(0)},A=b.compile=function(a,b){var c,d=[],e=[],f=T[a+" "];if(!f){for(b||(b=z(a)),c=b.length;c--;)f=s(b[c]),f[N]?d.push(f):e.push(f);
f=T(a,t(e,d)),f.selector=a}return f},B=b.select=function(a,b,c,d){var e,f,g,h,i,j="function"==typeof a&&a,l=!d&&z(a=j.selector||a);if(c=c||[],1===l.length){if(f=l[0]=l[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&v.getById&&9===b.nodeType&&I&&w.relative[f[1].type]){if(b=(w.find.ID(g.matches[0].replace(vb,wb),b)||[])[0],!b)return c;j&&(b=b.parentNode),a=a.slice(f.shift().value.length)}for(e=ob.needsContext.test(a)?0:f.length;e--&&(g=f[e],!w.relative[h=g.type]);)if((i=w.find[h])&&(d=i(g.matches[0].replace(vb,wb),tb.test(f[0].type)&&k(b.parentNode)||b))){if(f.splice(e,1),a=d.length&&m(f),!a)return _.apply(c,d),c;break}}return(j||A(a,l))(d,b,!I,c,tb.test(a)&&k(b.parentNode)||b),c},v.sortStable=N.split("").sort(U).join("")===N,v.detectDuplicates=!!E,F(),v.sortDetached=e(function(a){return 1&a.compareDocumentPosition(G.createElement("div"))}),e(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||f("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),v.attributes&&e(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||f("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),e(function(a){return null==a.getAttribute("disabled")})||f(cb,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),b}(a);_.find=eb,_.expr=eb.selectors,_.expr[":"]=_.expr.pseudos,_.unique=eb.uniqueSort,_.text=eb.getText,_.isXMLDoc=eb.isXML,_.contains=eb.contains;var fb=_.expr.match.needsContext,gb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,hb=/^.[^:#\[\.,]*$/;_.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?_.find.matchesSelector(d,a)?[d]:[]:_.find.matches(a,_.grep(b,function(a){return 1===a.nodeType}))},_.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(_(a).filter(function(){for(b=0;c>b;b++)if(_.contains(e[b],this))return!0}));for(b=0;c>b;b++)_.find(a,e[b],d);return d=this.pushStack(c>1?_.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(d(this,a||[],!1))},not:function(a){return this.pushStack(d(this,a||[],!0))},is:function(a){return!!d(this,"string"==typeof a&&fb.test(a)?_(a):a||[],!1).length}});var ib,jb=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,kb=_.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:jb.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||ib).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof _?b[0]:b,_.merge(this,_.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:Z,!0)),gb.test(c[1])&&_.isPlainObject(b))for(c in b)_.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=Z.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=Z,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):_.isFunction(a)?"undefined"!=typeof ib.ready?ib.ready(a):a(_):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),_.makeArray(a,this))};kb.prototype=_.fn,ib=_(Z);var lb=/^(?:parents|prev(?:Until|All))/,mb={children:!0,contents:!0,next:!0,prev:!0};_.extend({dir:function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&_(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),_.fn.extend({has:function(a){var b=_(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(_.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=fb.test(a)||"string"!=typeof a?_(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&_.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?_.unique(f):f)},index:function(a){return a?"string"==typeof a?U.call(_(a),this[0]):U.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(_.unique(_.merge(this.get(),_(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),_.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return _.dir(a,"parentNode")},parentsUntil:function(a,b,c){return _.dir(a,"parentNode",c)},next:function(a){return e(a,"nextSibling")},prev:function(a){return e(a,"previousSibling")},nextAll:function(a){return _.dir(a,"nextSibling")},prevAll:function(a){return _.dir(a,"previousSibling")},nextUntil:function(a,b,c){return _.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return _.dir(a,"previousSibling",c)},siblings:function(a){return _.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return _.sibling(a.firstChild)},contents:function(a){return a.contentDocument||_.merge([],a.childNodes)}},function(a,b){_.fn[a]=function(c,d){var e=_.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=_.filter(d,e)),this.length>1&&(mb[a]||_.unique(e),lb.test(a)&&e.reverse()),this.pushStack(e)}});var nb=/\S+/g,ob={};_.Callbacks=function(a){a="string"==typeof a?ob[a]||f(a):_.extend({},a);var b,c,d,e,g,h,i=[],j=!a.once&&[],k=function(f){for(b=a.memory&&f,c=!0,h=e||0,e=0,g=i.length,d=!0;i&&g>h;h++)if(i[h].apply(f[0],f[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,i&&(j?j.length&&k(j.shift()):b?i=[]:l.disable())},l={add:function(){if(i){var c=i.length;!function f(b){_.each(b,function(b,c){var d=_.type(c);"function"===d?a.unique&&l.has(c)||i.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),d?g=i.length:b&&(e=c,k(b))}return this},remove:function(){return i&&_.each(arguments,function(a,b){for(var c;(c=_.inArray(b,i,c))>-1;)i.splice(c,1),d&&(g>=c&&g--,h>=c&&h--)}),this},has:function(a){return a?_.inArray(a,i)>-1:!(!i||!i.length)},empty:function(){return i=[],g=0,this},disable:function(){return i=j=b=void 0,this},disabled:function(){return!i},lock:function(){return j=void 0,b||l.disable(),this},locked:function(){return!j},fireWith:function(a,b){return!i||c&&!j||(b=b||[],b=[a,b.slice?b.slice():b],d?j.push(b):k(b)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!c}};return l},_.extend({Deferred:function(a){var b=[["resolve","done",_.Callbacks("once memory"),"resolved"],["reject","fail",_.Callbacks("once memory"),"rejected"],["notify","progress",_.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return _.Deferred(function(c){_.each(b,function(b,f){var g=_.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&_.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?_.extend(a,d):d}},e={};return d.pipe=d.then,_.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=R.call(arguments),g=f.length,h=1!==g||a&&_.isFunction(a.promise)?g:0,i=1===h?a:_.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?R.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&_.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}});var pb;_.fn.ready=function(a){return _.ready.promise().done(a),this},_.extend({isReady:!1,readyWait:1,holdReady:function(a){a?_.readyWait++:_.ready(!0)},ready:function(a){(a===!0?--_.readyWait:_.isReady)||(_.isReady=!0,a!==!0&&--_.readyWait>0||(pb.resolveWith(Z,[_]),_.fn.triggerHandler&&(_(Z).triggerHandler("ready"),_(Z).off("ready"))))}}),_.ready.promise=function(b){return pb||(pb=_.Deferred(),"complete"===Z.readyState?setTimeout(_.ready):(Z.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1))),pb.promise(b)},_.ready.promise();var qb=_.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===_.type(c)){e=!0;for(h in c)_.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,_.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(_(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};_.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType},h.uid=1,h.accepts=_.acceptData,h.prototype={key:function(a){if(!h.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=h.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,_.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(_.isEmptyObject(f))_.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,_.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{_.isArray(b)?d=b.concat(b.map(_.camelCase)):(e=_.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(nb)||[])),c=d.length;for(;c--;)delete g[d[c]]}},hasData:function(a){return!_.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var rb=new h,sb=new h,tb=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ub=/([A-Z])/g;_.extend({hasData:function(a){return sb.hasData(a)||rb.hasData(a)},data:function(a,b,c){return sb.access(a,b,c)},removeData:function(a,b){sb.remove(a,b)},_data:function(a,b,c){return rb.access(a,b,c)},_removeData:function(a,b){rb.remove(a,b)}}),_.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=sb.get(f),1===f.nodeType&&!rb.get(f,"hasDataAttrs"))){for(c=g.length;c--;)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=_.camelCase(d.slice(5)),i(f,d,e[d])));rb.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){sb.set(this,a)}):qb(this,function(b){var c,d=_.camelCase(a);if(f&&void 0===b){if(c=sb.get(f,a),void 0!==c)return c;if(c=sb.get(f,d),void 0!==c)return c;if(c=i(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=sb.get(this,d);sb.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&sb.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){sb.remove(this,a)})}}),_.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=rb.get(a,b),c&&(!d||_.isArray(c)?d=rb.access(a,b,_.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=_.queue(a,b),d=c.length,e=c.shift(),f=_._queueHooks(a,b),g=function(){_.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return rb.get(a,c)||rb.access(a,c,{empty:_.Callbacks("once memory").add(function(){rb.remove(a,[b+"queue",c])})})}}),_.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?_.queue(this[0],a):void 0===b?this:this.each(function(){var c=_.queue(this,a,b);_._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&_.dequeue(this,a)})},dequeue:function(a){return this.each(function(){_.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=_.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)c=rb.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var vb=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,wb=["Top","Right","Bottom","Left"],xb=function(a,b){return a=b||a,"none"===_.css(a,"display")||!_.contains(a.ownerDocument,a)},yb=/^(?:checkbox|radio)$/i;!function(){var a=Z.createDocumentFragment(),b=a.appendChild(Z.createElement("div")),c=Z.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),Y.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",Y.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var zb="undefined";Y.focusinBubbles="onfocusin"in a;var Ab=/^key/,Bb=/^(?:mouse|pointer|contextmenu)|click/,Cb=/^(?:focusinfocus|focusoutblur)$/,Db=/^([^.]*)(?:\.(.+)|)$/;_.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=rb.get(a);if(q)for(c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=_.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return typeof _!==zb&&_.event.triggered!==b.type?_.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(nb)||[""],j=b.length;j--;)h=Db.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=_.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=_.event.special[n]||{},k=_.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&_.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,o,g)!==!1||a.addEventListener&&a.addEventListener(n,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),_.event.global[n]=!0)},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=rb.hasData(a)&&rb.get(a);if(q&&(i=q.events)){for(b=(b||"").match(nb)||[""],j=b.length;j--;)if(h=Db.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=_.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||_.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)_.event.remove(a,n+b[j],c,d,!0);_.isEmptyObject(i)&&(delete q.handle,rb.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,j,k,l,m=[d||Z],n=X.call(b,"type")?b.type:b,o=X.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||Z,3!==d.nodeType&&8!==d.nodeType&&!Cb.test(n+_.event.triggered)&&(n.indexOf(".")>=0&&(o=n.split("."),n=o.shift(),o.sort()),j=n.indexOf(":")<0&&"on"+n,b=b[_.expando]?b:new _.Event(n,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=o.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:_.makeArray(c,[b]),l=_.event.special[n]||{},e||!l.trigger||l.trigger.apply(d,c)!==!1)){if(!e&&!l.noBubble&&!_.isWindow(d)){for(i=l.delegateType||n,Cb.test(i+n)||(g=g.parentNode);g;g=g.parentNode)m.push(g),h=g;h===(d.ownerDocument||Z)&&m.push(h.defaultView||h.parentWindow||a)}for(f=0;(g=m[f++])&&!b.isPropagationStopped();)b.type=f>1?i:l.bindType||n,k=(rb.get(g,"events")||{})[b.type]&&rb.get(g,"handle"),k&&k.apply(g,c),k=j&&g[j],k&&k.apply&&_.acceptData(g)&&(b.result=k.apply(g,c),b.result===!1&&b.preventDefault());return b.type=n,e||b.isDefaultPrevented()||l._default&&l._default.apply(m.pop(),c)!==!1||!_.acceptData(d)||j&&_.isFunction(d[n])&&!_.isWindow(d)&&(h=d[j],h&&(d[j]=null),_.event.triggered=n,d[n](),_.event.triggered=void 0,h&&(d[j]=h)),b.result}},dispatch:function(a){a=_.event.fix(a);var b,c,d,e,f,g=[],h=R.call(arguments),i=(rb.get(this,"events")||{})[a.type]||[],j=_.event.special[a.type]||{};if(h[0]=a,a.delegateTarget=this,!j.preDispatch||j.preDispatch.call(this,a)!==!1){for(g=_.event.handlers.call(this,a,i),b=0;(e=g[b++])&&!a.isPropagationStopped();)for(a.currentTarget=e.elem,c=0;(f=e.handlers[c++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(f.namespace))&&(a.handleObj=f,a.data=f.data,d=((_.event.special[f.origType]||{}).handle||f.handler).apply(e.elem,h),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()));return j.postDispatch&&j.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?_(e,this).index(i)>=0:_.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||Z,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[_.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Bb.test(e)?this.mouseHooks:Ab.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new _.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=Z),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==l()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===l()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&_.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return _.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=_.extend(new _.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?_.event.trigger(e,null,b):_.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},_.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},_.Event=function(a,b){return this instanceof _.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?j:k):this.type=a,b&&_.extend(this,b),this.timeStamp=a&&a.timeStamp||_.now(),void(this[_.expando]=!0)):new _.Event(a,b)},_.Event.prototype={isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=j,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=j,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=j,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},_.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){_.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!_.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),Y.focusinBubbles||_.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){_.event.simulate(b,a.target,_.event.fix(a),!0)};_.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=rb.access(d,b);e||d.addEventListener(a,c,!0),rb.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=rb.access(d,b)-1;e?rb.access(d,b,e):(d.removeEventListener(a,c,!0),rb.remove(d,b))}}}),_.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=k;else if(!d)return this;return 1===e&&(f=d,d=function(a){return _().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=_.guid++)),this.each(function(){_.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,_(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=k),this.each(function(){_.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){_.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?_.event.trigger(a,b,c,!0):void 0}});var Eb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Fb=/<([\w:]+)/,Gb=/<|&#?\w+;/,Hb=/<(?:script|style|link)/i,Ib=/checked\s*(?:[^=]|=\s*.checked.)/i,Jb=/^$|\/(?:java|ecma)script/i,Kb=/^true\/(.*)/,Lb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Mb={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Mb.optgroup=Mb.option,Mb.tbody=Mb.tfoot=Mb.colgroup=Mb.caption=Mb.thead,Mb.th=Mb.td,_.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=_.contains(a.ownerDocument,a);if(!(Y.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||_.isXMLDoc(a)))for(g=r(h),f=r(a),d=0,e=f.length;e>d;d++)s(f[d],g[d]);if(b)if(c)for(f=f||r(a),g=g||r(h),d=0,e=f.length;e>d;d++)q(f[d],g[d]);else q(a,h);return g=r(h,"script"),g.length>0&&p(g,!i&&r(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,n=a.length;n>m;m++)if(e=a[m],e||0===e)if("object"===_.type(e))_.merge(l,e.nodeType?[e]:e);else if(Gb.test(e)){for(f=f||k.appendChild(b.createElement("div")),g=(Fb.exec(e)||["",""])[1].toLowerCase(),h=Mb[g]||Mb._default,f.innerHTML=h[1]+e.replace(Eb,"<$1></$2>")+h[2],j=h[0];j--;)f=f.lastChild;_.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));for(k.textContent="",m=0;e=l[m++];)if((!d||-1===_.inArray(e,d))&&(i=_.contains(e.ownerDocument,e),f=r(k.appendChild(e),"script"),i&&p(f),c))for(j=0;e=f[j++];)Jb.test(e.type||"")&&c.push(e);return k},cleanData:function(a){for(var b,c,d,e,f=_.event.special,g=0;void 0!==(c=a[g]);g++){if(_.acceptData(c)&&(e=c[rb.expando],e&&(b=rb.cache[e]))){if(b.events)for(d in b.events)f[d]?_.event.remove(c,d):_.removeEvent(c,d,b.handle);rb.cache[e]&&delete rb.cache[e]}delete sb.cache[c[sb.expando]]}}}),_.fn.extend({text:function(a){return qb(this,function(a){return void 0===a?_.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=m(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=m(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?_.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||_.cleanData(r(c)),c.parentNode&&(b&&_.contains(c.ownerDocument,c)&&p(r(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(_.cleanData(r(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return _.clone(this,a,b)})},html:function(a){return qb(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!Hb.test(a)&&!Mb[(Fb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Eb,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(_.cleanData(r(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,_.cleanData(r(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=S.apply([],a);var c,d,e,f,g,h,i=0,j=this.length,k=this,l=j-1,m=a[0],p=_.isFunction(m);if(p||j>1&&"string"==typeof m&&!Y.checkClone&&Ib.test(m))return this.each(function(c){var d=k.eq(c);p&&(a[0]=m.call(this,c,d.html())),d.domManip(a,b)});if(j&&(c=_.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(e=_.map(r(c,"script"),n),f=e.length;j>i;i++)g=c,i!==l&&(g=_.clone(g,!0,!0),f&&_.merge(e,r(g,"script"))),b.call(this[i],g,i);if(f)for(h=e[e.length-1].ownerDocument,_.map(e,o),i=0;f>i;i++)g=e[i],Jb.test(g.type||"")&&!rb.access(g,"globalEval")&&_.contains(h,g)&&(g.src?_._evalUrl&&_._evalUrl(g.src):_.globalEval(g.textContent.replace(Lb,"")))}return this}}),_.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){_.fn[a]=function(a){for(var c,d=[],e=_(a),f=e.length-1,g=0;f>=g;g++)c=g===f?this:this.clone(!0),_(e[g])[b](c),T.apply(d,c.get());return this.pushStack(d)}});var Nb,Ob={},Pb=/^margin/,Qb=new RegExp("^("+vb+")(?!px)[a-z%]+$","i"),Rb=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)};!function(){function b(){g.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",g.innerHTML="",e.appendChild(f);var b=a.getComputedStyle(g,null);c="1%"!==b.top,d="4px"===b.width,e.removeChild(f)}var c,d,e=Z.documentElement,f=Z.createElement("div"),g=Z.createElement("div");g.style&&(g.style.backgroundClip="content-box",g.cloneNode(!0).style.backgroundClip="",Y.clearCloneStyle="content-box"===g.style.backgroundClip,f.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",f.appendChild(g),a.getComputedStyle&&_.extend(Y,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return null==d&&b(),d},reliableMarginRight:function(){var b,c=g.appendChild(Z.createElement("div"));return c.style.cssText=g.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",g.style.width="1px",e.appendChild(f),b=!parseFloat(a.getComputedStyle(c,null).marginRight),e.removeChild(f),b}}))}(),_.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Sb=/^(none|table(?!-c[ea]).+)/,Tb=new RegExp("^("+vb+")(.*)$","i"),Ub=new RegExp("^([+-])=("+vb+")","i"),Vb={position:"absolute",visibility:"hidden",display:"block"},Wb={letterSpacing:"0",fontWeight:"400"},Xb=["Webkit","O","Moz","ms"];_.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=v(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=_.camelCase(b),i=a.style;return b=_.cssProps[h]||(_.cssProps[h]=x(i,h)),g=_.cssHooks[b]||_.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Ub.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(_.css(a,b)),f="number"),void(null!=c&&c===c&&("number"!==f||_.cssNumber[h]||(c+="px"),Y.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c))))}},css:function(a,b,c,d){var e,f,g,h=_.camelCase(b);return b=_.cssProps[h]||(_.cssProps[h]=x(a.style,h)),g=_.cssHooks[b]||_.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=v(a,b,d)),"normal"===e&&b in Wb&&(e=Wb[b]),""===c||c?(f=parseFloat(e),c===!0||_.isNumeric(f)?f||0:e):e}}),_.each(["height","width"],function(a,b){_.cssHooks[b]={get:function(a,c,d){return c?Sb.test(_.css(a,"display"))&&0===a.offsetWidth?_.swap(a,Vb,function(){return A(a,b,d)}):A(a,b,d):void 0},set:function(a,c,d){var e=d&&Rb(a);return y(a,c,d?z(a,b,d,"border-box"===_.css(a,"boxSizing",!1,e),e):0)}}}),_.cssHooks.marginRight=w(Y.reliableMarginRight,function(a,b){return b?_.swap(a,{display:"inline-block"},v,[a,"marginRight"]):void 0}),_.each({margin:"",padding:"",border:"Width"},function(a,b){_.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+wb[d]+b]=f[d]||f[d-2]||f[0];return e}},Pb.test(a)||(_.cssHooks[a+b].set=y)}),_.fn.extend({css:function(a,b){return qb(this,function(a,b,c){var d,e,f={},g=0;if(_.isArray(b)){for(d=Rb(a),e=b.length;e>g;g++)f[b[g]]=_.css(a,b[g],!1,d);return f}return void 0!==c?_.style(a,b,c):_.css(a,b)},a,b,arguments.length>1)},show:function(){return B(this,!0)},hide:function(){return B(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){xb(this)?_(this).show():_(this).hide()})}}),_.Tween=C,C.prototype={constructor:C,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(_.cssNumber[c]?"":"px")},cur:function(){var a=C.propHooks[this.prop];return a&&a.get?a.get(this):C.propHooks._default.get(this)},run:function(a){var b,c=C.propHooks[this.prop];return this.pos=b=this.options.duration?_.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):C.propHooks._default.set(this),this}},C.prototype.init.prototype=C.prototype,C.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=_.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){_.fx.step[a.prop]?_.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[_.cssProps[a.prop]]||_.cssHooks[a.prop])?_.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},C.propHooks.scrollTop=C.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},_.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},_.fx=C.prototype.init,_.fx.step={};var Yb,Zb,$b=/^(?:toggle|show|hide)$/,_b=new RegExp("^(?:([+-])=|)("+vb+")([a-z%]*)$","i"),ac=/queueHooks$/,bc=[G],cc={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=_b.exec(b),f=e&&e[3]||(_.cssNumber[a]?"":"px"),g=(_.cssNumber[a]||"px"!==f&&+d)&&_b.exec(_.css(c.elem,a)),h=1,i=20;
if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,_.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};_.Animation=_.extend(I,{tweener:function(a,b){_.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],cc[c]=cc[c]||[],cc[c].unshift(b)},prefilter:function(a,b){b?bc.unshift(a):bc.push(a)}}),_.speed=function(a,b,c){var d=a&&"object"==typeof a?_.extend({},a):{complete:c||!c&&b||_.isFunction(a)&&a,duration:a,easing:c&&b||b&&!_.isFunction(b)&&b};return d.duration=_.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in _.fx.speeds?_.fx.speeds[d.duration]:_.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){_.isFunction(d.old)&&d.old.call(this),d.queue&&_.dequeue(this,d.queue)},d},_.fn.extend({fadeTo:function(a,b,c,d){return this.filter(xb).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=_.isEmptyObject(a),f=_.speed(b,c,d),g=function(){var b=I(this,_.extend({},a),f);(e||rb.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=_.timers,g=rb.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&ac.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&_.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=rb.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=_.timers,g=d?d.length:0;for(c.finish=!0,_.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),_.each(["toggle","show","hide"],function(a,b){var c=_.fn[b];_.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(E(b,!0),a,d,e)}}),_.each({slideDown:E("show"),slideUp:E("hide"),slideToggle:E("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){_.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),_.timers=[],_.fx.tick=function(){var a,b=0,c=_.timers;for(Yb=_.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||_.fx.stop(),Yb=void 0},_.fx.timer=function(a){_.timers.push(a),a()?_.fx.start():_.timers.pop()},_.fx.interval=13,_.fx.start=function(){Zb||(Zb=setInterval(_.fx.tick,_.fx.interval))},_.fx.stop=function(){clearInterval(Zb),Zb=null},_.fx.speeds={slow:600,fast:200,_default:400},_.fn.delay=function(a,b){return a=_.fx?_.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=Z.createElement("input"),b=Z.createElement("select"),c=b.appendChild(Z.createElement("option"));a.type="checkbox",Y.checkOn=""!==a.value,Y.optSelected=c.selected,b.disabled=!0,Y.optDisabled=!c.disabled,a=Z.createElement("input"),a.value="t",a.type="radio",Y.radioValue="t"===a.value}();var dc,ec,fc=_.expr.attrHandle;_.fn.extend({attr:function(a,b){return qb(this,_.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){_.removeAttr(this,a)})}}),_.extend({attr:function(a,b,c){var d,e,f=a.nodeType;return a&&3!==f&&8!==f&&2!==f?typeof a.getAttribute===zb?_.prop(a,b,c):(1===f&&_.isXMLDoc(a)||(b=b.toLowerCase(),d=_.attrHooks[b]||(_.expr.match.bool.test(b)?ec:dc)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=_.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void _.removeAttr(a,b)):void 0},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(nb);if(f&&1===a.nodeType)for(;c=f[e++];)d=_.propFix[c]||c,_.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!Y.radioValue&&"radio"===b&&_.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),ec={set:function(a,b,c){return b===!1?_.removeAttr(a,c):a.setAttribute(c,c),c}},_.each(_.expr.match.bool.source.match(/\w+/g),function(a,b){var c=fc[b]||_.find.attr;fc[b]=function(a,b,d){var e,f;return d||(f=fc[b],fc[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,fc[b]=f),e}});var gc=/^(?:input|select|textarea|button)$/i;_.fn.extend({prop:function(a,b){return qb(this,_.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[_.propFix[a]||a]})}}),_.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;return a&&3!==g&&8!==g&&2!==g?(f=1!==g||!_.isXMLDoc(a),f&&(b=_.propFix[b]||b,e=_.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]):void 0},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||gc.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),Y.optSelected||(_.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),_.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){_.propFix[this.toLowerCase()]=this});var hc=/[\t\r\n\f]/g;_.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(_.isFunction(a))return this.each(function(b){_(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(nb)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(hc," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=_.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(_.isFunction(a))return this.each(function(b){_(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(nb)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(hc," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");g=a?_.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(_.isFunction(a)?function(c){_(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c)for(var b,d=0,e=_(this),f=a.match(nb)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else(c===zb||"boolean"===c)&&(this.className&&rb.set(this,"__className__",this.className),this.className=this.className||a===!1?"":rb.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(hc," ").indexOf(b)>=0)return!0;return!1}});var ic=/\r/g;_.fn.extend({val:function(a){var b,c,d,e=this[0];return arguments.length?(d=_.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,_(this).val()):a,null==e?e="":"number"==typeof e?e+="":_.isArray(e)&&(e=_.map(e,function(a){return null==a?"":a+""})),b=_.valHooks[this.type]||_.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))})):e?(b=_.valHooks[e.type]||_.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(ic,""):null==c?"":c)):void 0}}),_.extend({valHooks:{option:{get:function(a){var b=_.find.attr(a,"value");return null!=b?b:_.trim(_.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(Y.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&_.nodeName(c.parentNode,"optgroup"))){if(b=_(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=_.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=_.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),_.each(["radio","checkbox"],function(){_.valHooks[this]={set:function(a,b){return _.isArray(b)?a.checked=_.inArray(_(a).val(),b)>=0:void 0}},Y.checkOn||(_.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),_.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){_.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),_.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var jc=_.now(),kc=/\?/;_.parseJSON=function(a){return JSON.parse(a+"")},_.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&_.error("Invalid XML: "+a),b};var lc,mc,nc=/#.*$/,oc=/([?&])_=[^&]*/,pc=/^(.*?):[ \t]*([^\r\n]*)$/gm,qc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rc=/^(?:GET|HEAD)$/,sc=/^\/\//,tc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,uc={},vc={},wc="*/".concat("*");try{mc=location.href}catch(xc){mc=Z.createElement("a"),mc.href="",mc=mc.href}lc=tc.exec(mc.toLowerCase())||[],_.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:mc,type:"GET",isLocal:qc.test(lc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":wc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":_.parseJSON,"text xml":_.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?L(L(a,_.ajaxSettings),b):L(_.ajaxSettings,a)},ajaxPrefilter:J(uc),ajaxTransport:J(vc),ajax:function(a,b){function c(a,b,c,g){var i,k,r,s,u,w=b;2!==t&&(t=2,h&&clearTimeout(h),d=void 0,f=g||"",v.readyState=a>0?4:0,i=a>=200&&300>a||304===a,c&&(s=M(l,v,c)),s=N(l,s,v,i),i?(l.ifModified&&(u=v.getResponseHeader("Last-Modified"),u&&(_.lastModified[e]=u),u=v.getResponseHeader("etag"),u&&(_.etag[e]=u)),204===a||"HEAD"===l.type?w="nocontent":304===a?w="notmodified":(w=s.state,k=s.data,r=s.error,i=!r)):(r=w,(a||!w)&&(w="error",0>a&&(a=0))),v.status=a,v.statusText=(b||w)+"",i?o.resolveWith(m,[k,w,v]):o.rejectWith(m,[v,w,r]),v.statusCode(q),q=void 0,j&&n.trigger(i?"ajaxSuccess":"ajaxError",[v,l,i?k:r]),p.fireWith(m,[v,w]),j&&(n.trigger("ajaxComplete",[v,l]),--_.active||_.event.trigger("ajaxStop")))}"object"==typeof a&&(b=a,a=void 0),b=b||{};var d,e,f,g,h,i,j,k,l=_.ajaxSetup({},b),m=l.context||l,n=l.context&&(m.nodeType||m.jquery)?_(m):_.event,o=_.Deferred(),p=_.Callbacks("once memory"),q=l.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!g)for(g={};b=pc.exec(f);)g[b[1].toLowerCase()]=b[2];b=g[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return d&&d.abort(b),c(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,l.url=((a||l.url||mc)+"").replace(nc,"").replace(sc,lc[1]+"//"),l.type=b.method||b.type||l.method||l.type,l.dataTypes=_.trim(l.dataType||"*").toLowerCase().match(nb)||[""],null==l.crossDomain&&(i=tc.exec(l.url.toLowerCase()),l.crossDomain=!(!i||i[1]===lc[1]&&i[2]===lc[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(lc[3]||("http:"===lc[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=_.param(l.data,l.traditional)),K(uc,l,b,v),2===t)return v;j=l.global,j&&0===_.active++&&_.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!rc.test(l.type),e=l.url,l.hasContent||(l.data&&(e=l.url+=(kc.test(e)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=oc.test(e)?e.replace(oc,"$1_="+jc++):e+(kc.test(e)?"&":"?")+"_="+jc++)),l.ifModified&&(_.lastModified[e]&&v.setRequestHeader("If-Modified-Since",_.lastModified[e]),_.etag[e]&&v.setRequestHeader("If-None-Match",_.etag[e])),(l.data&&l.hasContent&&l.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",l.contentType),v.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+wc+"; q=0.01":""):l.accepts["*"]);for(k in l.headers)v.setRequestHeader(k,l.headers[k]);if(l.beforeSend&&(l.beforeSend.call(m,v,l)===!1||2===t))return v.abort();u="abort";for(k in{success:1,error:1,complete:1})v[k](l[k]);if(d=K(vc,l,b,v)){v.readyState=1,j&&n.trigger("ajaxSend",[v,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){v.abort("timeout")},l.timeout));try{t=1,d.send(r,c)}catch(w){if(!(2>t))throw w;c(-1,w)}}else c(-1,"No Transport");return v},getJSON:function(a,b,c){return _.get(a,b,c,"json")},getScript:function(a,b){return _.get(a,void 0,b,"script")}}),_.each(["get","post"],function(a,b){_[b]=function(a,c,d,e){return _.isFunction(c)&&(e=e||d,d=c,c=void 0),_.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),_.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){_.fn[b]=function(a){return this.on(b,a)}}),_._evalUrl=function(a){return _.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},_.fn.extend({wrapAll:function(a){var b;return _.isFunction(a)?this.each(function(b){_(this).wrapAll(a.call(this,b))}):(this[0]&&(b=_(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(_.isFunction(a)?function(b){_(this).wrapInner(a.call(this,b))}:function(){var b=_(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=_.isFunction(a);return this.each(function(c){_(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){_.nodeName(this,"body")||_(this).replaceWith(this.childNodes)}).end()}}),_.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},_.expr.filters.visible=function(a){return!_.expr.filters.hidden(a)};var yc=/%20/g,zc=/\[\]$/,Ac=/\r?\n/g,Bc=/^(?:submit|button|image|reset|file)$/i,Cc=/^(?:input|select|textarea|keygen)/i;_.param=function(a,b){var c,d=[],e=function(a,b){b=_.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=_.ajaxSettings&&_.ajaxSettings.traditional),_.isArray(a)||a.jquery&&!_.isPlainObject(a))_.each(a,function(){e(this.name,this.value)});else for(c in a)O(c,a[c],b,e);return d.join("&").replace(yc,"+")},_.fn.extend({serialize:function(){return _.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=_.prop(this,"elements");return a?_.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!_(this).is(":disabled")&&Cc.test(this.nodeName)&&!Bc.test(a)&&(this.checked||!yb.test(a))}).map(function(a,b){var c=_(this).val();return null==c?null:_.isArray(c)?_.map(c,function(a){return{name:b.name,value:a.replace(Ac,"\r\n")}}):{name:b.name,value:c.replace(Ac,"\r\n")}}).get()}}),_.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Dc=0,Ec={},Fc={0:200,1223:204},Gc=_.ajaxSettings.xhr();a.ActiveXObject&&_(a).on("unload",function(){for(var a in Ec)Ec[a]()}),Y.cors=!!Gc&&"withCredentials"in Gc,Y.ajax=Gc=!!Gc,_.ajaxTransport(function(a){var b;return Y.cors||Gc&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Dc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Ec[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Fc[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Ec[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}:void 0}),_.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return _.globalEval(a),a}}}),_.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),_.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=_("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),Z.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Hc=[],Ic=/(=)\?(?=&|$)|\?\?/;_.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Hc.pop()||_.expando+"_"+jc++;return this[a]=!0,a}}),_.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Ic.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ic.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=_.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Ic,"$1"+e):b.jsonp!==!1&&(b.url+=(kc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||_.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Hc.push(e)),g&&_.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),_.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||Z;var d=gb.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=_.buildFragment([a],b,e),e&&e.length&&_(e).remove(),_.merge([],d.childNodes))};var Jc=_.fn.load;_.fn.load=function(a,b,c){if("string"!=typeof a&&Jc)return Jc.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=_.trim(a.slice(h)),a=a.slice(0,h)),_.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&_.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?_("<div>").append(_.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},_.expr.filters.animated=function(a){return _.grep(_.timers,function(b){return a===b.elem}).length};var Kc=a.document.documentElement;_.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=_.css(a,"position"),l=_(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=_.css(a,"top"),i=_.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),_.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},_.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){_.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;return f?(b=f.documentElement,_.contains(b,d)?(typeof d.getBoundingClientRect!==zb&&(e=d.getBoundingClientRect()),c=P(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e):void 0},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===_.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),_.nodeName(a[0],"html")||(d=a.offset()),d.top+=_.css(a[0],"borderTopWidth",!0),d.left+=_.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-_.css(c,"marginTop",!0),left:b.left-d.left-_.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||Kc;a&&!_.nodeName(a,"html")&&"static"===_.css(a,"position");)a=a.offsetParent;return a||Kc})}}),_.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;_.fn[b]=function(e){return qb(this,function(b,e,f){var g=P(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),_.each(["top","left"],function(a,b){_.cssHooks[b]=w(Y.pixelPosition,function(a,c){return c?(c=v(a,b),Qb.test(c)?_(a).position()[b]+"px":c):void 0})}),_.each({Height:"height",Width:"width"},function(a,b){_.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){_.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return qb(this,function(b,c,d){var e;return _.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?_.css(b,c,g):_.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),_.fn.size=function(){return this.length},_.fn.andSelf=_.fn.addBack,"function"==typeof define&&define.amd&&define("jquery/jquery",[],function(){return _});var Lc=a.jQuery,Mc=a.$;return _.noConflict=function(b){return a.$===_&&(a.$=Mc),b&&a.jQuery===_&&(a.jQuery=Lc),_},typeof b===zb&&(a.jQuery=a.$=_),_})}),define("jquery-localize-master/dist/jquery.localize.js",[],function(a){var b=a("jquery/jquery");!function(a){var b;return b=function(a){return a=a.replace(/_/,"-").toLowerCase(),a.length>3&&(a=a.substring(0,3)+a.substring(3).toUpperCase()),a},a.defaultLanguage=b(navigator.language||navigator.userLanguage),a.localize=function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;return null==d&&(d={}),u=this,g={},f=d.fileExtension||"json",j=function(a,b,c){var e;switch(null==c&&(c=1),c){case 1:return g={},d.loadBase?(e=a+("."+f),h(e,a,b,c)):j(a,b,2);case 2:if(b.length>=2)return e=""+a+"-"+b.substring(0,2)+"."+f,h(e,a,b,c);break;case 3:if(b.length>=5)return e=""+a+"-"+b.substring(0,5)+"."+f,h(e,a,b,c)}},h=function(b,c,e,f){var h,i,k;return null!=d.pathPrefix&&(b=""+d.pathPrefix+"/"+b),k=function(b){return a.extend(g,b),p(g),j(c,e,f+1)},i=function(){return d.fallback&&d.fallback!==e?j(c,d.fallback):void 0},h={url:b,dataType:"json",async:!1,timeout:null!=d.timeout?d.timeout:500,success:k,error:i},"file:"===window.location.protocol&&(h.error=function(b){return b.responseText&&k(a.parseJSON(b.responseText))}),a.ajax(h)},p=function(a){return null!=d.callback?d.callback(a,e):e(a)},e=function(b){return a.localize.data[c]=b,u.each(function(){var c,d,e;return c=a(this),d=c.data("localize"),d||(d=c.attr("rel").match(/localize\[(.*?)\]/)[1]),e=t(d,b),null!=e?k(c,d,e):void 0})},k=function(b,c,d){return b.is("input")?n(b,c,d):b.is("img")?m(b,c,d):b.is("optgroup")?o(b,c,d):a.isPlainObject(d)||b.html(d),a.isPlainObject(d)?l(b,d):void 0},n=function(b,c,d){var e;return e=a.isPlainObject(d)?d.value:d,b.is("[placeholder]")?b.attr("placeholder",e):b.val(e)},l=function(a,b){return r(a,"title",b),s(a,"text",b)},o=function(a,b,c){return a.attr("label",c)},m=function(a,b,c){return r(a,"alt",c),r(a,"src",c)},t=function(a,b){var c,d,e,f;for(c=a.split(/\./),d=b,e=0,f=c.length;f>e;e++)a=c[e],d=null!=d?d[a]:null;return d},r=function(a,b,c){return c=t(b,c),null!=c?a.attr(b,c):void 0},s=function(a,b,c){return c=t(b,c),null!=c?a.text(c):void 0},q=function(a){var b;return"string"==typeof a?"^"+a+"$":null!=a.length?function(){var c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(q(b));return e}().join("|"):a},i=b(d.language?d.language:a.defaultLanguage),d.skipLanguage&&i.match(q(d.skipLanguage))||j(c,i,1),u},a.fn.localize=a.localize,a.localize.data={}}(b)}),define("bootstrape/js/bootstrap",[],function(a){"use strict";if(window.jQuery||(window.$=a("$"),window.jQuery=window.$),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(a){function b(b){return this.each(function(){var c=a(this),e=c.data("bs.alert");e||c.data("bs.alert",e=new d(this)),"string"==typeof b&&e[b].call(c)})}var c='[data-dismiss="alert"]',d=function(b){a(b).on("click",c,this.close)};d.VERSION="3.2.0",d.prototype.close=function(b){function c(){f.detach().trigger("closed.bs.alert").remove()}var d=a(this),e=d.attr("data-target");e||(e=d.attr("href"),e=e&&e.replace(/.*(?=#[^\s]*$)/,""));var f=a(e);b&&b.preventDefault(),f.length||(f=d.hasClass("alert")?d:d.parent()),f.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",c).emulateTransitionEnd(150):c())};var e=a.fn.alert;a.fn.alert=b,a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",c,d.prototype.close)}(jQuery),+function(a){function b(b){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof b&&b;e||d.data("bs.button",e=new c(this,f)),"toggle"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION="3.2.0",c.DEFAULTS={loadingText:"loading..."},c.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",null==f.resetText&&d.data("resetText",d[e]()),d[e](null==f[b]?this.options[b]:f[b]),setTimeout(a.proxy(function(){"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle="buttons"]');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")&&(c.prop("checked")&&this.$element.hasClass("active")?a=!1:b.find(".active").removeClass("active")),a&&c.prop("checked",!this.$element.hasClass("active")).trigger("change")}a&&this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(c){var d=a(c.target);d.hasClass("btn")||(d=d.closest(".btn")),b.call(d,"toggle"),c.preventDefault()})}(jQuery),+function(a){function b(b){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b),g="string"==typeof b?b:f.slide;e||d.data("bs.carousel",e=new c(this,f)),"number"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b).on("keydown.bs.carousel",a.proxy(this.keydown,this)),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};c.VERSION="3.2.0",c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},c.prototype.keydown=function(a){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(".item"),this.$items.index(a||this.$active)},c.prototype.to=function(b){var c=this,d=this.getItemIndex(this.$active=this.$element.find(".item.active"));return b>this.$items.length-1||0>b?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){c.to(b)}):d==b?this.pause().cycle():this.slide(b>d?"next":"prev",a(this.$items[b]))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){return this.sliding?void 0:this.slide("next")},c.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},c.prototype.slide=function(b,c){var d=this.$element.find(".item.active"),e=c||d[b](),f=this.interval,g="next"==b?"left":"right",h="next"==b?"first":"last",i=this;if(!e.length){if(!this.options.wrap)return;e=this.$element.find(".item")[h]()}if(e.hasClass("active"))return this.sliding=!1;var j=e[0],k=a.Event("slide.bs.carousel",{relatedTarget:j,direction:g});if(this.$element.trigger(k),!k.isDefaultPrevented()){if(this.sliding=!0,f&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var l=a(this.$indicators.children()[this.getItemIndex(e)]);l&&l.addClass("active")}var m=a.Event("slid.bs.carousel",{relatedTarget:j,direction:g});return a.support.transition&&this.$element.hasClass("slide")?(e.addClass(b),e[0].offsetWidth,d.addClass(g),e.addClass(g),d.one("bsTransitionEnd",function(){e.removeClass([b,g].join(" ")).addClass("active"),d.removeClass(["active",g].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger(m)},0)}).emulateTransitionEnd(1e3*d.css("transition-duration").slice(0,-1))):(d.removeClass("active"),e.addClass("active"),this.sliding=!1,this.$element.trigger(m)),f&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this},a(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(c){var d,e=a(this),f=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""));if(f.hasClass("carousel")){var g=a.extend({},f.data(),e.data()),h=e.attr("data-slide-to");h&&(g.interval=!1),b.call(f,g),h&&f.data("bs.carousel").to(h),c.preventDefault()}}),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),+function(a){function b(b){b&&3===b.which||(a(e).remove(),a(f).each(function(){var d=c(a(this)),e={relatedTarget:this};d.hasClass("open")&&(d.trigger(b=a.Event("hide.bs.dropdown",e)),b.isDefaultPrevented()||d.removeClass("open").trigger("hidden.bs.dropdown",e))}))}function c(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function d(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".dropdown-backdrop",f='[data-toggle="dropdown"]',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.2.0",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=c(e),g=f.hasClass("open");if(b(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a('<div class="dropdown-backdrop"/>').insertAfter(a(this)).on("click",b);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus"),f.toggleClass("open").trigger("shown.bs.dropdown",h)}return!1}},g.prototype.keydown=function(b){if(/(38|40|27)/.test(b.keyCode)){var d=a(this);if(b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled")){var e=c(d),g=e.hasClass("open");if(!g||g&&27==b.keyCode)return 27==b.which&&e.find(f).trigger("focus"),d.trigger("click");
var h=" li:not(.divider):visible a",i=e.find('[role="menu"]'+h+', [role="listbox"]'+h);if(i.length){var j=i.index(i.filter(":focus"));38==b.keyCode&&j>0&&j--,40==b.keyCode&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=d,a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",b).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f+', [role="menu"], [role="listbox"]',g.prototype.keydown)}(jQuery),+function(a){function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.2.0",c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var c=this,d=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(d),this.isShown||d.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.$body.addClass("modal-open"),this.setScrollbar(),this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.backdrop(function(){var d=a.support.transition&&c.$element.hasClass("fade");c.$element.parent().length||c.$element.appendTo(c.$body),c.$element.show().scrollTop(0),d&&c.$element[0].offsetWidth,c.$element.addClass("in").attr("aria-hidden",!1),c.enforceFocus();var e=a.Event("shown.bs.modal",{relatedTarget:b});d?c.$element.find(".modal-dialog").one("bsTransitionEnd",function(){c.$element.trigger("focus").trigger(e)}).emulateTransitionEnd(300):c.$element.trigger("focus").trigger(e)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.$body.removeClass("modal-open"),this.resetScrollbar(),this.escape(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var c=this,d=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var e=a.support.transition&&d;if(this.$backdrop=a('<div class="modal-backdrop '+d+'" />').appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(a){a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),e&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;e?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(150):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var f=function(){c.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",f).emulateTransitionEnd(150):f()}else b&&b()},c.prototype.checkScrollbar=function(){document.body.clientWidth>=window.innerWidth||(this.scrollbarWidth=this.scrollbarWidth||this.measureScrollbar())},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.scrollbarWidth&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery),+function(a){function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;(e||"destroy"!=b)&&(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",a,b)};c.VERSION="3.2.0",c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(this.options.viewport.selector||this.options.viewport);for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show()},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var c=a.contains(document.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!c)return;var d=this,e=this.tip(),f=this.getUID(this.type);this.setContent(),e.attr("id",f),this.$element.attr("aria-describedby",f),this.options.animation&&e.addClass("fade");var g="function"==typeof this.options.placement?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,h=/\s?auto?\s?/i,i=h.test(g);i&&(g=g.replace(h,"")||"top"),e.detach().css({top:0,left:0,display:"block"}).addClass(g).data("bs."+this.type,this),this.options.container?e.appendTo(this.options.container):e.insertAfter(this.$element);var j=this.getPosition(),k=e[0].offsetWidth,l=e[0].offsetHeight;if(i){var m=g,n=this.$element.parent(),o=this.getPosition(n);g="bottom"==g&&j.top+j.height+l-o.scroll>o.height?"top":"top"==g&&j.top-o.scroll-l<0?"bottom":"right"==g&&j.right+k>o.width?"left":"left"==g&&j.left-k<o.left?"right":g,e.removeClass(m).addClass(g)}var p=this.getCalculatedOffset(g,j,k,l);this.applyPlacement(p,g);var q=function(){d.$element.trigger("shown.bs."+d.type),d.hoverState=null};a.support.transition&&this.$tip.hasClass("fade")?e.one("bsTransitionEnd",q).emulateTransitionEnd(150):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top=b.top+g,b.left=b.left+h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=k.left?2*k.left-e+i:2*k.top-f+j,m=k.left?"left":"top",n=k.left?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(l,d[0][n],m)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+"%":"")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(){function b(){"in"!=c.hoverState&&d.detach(),c.$element.trigger("hidden.bs."+c.type)}var c=this,d=this.tip(),e=a.Event("hide.bs."+this.type);return this.$element.removeAttr("aria-describedby"),this.$element.trigger(e),e.isDefaultPrevented()?void 0:(d.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?d.one("bsTransitionEnd",b).emulateTransitionEnd(150):b(),this.hoverState=null,this)},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName;return a.extend({},"function"==typeof c.getBoundingClientRect?c.getBoundingClientRect():null,{scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop(),width:d?a(window).width():b.outerWidth(),height:d?a(window).height():b.outerHeight()},d?{top:0,left:0}:b.offset())},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.width&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),+function(a){function b(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b;(e||"destroy"!=b)&&(e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.2.0",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").empty()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},c.prototype.tip=function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip};var d=a.fn.popover;a.fn.popover=b,a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),+function(a){function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new c(this)),"string"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION="3.2.0",c.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a")[0],f=a.Event("show.bs.tab",{relatedTarget:e});if(b.trigger(f),!f.isDefaultPrevented()){var g=a(d);this.activate(b.closest("li"),c),this.activate(g,g.parent(),function(){b.trigger({type:"shown.bs.tab",relatedTarget:e})})}}},c.prototype.activate=function(b,c,d){function e(){f.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),b.addClass("active"),g?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active"),d&&d()}var f=c.find("> .active"),g=d&&a.support.transition&&f.hasClass("fade");g?f.one("bsTransitionEnd",e).emulateTransitionEnd(150):e(),f.removeClass("in")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this},a(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(c){c.preventDefault(),b.call(a(this),"show")})}(jQuery),+function(a){function b(b){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof b&&b;e||d.data("bs.affix",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};c.VERSION="3.2.0",c.RESET="affix affix-top affix-bottom",c.DEFAULTS={offset:0,target:window},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass("affix");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b=a(document).height(),d=this.$target.scrollTop(),e=this.$element.offset(),f=this.options.offset,g=f.top,h=f.bottom;"object"!=typeof f&&(h=g=f),"function"==typeof g&&(g=f.top(this.$element)),"function"==typeof h&&(h=f.bottom(this.$element));var i=null!=this.unpin&&d+this.unpin<=e.top?!1:null!=h&&e.top+this.$element.height()>=b-h?"bottom":null!=g&&g>=d?"top":!1;if(this.affixed!==i){null!=this.unpin&&this.$element.css("top","");var j="affix"+(i?"-"+i:""),k=a.Event(j+".bs.affix");this.$element.trigger(k),k.isDefaultPrevented()||(this.affixed=i,this.unpin="bottom"==i?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(j).trigger(a.Event(j.replace("affix","affixed"))),"bottom"==i&&this.$element.offset({top:b-this.$element.height()-h}))}}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},d.offsetBottom&&(d.offset.bottom=d.offsetBottom),d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery),+function(a){function b(b){return this.each(function(){var d=a(this),e=d.data("bs.collapse"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b);!e&&f.toggle&&"show"==b&&(b=!b),e||d.data("bs.collapse",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.transitioning=null,this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};c.VERSION="3.2.0",c.DEFAULTS={toggle:!0},c.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},c.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var c=a.Event("show.bs.collapse");if(this.$element.trigger(c),!c.isDefaultPrevented()){var d=this.$parent&&this.$parent.find("> .panel > .in");if(d&&d.length){var e=d.data("bs.collapse");if(e&&e.transitioning)return;b.call(d,"hide"),e||d.data("bs.collapse",null)}var f=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[f](0),this.transitioning=1;var g=function(){this.$element.removeClass("collapsing").addClass("collapse in")[f](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return g.call(this);var h=a.camelCase(["scroll",f].join("-"));this.$element.one("bsTransitionEnd",a.proxy(g,this)).emulateTransitionEnd(350)[f](this.$element[0][h])}}},c.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var d=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return a.support.transition?void this.$element[c](0).one("bsTransitionEnd",a.proxy(d,this)).emulateTransitionEnd(350):d.call(this)}}},c.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var d=a.fn.collapse;a.fn.collapse=b,a.fn.collapse.Constructor=c,a.fn.collapse.noConflict=function(){return a.fn.collapse=d,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(c){var d,e=a(this),f=e.attr("data-target")||c.preventDefault()||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""),g=a(f),h=g.data("bs.collapse"),i=h?"toggle":e.data(),j=e.attr("data-parent"),k=j&&a(j);h&&h.transitioning||(k&&k.find('[data-toggle="collapse"][data-parent="'+j+'"]').not(e).addClass("collapsed"),e[g.hasClass("in")?"addClass":"removeClass"]("collapsed")),b.call(g,i)})}(jQuery),+function(a){function b(c,d){var e=a.proxy(this.process,this);this.$body=a("body"),this.$scrollElement=a(a(c).is("body")?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",e),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.2.0",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b="offset",c=0;a.isWindow(this.$scrollElement[0])||(b="position",c=this.$scrollElement.scrollTop()),this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight();var d=this;this.$body.find(this.selector).map(function(){var d=a(this),e=d.data("target")||d.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[b]().top+c,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){d.offsets.push(this[0]),d.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<=e[0])return g!=(a=f[0])&&this.activate(a);for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(!e[a+1]||b<=e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,a(this.selector).parentsUntil(this.options.target,".active").removeClass("active");var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),+function(a){function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){return a(b.target).is(this)?b.handleObj.handler.apply(this,arguments):void 0}})})}($)}),define("app/document/File",["exoskeleton-master/exoskeleton","jquery/jquery","app/editor/UndoManager","app/document/StringUtils","app/document/Node","app/document/Node","app/editor/polyfill","app/window/FileHelper","app/editor/EditHelper","app/window/FileInfoPanel","app/editor/KeyMaster"],function(a,b,c){"use strict";function d(a){o.editor.stylize.putBookmark(null,o.editor.stylize.buildBookmark());var b=o.editor.styleBookmark.style,c=(o.editor.stylize.CONST.NormalBlockMap[b.block[0]],o.editor.stylize.CONST.NoInline.indexOf(b.block[0])>-1);c=c&&!b.inline.indexOf(i.inline_math),["Strong","Emphasis","Underline","Code","Strike","Hyperlink","Image","Clear Format","Inline Math","Highlight","Subscript","Superscript"].map(function(b){var d=a.getItem(b);d&&(d.setEnabled(!o.isLocked&&!c),d.setState(!1))});var d;(d=a.getItem("Inline Math"))&&d.setHidden(!o.option.enableInlineMath),(d=a.getItem("Highlight"))&&d.setHidden(!o.option.enableHighlight),(d=a.getItem("Subscript"))&&d.setHidden(!o.option.enableSubscript),(d=a.getItem("Superscript"))&&d.setHidden(!o.option.enableSuperscript),(o.editor.styleBookmark.style.inline||[]).map(function(b){var c=a.getItem(o.editor.stylize.CONST.StyleToNameMap[b]);c&&c.setState(!0)})}function e(a){function b(){try{return o.editor.getMarkElem(window.getSelection().getRangeAt(0).startContainer).attr("mdtype")==g.TYPE.meta_block}catch(a){}return!1}o.editor.stylize.putBookmark(null,o.editor.stylize.buildBookmark());var c=o.editor.styleBookmark.style,d=o.editor.stylize.CONST.NormalBlockMap[c.block[0]];["Heading 1","Heading 2","Heading 3","Heading 4","Heading 5","Heading 6","Paragraph","Decrease Heading Level","Increase Heading Level","Link Reference","Footnotes","YAML Front Matters","Table","Horizontal Line","Code Fences","Quote","Ordered List","Unordered List","Task List","Math Block","Table of Content"].map(function(b){var e=a.getItem(b);e&&(e.setEnabled(!o.isLocked&&c.block.length>0&&void 0!=d),e.setState(!1))}),b()?a.getItem("Paragraph").setEnabled(!0):["Paragraph","Quote","Ordered List","Unordered List","Task List"].map(function(b){a.getItem(b).setEnabled(!0)}),(o.editor.styleBookmark.style.block||[]).map(function(b){var c=a.getItem(o.editor.stylize.CONST.StyleToNameMap[b]);c&&c.setState(!0)})}var f=(a("exoskeleton-master/exoskeleton"),a("app/editor/UndoManager")),g=a("app/document/Node"),h=g.Node,i=g.TYPE,j=(a("app/editor/polyfill"),a("app/window/FileHelper")),k=a("app/window/FileInfoPanel"),l=j.ChangeCounter,m=(j.ChangeType,window.reqnode?reqnode("electron").remote:null),n=m?m.app:window.app,o={option:{indentSize:2,autoToggleEmojiAutoComplete:!0,enableInlineMath:!1,enableHighlight:!1,enableSubscript:!1,enableSuperscript:!1,copyMarkdownByDefault:!1,showLineNumbersForFence:!1,showOutlinePanelByDefault:!1,useRelativePathForImgInsert:!1,noSpellCheck:!1,autoCorrectMisspell:!1,noPairingMatch:!1,noPreWrap:!1,autoSave:!1,scrollWithCursor:!0,printPDFByPhantom:!1,headingStyle:0,ulStyle:0},readOption:function(){function a(a){return o.isMac?n.setting.getBool(a):o.isNode?n.setting.get(a):void 0}function b(a){return o.isMac?n.setting.getInteger(a):o.isNode?n.setting.get(a):void 0}function c(a,b){return void 0===a?b:a}(o.isMac||o.isNode)&&(o.option.autoToggleEmojiAutoComplete=c(a("trigger_emoji_autocomplete"),!0),o.option.enableInlineMath=c(a("enable_inline_math"),!0),o.option.enableHighlight=a("enable_highlight")||!1,o.option.enableSubscript=a("enable_subscript")||!1,o.option.enableSuperscript=a("enable_superscript")||!1,o.option.copyMarkdownByDefault=a("copy_markdown_by_default")||!1,o.option.showLineNumbersForFence=a("show_line_numbers_for_fence")||!1,o.option.noPairingMatch=a("no_pairing_match")||!1,o.option.headingStyle=b("heading_style")||0,o.option.ulStyle=b("ul_style")||0,o.isMac?(o.option.indentSize=n.setting.getInteger("indentSize")||2,o.option.showOutlinePanelByDefault=n.setting.getBool("show_outline_panel_by_default")||!1,o.option.useRelativePathForImgInsert=n.setting.getBool("use_relative_path_for_img")||!1):(n.setting.get("useCustomFontSize")&&(document.body.parentElement.style.fontSize=n.setting.get("customFontSize")+"px"),o.option.indentSize=n.setting.get("indentSize")||2,o.option.enableAutoSave=n.setting.get("enableAutoSave")||!1,o.option.noSpellCheck=n.setting.get("no_spell_check")||!1,o.option.autoCorrectMisspell=n.setting.get("auto_correct_misspell")||!1),o.option.showLineNumbersForFence&&$("#write").addClass("show-fences-line-number"))},bindMenu:function(){if(o.isMac){var a=n.menu.getItem("Edit").submenu();a.getItem("Undo").setCallback(function(){o.isLocked||(editor.undo.completeSnap(!0),o.editor.undo.undo(),o.freshMenu())}),a.getItem("Redo").setCallback(function(){o.isLocked||(editor.undo.completeSnap(!0),o.editor.undo.redo(),o.freshMenu())}),a.getItem("Select All").setEnabled(!0),a.getItem("Select Line/Sentence").setCallback(function(){o.editor.selection.selectLine()}),a.getItem("Select Line/Sentence").setEnabled(!0),a.getItem("Select Styled Scope").setCallback(function(){o.editor.selection.selectPhrase()}),a.getItem("Select Styled Scope").setEnabled(!0),a.getItem("Select Word").setCallback(function(){o.editor.selection.selectWord()}),a.getItem("Select Word").setEnabled(!0);var b=n.menu.getItem("Paragraph").submenu();b.getItem("Heading 1").setCallback(function(){o.editor.stylize.changeBlock("header1")}),b.getItem("Heading 2").setCallback(function(){o.editor.stylize.changeBlock("header2")}),b.getItem("Heading 3").setCallback(function(){o.editor.stylize.changeBlock("header3")}),b.getItem("Heading 4").setCallback(function(){o.editor.stylize.changeBlock("header4")}),b.getItem("Heading 5").setCallback(function(){o.editor.stylize.changeBlock("header5")}),b.getItem("Heading 6").setCallback(function(){o.editor.stylize.changeBlock("header6")}),b.getItem("Paragraph").setCallback(function(){o.editor.stylize.changeBlock(i.paragraph)}),b.getItem("Footnotes").setCallback(function(){o.editor.stylize.insertBlock(i.def_footnote)}),b.getItem("Link Reference").setCallback(function(){o.editor.stylize.insertBlock(i.def_link)}),b.getItem("YAML Front Matters").setCallback(function(){o.editor.stylize.insertMetaBlock()}),b.getItem("Horizontal Line").setCallback(function(){o.editor.stylize.insertBlock(i.hr)}),b.getItem("Table").setCallback(function(){o.editor.tableEdit.insertTable()}),b.getItem("Code Fences").setCallback(function(){o.editor.stylize.insertBlock(i.fences)}),b.getItem("Quote").setCallback(function(){o.editor.stylize.toggleIndent(i.blockquote)}),b.getItem("Ordered List").setCallback(function(){o.editor.stylize.toggleIndent("ol")}),b.getItem("Unordered List").setCallback(function(){o.editor.stylize.toggleIndent("ul")}),b.getItem("Task List").setCallback(function(){o.editor.stylize.toggleIndent("tasklist")}),b.getItem("Math Block").setCallback(function(){o.editor.stylize.insertBlock(i.math_block)}),b.getItem("Table of Content").setCallback(function(){o.editor.stylize.insertBlock(i.toc)});var c,f=n.menu.getItem("Format").submenu();f.getItem("Strong").setCallback(function(){o.editor.stylize.toggleStyle(i.strong)}),f.getItem("Emphasis").setCallback(function(){o.editor.stylize.toggleStyle(i.em)}),f.getItem("Underline").setCallback(function(){o.editor.stylize.toggleStyle(i.underline)}),f.getItem("Code").setCallback(function(){o.editor.stylize.toggleStyle(i.code)}),f.getItem("Strike").setCallback(function(){o.editor.stylize.toggleStyle(i.del)}),(c=f.getItem("Inline Math"))&&(c.setHidden(!o.option.enableInlineMath),c.setCallback(function(){o.editor.stylize.toggleStyle(i.inline_math)})),(c=f.getItem("Highlight"))&&(c.setHidden(!o.option.enableHighlight),c.setCallback(function(){o.editor.stylize.toggleStyle(i.highlight)})),(c=f.getItem("Subscript"))&&(c.setHidden(!o.option.enableSubscript),c.setCallback(function(){o.editor.stylize.toggleStyle(i.subscript)})),(c=f.getItem("Superscript"))&&(c.setHidden(!o.option.enableSuperscript),c.setCallback(function(){o.editor.stylize.toggleStyle(i.superscript)})),f.getItem("Hyperlink").setCallback(function(){o.editor.stylize.toggleStyle(i.link)
}),f.getItem("Image").setCallback(function(){o.editor.stylize.toggleStyle(i.image)}),f.getItem("Clear Format").setCallback(function(){o.editor.stylize.clearStyle()}),b.setMenuWillOpen(function(){e(b);var a=b.getItem("Heading 6");a.setHidden(!a.getState())}),b.setMenuDidClose(function(){b.getItem("Heading 6").setHidden(!1)}),f.setMenuWillOpen(function(){d(f)}),e(b),d(f),o.freshMenu(),$(o.editor.sessionStr).on("cursorChange",function(){e(b),d(f)})}else if(o.isNode){var c,g=m.Menu.getApplicationMenu(),b=g.getItem("Paragraph").submenu,f=g.getItem("Format").submenu;(c=f.getItem("Inline Math"))&&c.setHidden(!o.option.enableInlineMath),(c=f.getItem("Highlight"))&&c.setHidden(!o.option.enableHighlight),(c=f.getItem("Subscript"))&&c.setHidden(!o.option.enableSubscript),(c=f.getItem("Superscript"))&&c.setHidden(!o.option.enableSuperscript),$(o.editor.sessionStr).on("cursorChange",function(){e(b),d(f)})}},freshMenu:function(){var a,b=null,c=null,d=o.editor.sourceView.inSourceMode;if(o.isMac)a=n.menu,b=a.getItem("Edit").submenu(),c=a.getItem("View").submenu();else{if(!o.isNode)return;a=m.Menu.getApplicationMenu(),b=a.getItem("Edit").submenu,c=a.getItem("View").submenu}if(c&&(c.getItem("Source Code Mode").setState(o.editor.sourceView.inSourceMode),c.getItem("Source Code Mode").setEnabled(!o.isLocked),c.getItem("Always On Top").setState(o.isMac?n.window.isAlwaysOnTop():m.getCurrentWindow().isAlwaysOnTop()),c.getItem("Focus Mode").setState(o.isFocusMode),c.getItem("Typewriter Mode").setState(o.isTypeWriterMode)),b&&b.getItem("Copy As HTML Code").setEnabled(!d),d){a.getItem("Paragraph").setEnabled(!1),a.getItem("Format").setEnabled(!1);var e=o.editor.sourceView.cm.doc.historySize();b.getItem("Undo").setEnabled(!o.isLocked&&e.undo>0),b.getItem("Redo").setEnabled(!o.isLocked&&e.redo>0),o.isNode?window.ClientCommand.refreshViewMenu():c.getItem("Toggle Outline Panel").setEnabled(!1)}else a.getItem("Paragraph").setEnabled(!0),a.getItem("Format").setEnabled(!0),b.getItem("Undo").setEnabled(!o.isLocked&&o.editor.undo.hasUndo()),b.getItem("Redo").setEnabled(!o.isLocked&&o.editor.undo.hasRedo()),o.isNode?window.ClientCommand.refreshViewMenu():(c.getItem("Toggle Outline Panel").setEnabled(!0),c.getItem("Always On Top").setEnabled(!0)),!o.isLocked&&$(o.editor.sessionStr).trigger("cursorChange")},setEditor:function(a){o.isLocked=o.isMac&&n.document.isLocked(),o.editor=a,o.isMac||(o.changeCounter=new l)},getFilePathUseNode:function(){if(o.isNode)var a=m.getCurrentWindow(),b=m.app,c=b.getPropFrom("win2file",a.id);return c},getContent:function(){if(console.log("getContent"),o.isMac)return(n.document.content||"").replace(/\r/gi,"");if(o.isNode)try{var a,b=o.getFilePathUseNode();if(b){if(console.log("path: "+b),"darwin"==process.platform)return a=o.fs.readFileSync(b,"utf8"),k.setFileTitle(b,"utf8"),a;var c=reqnode("chardet").detectFileSync(b),d=reqnode("iconv-lite"),e=o.fs.readFileSync(b);return"ascii"==c.toLowerCase()&&(c="utf8"),d.encodingExists(c)||(c=c.replace(/-/g,"_")),c=d.encodingExists(c)?c:"utf8",a=d.decode(e,c).replace(/\r/gi,""),k.setFileTitle(b,c),a}k.setFileTitle()}catch(f){console.trace(f);var g=m.getCurrentWindow();return n.removeOpenedFile(g.id),k.setFileTitle(),""}return""},setContent:function(a){console.log("setContent"),o.isMac&&(n.document.content=a)},sync:function(){if(o.editor.sourceView.inSourceMode){var a=o.editor.sourceView.cm.getValue();o.isMac&&n.document.isDocumentEdited()&&(o.reloadContent(a,!0,!0),o.setContent(a))}else{o.editor.store(null,!0);try{o.editor.undo.completeSnap(!0),$(".md-focus").closest(".unholdable").length||o.editor.autoRemoveUnholdable()}catch(b){console.error(b.stack)}o.setContent(o.editor.getMarkdown())}},saveUseNode:function(a,b){o.sync();var c=o.getFilePathUseNode();if(o.isNode){var d,e=reqnode("iconv-lite"),f=o.fileEncode||"utf8";try{d=e.encode(o.editor.getMarkdown(),f)}catch(g){console.log("swith to utf8 encode"),d=e.encode(o.editor.getMarkdown(),"utf8"),o.fileEncode="utf8"}c&&!b?(o.fs.writeFile(c,d,function(a){o.resumeFileChangeTimestamp=new Date,a&&(alert("save file failed for\n"+a.stack),console.error(a.stack))}),o.updateChangeCount(o.ChangeType.NSChangeAutosaved),console.log("saved")):j.showSaveDialog(a)}},updateChangeCount:function(a){if(o.editor.sourceView.inSourceMode)return void(o.isMac?a==o.ChangeType.NSChangeAutosaved?(o.editor.sourceView.cm.save(),n.document.updateChangeCount(a)):n.document.isDocumentEdited()||n.document.updateChangeCount(o.ChangeType.NSChangeDone):(o.changeCounter.updateChangeCount(a),a===o.ChangeType.NSChangeAutosaved&&k.setLastModified(new Date)));if(o.isMac)n.menu.getItem("Edit").submenu().getItem("Undo").setEnabled(o.editor.undo.hasUndo()),n.menu.getItem("Edit").submenu().getItem("Redo").setEnabled(o.editor.undo.hasRedo()),n.document.updateChangeCount(a);else if(o.changeCounter.updateChangeCount(a),a===o.ChangeType.NSChangeAutosaved?(p=!1,k.setLastModified(new Date)):p=!0,o.isNode){var b=m.Menu.getApplicationMenu().getItem("Edit").submenu;b.getItem("Undo").setEnabled(o.editor.undo.hasUndo()),b.getItem("Redo").setEnabled(o.editor.undo.hasRedo()),releasePrintWin_()}},presentedItemChanged:function(){function a(a){var b;a?(o.isMac?b=n.document.getDataFromFile(!0):o.isNode&&(b=o.getContent()),o.reloadContent(b),o.updateChangeCount(o.ChangeType.NSChangeAutosaved),o.editor.sourceView.inSourceMode&&o.editor.sourceView.setValue(b)):o.updateChangeCount(o.ChangeType.NSChangeReadOtherContents)}console.log("presentedItemChanged"),o.isNode?o.fs.stat(o.filePath,function(b,c){if(c)if((o.resumeFileChangeTimestamp-0||0)+2e3<c.mtime-0){var d=o.changeCounter.curState?confirm(document.getElementById("reload_confirm").innerHTML.trim()):!0;a(d)}else console.debug("presentedItemChanged ignored")}):o.isMac&&(!n.document.lastEdited||confirm("File content is changed by external applications. Reload content ?"))&&n.document.refreshContentFromDisk()},reloadContent:function(a,b,c){a=c?a:(a||"").replace(/\r/gi,"");var d,e=f.makeEmptyCommand(),h=o.editor.sourceView.inSourceMode;if(h||(o.editor.store(),o.editor.undo.completeSnap(!0),e.undo.push(o.editor.selection.buildUndo())),o.editor.focusCid=null,e.undo.push(f.buildAllDoc(o.editor.nodeMap)),o.editor.nodeMap.reset(),setTimeout(function(){o.setContent(a)},c?500:0),d=g.Node.parseFrom(a,o.editor.nodeMap,{skips:{old_code:!1}}),d[1].map(function(a){a.set("attachTo",o.editor.nodeMap)}),h){if(o.editor.sourceView.renderedHTML=d[0],!c){var i=o.editor.sourceView.cm.getCursor();o.editor.sourceView.cm.setValue(a),o.editor.sourceView.cm.refresh(),o.editor.sourceView.cm.setCursor(i)}}else $(o.editor.sessionStr).html(d[0]);e.redo.push(f.buildAllDoc(o.editor.nodeMap)),o.editor.undo.register(e),h||(b?(o.editor.undo.clear(),o.updateChangeCount(o.ChangeType.NSChangeAutosaved)):window.getSelection().removeAllRanges(),setTimeout(function(){o.editor.refresh()},c?500:0))},copy:function(){o.editor.UserOp.copyHandler(o.editor)},"delete":function(){"TEXTAREA"!=document.activeElement.tagName&&"INPUT"!=document.activeElement.tagName&&o.editor.UserOp.backspaceHandler(o.editor,null,"Backspace")},deleteActive:function(){var a=o.editor.getMarkElem(),b=o.editor.findNodeByElem(a),c=o.editor.UserOp.backToParagraph(editor,b,!0);o.editor.undo.register(c)},cut:function(){return o.isLocked?!1:(o.editor.refocus(void 0,!0),o.editor.snapSelection=editor.selection.buildUndo(),o.editor.UserOp.copyHandler(editor,null),void o.editor.UserOp.backspaceHandler(editor,null,"delSelection"))},pasteAsPlainText:function(){$(o.editor.sessionStr).trigger("pasteAsPlainText")},lock:function(){o.isLocked=!0,o.freshLock()},unlock:function(){o.isLocked=!1,o.freshLock()},toggleSourceMode:function(){o.editor.sourceView.inSourceMode?o.editor.sourceView.hide():(o.editor.docMenu.hideOutline(),o.editor.sourceView.show()),o.freshMenu()},getExtraContext:function(){if(o.editor.sourceView.inSourceMode)return"sourceMode";try{if(h.isType(document.activeElement.tagName,"INPUT","TEXTAREA"))return"";var a=editor.selection.getRangy(),b=editor.getMarkElem(),c=$(".md-expand"),d=b.attr("mdtype"),e=/^file:\/\//;if(/^table/g.exec(d)&&!o.isLocked)return"table|seperator|insertParagraphBefore|insertParagraphAfter";if(h.isType(d,i.math_block))return"copyMathBlock|delete|seperator|insertParagraphBefore|insertParagraphAfter";if(h.isType(d,i.fences))return"delete-fences|insertParagraphBefore|insertParagraphAfter";if(b.attr("tabindex"))return"copy|delete|seperator|insertParagraphBefore|insertParagraphAfter";if(a&&$(a.commonAncestorContainer).closest(".md-inline-math").length)return"copyMathInline";if(h.isType(c.hasClass("md-img-loaded")&&c.attr("md-inline"),i.image)&&e.exec(c.find("img").attr("src")))return"revealInFinder";if(h.isType(c.hasClass("md-img-loaded")&&c.attr("md-inline"),i.refimg)&&e.exec(c.find("img").attr("src")))return"revealInFinder"}catch(f){}return""},getCurBlockType:function(){try{if(document.activeElement.hasAttribute&&document.activeElement.hasAttribute("tabindex"))return $(document.activeElement).closest("[mdtype]").attr("mdtype")||"";if(rangy.getSelection().rangeCount){var a=o.editor.selection.getRangy();return $(a.commonAncestorContainer).closest("[mdtype]").attr("mdtype")||""}}catch(b){}return""},freshLock:function(a){void 0!==a&&(o.isLocked=a);for(var b in o.editor.fences.queue)o.editor.fences.queue[b].readOnly=!0;$("input, selector, textarea").prop("readOnly",o.isLocked),o.isLocked?(o.editor.tableEdit.unfocusAll(),$("[contenteditable=true]").attr("locked","true").attr("contenteditable","false"),$(o.editor.sessionStr).blur(),$(".md-expand").removeClass("md-expand")):$("[locked='true']").attr("locked","false").attr("contenteditable","true"),$("#md-searchpanel input").prop("readOnly",!1),o.freshMenu()},setTheme:function(a){function b(){function a(a){var b=Number(a).toString(16).toUpperCase();return 1==b.length?"0"+b:b}function b(b,c,d){return"#"+a(b)+a(c)+a(d)}var c=window.getComputedStyle(document.body).backgroundColor.match(/\d+/gi);c.length&&(o.isMac?n.window.setBackgroundColor(c[0],c[1],c[2],c[3]||256):n.setting.put("backgroundColor",b(c[0],c[1],c[2])),o.colorBrightness=(299*c[0]+587*c[1]+114*c[2])/256e3)}var c=!0;o.colorBrightness=1;var d=function(){b(),o.editor.refresh(!0),o.isFocusMode&&o.editor.updateFocusMode(!1),o.isTypeWriterMode&&(o.editor.toggleTypeWriterMode(!1),o.editor.toggleTypeWriterMode(!0))};if(o.isMac){var e=document.getElementById("theme_css"),f=e.getAttribute("href"),g=n.setting.get("currentThemeFolder")||e.href.replace(/\/([a-z-]+)\.css$/i,"");if(a=a||n.setting.get("theme")||"github",a=a.replace(/([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase(),n.setting.getBool("allow_custom_fontsize")){var h=(n.setting.getDouble("custom_fontsize")||16)+"";document.body.parentElement.style.fontSize=h+"px"}f!=a&&$.get(g+"/"+a+".css",function(){e.setAttribute("href",g+"/"+a+".css")}).then(function(){setTimeout(d,20)}),c&&(document.querySelector("#base_user_css").setAttribute("href",g+"/base.user.css"),document.querySelector("#theme_user_css").setAttribute("href",g+"/"+a+".user.css"))}else if(o.isNode){var i=n.setting.getCurrentTheme(),j=n.getPath("userData"),k=o.isWin?"\\":"/";$("#theme_css").attr("href",[j,"themes",i].join(k)),setTimeout(d,20),c&&(document.querySelector("#base_user_css").setAttribute("href",[j,"themes","base.user.css"].join(k)),document.querySelector("#theme_user_css").setAttribute("href",[j,"themes",i.replace(/\.css$/,".user.css")].join(k)))}},getFileName:function(){if(o.isMac){var a=n.document.currentFilePath(),b=n.document.currentFolderPath(),c=void 0;return a&&b&&(c=a.replace(b,"").replace(/^\//g,"").replace(/\.[^.]+$/,"")),c}return o.fileName},getSuggestedFileName:function(){var a,b=(o.editor.nodeMap.blocks,""),c="",d=null;try{a=o.editor.docMenu.getMetaNode(),a&&(c=o.editor.docMenu.getValueInMeta("date",a)||"",c=(/\d+-\d+-\d+/g.exec(c)||/\d+\/\d+\/\d+/g.exec(c)||[""])[0],b=o.editor.docMenu.getValueInMeta("title",a)||"",b=b.replace(/(^\s*("|'))|(("|')\s*)/gi,"").replace(/\s+(.)/gi,"-$1").toLocaleString(),b=[c,b].join("-")),(0==b.trim().length||"-"==b)&&(d=document.querySelector("#write h1, #write h2, #write h3"),d?b=d.textContent.replace(/\r?\n/gi,""):(b=$("[cid]:not(.md-meta-block)")[0],b=b?b.textContent:"",b=b.substr(0,b.indexOf("\n"))||b,b.length>140&&(b=b.substr(0,b.indexOf("."))||b),b.length>140&&(b=b.substr(0,140))),b.replace(/\u00A0|\n/g," "))}catch(e){}return 0==b.trim().length&&(b="Untitled"),b}},p=!1,q=function(){o.editor.brush.timerID&&(p&&(p=!1,k.saveToRecover(o.editor.getMarkdown())),o.option.enableAutoSave&&o.fileHasModified&&!o.changeCounter.curState&&o.filePath&&o.saveUseNode())};o.ChangeType=j.ChangeType,o.isMac=void 0!==window.app,o.isNode=void 0!==window.reqnode,o.isNodeHtml=window.isOnWindowHtml,o.isWin=o.isNode&&"win32"==process.platform,o.FileInfoPanel=k,o.autoSaveWorker=q,o.isNode&&(o.fs=reqnode("fs"),setInterval(q,3e5)),c.exports=o}),define("exoskeleton-master/exoskeleton",["jquery/jquery"],function(a,b){"use strict";var c,d,e=window,f=a("jquery/jquery"),g=e.Backbone,h=e.Exoskeleton,i=b.utils=c=c||{};b.$=f;var j=[],k=(j.push,j.slice),l={}.toString;b.noConflict=function(){return e.Backbone=g,e.Exoskeleton=h,this},b.extend=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};var m=function(){throw new Error('A "url" property or function must be specified')},n=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}},o=function(a){return"function"==typeof c[a]};i.result=function(a,b){var c=a?a[b]:void 0;return"function"==typeof c?a[b]():c},i.defaults=function(a){return k.call(arguments,1).forEach(function(b){for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},i.extend=function(a){return k.call(arguments,1).forEach(function(b){for(var c in b)a[c]=b[c]}),a},i.clone=function(a){return!a instanceof Object?a:Array.isArray(a)?a.slice():i.extend({},a)};var p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};i.escape=function(a){return null==a?"":String(a).replace(/[&<>"']/g,function(a){return p[a]})},i.sortBy=function(a,b,c){var d="function"==typeof b?b:function(a){return a[b]};return a.map(function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}).map(function(a){return a.value})};var q=0;i.uniqueId=function(a){var b=++q+"";return a?a+b:b},i.has=function(a,b){return Object.hasOwnProperty.call(a,b)};var r=function(a,b,d,e){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;var f=l.call(a);if(f!=l.call(b))return!1;switch(f){case"[object String]":return a==String(b);case"[object Number]":return a!==+a?b!==+b:0===a?1/a===1/b:a===+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var g=d.length;g--;)if(d[g]==a)return e[g]==b;var h=a.constructor,i=b.constructor;if(h!==i&&!("function"==typeof h&&h instanceof h&&"function"==typeof i&&i instanceof i))return!1;d.push(a),e.push(b);var j=0,k=!0;if("[object Array]"===f){if(j=a.length,k=j===b.length)for(;j--&&(k=r(a[j],b[j],d,e)););}else{for(var m in a)if(c.has(a,m)&&(j++,!(k=c.has(b,m)&&r(a[m],b[m],d,e))))break;if(k){for(m in b)if(c.has(b,m)&&!j--)break;k=!j}}return d.pop(),e.pop(),k};i.isEqual=function(a,b){return r(a,b,[],[])};var s=b.Events={on:function(a,b,c){if(!u(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!u(this,"once",a,[b,c])||!b)return this;var d,e=this,f=function(){d||(d=!0,e.off(a,f),b.apply(this,arguments))};return f._callback=b,this.on(a,f,c)},off:function(a,b,c){var d,e,f,g,h,i,j,k;if(!this._events||!u(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events=void 0,this;for(g=a?[a]:Object.keys(this._events),h=0,i=g.length;i>h;h++)if(a=g[h],f=this._events[a]){if(this._events[a]=d=[],b||c)for(j=0,k=f.length;k>j;j++)e=f[j],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=k.call(arguments,1);if(!u(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&v(c,b),d&&v(d,arguments),this},stopListening:function(a,b,c){var d=this._listeningTo;if(!d)return this;var e=!b&&!c;c||"object"!=typeof b||(c=this),a&&((d={})[a._listenId]=a);for(var f in d)a=d[f],a.off(b,c,this),(e||!Object.keys(a._events).length)&&delete this._listeningTo[f];return this}},t=/\s+/,u=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(t.test(c)){for(var f=c.split(t),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},v=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},w={listenTo:"on",listenToOnce:"once"};Object.keys(w).forEach(function(a){var b=w[a];s[a]=function(a,d,e){var f=this._listeningTo||(this._listeningTo={}),g=a._listenId||(a._listenId=c.uniqueId("l"));return f[g]=a,e||"object"!=typeof d||(e=this),a[b](d,e,this),this}}),s.bind=s.on,s.unbind=s.off,c.extend(b,s);var x=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId("c"),this.attributes=Object.create(null),b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed=Object.create(null),this.initialize.apply(this,arguments)};if(c.extend(x.prototype,s,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return c.extend({},this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,d){var e,f,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(f=a,d=b):(f={})[a]=b,d||(d={}),!this._validate(f,d))return!1;g=d.unset,i=d.broadcast,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=c.extend(Object.create(null),this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in f&&(this.id=f[this.idAttribute]);for(e in f)b=f[e],c.isEqual(l[e],b)||h.push(e),c.isEqual(k[e],b)?delete this.changed[e]:this.changed[e]=b,g?delete l[e]:l[e]=b;if(i){h.length&&(this._pending=d);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],d)}if(j)return this;if(i)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!!Object.keys(this.changed).length:c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.extend(Object.create(null),this.changed):!1;var b,d=!1,e=this._changing?this._previousAttributes:this.attributes;for(var f in a)c.isEqual(e[f],b=a[f])||((d||(d={}))[f]=b);return d},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.extend(Object.create(null),this._previousAttributes)},fetch:function(a){a=a?c.extend({},a):{},void 0===a.parse&&(a.parse=!0);var b=this,d=a.success;return a.success=function(c){return b.set(b.parse(c,a),a)?(d&&d(b,c,a),void b.trigger("sync",b,c,a)):!1},n(this,a),this.sync("read",this,a)},save:function(a,b,d){var e,f,g,h=this.attributes;if(null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0},d),e&&!d.wait){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;e&&d.wait&&(this.attributes=c.extend(Object.create(null),h,e)),void 0===d.parse&&(d.parse=!0);var i=this,j=d.success;return d.success=function(a){i.attributes=h;var b=i.parse(a,d);return d.wait&&(b=c.extend(e||{},b)),b&&"object"==typeof b&&!i.set(b,d)?!1:(j&&j(i,a,d),void i.trigger("sync",i,a,d))},n(this,d),f=this.isNew()?"create":d.patch?"patch":"update","patch"===f&&(d.attrs=e),g=this.sync(f,this,d),e&&d.wait&&(this.attributes=h),g},destroy:function(a){a=a?c.extend({},a):{};var b=this,d=a.success,e=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(c){(a.wait||b.isNew())&&e(),d&&d(b,c,a),b.isNew()||b.trigger("sync",b,c,a)},this.isNew())return a.success(),!1;n(this,a);var f=this.sync("delete",this,a);return a.wait||e(),f},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||m();return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend(Object.create(null),this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return d?(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1):!0}}),c.keys){var y=["keys","values","pairs","invert","pick","omit"];y.filter(o).forEach(function(a){x.prototype[a]=function(){var b=k.call(arguments);return b.unshift(this.attributes),c[a].apply(c,b)}})}var z=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({broadcast:!0},b))},A={add:!0,remove:!0,merge:!0},B={add:!0,remove:!1};if(c.extend(z.prototype,s,{model:"undefined"==typeof x?null:x,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,B))},remove:function(a,b){var c=!Array.isArray(a);a=c?[a]:a.slice(),b||(b={});var d,e,f,g;for(d=0,e=a.length;e>d;d++)g=a[d]=this.get(a[d]),g&&(delete this._byId[g.id],delete this._byId[g.cid],f=this.indexOf(g),this.models.splice(f,1),this.length--,b.broadcast&&(b.index=f,g.trigger("remove",g,this,b)),this._removeReference(g,b));return c?a[0]:a},set:function(a,b){b=c.defaults({},b,A),b.parse&&(a=this.parse(a,b));var d=!Array.isArray(a);a=d?a?[a]:[]:a.slice();var e,f,g,h,i,j,k,l=b.at,m=this.model,n=this.comparator&&null==l&&b.sort!==!1,o="string"==typeof this.comparator?this.comparator:null,p=[],q=[],r={},s=b.add,t=b.merge,u=b.remove,v=!n&&s&&u?[]:!1;for(e=0,f=a.length;f>e;e++){if(i=a[e]||{},g=i instanceof x?h=i:i[m.prototype.idAttribute||"id"],j=this.get(g))u&&(r[j.cid]=!0),t&&(i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b)),j.set(i,b),n&&!k&&j.hasChanged(o)&&(k=!0)),a[e]=j;else if(s){if(h=a[e]=this._prepareModel(i,b),!h)continue;p.push(h),this._addReference(h,b)}h=j||h,!v||!h.isNew()&&r[h.id]||v.push(h),r[h.id]=!0}if(u){for(e=0,f=this.length;f>e;++e)r[(h=this.models[e]).cid]||q.push(h);q.length&&this.remove(q,b)}if(p.length||v&&v.length)if(n&&(k=!0),this.length+=p.length,null!=l)for(e=0,f=p.length;f>e;e++)this.models.splice(l+e,0,p[e]);else{v&&(this.models.length=0);var w=v||p;for(e=0,f=w.length;f>e;e++)this.models.push(w[e])}if(k&&this.sort({broadcast:!1}),b.broadcast){for(e=0,f=p.length;f>e;e++)(h=p[e]).trigger("add",h,this,b);(k||v&&v.length)&&this.trigger("sort",this,b)}return d?a[0]:a},reset:function(a,b){b||(b={});for(var d=0,e=this.models.length;e>d;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({broadcast:!1},b)),b.broadcast&&this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return k.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,b){return a&&Object.keys(a).length?this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0}):b?void 0:[]},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),"string"==typeof this.comparator||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(this.comparator.bind(this)),a.broadcast&&this.trigger("sort",this,a),this},pluck:function(a){return this.models.map(function(b){return b.get(a)})},fetch:function(a){a=a?c.extend({},a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b(d,c,a),d.trigger("sync",d,c,a)},n(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?c.extend({},b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var d=this,e=b.success;return b.success=function(a,c){b.wait&&d.add(a,b),e&&e(a,c,b)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId=Object.create(null)},_prepareModel:function(a,b){if(a instanceof x)return a;b=c.extend({},b),b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_addReference:function(a){this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a),a.collection||(a.collection=this),a.on("all",this._onModelEvent,this)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))},toArray:function(){return this.models||[]}}),o("each")){var C=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];C.filter(o).forEach(function(a){z.prototype[a]=function(){var b=k.call(arguments);return b.unshift(this.models),c[a].apply(c,b)}});var D=["groupBy","countBy","sortBy"];D.filter(o).forEach(function(a){z.prototype[a]=function(b,d){var e="function"==typeof b?b:function(a){return a.get(b)};return c[a](this.models,e,d)}})}else["forEach","map","filter","some","every","reduce","reduceRight","indexOf","lastIndexOf"].forEach(function(a){z.prototype[a]=function(b,c){return this.models[a](b,c)}}),z.prototype.find=function(a,b){var c;return this.some(function(d,e,f){return a.call(b,d,e,f)?(c=d,!0):void 0}),c},["sortBy"].forEach(function(a){z.prototype[a]=function(b,d){var e="function"==typeof b?b:function(a){return a.get(b)};return c[a](this.models,e,d)}});return["Model","Collection","Router","View","History"].forEach(function(a){var c=b[a];c&&(c.extend=b.extend)}),c.extend(b,s),d&&(b.history=new d),b}),define("app/editor/UndoManager",["exoskeleton-master/exoskeleton","jquery/jquery","app/document/StringUtils","app/document/Node"],function(a,b,c){"use strict";var d=a("exoskeleton-master/exoskeleton"),e=(a("app/document/StringUtils"),a("app/document/Node")),f=e.Node,g=e.TYPE,h=d.Model.extend({commandStack:void 0,index:void 0,undoManagerContext:!1,stackSize:void 0,UndoManager:h,initialize:function(a){this.commandStack=[],this.set({index:-1,stackSize:200}),this.editor=a,this.UndoManager=h},callCommand:function(a,b){var c=!1;try{if(b)for(var d=a.undo.length-1;d>-1;d--)c=this.exeCommand(a.undo[d],a.redo)||c;else for(var d=0;d<a.redo.length;d++)c=this.exeCommand(a.redo[d],a.undo)||c}catch(e){console.error(e.stack)}return c}});h.prototype.register=function(a,b){!this.undoManagerContext&&a&&(this.commandStack.splice(this.get("index")+1,this.commandStack.length-this.get("index")),this.commandStack.length>this.get("stackSize")&&this.commandStack.splice(0,this.commandStack.length-this.get("stackSize")),this.commandStack.push(a),this.set({index:this.commandStack.length-1}),b||File.updateChangeCount(File.ChangeType.NSChangeDone))},h.prototype.undo=function(a){if(this.editor.sourceView.inSourceMode)return this.editor.sourceView.cm.undo(),a&&a.preventDefault();if(this.completeSnap(!0),"INPUT"==document.activeElement.tagName&&a&&"checkbox"!=document.activeElement.getAttribute("type")){var b=document.activeElement,c=b.value,d=this;return setTimeout(function(){c==b.value&&d.undo()},50),!0}a&&a.preventDefault();var e=this.commandStack[this.get("index")];if(e){this.editor.brush.pause();var f=this.callCommand(e,!0);this.set({index:this.get("index")-1}),File.updateChangeCount(File.ChangeType.NSChangeUndone),f&&this.editor.refresh(),this.editor.brush.resume(!0),this.editor.refocus(void 0,null,null,!0)}},h.prototype.redo=function(a){if(this.editor.sourceView.inSourceMode)return this.editor.sourceView.cm.redo(),a&&a.preventDefault();if("INPUT"==document.activeElement.tagName&&a&&"checkbox"!=document.activeElement.getAttribute("type")){var b=document.activeElement,c=b.value,d=this;return setTimeout(function(){c==b.value&&d.redo()},50),!0}if(a&&a.preventDefault(),!this.snapFlag){var e=this.commandStack[this.get("index")+1];if(e){var f=this.callCommand(e,!1);this.set({index:this.get("index")+1}),File.updateChangeCount(File.ChangeType.NSChangeRedone),f&&this.editor.refresh(),this.editor.brush.brushQueue(),this.editor.refocus(void 0,null,null,!0)}}},h.prototype.clear=function(){this.initialize(this.editor)},h.prototype.hasUndo=function(){return!(!this.snapFlag&&-1===this.get("index"))},h.prototype.hasRedo=function(){return!(this.snapFlag||!(this.get("index")<this.commandStack.length-1))},h.prototype.setCallback=function(a){this.callback=a},h.prototype.initCmd=function(){this.cmdArr=new Array},h.prototype.addCmd=function(a){cmdArr.push(a)},h.prototype.exeCommand=function(a,b){function c(b,c){c=c||[],b=b||h.nodeMap,a.json.map(function(a){c.push(f.readFromJson(a,b,!0))}),a.json.map(function(a){var b=h.getNode(a.id);b.set("before",h.getNode(a.relation.before_id)),b.set("after",h.getNode(a.relation.after_id)),b.set("parent",h.getNode(a.relation.parent_id))})}var d,h=this.editor,i=!1;if(a){switch(a.type){case"reload":h.nodeMap.reset(h),c(),h.brush.queue=[],i=!0,$(h.sessionStr).html(e.NodeCollectionUtils.toHTML(h.nodeMap.blocks)),window.getSelection().removeAllRanges();break;case"reset":File.reloadContent(a.content,!0);break;case"replace":var j=h.getNode(a.id);if(!j)return console.error(a.id+" not found in  replace");j.get("type")==j.TYPE.fences&&h.fences.beforeDeleteFences(j,b),j.get("type")==j.TYPE.math_block&&h.mathBlock.beforeDeleteFences(j,b),a.id!=a.json.id?(h.getNode(a.id).remove(),j=f.readFromJson(a.json,h.nodeMap)):j.readFromJson(a.json,h.nodeMap),h.findElemById(a.id).replaceWith(j.toHTML()),$(h.sessionStr).attr("contenteditable",!0),i=!0,h.brush.restart(),h.brush.addToQueue(j.id,!0);break;case"insert":var k=h.nodeMap,l=new Array,m=[];if(c(k,l),a.after&&(m=h.findElemById(a.after),m.before(e.NodeCollectionUtils.toHTML(l))),!m.length&&a.before&&(m=h.findElemById(a.before),m.after(e.NodeCollectionUtils.toHTML(l))),!m.length){var n=l[0].get("parent");
n?h.findElemById(n.id).replaceWith(n.toHTML()):0===$(h.sessionStr).children().length&&$(h.sessionStr).html(e.NodeCollectionUtils.toHTML(l))}i=!0;break;case"remove":a.idArray.map(function(a){var c=h.getNode(a);if(c){c.get("type")==c.TYPE.fences&&h.fences.beforeDeleteFences(c,b),c.get("type")==c.TYPE.math_block&&h.mathBlock.beforeDeleteFences(c,b),c.remove(),d=h.findElemById(a);var e=d.parent("li");e.length&&e.css("margin","0.1px"),h.findElemById(a).remove(),e.length&&e.css("margin","")}}),i=!0;break;case"text":d=h.findElemById(a.id),h.getNode(a.id).set("text",a.text),a.html&&d.html(a.html),i=!1,("def-footnote"==d.attr("md-type")||"def-link"==d.attr("md-type"))&&(i=!0),h.brush.addToQueue(a.id,!0);break;case"cursor":try{if(void 0==a.end&&(a.end=a.start),void 0==a.startId&&void 0==a.id&&(a.id=a.cid),a.focus)return setTimeout(function(){h.findElemById(a.id).children("[tabindex]").andSelf("[tabindex]").focus()},100),h.findElemById(a.id).children("[tabindex]").andSelf("[tabindex]").focus(),!1;if(a.id||a.startId==a.endId){if(a.id=a.id||a.startId,d=h.findElemById(a.id),d.attr("mdtype")==g.fences){h.fences.refreshEditor();var o=h.fences.getCm(a.id);o.focus(),a.pos?(o.setCursor(a.pos),a.selections&&o.setSelections(a.selections)):a.start>-1?(o.setCursor(o.posFromIndex(a.start)),a.end>-1&&o.setSelection(o.posFromIndex(a.start),o.posFromIndex(a.end))):h.selection.jumpIntoElemEnd(d)}else if(d.length&&void 0!==a.end){var p=d.text().length;a.start>p&&(a.start=p),a.end>p&&(a.end=p),h.selection.restoreSelection(d[0],{start:a.start,end:a.end})}else window.getSelection().removeAllRanges();b||h.refocus(a.id)}else if(a.startId)try{var q=h.selection.restoreEdge(h.findElemById(a.startId),a.start);q=h.selection.restoreEdge(h.findElemById(a.endId),a.end,!0,q),h.selection.setRange(q)}catch(r){console.log(r.stack)}File.isTypeWriterMode&&h.selection.scrollAdjust(),i=!1}catch(r){throw console.log(r.stack),r}break;case"fences":var s,j=h.getNode(a.id);f.isType(j,j.TYPE.math_block)?(h.mathBlock.startEditing(a.id),s=h.mathBlock.currentCm):s=h.fences.getCm(a.id),s.focus(),"undo"==a.cmd&&s.undo(),"redo"==a.cmd&&s.redo(),i=!1;break;case"fences-pos":var s,j=h.getNode(a.id);f.isType(j,j.TYPE.math_block)?(h.mathBlock.startEditing(a.id),s=h.mathBlock.currentCm):(h.fences.refreshEditor(),s=h.fences.getCm(a.id)),s.focus(),s.setCursor(a.pos),i=!1;break;case"attr":a.value=a.value||!1;var j=this.editor.getNode(a.id);j.attr(a.key,a.value,this.editor,!0),h.brush.addToQueue(a.id,!0);break;case"wrap":var t={};t.type="insert",t.json=[a.json],a.json.children.map(function(c,d){var e=h.getNode(c.id);0===d?t.before=e.get("before")?e.get("before").id:null:d===a.json.children.length-1&&(t.after=e.get("after")?e.get("after").id:null),e&&(e.get("type")==e.TYPE.fences&&(i=!0,h.fences.beforeDeleteFences(e,b)),e.get("type")==e.TYPE.math_block&&(i=!0,h.mathBlock.beforeDeleteFences(e,b)),e.remove(),h.findElemById(c.id).remove())}),this.exeCommand(t,b);break;case"unwrap":var j=h.getNode(a.id),u=j.unwrap();!a.skipHTML&&h.findElemById(a.id).replaceWith(e.NodeCollectionUtils.toHTML(u)),i=!0;break;case"scroll":h.selection.scrollAdjust(a.id?h.findElemById(a.id):void 0,a.marginTop);break;default:return!1}return i}},h.prototype.clearSnap=function(){this.snapNode={},this.snapFlag=0,this.snapDate=0,this.snapSelection=null},h.prototype.completeSnap=function(a,b){if(a&&!this.snapFlag||!this.snapNode||!this.snapNode.id)return this.snapFlag=0;var c=h.makeEmptyCommand();if(!f.isType(this.snapNode.content.type,g.fences,g.math_block))return this.snapSelection&&c.undo.push(this.snapSelection),c.undo.push({type:"replace",id:this.snapNode.id,json:this.snapNode}),this.buildSnap(this.snapNode.id,0),c.redo.push({type:"replace",id:this.snapNode.id,json:this.snapNode}),this.snapSelection&&c.redo.push(this.snapSelection),b||this.register(c,!0),c},h.prototype.buildSnap=function(a,b,c){this.snapSelection=this.editor.selection.buildUndo();var d=this.editor.getNode(a);return d?(void 0!==c&&null!==c?d.set("text",c):this.editor.store(a,!0),this.snapNode=d.storeToJson(),this.snapFlag=b||0,void(this.snapDate=(new Date).getTime())):this.clearSnap()};var i=null;h.prototype.snap=function(a,b,c,d){var e=this;!a&&this.snapNode&&(a=this.snapNode.id),a||this.clearSnap(),this.snapFlag?(this.snapNode.id!=a?(this.completeSnap(),this.buildSnap(a,b,c),File.updateChangeCount(File.ChangeType.NSChangeDone)):b!=this.snapFlag||2==this.snapFlag?(this.completeSnap(),File.updateChangeCount(File.ChangeType.NSChangeDone)):b&&this.snapDate&&(new Date).getTime()-this.snapDate>1e3&&(this.completeSnap(),File.updateChangeCount(File.ChangeType.NSChangeDone)),this.snapFlag=b):b&&(this.buildSnap(a,b,c),File.updateChangeCount(File.ChangeType.NSChangeDone)),b&&!d&&(i&&clearTimeout(i),-2==b?(this.editor.selection.scrollAdjust(),i=null):i=setTimeout(function(){e.editor.findElemById(a).trigger("inline-input"),i=null},50))},h.prototype.buildReplaceUndo=function(a){return h.buildReplaceUndo(a)},h.buildReplaceUndo=function(a,b){if(!a)throw new Error("empty node");return{type:"replace",id:b?b:a.id,json:a.storeToJson()}},h.addUndoForInsert=function(a,b,c,d){b&&(a.redo.push({type:"insert",after:d?d.id:b.get("after")?b.get("after").id:null,before:c?c.id:b.get("before")?b.get("before").id:null,json:[b.storeToJson()]}),a.undo.push({type:"remove",idArray:[b.id]}))},h.addUndoForWrap=function(a,b,c){b&&(a.redo.push({type:"wrap",json:b.storeToJson(),skipHTML:c}),a.undo.push({type:"unwrap",id:b.id,skipHTML:c}))},h.addUndoForUnwrap=function(a,b){b&&(a.undo.push({type:"wrap",json:b.storeToJson()}),a.redo.push({type:"unwrap",id:b.id}))},h.buildAllDoc=function(a,b){var c=a.blocks.at(0),d=[];for(c=c.getLastBrother(!0);c;)d.push(c.storeToJson()),b&&b.push(c),c=c.get("after");return{type:"reload",json:d}},h.addUndoForInsertArray=function(a,b,c,d){b&&0!=b.length&&(a.redo.push({type:"insert",after:d?d.id:b[b.length-1].get("after")?b[b.length-1].get("after").id:null,before:c?c.id:b[0].get("before")?b[0].get("before").id:null,json:b.reduce(function(a,b){return a.push(b.storeToJson()),a},[])}),a.undo.push({type:"remove",idArray:b.reduce(function(a,b){return a.push(b.id),a},[])}))},h.addUndoForRemoveArray=function(a,b,c,d){b&&0!=b.length&&(a.undo.push({type:"insert",after:d?d.id:b[b.length-1].get("after")?b[b.length-1].get("after").id:null,before:c?c.id:b[0].get("before")?b[0].get("before").id:null,json:b.reduce(function(a,b){return a.push(b.storeToJson()),a},[])}),a.redo.push({type:"remove",idArray:b.reduce(function(a,b){return a.push(b.id),a},[])}))},h.addUndoForRemove=function(a,b,c,d){a.undo.push({type:"insert",after:d?d.id:b.get("after")?b.get("after").id:null,before:c?c.id:b.get("before")?b.get("before").id:null,json:[b.storeToJson()]}),a.redo.push({type:"remove",idArray:[b.id]})},h.makeEmptyCommand=function(a){var b={};return b.undo=[],b.redo=[],a&&b.undo.push(a),b},h.isEmptyCommand=function(a){return!(a&&a.undo&&a.redo&&(a.undo.length||a.redo.length))},h.append=function(a,b){return b&&(a.undo=a.undo.concat(b.undo),a.redo=a.redo.concat(b.redo)),a},f.storeToJson=function(a){var b={};return b.content={},b.relation={},b.children=new Array,f.property.map(function(c){var d=a.get(c);void 0!==d&&null!==d&&(b.content[c]=d instanceof Array?$.merge([],d):typeof d==Object?$.extend({},d):d)}),b.relation.before_id=a.get("before")?a.get("before").id:null,b.relation.after_id=a.get("after")?a.get("after").id:null,b.relation.parent_id=a.get("parent")?a.get("parent").id:null,b.is_top=a.get("attachTo")?!0:!1,a.get("children").toArray().map(function(a){var c=f.storeToJson(a);b.children.push(c)}),b.id=a.id,b},f.readFromJson=function(a,b,c){function d(a){var c=b.allNodes.get(a);return c&&!c.attributes&&(console.assert(null,"node deleted"),c.attributes={}),c}var e=d(a.id)||new f({id:a.id});return e.set("in",b),a.is_top&&e.set("attachTo",b),e.set(a.content),e.clearChildren(!0),a.relation.parent_id||e.set("attachTo",b),a.children.map(function(a){f.readFromJson(a,b,!0)}),a.children.map(function(a){var c=b.get("allNodes").get(a.id);c.set("before",b.get("allNodes").get(a.relation.before_id)),c.set("after",b.get("allNodes").get(a.relation.after_id)),c.set("parent",e)}),c||(e.set("before",b.get("allNodes").get(a.relation.before_id)),e.set("after",b.get("allNodes").get(a.relation.after_id)),e.set("parent",b.get("allNodes").get(a.relation.parent_id))),e},f.prototype.storeToJson=function(){return f.storeToJson(this)},f.prototype.readFromJson=function(a,b){this.clearChildren();var c=f.readFromJson(a,b||this.get("in"));this.replaceWith(c)},c.exports=h}),define("app/document/StringUtils",[],function(a,b){"use strict";var c=/^[\s\u200b]+$/,d=function(a){return null==a||void 0==a||""===a||""===a},e=function(a){return!d(a)},f=function(a){return null==a||void 0==a||""===a||c.exec(a)},g=function(a,b,c){return null==a||void 0==a||""==a?"":"string"!=typeof a&&"number"!=typeof a?a:(a=(a+"").replace(c?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),b&&(a=k(a)),a)},h=function(a,b,c){var a=g(a,b,c);return File.option.noPreWrap&&(a=a.replace(/(^ )|( $)/g,"").replace(/  /g," ")),a},i=function(a){return null==a||void 0==a||""==a?"":(a+"").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'")},j=function(a){return a.replace(/(^ *)((#+)|(\+ +)|(\- +)|(\* +)|(\d+\. +)|(```|~~~)|(>)|(-+\s*$))/,"$1\\$2")},k=function(a){return a.replace(/[[\]~`*\\$<]/g,"\\$&").replace(/(\b_)|(_(?=\s))/g,"\\$&")},l=function(a,b,c){return a=a||"",b<a.length?a.substring(0,b)+c+a.substring(b):a+c},m=/(([\w-_]+:\/\/)|(www\.)|\w*\/)[\w-.\/?%&=:@]*/i,n=/(([\w-_]+:\/\/)|(www\.)|\w*\/)?[\w-.\/?%&=:@]+(\.jpe?g|png|gif|webm|svg)/i,o=function(a){return!!m.exec(a)},p=function(a){return!!n.exec(a)},q=function(a,b,c){return a.replace(new RegExp("\\b"+b+"\\b","gi"),c)},r=function(a,b){return a.split(new RegExp("\\b"+b+"\\b","gi"))},s=function(a){if(a&&a.length){for(var b=0,c=a.length-1;0===a[b].trim().length&&c>b;)b++;for(;c>b&&0===a[c].trim().length;)c--;return a.slice(b,c+1)}return a},t=function(a,b){var c=a.getHours()+"",d=a.getMinutes()+"",e=a.getSeconds()+"";return(c.length<2?"0":"")+c+":"+(d.length<2?"0":"")+d+(b?(e.length<2?"0":"")+e:"")},u=function(a){return a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+"  "+t(a)},v=function(a){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()},w=function(a){return a.replace(/(?:^|_|-)(\w)/g,function(a,b,c){return 0==c?b.toLowerCase():b.toUpperCase()})},x=function(a,b){if(File.isNode)return reqnode("path").relative(a,b);a=a.replace(/\\\\/g,"/"),b=b.replace(/\\\\/g,"/");var c,d=b.split(/\//g),e=a.split(/\//g),f=d.pop(),g="";for(""==e.last()&&e.pop(),""==e[0]&&e.shift(),""==d[0]&&d.shift(),c=d.join("/");0!==c.indexOf(e.join("/"));)e.pop(),g+="../";var h=d.slice(e.length);return h.length&&(g+=h.join("/")+"/"),g+f},y=function(a,b){var c=a.split("/"),d=b.split("/");c.pop();for(var e=0;e<d.length;e++)"."!=d[e]&&(".."==d[e]?c.pop():c.push(d[e]));return c.join("/")},z=function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},A=function(a,b){return a.trim().length?a:b};String.prototype.replaceExact=function(a,b){return q(this,a,b)},String.prototype.repeat=function(a){return(!$.isNumeric(a)||0>a)&&(console.error("String.prototype.repeat only accepts non-nagitive number"),a=0),new Array(a-0+1).join(this)},String.prototype.startsWith=function(a){return this.match("^"+a)===a},String.prototype.endsWith=function(a){return this.match(a+"$")===a},String.prototype.format=function(){var a=/\{\d+\}/g,b=arguments;return this.replace(a,function(a){return b[a.match(/\d+/)]})},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};for(var B=[{base:"A",letters:"A"},{base:"AA",letters:""},{base:"AE",letters:""},{base:"AO",letters:""},{base:"AU",letters:""},{base:"AV",letters:""},{base:"AY",letters:""},{base:"B",letters:"B"},{base:"C",letters:"C"},{base:"D",letters:"D"},{base:"DZ",letters:""},{base:"Dz",letters:""},{base:"E",letters:"E"},{base:"F",letters:"F"},{base:"G",letters:"G"},{base:"H",letters:"H"},{base:"I",letters:"I"},{base:"J",letters:"J"},{base:"K",letters:"K"},{base:"L",letters:"L"},{base:"LJ",letters:""},{base:"Lj",letters:""},{base:"M",letters:"M"},{base:"N",letters:"N"},{base:"NJ",letters:""},{base:"Nj",letters:""},{base:"O",letters:"O"},{base:"OI",letters:""},{base:"OO",letters:""},{base:"OU",letters:""},{base:"OE",letters:""},{base:"oe",letters:""},{base:"P",letters:"P"},{base:"Q",letters:"Q"},{base:"R",letters:"R"},{base:"S",letters:"S"},{base:"T",letters:"T"},{base:"TZ",letters:""},{base:"U",letters:"U"},{base:"V",letters:"V"},{base:"VY",letters:""},{base:"W",letters:"W"},{base:"X",letters:"X"},{base:"Y",letters:"Y"},{base:"Z",letters:"Z"},{base:"a",letters:"a"},{base:"aa",letters:""},{base:"ae",letters:""},{base:"ao",letters:""},{base:"au",letters:""},{base:"av",letters:""},{base:"ay",letters:""},{base:"b",letters:"b"},{base:"c",letters:"c"},{base:"d",letters:"d"},{base:"dz",letters:""},{base:"e",letters:"e"},{base:"f",letters:"f"},{base:"g",letters:"g"},{base:"h",letters:"h"},{base:"hv",letters:""},{base:"i",letters:"i"},{base:"j",letters:"j"},{base:"k",letters:"k"},{base:"l",letters:"l"},{base:"lj",letters:""},{base:"m",letters:"m"},{base:"n",letters:"n"},{base:"nj",letters:""},{base:"o",letters:"o"},{base:"oi",letters:""},{base:"ou",letters:""},{base:"oo",letters:""},{base:"p",letters:"p"},{base:"q",letters:"q"},{base:"r",letters:"r"},{base:"s",letters:"s"},{base:"t",letters:"t"},{base:"tz",letters:""},{base:"u",letters:"u"},{base:"v",letters:"v"},{base:"vy",letters:""},{base:"w",letters:"w"},{base:"x",letters:"x"},{base:"y",letters:"y"},{base:"z",letters:"z"}],C={},D=0;D<B.length;D++)for(var E=B[D].letters,F=0;F<E.length;F++)C[E[F]]=B[D].base;var G=function(a){return(a||"").replace(/[^\u0000-\u007E]/g,function(a){return C[a]||a})},H={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},I=function(a){return a.replace(/["\\\b\t\n\f\r]/g,function(a){return H[a]}).replace(/\u200b/g,"")};b.formateDateTime=u,b.formateTimeOnly=t,b.formateDateOnly=v,b.insert=l,b.escape=h,b.escapeForPreWrap=g,b.unescape=i,b.escapeHead=j,b.escapeMark=k,b.escapeRegExp=z,b.isNullOrEmpty=d,b.isNotNullOrEmpty=e,b.isNullOrBlank=f,b.replaceExact=q,b.splitExact=r,b.trimArr=s,b.isURL=o,b.isImg=p,b.camelize=w,b.getRelativePath=x,b.getAbsolutePath=y,b.useOrDefault=A,b.removeDiacritics=G,b.escapeInQuote=I}),define("app/document/Node",["exoskeleton-master/exoskeleton","jquery/jquery","app/document/StringUtils"],function(a,b){"use strict";var c=a("exoskeleton-master/exoskeleton"),d=a("app/document/StringUtils"),e={paragraph:"paragraph",heading:"heading",blockquote:"blockquote",fences:"fences",hr:"hr",def_link:"def_link",def_footnote:"def_footnote",table:"table",raw_edit:"raw_edit",meta_block:"meta_block",math_block:"math_block",list:"list",toc:"toc"},f={list_item:"list_item",table_row:"table_row",table_cell:"table_cell",line:"line"},g={plain:"plain",strong:"strong",em:"em",code:"code",underline:"underline",escape:"escape",autolink:"autolink",reflink:"reflink",refimg:"refimg",link:"link",url:"url",tag:"tag",del:"del",todo:"todo",image:"image",footnote:"footnote",attr:"attr",emoji:"emoji",inline_math:"inline_math",subscript:"subscript",superscript:"superscript",linebreak:"linebreak",highlight:"highlight"},h={};c.utils.extend(h,e,f,g);var i=c.Model.extend({initialize:function(){var a=this.get("id")||this.cid;this.get("id")||this.set("id",a),i.pool[a]&&console.warn("Duplicate Model"),i.pool[a]=this,this.TYPE=h,this.set("text",this.get("text")||""),this.set("broadcast",!1),this.set("children",new j)},isBlock:function(a){return i.isBlock(this.get("type"),a)},isTopBlock:function(){return this.get("attachTo")&&!this.get("parent")},isVirtualBlock:function(){return i.isVirtualBlock(this.get("type"))},getClosetBlock:function(a){return this.isBlock(a)?this:this.get("parent").getClosetBlock(a)},getTopBlock:function(){return this.isTopBlock()?this:this.get("parent").getTopBlock()},isInline:function(){return!this.isBlock(!0)},getLastChild:function(){try{var a=this.get("children").at(this.get("children").length-1);return a.getLastBrother(!1)}catch(b){return null}},getFirstChild:function(){try{var a=this.get("children").at(0);return a.getLastBrother(!0)}catch(b){return null}},escapedMark:function(a){return a.replace(/\*/g,"*").replace(/_/g,"_").replace(/`/g,"`")},isLoose:function(a){function b(a){for(var b=a.getFirstChild(),c=0,d=0;b;){if(i.isType(b,h.paragraph))c++;else{if(!i.isType(b,h.list))return!0;if(b.isLoose())return!0;d++}b=b.get("after")}return!(1>=c&&1>=d)}for(var c=this.getFirstChild(),d=c,e=!1;d;){if(b(d)){e=!0;break}d=d.get("after")}if(a)for(d=c;d;)d.set("tight",!e),d=d.get("after");return e},safeGetStrAttr:function(a,b){if("href-title"==a)return this.safeGetStrAttr("href")+" "+this.safeGetStrAttr("title");var c=this.get(a)?this.get(a):"";return b?d.escape(c):c},replaceWith:function(a){a.id!=this.id&&(a.get("after")&&a.get("after").set("before",a.get("before")),a.get("before")&&a.get("before").set("after",a.get("after")),a.set("parent",this.get("parent")),a.set("before",this.get("before")),a.set("after",this.get("after")),this.remove())},giveChildrenTo:function(a,b,c,d){if(0!=this.get("children").length){var e=b||this.getFirstChild();for(d&&(b=b||e,c=c||this.getLastChild(),b.get("before")&&b.get("before").set("after",c.get("after")),b.set("before",null),b.set("in",this.get("in")),c.set("after",null),c.set("in",this.get("in")));e;)e.set("parent",a),e=e.get("after")}},append:function(a,b){a&&(a.detach(),this.get("children").length?b?this.getFirstChild().insert(a,!0):this.getLastChild().insert(a):(a.set("in",this.get("in")),a.set("parent",this)))},appendTillEnd:function(a){if(a){var b=null,c=this.getLastChild();do b=a.get("after"),a.detach(),c?c.insert(a):(a.set("parent",this),a.set("in",this.get("in"))),c=a,a=b;while(b)}},insertTillEnd:function(a){if(a){var b=null,c=this;do b=a.get("after"),a.detach(),c.insert(a),c=a,a=b;while(b)}},insert:function(a,b){if(a){if(a instanceof Array)return console.warning("deprecate, use insertArray"),this.insertArray(a,b);var c=b?"before":"after";return this.get(c)!==a&&(a.detach(),a.set(c,this.get(c)),this.set(c,a)),a.set("in",this.get("in")),a.set("parent",this.get("parent")),a.set("attachTo",this.get("attachTo")),a}},insertArray:function(a,b,c){if(a&&a.length){var d=b?"before":"after",e=c?a[0]:a[0].getLastBrother(!0),f=c?a.last():a.last().getLastBrother(!1);"before"===d?(e.set("before",this.get("before")),f.set("after",this)):(f.set("after",this.get("after")),e.set("before",this));for(var g=0;g<a.length;g++)a[g].set("in",this.get("in")),a[g].set("parent",this.get("parent")),a[g].set("attachTo",this.get("attachTo")),c&&g>0&&a[g].set("before",a[g-1]);return e}},clearChildren:function(){this.get("in");this.get("children").toArray().map(function(a){a.clearChildren(),a.delete()}),this.get("children").reset()},canContainBlock:function(a){return i.canContainBlock(this.get("type"),a)},canNotDirectEdit:function(){return i.isType(this,h.hr,h.math_block,h.list,h.list_item,h.toc)},getText:function(a,b){var c=[],e=this.get("children");return b=b||"",this.canContainBlock(!0)||e&&e.length>0?(e.forEach(function(b){c.push(b.getText(a))}),c=c.join(b),this.unset("text")):(c=this.get("text")||"",a&&i.isType(this,h.heading,h.paragraph,h.line)&&(c=d.escapeHead(c))),c},getNthChild:function(a){try{for(var b=this.get("children").at(0).getLastBrother(!0),c=0;b&&a>c;)c++,b=b.get("after");return b}catch(d){}return null},getVeryFirst:function(a,b){return 0==this.get("children").length||b&&i.isType(this,h.paragraph)?this:(a?this.getLastChild():this.getFirstChild()).getVeryFirst(a,b)},getLastBrother:function(a,b,c){var d=a?"before":"after",e=this.get("in").blocks;if(this.isTopBlock()){if(b)return null;if(!c&&e.length)return e.at(a?0:e.length-1).getLastBrother(a,!1,!0)}return this.get(d)?this.attributes[d].getLastBrother(a,b,!0):this},getVeryFirstBrotherIncludeTopBlock:function(a){return this.getVeryFirstBrother(a,!0)},getVeryFirstBrother:function(a,b){var c=a?"before":"after";return!b&&this.isTopBlock()?null:!this.get(c)&&this.get("parent")?this.get("parent").getVeryFirstBrother(a,b):this.get(c)?this.get(c).getVeryFirst(a):null},getClosetParagraphLevel:function(){return i.isType(this.get("parent"),h.paragraph)?this.get("parent"):this},contains:function(a){return a?this.id==a.id?!0:this.contains(a.get("parent")):!1},closest:function(){for(var a=this.get("type"),b=0;b<arguments.length;b++)if(a==arguments[b])return this;var c=this.get("parent");return c?i.prototype.closest.apply(c,arguments):null},closestWithCondition:function(a){if(a(this))return this;var b=this.get("parent");return b?i.prototype.closest.apply(b,a):null},isStyled:function(){var a=this.get("type");return a==h.strong||a==h.em||a==h.code},isSeperated:function(){var a=this.get("type");return this.canNotDirectEdit()||a==h.code||a==h.escape},isDeleted:function(){return void 0==this.attributes},"delete":function(a){this.set("parent",null),this.set("after",null),this.set("before",null),this.set("in",null),a?this.get("children").toArray().map(function(a){a.attributes.parent=null}):this.clearChildren(),delete i.pool[this.cid],delete this.attributes},remove:function(a){var b=this.get("before"),c=this.get("after");this.delete(a),b&&b.set("after",c),c&&c.set("before",b)},detach:function(){var a=this.get("before"),b=this.get("after");a&&a.set("after",b),b&&b.set("before",a),this.set("parent",null),this.set("attachTo",null)},clearEmptyChar:function(){var a=this.attributes.text;a&&(a=a.replace(/\u200B/g,""),this.get("type")==h.line&&/\u200b +/.exec(this.attributes.text)&&(a=""+a),this.attributes.text=a)},get:function(a){if(!this.attributes)return console.error("attributes for node has been deleted"),null;var b=this.attributes[a];switch(a){case"text":return b=b||"",i.isType(this,h.math_block)&&(b=b.replace(/^(\w*)\$\$(\w*)$/m,"$1\\$$$$$2")),b;default:return b}},set:function(a,b){var c,d,e=this.get("in"),f=function(){var c=this.get("in")||e,f="type"===a&&d===h.heading||this.get("type")==h.heading&&i.isType(a,"depth","text","parent","before","after");c&&d!=b&&f&&c.toc&&c.toc.refresh(),this.get("type")===h.def_link&&d!=b&&("ref"===a?(File.editor.imgEdit.willUpdateImgRef(d),File.editor.imgEdit.willUpdateImgRef(b)):"text"===a&&File.editor.imgEdit.willUpdateImgRef(this.get("ref")))},g=function(){var c=this.get("in")||e;"type"===a&&c&&(d===h.def_footnote&&c.foot_list.remove(this),d===h.def_link&&c.link_list.remove(this),b===h.def_footnote&&c.foot_list.push(this),b===h.def_link&&c.link_list.push(this))};if("string"==typeof a){switch(d=this.get(a),a){case"parent":d&&d.attributes&&d.get("children").remove(this),b&&b.get("children").add(this);break;case"before":d&&d.attributes&&(d.attributes.after=null),b&&(b&&b.attributes.after&&b.attributes.after.attributes&&(b.attributes.after.attributes.before=null),b.attributes.after=this);break;case"after":d&&d.attributes&&(d.attributes.before=null),b&&(b&&b.attributes.before&&b.attributes.before.attributes&&(b.attributes.before.attributes.after=null),b.attributes.before=this);break;case"attachTo":d&&d.blocks.remove(this),b&&b.blocks.add(this);break;case"in":var j=this.get("attachTo");d&&(d.foot_list.remove(this),d.link_list.remove(this),d.blocks.remove(this),d.allNodes.remove(this)),b&&(this.get("type")!=h.def_footnote||b.foot_list.get(this.id)?this.get("type")!=h.def_link||b.link_list.get(this.id)||b.link_list.push(this):b.foot_list.push(this),b.allNodes.add(this),j&&this.set("attachTo",j));break;case"id":b&&(this.id=b,this.cid=b);break;case"ref":b=b?b.replace(/\u200b/gi,"").replace(/\\?\]/gi,"\\]"):b;break;case"href":b=b&&this.get("type")===h.def_link?b.replace(/\[|\]|"]/gi,""):b;break;case"title":break;case"type":b!=d&&(this.attributes.tail=void 0,this.attributes.ahead=void 0,this.attributes.pattern=void 0,this.attributes.subindent=void 0,this.attributes.mathLabel=void 0,this.attributes.mathEqLabel=void 0)}this.attributes[a]=b,f.call(this),g.call(this)}else{a["in"]&&this.set("in",a["in"]),a.attachTo&&this.set("attachTo",a.attachTo),a.type&&this.set("type",a.type);for(c in a)-1==["in","attachTo","type"].indexOf(c)&&i.prototype.set.call(this,c,a[c])}return this}});i.property=["text","type","depth","lang","pattern","ahead","tail","header","align","style","href","title","ref","checked","history","alt","attr","isStart","meta","subindent"],i.isBlock=function(a,b){return e[a]||b&&f[a]},i.isVirtualBlock=function(a){return f[a]},i.canContainBlock=function(a,b){return a==h.blockquote||a==h.list||a==h.list_item||b&&(a==h.table_row||a==h.table)},i.noChangeLine=function(a){for(var b=a;b;){if(i.isType(a,h.table_cell,h.def_footnote,h.def_link))return!0;b=b.get("parent")}return!1},i.isType=function(a){if(null===a||void 0===a||a===!1)return void 0;var b="string"==typeof a?a:a.attributes.type;if(arguments[1]instanceof Array)return i.isType.apply(null,[b].concat(arguments[1]));for(var c=1;c<arguments.length;c++)if(b==arguments[c])return!0;return arguments.length>1?!1:void 0};var j=c.Collection.extend({model:i});i.pool={};var k={toHTML:function(a){var b=[];if(a.length){var c=a instanceof Array,d=c?a[0]:a.at(0);if(!c)for(;d.get("before");)d=d.get("before");do b.push(d.toHTML()),d=d.get("after");while(d&&(!c||a.indexOf(d)>-1))}return b.join("")}},l=function(){this.blocks=new j,this.allNodes=new j,this.foot_list=[],this.link_list=[]};l.prototype.get=function(a){switch(a){case"allNodes":return this.allNodes;case"blocks":return this.blocks}},l.prototype.reset=function(a){for(var b=this.blocks.toArray().length,c=0;b>c;c++)this.blocks.at(c)&&this.blocks.at(c).delete();this.blocks.reset(),!a&&this.allNodes.length&&console.warn("nodeMap not clean"),this.allNodes.reset(),this.foot_list instanceof Array?(this.foot_list=[],this.link_list=[]):(this.foot_list.reset(),this.link_list.reset())},l.prototype.getFirst=function(){if(this.blocks.length>0){var a=this.blocks.at(0);return a=a.getLastBrother(!0)}return null},l.prototype.getLast=function(){if(this.blocks.length>0){var a=this.blocks.at(this.blocks.length-1);return a=a.getLastBrother(!1)}return null},i.backToParagraphBeforeDelete=[h.heading,h.def_footnote,h.def_link,h.meta_block,h.fences],i.ListType={ol:"ol",ul:"ul",task:"tasklist"},b.Node=i,b.NodeMap=l,b.NodeCollection=j,b.NodeCollectionUtils=k,b.TYPE=h,i.TYPE=h}),define("app/editor/polyfill",["jquery/jquery"],function(a){"use strict";var b=a("jquery/jquery");window.app&&(window.open=function(a){app.window.openLink(a)}),"performance"in window==0&&(window.performance=window.performance||{offset:Date.now(),now:function(){return Date.now()-this.offset}}),[].fill||(Array.prototype.fill=function(a){for(var b=Object(this),c=parseInt(b.length),d=arguments[1],e=parseInt(d)||0,f=0>e?Math.max(c+e,0):Math.min(e,c),g=arguments[2],h=void 0===g?c:parseInt(g)||0,i=0>h?Math.max(c+h,0):Math.min(h,c);i>f;f++)b[f]=a;return b}),Array.prototype.remove=function(a){var b=this.indexOf(a);return~b?this.splice(b,1):void 0},Array.prototype.repeat=function(a,b){for(;b;)this[--b]=a;return this},Array.prototype.last=function(){return this.length?this[this.length-1]:void 0},Array.prototype.lastDef=function(){for(var a=this.length-1;a>=0;a--)if(void 0!=this[a])return this[a];return void 0},Array.prototype.clone=function(){return this.slice(0)},b.fn.visibleText=function(){if(0===this.length)return"";if(1===this.length&&(3===this[0].nodeType||0===this[0].childElementCount))return this.text();var a="";return b.each(this.contents(),function(c,d){3===d.nodeType?a+=d.textContent:1===d.nodeType&&d.offsetHeight&&d.offsetWidth&&(a+=b(d).visibleText())}),a},window.printTrace=function(){var a=new Error("dummy"),b=a.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n");console.log(b)}}),define("app/window/FileHelper",["app/document/StringUtils","app/editor/EditHelper","jquery/jquery","app/document/Node","exoskeleton-master/exoskeleton"],function(a,b){"use strict";var c=a("app/document/StringUtils"),d=a("app/editor/EditHelper"),e=window.reqnode?reqnode("electron").remote:null,f={NSChangeDone:0,NSChangeUndone:1,NSChangeCleared:2,NSChangeReadOtherContents:3,NSChangeAutosaved:4,NSChangeRedone:5},g=function(){this.doneStack=[],this.undoneStack=[],this.curState=[f.NSChangeAutosaved,new Date],this.lastSaved=this.curState[1]};g.prototype.updateChangeCount=function(a){var b,c=this.curState;switch(File.fileHasModified=File.filePath||!0,a){case f.NSChangeDone:this.curState&&this.curState[0]===f.NSChangeAutosaved&&(this.doneStack.push(this.curState),this.curState=null),this.doneStack.push([a]),this.doneStack.length>200&&this.doneStack.splice(0,this.doneStack.length-200),this.undoneStack=[];break;case f.NSChangeUndone:for(this.curState&&this.curState[0]===f.NSChangeAutosaved&&(this.undoneStack.push(this.curState),this.curState=null),this.doneStack.pop(),this.undoneStack.push([a]);(b=this.doneStack.last())&&b&&b[0]===f.NSChangeAutosaved;)this.doneStack.pop(),this.lastSaved===b[1]&&(this.curState=b);break;case f.NSChangeRedone:for(this.curState&&this.curState[0]===f.NSChangeAutosaved&&(this.doneStack.push(this.curState),this.curState=null),this.undoneStack.pop(),this.doneStack.push([a]);(b=this.undoneStack.last())&&b&&b[0]===f.NSChangeAutosaved;)this.undoneStack.pop(),this.lastSaved===b[1]&&(this.curState=b);break;case f.NSChangeCleared:File.resumeFileChangeTimestamp=new Date,this.doneStack=[],this.undoneStack=[],this.curState=[f.NSChangeAutosaved,new Date],this.lastSaved=this.curState[1];break;case f.NSChangeAutosaved:if(File.resumeFileChangeTimestamp=new Date,this.curState)return;this.curState=[f.NSChangeAutosaved,new Date],this.lastSaved=this.curState[1];break;case f.NSChangeReadOtherContents:File.resumeFileChangeTimestamp=new Date;for(var d=[],g=[],h=0;h<this.doneStack.length;h++)this.doneStack[h][0]!==f.NSChangeAutosaved&&d.push(this.doneStack[h]);for(var h=0;h<this.undoneStack.length;h++)this.undoneStack[h][0]!==f.NSChangeAutosaved&&g.push(this.undoneStack[h]);this.doneStack=d,this.undoneStack=g,this.curState=null}if(c!==this.curState&&File.isNodeHtml)if(this.curState){if((File.filePath||File.fileName)&&File.isNode){var i=e.getCurrentWindow();i.setTitle(i.getTitle().replace(/? - Typora$/," - Typora"))}document.querySelector("#title-text").classList.remove("title-modified")}else if(document.querySelector("#title-text").classList.add("title-modified"),(File.filePath||File.fileName)&&File.isNode){var i=e.getCurrentWindow();i.setTitle(i.getTitle().replace(/? - Typora$/," - Typora"))}},b.showExportDialog=function(a,b,f,g,i){var j=e.getCurrentWindow(),k=e.app,l=File.getFilePathUseNode(),m=e.dialog;l?(a=a||"md",l=l.replace(/\.[^\/\\.]+$/,"")+"."+a):l=k.getPath("userDesktop")+"/"+File.getSuggestedFileName()+"."+a;var n=$.isFunction(b)?b:function(a){var e=g||function(b){b&&(d.getDialog("Error","failed to export file to <em>"+c.escape(a)+"</em>",!0,"error-dialog").modal({backdrop:"static"}),console.error(b))},h=b;File.fs.writeFile(a,h,f,e)};m.showSaveDialog(j,{properties:["saveFile"],title:h(l)||File.getSuggestedFileName(),defaultPath:l,filters:i?[{name:a.toUpperCase(),extensions:[a]}]:[]},n)
},b.showSaveDialog=function(a){var b=e.getCurrentWindow(),c=e.app,d=File.getFilePathUseNode(),f=e.dialog;d||(d=c.getPath("userDesktop")+"/"+(h(d)||File.getSuggestedFileName())+".md"),f.showSaveDialog(b,{properties:["saveFile"],title:h(d)||File.getSuggestedFileName(),defaultPath:d},function(d){d&&(File.fs.writeFileSync(d,File.editor.getMarkdown(),"utf8"),File.resumeFileChangeTimestamp=new Date,c.isFileOpened(d)||(c.removeOpenedFile(b.id),c.addOpenedFile(d,b.id),File.FileInfoPanel.setFileTitle(d),File.updateChangeCount(File.ChangeType.NSChangeAutosaved)),console.log("saved"),a&&b.close())})};var h=function(a){return a=a&&a.replace(/\\/g,"/"),a&&a.substring(a.lastIndexOf("/")+1)},i=function(a){return a=a&&a.replace(/\\/g,"/"),a=a&&a.substring(0,a.lastIndexOf("/")+1),"win32"==process.platform?a.replace(/\//g,"\\"):a},j=function(){return File.isMac?app.document.currentFolderPath():i(File.filePath||"")},k=null,l=function(){return k||(k=reqnode("path").resolve(e.app.getPath("userData"),"draftsRecover"),reqnode("fs-extra").ensureDirSync(k)),k};b.getFileNameFromPath=h,b.getFileFolderPath=i,b.getCurrentFileFolderPath=j,b.getUnsavedDraftsPath=l,b.ChangeType=f,b.ChangeCounter=g}),define("app/editor/EditHelper",["jquery/jquery","app/document/Node","exoskeleton-master/exoskeleton","app/document/StringUtils"],function(a,b){"use strict";function c(a){if(!a)return"";var b=(new XMLSerializer).serializeToString(a),c=document.createElement("img"),d=a.getBoundingClientRect();return c.width=d.width,c.height=d.height,c.setAttribute("src","data:image/svg+xml;base64,"+btoa(b)),c.outerHTML}function d(a,b){var c=a[0].outerHTML,d=new RegExp("<"+a[0].tagName,"i"),e=c.replace(d,"<"+b);d=new RegExp("</"+a[0].tagName+">$","i"),e=e.replace(d,"</"+b+">");var f=i(e);return a.replaceWith(f),f}function e(a,b){return b.getClosetBlock(!0)}function f(a,b,c,d,e){d=d||"quick-dialog";var f=i("#"+d);return f.find("#"+d+"-title").text(a),c?f.find("#"+d+"-message").html(b):f.find("#"+d+"-message").text(b),f.find(".btn-primary").text(e||"OK").off("click"),f}function g(a){var b=File.editor;if(m)return!(m=!1);if(a.target&&("CONTENT"==a.target.tagName||"HTML"==a.target.tagName)){var c=a.clientX,d=a.clientY,e=document.querySelector(b.sessionStr),f=i(e).offset(),g=document.createEvent("MouseEvents"),h=f.left,j=f.left+e.clientWidth,k=f.top,l=f.top+e.clientHeight;if(c>=h&&j>=c||d>=k&&l>=d)return;m=!0,c=c<f.left?f.left+1:f.left+e.clientWidth-1,d=d<f.top?f.top+1:f.top+e.clientHeight-1,a.stopPropagation(),g=document.createEvent("MouseEvents"),e=document.elementFromPoint(c,d),g.initMouseEvent("click",!0,!0,e.ownerDocument.defaultView,1,a.screenX+(c-a.clientX),a.screenY+(d-a.clientY),c,d,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button),e.dispatchEvent(g)}}function h(a){if(0===a.trim().length)return 0;var b=0,c=["d",a.replace(/[\u303F-\uFAFF]/gi,function(){return b++," "}).replace(/(^|\s+)[!-\/:-@\[-`{-~]+(\s+|$)/gm," "),"d"].join(" ").split(/[\s!-,\.\\:-@\[-`{-~]+/g).length;return b+c-2}var i=a("jquery/jquery"),j=a("app/document/Node"),k=(j.Node,a("app/document/StringUtils"),a("exoskeleton-master/exoskeleton"),function(a){var b="<p>"+a+"<span class='btn close-btn btn-xs'><span class='glyphicon glyphicon-remove'></span></span></p>";i("#md-notification").html(b).show().delay(5e3).fadeOut()}),l=function(a,b,c){var d,e=a.offset(),f=(i(editor.sessionStr).offset().left,i(editor.sessionStr).width()),g=a.find(".md-arrow"),b=b||".code-tooltip.md-hover-tip";return b.jquery?(d=b,g=d.find(".md-arrow")):d=a.find(b),a.length?(e.top+=a.height()*(c?1:1.5),e.left+=(a.width()-d.width())/2,e.left+d.width()>window.innerWidth-10?e.left=window.innerWidth-10-d.width():e.left<10&&(e.left=10),d.css("position","absolute").css("max-width",f-60).offset(e),!c&&g.offset(function(b,c){var d={};return d.left=a.offset().left+a.width()/2,d.top=c.top,d}),d):(console.error("cannot fixPopoverPosition on empty $parent"),d.hide())},m=!1;b.getDialog=f,b.replaceTag=d,b.getEditParent=e,b.fixPopoverPosition=l,b.showNotification=k,b.resetClick=g,b.getWordCount=h,b.SVG2HtmlImg=c}),define("app/window/FileInfoPanel",["app/document/StringUtils","exoskeleton-master/exoskeleton","jquery/jquery","app/window/FileHelper","app/editor/EditHelper","app/document/Node","app/editor/KeyMaster"],function(a,b){"use strict";function c(a){var b,c=new Date,d=(c-a)/1e3,e="";return 30>d?b="just now":60>d?b="less than one minute ago":3600>d?b=Math.floor(d/60).toString()+" minutes ago":18e3>d?(d/3600>=2&&(e="s"),b=Math.floor(d/3600)+" hour"+e+" ago"):86400>d&&c.getDay()==a.getDay()?b=Math.floor(d/3600)+" hours ago":172800>d&&c.getDay()==(a.getDay()+1)%7?b="yesterday":2592e3>d?b=Math.floor(d/86400)+" days ago":31104e3>d?(e=d/2592e3>=2?"s":"",b=Math.floor(d/2592e3)+" month"+e+" ago"):(e=d/31104e3>=2?"s":"",b=Math.floor(d/31104e3)+" year"+e+" ago"),b}function d(a){if(reqnode){{var b=reqnode("fs");q.getCurrentWindow()}r&&(r.close(),r.removeAllListeners()),File.resumeFileChangeTimestamp=new Date;try{r=b.watch(a,{persistent:!0}),r.on("change",function(a,b){console.debug("file "+a+"d, filename: "+b),"change"==a?File.presentedItemChanged():(!b&&f(),File.filePath=void 0,File.updateChangeCount(File.ChangeType.NSChangeReadOtherContents))})}catch(c){console.log(c)}}}function e(){$("#file-info-filename-input-area").hide(),$("#file-info-filename").show()}function f(a){var b=q.getCurrentWindow(),c=q.app;c.setting.history("recentDocument").remove({path:File.filePath}),c.removeOpenedFile(b.id),a&&c.addOpenedFile(a,b.id),a&&v(a),File.resumeFileChangeTimestamp=new Date}function g(a){var b,c=k.getFileFolderPath(File.filePath)+a;return File.fs.existsSync(c)?(b=l.getDialog("Error -- File Exists","File or directory with name <i>"+j.escape(a)+"</i> already exist, please choose another file name",!0).modal({backdrop:!1,keyboard:!1}),void b.find(".btn-primary").one("click",function(){$("#quick-dialog").hide()})):(b=l.getDialog("Confrim","Rename file from <i>"+j.escape(File.fileName)+"</i> to <i>"+j.escape(a)+"</i> ?",!0),b.modal({backdrop:!1,keyboard:!1}),void b.find(".btn-primary").one("click",function(){return b.modal("hide"),File.fs.existsSync(c)?(q.dialog.showErrorBox("File Exists","File or directory with the given name already exists, please give a different name"),void f(c)):void File.fs.rename(File.filePath,c,function(a){a?($("#quick-dialog").hide(),console.log("renamed failed: "+a.message),q.dialog.showErrorBox("Rename Filed","Renaming operation failed due to "+a.message)):(l.showNotification("<i class='fa fa-check'></i> Rename Success ","success"),f(c))})}))}function h(){var a=$("#file-info-filename").hide(),b=$("#file-info-filename-input-area").show(),c=b.children("input"),d=b.children("#file-info-filename-input-ext"),e=a.text(),f=e.substring(0,e.lastIndexOf(".")),g=e.substring(e.lastIndexOf("."));c.val(f).focus(),d.text(g)}var i,j=a("app/document/StringUtils"),k=(a("exoskeleton-master/exoskeleton"),a("app/window/FileHelper")),l=a("app/editor/EditHelper"),m=a("app/editor/KeyMaster"),n=m.map,o=null,p=null,q=window.reqnode?reqnode("electron").remote:null,r=null,s=function(a){var b=new Date;return i=j.formateDateOnly(new Date)+" "+(a||"untitled").replace(/\.[^.]*$/,"")+" "+j.formateTimeOnly(b,!0).replace(/:/g,"")+".md"},t=function(a){console.warn(a)},u=function(a){if(i&&a){var b=reqnode("fs"),c=reqnode("path"),d=k.getUnsavedDraftsPath(),e=c.resolve(d,i);b.exists(e,function(){b.rename(e,c.resolve(d,s(a)),t)})}},v=function(a,b,c){var e=$("#title-text"),f=q.app,g=q.getCurrentWindow(),h=q.Menu.getApplicationMenu().getItem("File").submenu.getItem("Open File Location");if(a){h.visible=!0,$("#file-info-content").removeClass("file-info-untitled");var c=k.getFileNameFromPath(a);File.filePath=a,File.fileName=c,(f.getPropFrom("name2path",c)||[]).length>1?(e.text(a),g.setTitle(a+" - Typora")):(e.text(c),g.setTitle(c+" - Typora")),$("#file-info-filename").show().text(c).attr("data-disabled","false"),$("#file-info-file-path").show().find(".file-info-field-value").text(a.substring(0,a.length-c.length)),x(a),d(a),u(c)}else $("#file-info-content").addClass("file-info-untitled"),c?(File.fileName=c,g.setTitle(c+" - Typora")):g.setTitle("Untitled - Typora"),i||s(),h.visible=!1},w=function(){function a(a){$(".info-panel-tab.active").removeClass("active"),"file"==a?($("#outline-content").hide(),$("#file-info-content").show(),$("#info-panel-tab-file").addClass("active"),z()):($("#outline-content").show(),$("#file-info-content").hide(),$("#info-panel-tab-outline").addClass("active")),window.ClientCommand&&ClientCommand.refreshViewMenu()}p||(p=setInterval(function(){y()},3e4)),$("#file-info-save-btn").click(function(){File.saveUseNode()}),$("#info-panel-tab-file").click(function(){a("file")}),$("#info-panel-tab-outline").click(function(){a("outline")}).trigger("click"),$("#file-info-filename").click(function(){"false"==this.getAttribute("data-disabled")&&h()}),$("#file-info-file-path .file-info-field-value").click(function(){$("#outline-dropmenu").removeClass("open"),q.shell.showItemInFolder(File.filePath)});var b=$("#file-info-filename-input"),c=$("#file-info-filename-input-ext");b.blur(function(){setTimeout(function(){var a=$("#file-info-filename-input:visible");if(a.length)e();else{var d=(b.val()+c.text()).trim();e(),d!=File.fileName&&g(d)}},50)}).keydown(function(a){var b=n[a.which||a.keyCode];"Esc"==b?e():"Enter"==b&&(e(),$("#file-info-filename-input").trigger("blur"))}).keypress(function(a){var b=String.fromCharCode(a.keyCode);return'\\/:*?"<>|'.indexOf(b)>-1?!1:void 0}),c.click(function(){b.val(b.val()+c.text()).focus(),c.text("")})},x=function(a){a=a||File.filePath,File.fs&&a&&File.fs.stat(File.filePath,function(a,b){b&&y(b.mtime)})},y=function(a){if(a=a||o){o=a;var b=j.formateDateTime(a);$("#file-info-last-modified .file-info-field-value").text(b),$("#file-info-last-saved-sub").text("Saved "+c(a))}},z=function(a){var b=File.editor.writingArea.innerText;void 0===a&&(a=l.getWordCount(b)),$("#file-info-field-read-value-word").text(a),$("#file-info-field-read-value-ch").text(b.length),$("#file-info-field-read-value-minutes").text(Math.floor(a/250)+1)},A=function(a){a.length&&-1==(File.filePath||"").indexOf(k.getUnsavedDraftsPath())&&reqnode("fs").writeFile(k.getUnsavedDraftsPath()+"/"+(i||s()),a,"utf8",function(a){a?t(a):u(File.fileName||File.getSuggestedFileName())})};b.setFileTitle=v,b.saveToRecover=A,b.prepareInfoPanel=w,b.setLastModified=y,b.updateContentAnalyze=z}),define("app/editor/KeyMaster",[],function(a,b,c){"use strict";function d(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function e(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}function f(a){for(u in w)w[u]=a[C[u]]}function g(a){var b,c,e,g,h,i;if(b=a.keyCode,-1==d(B,b)&&B.push(b),(93==b||224==b)&&(b=91),b in w){w[b]=!0;for(e in y)y[e]==b&&(j[e]=!0)}else if(f(a),j.filter.call(this,a)&&b in v)for(i=p(),g=0;g<v[b].length;g++)if(c=v[b][g],c.scope==i||"all"==c.scope){h=c.mods.length>0;for(e in w)(!w[e]&&d(c.mods,+e)>-1||w[e]&&-1==d(c.mods,+e))&&(h=!1);(0!=c.mods.length||w[16]||w[18]||w[17]||w[91])&&!h||c.method(a,c)===!1&&(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&(a.cancelBubble=!0))}}function h(a){var b,c=a.keyCode,e=d(B,c);if(e>=0&&B.splice(e,1),(93==c||224==c)&&(c=91),c in w){w[c]=!1;for(b in y)y[b]==c&&(j[b]=!1)}}function i(){for(u in w)w[u]=!1;for(u in y)j[u]=!1}function j(a,b,c){var d,e;d=r(a),void 0===c&&(c=b,b="all");for(var f=0;f<d.length;f++)e=[],a=d[f].split("+"),a.length>1&&(e=s(a),a=[a[a.length-1]]),a=a[0],a=A(a),a in v||(v[a]=[]),v[a].push({shortcut:d[f],scope:b,method:c,key:d[f],mods:e})}function k(a,b){var c,d,f,g,h,i=[];for(c=r(a),g=0;g<c.length;g++){if(d=c[g].split("+"),d.length>1&&(i=s(d),a=d[d.length-1]),a=A(a),void 0===b&&(b=p()),!v[a])return;for(f in v[a])h=v[a][f],h.scope===b&&e(h.mods,i)&&(v[a][f]={})}}function l(a){return"string"==typeof a&&(a=A(a)),-1!=d(B,a)}function m(){return B.slice(0)}function n(a){var b=(a.target||a.srcElement).tagName;return!("SELECT"==b)}function o(a){x=a||"all"}function p(){return x||"all"}function q(a){var b,c,d;for(b in v)for(c=v[b],d=0;d<c.length;)c[d].scope===a?c.splice(d,1):d++}function r(a){var b;return a=a.replace(/\s/g,""),b=a.split(","),""==b[b.length-1]&&(b[b.length-2]+=","),b}function s(a){for(var b=a.slice(0,a.length-1),c=0;c<b.length;c++)b[c]=y[b[c]];return b}function t(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c(window.event)})}var u,v={},w={16:!1,18:!1,17:!1,91:!1},x="all",y={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,command:91},z={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},A=function(a){return z[a]||a.toUpperCase().charCodeAt(0)},B=[];for(u=1;20>u;u++)z["f"+u]=111+u;var C={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(u in y)j[u]=!1;t(document,"keydown",function(a){g(a)}),t(document,"keyup",h),t(window,"focus",i);var D=j;c.exports=D,D.setScope=o,D.getScope=p,D.deleteScope=q,D.filter=n,D.isPressed=l,D.getPressedKeyCodes=m,D.unbind=k,"undefined"!=typeof c&&(c.exports=D);var E={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Command",107:"=",109:"-",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};D.map=E,D.functionKey=["Command","Ctrl","Shift","Alt","Home","End","PageUp","PageDown","CapsLock","Esc","PrintScrn","Insert","Pause"],D.handleCtrlDown=function(a){$(a.sessionStr+" a").attr("contenteditable",!0)},D.isCommand=function(a){return String.fromCharCode(a.which).length>0&&(a.ctrlKey||a.metaKey)},D.handleCtrlUp=function(a){$(a.sessionStr+" a").attr("contenteditable",!1)}}),define("app/editor/Editor",["app/editor/polyfill","jquery/jquery","app/document/StringUtils","exoskeleton-master/exoskeleton","app/document/Node","app/document/MarkParser","app/editor/Inline","app/editor/UndoManager","app/editor/Emoji","app/document/Node2Mark","app/document/Node2HTML","app/document/NodeOperation","rangy/rangy-core","app/editor/Fences","codemirror/lib/codemirror","autoComplete","app/editor/KeyMaster","codemirror/addon/selection/mark-selection","codemirror/addon/edit/closebrackets","codemirror/addon/edit/closetag","codemirror/addon/mode/overlay","app/editor/MathBlock","codemirror/addon/display/placeholder","codemirror/mode/stex/stex","app/editor/MathInline","app/editor/EditHelper","rangy/rangy-classapplier","app/editor/Brush","app/editor/Stylize","app/editor/Selection","app/editor/EditHelper","app/editor/TableEdit","app/editor/polyfill","app/editor/ImageEdit","app/editor/UserOp","app/editor/TableEdit","app/editor/ConvertUtils","app/editor/Selection","app/window/FileHelper","app/editor/UndoManager","app/editor/KeyMaster","app/editor/UserOp","app/document/File","app/window/FileInfoPanel","app/editor/DocMenu","app/editor/Stylize","app/editor/SearchPanel","app/editor/Emoji","app/editor/Word","app/document/Export","app/document/Node2Native","app/editor/SourceView","codemirror/addon/selection/active-line","codemirror/addon/edit/visiblespace","app/editor/QuickOpenPanel"],function(a,b,c){"use strict";var d=(a("app/editor/polyfill"),a("jquery/jquery")),e=a("app/document/StringUtils"),f=a("exoskeleton-master/exoskeleton"),g=a("app/document/Node"),h=g.Node,i=g.TYPE,j=(a("app/document/MarkParser"),a("app/document/Node2Mark"),a("app/document/Node2HTML"),a("app/document/NodeOperation"),a("app/editor/Fences")),k=a("app/editor/MathBlock"),l=a("app/editor/MathInline"),m=a("app/editor/Brush"),n=a("app/editor/Selection"),o=n.rangy,p=a("app/editor/EditHelper"),q=a("app/editor/TableEdit"),r=a("app/editor/ImageEdit"),s=a("app/editor/UndoManager"),t=a("app/editor/KeyMaster"),u=t.map,v=a("app/editor/UserOp"),w=a("app/document/File"),x=a("app/editor/DocMenu"),y=a("app/editor/Stylize"),z=a("app/editor/SearchPanel"),A=a("app/editor/Emoji"),B=a("app/editor/Word"),C=a("app/document/Export"),D=a("app/editor/SourceView"),E=a("app/window/FileHelper"),F=a("app/editor/QuickOpenPanel"),G=window.reqnode?reqnode("electron").remote:null;!function(){var a=d.fn.replaceWith;d.fn.oldReplaceWith=a,d.fn.replaceWith=function(){var b=this.parent().closest("li");a.apply(this,arguments),b.length&&(b.css("margin","0.1px"),b.css("margin",""))}}();var H,I=f.Model.extend({constructor:function(a,b){console.time("putHTML"),this.sessionStr=a,this.EditHelper=p,b.setTheme(),b.setEditor(this),this.nodeMap=new g.NodeMap,this.writingArea=document.querySelector(this.sessionStr),b.readOption();var c=b.getContent(),d=new g.Node({type:g.TYPE.raw_edit,"in":this.nodeMap,attachTo:this.nodeMap,text:c});this.imgEdit=new r(this),this.docMenu=new x(this),this.writingArea.innerHTML=d.parseFrom({skips:{old_code:!1}})[0],console.timeEnd("putHTML"),this._bindGlobal(),this._bindKeyEvents(),this._bindMouseEvents(),this.focusCid=null,this.selection=new n(this),this.keypressMsg="",this.undo=new s(this),this.mathInline=new l(this),this.brush=new m(this),this.tableEdit=new q(this),this.fences=new j(this),this.mathBlock=new k(this),this.stylize=new y(this),setTimeout(function(){this.refresh()}.bind(this),500),this.brush.run(),this.UserOp=v,this.searchPanel=new z(this),this.export=new C(this),this.writingArea.setAttribute("contenteditable","true"),this.writingArea.focus(),c.trim().length?this.writingArea.blur():document.querySelector(this.sessionStr+">*:first-child").classList.add("md-focus"),this.emoji=new A(this),this.word=new B(this),b.option.showOutlinePanelByDefault&&this.docMenu.showOutline(!0),this.sourceView=new D(this),(b.isMac||b.isNode)&&setTimeout(b.bindMenu,200),b.freshLock(),this.quickOpenPanel=new F(this),this.quickOpenPanel.init(),this.refocus()},resizeDef:function(){var a=this;if(!(a.nodeMap.foot_list.models.length+a.nodeMap.link_list.models.length>30)){var b=a.nodeMap.foot_list.models.reduce(function(b,c){var d=a.findElemById(c.id),e=d.find(".md-def-f").css("width","").width()+d.find(".md-def-name").width();return b>e?b:e},0);b=a.nodeMap.link_list.models.reduce(function(b,c){var d=a.findElemById(c.id),e=d.find(".md-def-f").css("width","").width()+d.find(".md-def-name").width();return b>e?b:e},b),this.maxDefLength=b,a.nodeMap.link_list.models.map(function(c){var d=a.findElemById(c.id),e=d.find(".md-def-name").width();a.findElemById(c.id).find(".md-def-f").css("width",b-e)}),a.nodeMap.foot_list.models.map(function(c){var d=a.findElemById(c.id),e=d.find(".md-def-name").width();a.findElemById(c.id).find(".md-def-f").css("width",b-e)})}},refresh:function(a){if(this.sourceView&&this.sourceView.inSourceMode)return void(a&&this.sourceView&&this.sourceView.cm.refresh());var b=this;setTimeout(function(){b.resizeDef(),b.writingArea.setAttribute("contenteditable","true")},30),d(b.writingArea).find(".md-mathjax-panel").length||(b.mathBlock.currentCm=void 0),b.nodeMap.toc.refresh(!0),b.mathBlock.renderAll(),b.fences.modeLoaded&&b.fences.refreshEditor(void 0,a),b.mathInline.renderAll(),b.brush&&b.stylize&&(b.brush.expand(),b.brush.updateWordCount()),b.selection.scrollAdjust()},getJQueryElem:function(a){return a?d(a.nodeType==a.ELEMENT_NODE?a:a.parentNode):d()},getMarkElem:function(a){if(!a&&document.activeElement.nodeType==window.Node.ELEMENT_NODE&&(document.activeElement.hasAttribute("tabindex")||h.isType(document.activeElement.tagName,"TEXTAREA","INPUT")))return d(document.activeElement).closest("[cid]");if(a=a||window.getSelection().anchorNode||document.activeElement,!a)return[];var b=d(a.nodeType==a.ELEMENT_NODE?a:a.parentNode);return!b.length||"TH"!==b[0].tagName&&"TD"!==b[0].tagName||(b=b.children(".td-span")),e.isNullOrEmpty(b.attr("cid"))&&(b=b.closest("[cid]")),b},autoRemoveUnholdable:function(a){var b=this.focusCid&&this.findElemById(this.focusCid).closest(".unholdable");if(b&&b.length)try{var c=this.findNodeByElem(b).getClosetParagraphLevel(),a=a||s.makeEmptyCommand(this.selection.buildUndo());b.text().length||b.children(".md-line").length>1?b.removeClass("unholdable"):(this.undo.UndoManager.addUndoForRemove(a,c),a.redo.push(this.selection.buildUndo()),c.remove(),b.remove(),this.undo.register(a),this.focusCid=null)}catch(d){console.warn(d.stack)}},store:function(a,b){if((!this.sourceView||!this.sourceView.inSourceMode)&&(a=a?a:this.focusCid)){var c=a.id?a:this.nodeMap.get("allNodes").get(a);if(c){var d=this.findElemById(c.id);if(d.length>0){var e=d.textExcludeSVG();h.isType(c,c.TYPE.math_block)?this.mathBlock.syncToNode(c):h.isType(c,c.TYPE.def_footnote,c.TYPE.def_link)?(h.reverseAttrFromElem(c,d),!b&&this.resizeDef()):c&&!d[0].querySelector("[cid]")?c.get("type")==c.TYPE.fences&&d.find(".CodeMirror-code").length?this.fences.syncToNode(c):(c.set("text",e),c.clearChildren()):b&&c.get("children").map(function(a){d[0].querySelector("[cid='"+a.cid+"']")?this.store(a):a.remove()},this)}else c.set("text",""),c.clearChildren();return h.isType(c,c.TYPE.meta_block)&&!b&&this.imgEdit.updateLocalRootUrl(),c}}},cleanTooltip:function(){d(this.sessionStr).find(".md-tooltip-hide").hide(),K(),this.mathBlock.stopEditing()},refocus:function(a,b,c){function e(){var a=h.findElemById(h.focusCid).trigger("blur").trigger("losefocus");a.find(".md-tooltip-hide").hide(),K()}if(!this.sourceView||!this.sourceView.inSourceMode){var f,g=a?this.findElemById(a):this.getMarkElem(),h=this,i=this.nodeMap.allNodes.get(this.focusCid),j=h.findElemById(this.focusCid);if(h.docMenu.autoHideOutline(),a=void 0===a?g.attr("cid"):a,b&&a&&h.store(a),this.focusCid!=a||!g.hasClass("md-focus")){if(this.focusCid!=a&&e(),d(document.activeElement).trigger("focus"),g.addClass("md-focus").trigger("refocus"),this.focusCid==a)return;if(this.undo.completeSnap(!0),this.store(this.focusCid),this.focusCid=a,w.isLocked)return;this.focusCid&&i&&!(d.contains(j,g)||d.contains(g,j)||g.length&&g.is(j))&&(i.clearEmptyChar(),f=this.simpleParse(i),f&&(f[0].undo[0]=h.lastCursor,setTimeout(function(){f[0].redo.push(h.selection.buildUndo()),h.findElemById(f[2]).replaceWith(f[1]),h.undo.register(f[0]),h.refresh(),h.undo.exeCommand(f[0].redo.last())},50))),this.docMenu.highlightVisibleHeader(),this.focusCid&&this.brush.focusContainer(g)}return h.isIME=0,c||setTimeout(this.brush.expand.bind(this.brush),30),a}},_bindGlobal:function(){function a(){t("command+z, ctrl+z",function(a){return w.isLocked?!1:void k.undo.undo(a)}),t("command+a, ctrl+a",function(a){w.editor.sourceView.inSourceMode||d(document.activeElement).closest("#write").length&&(k.selection.selectAll(a),k.brush.expand())}),t("command+l, ctrl+l",function(a){a.preventDefault(),k.selection.selectLine()}),t("command+d, ctrl+d",function(a){a.preventDefault(),k.selection.selectWord()}),t("command+e, ctrl+e",function(a){a.preventDefault(),k.selection.selectPhrase()}),t("command+b, ctrl+b",function(a){return w.isLocked?!1:(a.preventDefault(),void k.stylize.toggleStyle(g.TYPE.strong))}),t("command+i, ctrl+i",function(a){return w.isLocked?!1:(a.preventDefault(),void k.stylize.toggleStyle(g.TYPE.em))}),t("command+u, ctrl+u",function(a){return w.isLocked?!1:(a.preventDefault(),void k.stylize.toggleStyle(g.TYPE.underline))}),t("ctrl+home",function(){w.editor.selection.jumpTop()}),t("ctrl+end",function(){w.editor.selection.jumpBottom()})}function b(){t("shift+command+l, shift+ctrl+l",function(a){return w.isLocked?!1:(a.preventDefault(),void v.deleteLine(k))}),t("shift+command+e, shift+ctrl+e",function(a){return w.isLocked?!1:(a.preventDefault(),k.selection.selectPhrase(),void v.backspaceHandler(k,null,"delSelection"))}),t("shift+command+d, shift+ctrl+d",function(a){return w.isLocked?!1:(a.preventDefault(),k.selection.selectWord(),void v.backspaceHandler(k,null,"delSelection"))}),t("command+y, ctrl+y,command+shift+z, ctrl+shift+z",function(a){return w.isLocked?!1:void k.undo.redo(a)}),t("command+=, ctrl+]",function(a){var b=k.getMarkElem(),c=b.attr("mdtype");h.isType(c,i.heading,i.line)&&k.stylize.changeHeadingLevel(k.findNodeByElem(b),!0),a.preventDefault(),a.stopPropagation()}),t("command+-, ctrl+[",function(a){var b=k.getMarkElem(),c=b.attr("mdtype");h.isType(c,i.heading,i.line)&&k.stylize.changeHeadingLevel(k.findNodeByElem(b),!1),a.preventDefault(),a.stopPropagation()}),w.isMac&&(t("ctrl+k",function(a){var b=k.selection.getRangy();if(b&&!h.isType(document.activeElement.tagName,"INPUT","TEXTAREA")){if(b.collapsed){var c=k.getMarkElem();b.setEnd(c[0],c[0].childNodes.length),k.selection.setRange(b)}v.backspaceHandler(k,a,"delSelection"),a.preventDefault(),a.stopPropagation()}}),t("ctrl+h",function(a){var b=k.selection.getRangy();b&&!h.isType(document.activeElement.tagName,"INPUT","TEXTAREA")&&v.backspaceHandler(k,a,"Backspace")}),t("ctrl+d",function(a){var b=k.selection.getRangy();b&&!h.isType(document.activeElement.tagName,"INPUT","TEXTAREA")&&v.backspaceHandler(k,a,"Delete")}))}function c(a){if(a&&/\.(png|jpg|jpeg|svg|gif)$/gi.exec(a)){window.FileHelper=E;var b=k.imgEdit.getLocalRootUrlForInsert(),c=w.isWin?a.match(/\\([^\\]+)\./g).last().replace(/\[|\]|\//g,""):a.match(/\/([^/]+)\./g).last().replace(/\[|\]/g,""),d=E.getCurrentFileFolderPath();b.length?a="/"+e.getRelativePath(b,a):d&&0===a.indexOf(d)&&(a=a.substring(d.length).replace(/^\//,"")),v.pasteHandler(k," !["+c.substring(1,c.length-1)+"]("+a+")",!0)}}function f(){d(".md-table-edit").length&&k.tableEdit.resizeTableEdit(d(".md-table-edit"))}var j,k=this;!w.isMac&&a(),b(),d(document).on("dragenter",function(a){return w.isLocked?!1:(a.stopPropagation(),void a.preventDefault())}).on("dragover",function(a){return w.isLocked?!1:(a.stopPropagation(),void a.preventDefault())}).on("drop",function(a){function b(){if(ClientCommand.validatePandocInstall())if(w.fileHasModified){var a=app.openFile();a.webContents.once("did-finish-load",function(){a.webContents.executeJavaScript('setTimeout(function(){window.getSelection().removeAllRanges();ClientCommand.doImport("'+e.escapeInQuote(f[0].path)+'")}, 200)')})}else ClientCommand.doImport(f[0].path)}if(w.isLocked)return!1;var d=a.originalEvent.dataTransfer.getData("text/html"),f=a.originalEvent.dataTransfer.files;if(d)v.pasteHandler(k,d);else if(f&&f.length&&w.isNodeHtml){var g;if(g=f[0].path.match(/(?:^|\.)([^.]+)$/)){if(g=g[1],~["latex","ltx","tex","wiki","dokuwiki","docx","rst","rest","org","textile","opml"].indexOf(g))return b(),!1;if(~["txt","md","mmd","markdown","mdown","multimarkdown",""].indexOf(g))return G.app.openFile(f[0].path),!1}c(f[0].path)}a.stopPropagation(),a.preventDefault()}).on("dragfile",function(a){try{if(window.app&&app.document.isLocked())return!1;if(w.isLocked&&!w.isMac)return!1;var b,d=a.originalEvent.data.url;if((b=d.match(/(?:^|\.)([^.]+)$/))&&(b=b[1],~["txt","latex","ltx","tex","wiki","dokuwiki","docx","rst","rest","org","textile","opml","md","mmd","markdown","mdown","multimarkdown",""].indexOf(b)))return void app.app.openInTypora(d);c(d)}catch(a){}}).on("paste",this.sessionStr,function(a){return w.isLocked?!1:void(k.sourceView.inSourceMode||v.pasteHandler(k,a.originalEvent,w._PasteContentFlag))}).on("pasteAsPlainText",this.sessionStr,function(a){return w.isLocked?!1:void(k.sourceView.inSourceMode||v.pasteHandler(k,a.originalEvent,!0))}).on("copy",this.sessionStr,function(a){console.log("on copy"),h.isType(document.activeElement.tagName,"INPUT","TEXTAREA")||(k.refocus(void 0,!0),v.copyHandler(k,a.originalEvent))}).on("cut",this.sessionStr,function(a){return w.isLocked?!1:h.isType(document.activeElement.tagName,"INPUT","TEXTAREA")?!0:w.isNode?(w._CopyContentFlag="cut_before",G.getCurrentWindow().webContents.copy(),!1):(k.refocus(void 0,!0),k.snapSelection=k.selection.buildUndo(),v.copyHandler(k,a.originalEvent),v.backspaceHandler(k,a,"delSelection"),void 0)}).on("contextmenu",function(){if("IMG"===event.target.tagName&&0==d(event.target).closest(".md-image.md-expand").length){var a=d(event.target).closest(".md-image").addClass("md-expand"),b=o.createRange(),c=a.children(".md-meta")[0].length;b.moveToBookmark({containerNode:a.children(".md-meta")[0],start:c-1,end:c-1}),k.selection.setRange(b)}else k.brush.expand()}).on("inline-input",function(){k.selection.scrollAdjust()}).on("click",p.resetClick),d(window).on("resize",function(){clearTimeout(j),j=setTimeout(f,300)}),d(k.sessionStr).on("change","[type='checkbox']",function(){var a=this.parentElement.getAttribute("cid"),b=this.checked;b?this.setAttribute("checked","checked"):this.removeAttribute("checked"),k.getNode(a).attr("checked",b,k,!1)}),document.addEventListener("selectionchange",function(){var a;w.isNodeHtml&&(a=k.selection.getRangy(),d("svg.in-text-selection").attr("class",""),a&&a.getNodes([1],function(a){"svg"===a.tagName&&a.classList.add("in-text-selection")})),w.isFocusMode&&M.call(k)},!1)},_bindKeyEvents:function(){function a(a){a?d("a, .md-def-url, .md-url").css("cursor","pointer"):d("a, .md-def-url, .md-url").css("cursor","")}var b=this,c=!1,e=!1,f=!1;b.isIME=0,d("body").on("keydown",function(a){if(b.docMenu.autoHideOutline(),document.body.classList.remove("show-word-count"),document.activeElement==document.body){var c=a.keyCode||a.which;("Delete"==u[c]||"Backspace"==u[c])&&a.preventDefault()}}),d(b.sessionStr).on("keydown",function(e){b.keypressMsg=null;var g=e.keyCode||e.which;if(d(".dropdown-menu.open:not(#outline-dropmenu), .dropdown-menu.show").removeClass("open").removeClass("show"),229!=g){if(("Ctrl"==u[g]||"Command"==u[g])&&a(!0),h.isType(u[g],"Right","Left","Up","Down")){var i;if(e.ctrlKey||e.metaKey){if(w.isMac&&e.metaKey&&("Up"==u[g]||"Down"==u[g]))return"Up"==u[g]?b.selection.jumpTop(e.shiftKey):b.selection.jumpBottom(e.shiftKey),!1;if(e.target.classList&&e.target.classList.contains("md-def-name")&&"Right"===u[g])return b.selection.jumpIntoElemEnd(d(e.target).closest("[mdtype]")),!1;if(i=b.selection.getRangy())if(w.isNodeHtml&&e.ctrlKey&&("Left"==u[g]||"Right"==u[g]),"Left"==u[g]){var j=d(i.startContainer).closest("[mdtype]");j.find("[md-inline]").first().addClass("md-expand")}else if("Right"==u[g]){var j=d(i.endContainer).closest("[mdtype]");j.find("[md-inline]").last().addClass("md-expand")}}e.shiftKey&&d(".md-focus .md-math-after-sym").text(""),"Right"==u[g]||"Left"==u[g]?(b.lastCursor=b.selection.buildUndo(),b.brush.isAutoCompleteShown()&&b.brush.triggerAutoComplete(),!e.shiftKey&&b.selection.moveLeftOrRight("Left"==u[g],e)):("Up"==u[g]||"Down"==u[g])&&(b.lastCursor=b.selection.buildUndo(),b.brush.isAutoCompleteShown()?e.shiftKey?b.brush.hideAutoComplete():b.brush.changeAutoCompleteSelection("Up"==u[g],e):!e.shiftKey&&b.selection.moveUpOrDown("Up"==u[g],e))}else if(w.isLocked)return!0;if("TEXTAREA"!=e.target.tagName&&"INPUT"!=e.target.tagName){if("Esc"==u[g]){if(d("#table-insert-dialog:visible").modal("hide").length)return void d(w.editor.sessionStr).trigger("cursorChange");b.brush.triggerAutoComplete(!0),e.preventDefault()}else if("Tab"!=u[g]||w.isNode&&e.ctrlKey){if("Backspace"==u[g]||"Delete"==u[g])if(w.isNodeHtml)f||(f=!0,e.ctrlKey&&(b.selection.getRangy()||{}).collapsed?(window.getSelection().modify("extend","Backspace"==u[g]?"backward":"forward","word"),v.backspaceHandler(b,null,u[g]),f=!1):setTimeout(function(){v.backspaceHandler(b,null,u[g]),f=!1},10)),e.preventDefault();else{if(e.metaKey){{var k=b.getMarkElem(window.getSelection().commonAncestorContainer);k.hasClass("md-expand")}k.addClass("md-expand"),window.getSelection().modify("extend","backward","lineboundary")}v.backspaceHandler(b,e,u[g])}else if("Enter"==u[g]){if(d(".auto-suggest-container:visible .active").length)return b.brush.applyAutocompleteByKey(),void e.preventDefault();J.call(b,e.metaKey||e.ctrlKey,e.shiftKey),e.preventDefault()}}else{e.preventDefault();
var l=e.shiftKey?v.lessIndent(b):v.moreIndent(b);if(!l){{var k=b.getMarkElem();k.hasClass("md-def-link")}if(k.closest(".md-table").length)b.tableEdit.moveToNextCell(!0,e.shiftKey);else if(k.hasClass("md-def-link")||k.hasClass("md-def-footnote")){var m=b.getJQueryElem(window.getSelection().anchorNode).closest("span[contenteditable]");b.selection.selectAllElem(e.shiftKey?d(m.prevAll("span[contenteditable='true']")[0]):d(m.nextAll("span[contenteditable='true']")[0]))}else e.shiftKey||(b.selection.prepNode("	",e),v.insertInlineText(b,null,"	",b.selection.getOffset(k),null,!0),b.refocus(),b.brush.addToQueue(b.focusCid))}}c&&g==this.lastKey&&[224,17,91,93].indexOf(g)>-1&&this.lastKeyTime&&performance.now()-this.lastKeyTime<300?(e.preventDefault(),b.refocus(void 0,!0),this.lastKey=0):(this.lastKey=e.keyCode,this.lastKeyTime=performance.now()),c=!1}}}).on("keypress",function(a){var c=a.keyCode||a.which;if(w.isLocked&&a.charCode>0)return a.ctrlKey||a.metaKey;var d=b.findNodeByElem(b.getMarkElem());if("TEXTAREA"!=a.target.tagName&&"INPUT"!=a.target.tagName&&!t.isCommand(a)){if(!d||d.canNotDirectEdit())return a.preventDefault();if("Enter"==u[c])a.preventDefault();else if(a.charCode>0&&window.getSelection().rangeCount){b.lastKeyPressOn=new Date,b.selection.prepNode(String.fromCharCode(a.charCode),a);var e=b.getMarkElem().attr("cid");e!=b.focusCid&&b.refocus(e),b.brush.addToQueue(b.focusCid)}}}).on("keyup",function(f){c=!0;var g=f.keyCode||f.which;("CTRL"==u[g]||"Command"==u[g])&&a(!1),"TEXTAREA"!=f.target.tagName&&"INPUT"!=f.target.tagName&&("Right"==u[g]||"Left"==u[g]||"Up"==u[g]||"Down"==u[g]?(e=f.shiftKey,!e&&!b.isIME&&b.refocus()):e&&"Shift"==u[g]?(e=!1,!b.isIME&&b.refocus()):"Enter"==u[g]&&!function(){var a=d("#write .md-focus");2==a.length&&a.get(0).getAttribute("cid")===a.get(1).getAttribute("cid")?(d(a.get(1)).remove(),b.selection.jumpIntoElemEnd(d(a.get(0))),J.call(b,f.metaKey||f.ctrlKey,f.shiftKey)):a.next("div:not('[mdtype]')").remove().length&&J.call(b,f.metaKey||f.ctrlKey,f.shiftKey)}())}).on("compositionend",function(){if(console.log("compositionend"),"TEXTAREA"!=event.target.tagName&&"INPUT"!=event.target.tagName){var a=b.getMarkElem();b.focusCid=b.getMarkElem().attr("cid"),b.brush.addToQueue(b.focusCid),b.isIME=0,setTimeout(function(){a.trigger("inline-input"),b.writingArea.setAttribute("contenteditable","true"),b.brush.brushQueue()},0)}}).on("compositionstart",function(a){"TEXTAREA"!=event.target.tagName&&"INPUT"!=event.target.tagName&&(b.isIME=1,b.selection.prepNode("",a,void 0,!0),w.isMac&&(b.writingArea.setAttribute("contenteditable","false"),d(".md-focus").attr("contenteditable","true")))})},tryOpenLink:function(a){var b=a.attr("href"),c=d("#need_def_link").html();if(this.undo.completeSnap(!0),a[0].hasAttribute("data-ref")){var e=a.data("ref");if(b=this.nodeMap.link_list.getHrefByRef(e,!0),void 0===b)return p.showNotification(c.format(e,e),"warning"),!w.isLocked&&this.docMenu.addEmptyDef(e,g.TYPE.def_link),!1;if(""===b)return p.showNotification(c.format(e,e),"warning"),!1}b&&this.tryOpenUrl_(b)},tryOpenUrl_:function(a){if(a.match(/^#/)){var b=a.substr(1),c=d("#write").find("h1, h2, h3, h4, h5, h6").filter(function(){return d(this).text().toLowerCase().trim().replace(/-/g," ")==b.toLowerCase().trim().replace(/-/g," ")});this.selection.jumpIntoElemBegin(c),this.selection.scrollAdjust(c,10)}else{if(!a.match(/:\/\//)){if(w.isMac&&window.app.path.openURL(a,app.document.currentFilePath()||""))return;a="http://"+a}window.open(a)}},_bindMouseEvents:function(){var a=this,b=!1;d(this.sessionStr).on("mouseover",".footnotes, .md-table, .task-list-item, .md-inline-math",function(a){1==a.which&&d(this).attr("contenteditable",!0).find(".md-math-after-sym").text("")}).on("mouseenter",'[mdtype="heading"], [mdtype="paragraph"]',function(a){1==a.which&&d(this).find(".md-math-after-sym").text("")}).on("mouseup",function(c){function e(){if(g=d(a.writingArea).find(".unholdable"),!g.length||g.find("[cid='"+a.focusCid+"']").andSelf("[cid='"+a.focusCid+"']").length);else if(g.text().length||g.children(".md-line").length>1)g.removeClass("unholdable");else{var b=s.makeEmptyCommand(a.selection.buildUndo()),c=a.findNodeByElem(g).getClosetParagraphLevel();a.undo.UndoManager.addUndoForRemove(b,c),b.redo.push(a.selection.buildUndo()),c.remove(),g.remove(),a.undo.register(b)}}d(".footnotes, .md-table, .task-list-item").attr("contenteditable",!1);var f=a.selection.getRangy();if(f&&!f.collapse&&h.isType(f.commonAncestorContainer.tagName,"LI","UL","QUOTEBLOCK","ARTICLE")&&a.refocus(null),!h.isType(document.activeElement.tagName,"INPUT","TEXTAREA")){var g=a.getMarkElem(c.target),j=g.length&&!g.find("[cid]").length?g.attr("cid"):void 0;if(!g.length&&c.target==document.querySelector(a.sessionStr)&&!b)try{var k=a.nodeMap.getLast(),l=a.findElemById(k.cid),m=c.pageY-l.offset().top-l.height();if(m>0){if(h.isType(k,i.paragraph,i.heading))a.selection.jumpIntoElemEnd(a.findElemById(k.getVeryFirst(!0).cid)),g=l;else{var n=s.makeEmptyCommand(a.selection.buildUndo()),o=a.selection.addUnholdable(k,n),p=a.findElemById(o.cid);a.undo.register(n),a.selection.jumpIntoElemBegin(p),g=p,a.refocus()}c.stopPropagation()}}catch(q){}try{w.isTypeWriterMode?a.selection.typeWriterScroll(null,null,function(){a.refocus(j)}):a.refocus(j),e()}catch(q){console.warn(q.stack)}w.isLocked||a.writingArea.setAttribute("contenteditable","true")}}).on("mousedown",function(c){b=!1;var e=document.body.classList;e.remove("show-word-count"),w.isNode&&e.contains("typora-fullscreen")&&e.contains("native-window")&&G.getCurrentWindow().setMenuBarVisibility(!1);var f=d(c.target);return d(".dropdown-menu.open:not(#outline-dropmenu), .dropdown-menu.show").removeClass("open").removeClass("show"),f.closest("a").length&&!f.closest("img").length&&(c.metaKey||c.ctrlKey)?(c.stopPropagation(),c.preventDefault(),!1):(w.isMac||3!==c.which||d(c.target).closest("[md-inline]").addClass("md-expand"),void(a.lastCursor=a.selection.buildUndo()))}).on("click","[md-inline='link']>.md-content, .md-def-url",function(b){return b.ctrlKey||b.metaKey?(a.tryOpenUrl_(d(this).text()),!1):void 0}).on("contextmenu",function(){document.activeElement.hasAttribute&&document.activeElement.hasAttribute("tabindex")&&document.activeElement.hasAttribute("mdtype")&&window.getSelection().removeAllRanges()}).on("mousemove",function(){b=!0}).on("click",function(b){var c=a.getMarkElem(b.target);if(a.docMenu.autoHideOutline(),a.brush.isAutoCompleteShown()&&a.brush.triggerAutoComplete(),"block"==document.querySelector("#md-searchpanel").style.display&&a.searchPanel.closePanel(),"INPUT"!==b.target.tagName||"checkbox"!==b.target.getAttribute("type")){if("TEXTAREA"===b.target.tagName||"INPUT"===b.target.tagName||b.target.classList&&b.target.classList.contains("code-tooltip"))return b.preventDefault(),void d(b.target).trigger("focus");if(c.hasClass("md-fences")&&a.fences.clickEventHandled.call(a.fences,b,c.attr("cid")))return!1;if(d(b.target).closest("a").length){if(b.stopPropagation(),b.preventDefault(),b.metaKey||b.ctrlKey||w.isLocked)return a.tryOpenLink(d(b.target).closest("a")),!1;var e=d(b.target).closest(".md-image"),f=e.closest('[md-inline="link"]');(f.length?f:e).addClass("md-expand")}h.isType(a.findNodeByElem(c),g.TYPE.paragraph,g.TYPE.heading)&&d(".md-tooltip-remove").remove();var i=a.selection.getRangy();return i&&i.commonAncestorContainer==a.writingArea&&!i.collapsed?(b.stopPropagation(),!1):void 0}}).on("dblclick",function(){return w.isMac&&!/\S\s+\S/.exec(window.getSelection().toString())?(a.selection.selectWord(!1,!0),!1):void 0});document.querySelector("content").addEventListener("wheel",function(b){Math.abs(b.deltaY)<4||w.isFocusMode&&setTimeout(N.bind(a),100)}),d("content").on("scroll",function(b){1==b.buttons&&w.isFocusMode&&setTimeout(N.bind(a),100),d(".auto-suggest-container, .autoComplt-list").hide()}).on("click",function(b){function c(a,c){var d=document.createEvent("MouseEvents");d.initMouseEvent("mousedown",!0,!0,a.ownerDocument.defaultView,1,b.screenX,b.screenY+c,b.clientX,b.clientY+c,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.button),a.dispatchEvent(d)}function e(c,d){d?a.selection.jumpIntoElemEnd(c):a.selection.jumpIntoElemBegin(c),b.preventDefault(),b.stopPropagation()}if(event.target==this){if(a.selection.getRangy())return;for(var f,g=window.innerHeight,h=document.querySelector("#write > *").getBoundingClientRect(),i=b.pageX>h.right-2,j=b.pageX<h.left+2,k=Math.min(h.right-2,Math.max(b.pageX,h.left+2)),l=b.pageY;g>l;l+=20)if(f=d(document.elementFromPoint(k,l)),!f.find("[mdtype]").length&&f.closest("[mdtype]").andSelf("[mdtype]").length)return w.isNodeHtml?e(f,!1||i):c(f[0],l-b.pageY),void a.refocus(f.attr("cid"));for(var l=b.pageY;l>0;l-=20)if(f=d(document.elementFromPoint(k,l)),!f.find("[mdtype]").length&&f.closest("[mdtype]").andSelf("[mdtype]").length)return w.isNodeHtml?e(f,!0&&!j):c(f[0],l-b.pageY),void a.refocus(f.attr("cid"))}})},simpleParse:function(a){var b=a.get("type")==i.line;if(a.get("type")==i.raw_edit||b&&/(^[`~>#|\-+*1-9=\[])|\n\s*\S/g.test(a.safeGetStrAttr("text"))){this.brush.pause();var c,d,e=this.undo.UndoManager.makeEmptyCommand(),f=a.getClosetParagraphLevel();return e.undo.push(this.selection.buildUndo()),e.undo.push(s.buildReplaceUndo(f)),c=a.parseFrom(),b=b&&1===c[1].length,b&&h.isType(a,i.line)?(this.brush.restart(),null):(b?(c=a.separateBlockFromLine(),d="",e.redo.push(s.buildReplaceUndo(c[1])),c[0]&&(d+=c[0].toHTML(),s.addUndoForInsert(e,c[0])),d+=c[1].toHTML(),c[2]&&(d+=c[2].toHTML(),s.addUndoForInsert(e,c[2]))):(e.redo.push(this.undo.buildReplaceUndo(c[1][0])),s.addUndoForInsertArray(e,c[1].slice(1)),d=c[0]),this.brush.restart(),[e,d,f.cid])}},findElemById:function(a){return a?d("[cid='"+a+"']"):d()},findNodeByElem:function(a){return a.length?this.nodeMap.get("allNodes").get(a.attr("cid")):null},replaceText:function(a,b,c,e,f){function g(){this.undo.snap(n,2,void 0,!0),p=a.length-q.toString().length,q.deleteContents(),q.insertNode(document.createTextNode(a)),o.start+=p,o.end+=p,r.moveToBookmark(o),this.selection.setRange(r),this.brush.addToQueue(n)}function i(a){this.selection.deRange(a);var b=d(a.startContainer).closest(".md-meta"),c=d(a.endContainer).closest(".md-meta");a.collapsed||!b.length&&!c.length||s>3||b[0]!=c[0]&&(b.length&&a.setStartAfter(b[0]),c.length&&a.setEndBefore(c[0]),s++,i.call(this,a))}if(this.sourceView.inSourceMode||this.isIME||!this.writingArea.contains(document.activeElement)||h.isType(document.activeElement.tagName,"INPUT","TEXTAREA"))return!0;var j,k,l,m,n,o,p,q=this.selection.rangy.createRange(),r=this.selection.getRangy(),s=0;if(q.setStart(b,c),q.setEnd(e,f),!r.collapsed)return!0;if(l=this.getJQueryElem(q.commonAncestorContainer),m=l.closest("[cid]"),n=m.attr("cid"),!n)return!1;if(o=r.getBookmark(m[0]),q.collapsed){var t;return 1==a.length&&(t=this.UserOp.hanldePair(this,a,this.getNode(n),o))?(this.undo.register(t),!1):!0}return l.closest("code, script").length?!1:q.commonAncestorContainer==r.commonAncestorContainer&&r.startOffset-q.endOffset>=0&&r.startOffset-q.endOffset<=2||r.equals(q)?(g.call(this),!1):(k=this.selection.rangy.createRange(),k.setEnd(r.startContainer,r.startOffset),k.setStart(q.endContainer,q.endOffset),j=k.toString(),j.length&&j.replace(/[*_\s\]]/g,"").length<2&&(i.call(this,q),g.call(this)),!1)},getMarkdown:function(a){if(this.sourceView.inSourceMode)return this.sourceView.cm.getValue();var b=this.nodeMap.toMark();return a?b.replace(/\n+$/,""):b},getNode:function(a,b){return b&&(a=a||this.focusCid,!a&&(a=this.refocus())),this.nodeMap.get("allNodes").get(a)},restoreLastCursor:function(a,b){a&&a.preventDefault(),this.lastCursor&&this.undo.exeCommand(this.lastCursor,b?[]:void 0)},toggleFocusMode:function(){w.isFocusMode?(w.isFocusMode=!1,N.call(this)):(w.isFocusMode=!0,M.call(this))},updateFocusMode:function(a){a?M.call(this):N.call(this)},toggleTypeWriterMode:function(a){if(void 0===a&&(a=!w.isTypeWriterMode),w.isTypeWriterMode!=a){w.isTypeWriterMode=a;var b=this;if(a){document.body.classList.add("on-typewriter-mode");var c=b.writingArea.clientHeight,e=(d("content"),(c-b.defaultTextHeight)/2);document.querySelector("#write-style").innerHTML="#write { \npadding-top: $1px;\npadding-bottom: 0;\n}\n#write:after {\nheight: $2px;\n}".replace(/\$1/g,e-b.defaultTextHeight).replace(/\$2/g,e+b.defaultTextHeight),b.selection.typeWriterScroll(null,null)}else document.querySelector("#write-style").innerHTML=0,document.body.classList.remove("on-typewriter-mode"),b.selection.scrollAdjust()}}}),J=function(a,b){function c(c){if(d.attr("mdtype")==g.TYPE.meta_block)try{var e=c.selection.getRangy();return!a&&!b&&e.collapsed&&e.endContainer.textContent.replace(/\n$/,"").length<=e.endOffset&&e.endContainer.textContent.match(/\n{2,}$/g)?!1:!0}catch(f){return!0}return!1}this.brush.pause(),this.brush.hideAutoComplete(),this.undo.completeSnap(!0);var d=this.getMarkElem();if(this.brush.brushNode(d.attr("cid")),d=this.getMarkElem(),h.isType(d.attr("mdtype"),g.TYPE.fences,g.TYPE.footnote))return!0;var e,f=(window.getSelection(),d.closest(".md-table").length),i=f,j=this,k=d.attr("cid"),l=this.store(k);if(w.isTypeWriterMode&&this.selection.lockScroll(),c(this)){var m=s.makeEmptyCommand();m.undo.push(this.selection.buildUndo()),v.insertInlineText(this,null,"\n",this.selection.getOffset(d),m,!0),this.undo.register(m),this.brush.addToQueue(k)}else if(f)this.tableEdit.moveToNextCell(!0);else if(!i){var m=this.selection.prepNode("",null,!0);if(m)this.undo.register(m);else if(l){this.undo.completeSnap(!0);var e=l.breakOn(a,this,b);if(e){var n=this.findElemById(e.oldCid);n.replaceWith(e.newHtml),h.isType(this.getNode(e.nextFocus),g.TYPE.math_block)?(e.command.redo.push({type:"fences-pos",id:e.nextFocus,pos:{line:0,ch:0}}),setTimeout(function(){j.mathBlock.startEditing(n.attr("cid"))},0)):(this.selection.jumpIntoElemBegin(this.findElemById(e.nextFocus)),e.command.redo.push(this.selection.buildUndo())),this.focusCid=this.refocus(e.nextFocus),this.undo.register(e.command),this.refresh()}}}return this.refocus(),this.brush.resume(),!0},K=function(){d(".md-tooltip-remove").remove(),d(".md-focus").removeClass("md-focus"),d(".md-focus-container").removeClass("md-focus-container"),document.body.classList.remove("show-word-count")},L=!1,M=function(){H&&(clearTimeout(H),H=null),L||(L=!0,document.body.classList.add("on-focus-mode"))},N=function(){L&&(L=!1,document.body.classList.remove("on-focus-mode"))};c.exports=I}),define("app/document/MarkParser",["app/document/StringUtils","app/document/Node","exoskeleton-master/exoskeleton","jquery/jquery","app/document/StringUtils","app/editor/Inline","app/document/Node","app/editor/UndoManager","app/editor/Emoji"],function(a,b,c){"use strict";function d(a){return a?a.replace(new RegExp(ab.ESCAPE_ESCAPE,"g"),"\\\\").replace(new RegExp(ab.ESCAPE_VLINE,"g"),"\\|"):a}function e(a,b){function c(a){return p.isType(this.cur,q.paragraph)&&1==this.cur._lines.length&&this.cur._lines[0].match(z)?(f.call(this,this.cur),this.cur=null,a.set("ahead",1),!0):void 0}function e(a){var b=this.lines[this.ln+1];return void 0!==b&&b.match(z)?(this.ln++,a.set("tail",1),!0):void(void 0!==b&&a.set("tail",0))}function f(a){this.blocks.remove(a),a.remove()}function g(a,b){a=a||this.cur;var c=a;this.oldNode&&!this.blocks.length?(p.isType(a,q.paragraph)&&p.isType(this.oldNode,q.line)?(a.set("type",q.line),a.set("text",a.getText())):a.giveChildrenTo(this.oldNode),this.oldNode.copyContentFrom(a),a._lines&&(this.oldNode._lines=a._lines),a.remove(),this.blocks.push(p.isType(this.oldNode,q.line)?this.oldNode.get("parent"):this.oldNode),c=this.oldNode):(this.parent?this.parent.append(a):this.blocks.length?this.blocks.last().insert(a):(console.error("parse error"),a.set("parent",this.parent),a.set("in",this.nodeMap),a.set("attachTo",this.nodeMap)),this.blocks.push(a)),this.cur=b?c:null}function h(a,b){this.cur&&(o.onClose&&o.onClose.call(this,b),b||void 0!=this.cur.get("tail")||this.cur.set("tail",0),g.call(this,this.cur,a))}function i(a,b,d){var e=new p({type:q.list,style:a,"in":this.nodeMap,pattern:b});e._mark=d,c.call(this,e),h.call(this),this.cur=e}function j(b){var c=b?R:P,d=b?S:Q;if(l=c.exec(a)){var e,f=this.ln+1,g=this.lines.length,h=a,i=this.lines[f],j=[];if(g>f&&this.lines[f].match(d))for(h=l[1].replace(/\\\ /g,ab.ESCAPE_SPACE).split(T),f++;g>f&&(e=this.lines[f],l=c.exec(e));f++)j.push(l[1].replace(/\\\ /g,ab.ESCAPE_SPACE).split(T));if(j.length)return i=b?i.split(T):i.replace(/^ *\||\| *$/g,"").split(T),k.call(this,h,i,j,f-1),!0}return!1}function k(a,b,f,i){function j(a,b){var c,e=new p({type:q.table_row,parent:a,"in":a.get("in"),header:!k,before:k});for(n=0;m>n;n++){var f=new p({type:q.table_cell,parent:e,"in":e.get("in"),before:c,text:d(b[n]||"").trim()});c=f}return e}var k,l=new p({type:q.table,"in":this.nodeMap}),m=a.length;b=b||new Array(a.length),f=f||[[]];for(var n=0;m>n;n++)b[n]=b[n]||"",b[n]=b[n].match(/^ *-+: *$/)?"right":b[n].match(/^ *:-+: *$/)?"center":b[n].match(/^ *:-+ *$/)?"left":null;l.set("align",b),k=j.call(this,l,a),f.forEach(function(a){k=j.call(this,l,a)},this),c.call(this,l),h.call(this),i&&(this.ln=i),e.call(this,l),g.call(this,l),this.cur=null}var l,m,o;if(this.cur){o=Y[this.cur.get("type")];var r=!b&&o.shouldClose.call(this,a);if(r>0||b){if(h.call(this,!1,b),2==r)return}else if(!r)return void(o.onContinue&&o.onContinue.call(this,a))}if(!b){if(!this.skips.old_code&&(l=H.exec(a)))return void(p.isType(this.cur,q.code)&&o?o.onContinue&&o.onContinue.call(this,a):(m=new p({type:q.code,pattern:l[1],"in":this.nodeMap}),c.call(this,m),m._lines=[l[2]],h.call(this),this.cur=m));if((l=C.exec(a))&&p.isType(this.cur,q.paragraph)&&!n.isNullOrBlank(this.cur._lines.last()))return m=new p({type:q.heading,depth:"="==l[1]?1:2,text:d(this.cur._lines.pop()),pattern:"{0}\n"+a,"in":this.nodeMap}),c.call(this,m),h.call(this),e.call(this,m),void g.call(this,m);if(a.match(D)){if(l=A.exec(a))return m=new p({type:q.blockquote,"in":this.nodeMap,pattern:l[1]}),c.call(this,m),m._lines=[l[2]],m._indent=l[1].replace(/[ \u00A0]*>/,"").length,h.call(this),void(this.cur=m);if(l=B.exec(a))return m=new p({type:q.heading,depth:l[2].length,text:d(l[3]),pattern:(this.skips.enableStartMatch?l[1].replace(/#$/,"# "):l[1])+"{0}"+l[4],"in":this.nodeMap}),c.call(this,m),e.call(this,m),h.call(this),void g.call(this,m);if(l=u.tasklist.exec(a))return i.call(this,p.ListType.task,l[2],l[3]),o=Y[q.list],void o.onContinue.call(this,a,l[0].replace(/\t/,"  ").replace(/\s+$/,"").length+1);if(l=u.ul.exec(a))return i.call(this,p.ListType.ul,l[2],l[3]),o=Y[q.list],void o.onContinue.call(this,a,l[0].replace(/\t/,"  ").replace(/\s+$/,"").length+1);if(l=u.ol.exec(a))return i.call(this,p.ListType.ol,l[0].replace(/\d/,"{0}")),o=Y[q.list],void o.onContinue.call(this,a,l[0].replace(/\t/,"  ").replace(/\s+$/,"").length+1);if(this.skips.enableMetaBlock&&0==this.ln&&a.match(N)){var s=this.ln+1,t=this.lines.length,v=this.skips.enableStartMatch||!1;if(!v)for(;t>s;s++)if(this.lines[s].match(N)){v=s>this.ln+1;break}if(v)return m=new p({type:q.meta_block,"in":this.nodeMap,text:d(this.lines.slice(this.ln+1,s).join("\n"))}),c.call(this,m),this.ln=s,e.call(this,m),h.call(this,!0),void g.call(this,m)}if((l=a.match(G))&&!this.skips.math_block){var s=this.ln+1,t=this.lines.length,v=this.skips.enableStartMatch||!1;if(!v)for(;t>s;s++)if(this.lines[s].match(G)){v=!0;break}if(v)return m=new p({type:q.math_block,"in":this.nodeMap,text:d(this.lines.slice(this.ln+1,s).join("\n"))}),c.call(this,m),this.ln=s,e.call(this,m),h.call(this,!0),void g.call(this,m)}if(l=E.exec(a))return m=new p({type:q.fences,lang:l[3],pattern:l[1]+"{0}","in":this.nodeMap}),m._mark=l[2],m._lines=[],c.call(this,m),h.call(this),void(this.cur=m);if(l=J.exec(a))return m=new p({type:q.hr,pattern:l[1],"in":this.nodeMap}),c.call(this,m),e.call(this,m),h.call(this,!0),void g.call(this,m);if(a.match(K))return m=new p({type:q.toc,"in":this.nodeMap}),c.call(this,m),e.call(this,m),h.call(this,!0),void g.call(this,m);if(j.call(this,!1))return;if(this.skips.enableStartMatch&&(l=O.exec(a)))return void k.call(this,l[1].split(T));if(l=M.exec(a))return m=new p({type:q.def_footnote,ref:d(l[1]),text:d(l[2]),"in":this.nodeMap}),c.call(this,m),e.call(this,m),h.call(this,!0),void g.call(this,m);if(l=L.exec(a))return m=new p({type:q.def_link,ref:d(l[1]),href:d(l[2]),title:d(l[3]),"in":this.nodeMap}),c.call(this,m),e.call(this,m),h.call(this,!0),void g.call(this,m)}else if(j.call(this,!0))return;this.cur||(this.cur=new p({type:q.paragraph,"in":this.nodeMap}),this.cur._lines=[]),p.isType(this.cur,q.paragraph)?this.cur._lines.push(a):o&&o.onContinue&&o.onContinue.call(this,a)}}function f(a,b,c){this.options=a||k({},eb.defaults),this.options.decorate=b||r.decorate,this.options.context=c||this,this.rules=_.normal,this.options.gfm?this.rules=this.options.breaks?_.breaks:_.gfm:this.options.pedantic&&(this.rules=_.pedantic),File.option.enableHighlight&&(this.rules.escape2=/^[\uE013\uE014\uE015\uE018]/)}function g(a,b){var c=/([a-z])_([a-z])/gi;return a=a.replace(c,"$1"+ab.UNDER_CHAR+"$2").replace(/\\[\*_=\]]/gi,function(a){return cb[a]||a}),b&&(a=a.replace(/((?:(https?:\/\/[\w-.\/?%&=:#\uE006]+)|((mailto:\/\/)?[a-z0-9][a-z0-9\-_+\.\uE006]+(@)[a-z0-9][a-z0-9\-_\uE006]*\.(com|co|net|org|edu|io|tv|fm|me|info|cc|ca|de|cn|ru)(\.[a-z0-9][a-z0-9\-_\uE006]+)?)|(www\.[a-z0-9][a-z0-9\-_\uE006]*(\.[a-z0-9\-_\uE006]+)+(\/[\w-.\/?%&=:#\uE006]*)?)))/gi,ab.URL_START+"$1"+ab.URL_END)),a}function h(a){return a.replace(/[\uE006-\uE018]/g,function(a){return bb[a]||""})}function i(a,b){return a=a.source,b=b||"",function c(d,e){return d?(e=e.source||e,e=e.replace(/(^|[^\[])\^/g,"$1"),a=a.replace(d,e),c):new RegExp(a,b)}}function j(){}function k(a){for(var b,c,d=1;d<arguments.length;d++){b=arguments[d];for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])}return a}function l(a,b,c,d,e){function f(a,b,c){return new p({type:c||q.paragraph,text:a,parent:b,"in":b.get("in")})}function g(c,d,e){t+=c.length,a=a.substring(t),e.cid==b.editor.focusCid&&b.editor.store(),b.editor.undo.completeSnap(!0),d.undo.push(s.buildReplaceUndo(e.getClosetParagraphLevel()))}function h(c,d,e,f){var g,h="";return f=f||l(a,b,c,!1,d),p.isType(e,q.list,q.blockquote)&&p.isType(e.get("parent"),q.paragraph)?(g=e.separateBlockFromLine(),e=g[1],d.redo.push(s.buildReplaceUndo(e)),g[0]&&s.addUndoForInsert(d,g[0]),g[2]&&s.addUndoForInsert(d,g[2]),h=(g[0]&&g[0].toHTML()||"")+e.toHTML(f.html)+(g[2]&&g[2].toHTML()||"")):(d.redo.push(s.buildReplaceUndo(e)),h=e.toHTML(f.html)),{innerHtml:f.html,html:h,offset:t+f.offset,focus:f.focus,blockChanged:!0,command:d}}function i(b){return g(a.match(/^ *>[ \u00A0]?/)[0],b,c),c.set("type",q.blockquote),c.set("text",""),u=f(a,c),h(u,b,c)}function j(d,e,i){var j,k,m,n=File.option.indentSize;return g(d,e,c),c.set("type",q.list),c.set("text",""),c.set("style",i),k=f("",c,q.list_item),k.set("checked",null!=/x|X/g.exec(d)),u=f(a,k,q.paragraph),i==p.ListType.ul&&c.set("pattern",d.trim()+" ".repeat(n-1)),m=l(a,b,u,!1),m.html=k.toHTML(m.html),j=h(null,e,c,m)}function k(d,e){var f,i,j=c.get("parent"),k=j.get("parent"),m=k.get("parent");return g(d,e,m),m.set("style",p.ListType.task),k.set("checked",null!=/x|X/g.exec(d)),c.set("text",a),u=c,i=l(a,b,u,!0,e),i.html=k.toHTML(),f=h(null,e,m,i),f.replaceCid=m.cid,f}function n(a,b){var c=a.get("parent"),d=c&&c.get("parent");return p.isType(a,q.line)&&!a.get("before")&&c&&p.isType(c,q.paragraph)&&!c.get("before")&&d&&p.isType(d,q.list_item)&&!d.get("before")&&!d.get("after")&&d.get("parent").get("style")==p.ListType.ul&&/(^ *\[(x|X)\]( |\t)+)|((^ *\[ \]) +)/g.exec(b)}function o(b){return u=f(a,c,q.line),h(u,b,c)}var r,t=0,u=c,v=[];if(e=e||!d&&s.makeEmptyCommand(),!d){if(/^ *>[^\n]+/.exec(a))return i(e);if(r=/^( *)[*+-][ \t\u00A0]+(\[(x|X)\]|\[ \]) +/.exec(a))return j(r[0],e,p.ListType.task);if(r=/^( *)[*+-][ \t\u00A0]+/.exec(a))return j(r[0],e,p.ListType.ul);if(r=/^( *)\d+\.[ \t\u00A0]+/.exec(a))return j(r[0],e,p.ListType.ol);if(r=n(c,a))return k(r[0],e);if(p.isType(c,q.paragraph))return o(e)}var w={innerHtml:m(a,b.inline,p.isType(c,q.heading),c,v),offset:0,focus:c.cid,blockChanged:!1,command:e,cursorDiff:v};return w.html=c&&c.toHTML(w.innerHtml),w}function m(a,b,c,d,e){for(var f=[],g="";a;){if(!c){if(f=/^ *>[^\n]+/.exec(a)){a=a.substring(f[0].length),g+=b.options.decorate({type:q.blockquote,pattern:f[0].match(/^( *> ?)+/gm)[0],inner:m(f[0].replace(/^( *> ?)+/gm,""),b,!0,null,e)});continue}if(f=/^( *#{1,6} *)([^\n]+? *)(#* *)(\n{1,2}|$)/.exec(a)){a=a.substring(f[0].length);var h=f[1].length;g+=b.options.decorate({type:q.heading,meta_before:f[0].substring(0,h),meta_after:f[3],inner:b.output(f[2],null,null,null,{attr:!1},e)});continue}if(f=E.exec(a)){a=a.substring(f[0].length),g+=b.options.decorate({type:q.fences,lang:f[3],pattern:f[1]});continue}if(f=M.exec(a)){a=a.substring(f[0].length),g+=b.options.decorate({type:q.def_footnote,ref:f[1],inner:b.output(f[2]||"",null,null,null,null,e)});continue}if(a=a.replace(/^(\s*)(\[\^)/g,"$1"+ab.DEF_FOOT_PERFIX_CHAR),f=/^\s*\[([^\]]+)\]:\s+([^\n]*)/.exec(a)){a=a.substring(f[0].length),g+=b.options.decorate({type:q.def_link,ref:f[1],inner:b.output(f[2]||"",null,null,null,null,e)});continue}}if(f=/(^[^\n]+(\n){0,1})/g.exec(a))a=a.substring(f[0].length),g+=b.options.decorate({type:q.paragraph,inner:b.output(f[0],null,null,null,{attr:!p.isType(d,q.heading)},e)});else if(f=/^\s*\n\s*/.exec(a))a=a.substring(f[0].length),g+=f[0];else if(a.length){console.log(a);break}}return g}var n=a("app/document/StringUtils"),o=a("app/document/Node"),p=o.Node,q=o.TYPE,r=a("app/editor/Inline"),s=a("app/editor/UndoManager"),t=a("app/editor/Emoji"),u={ul:/^(\s*)(([-+*])\s+)/,ol:/^(\s*)\d+\.\s+/,tasklist:/^(\s*)(([-+*])\s*)\[((x|X)| )\]\s+/},v=/^(\s*)([-+*>\[]|\d+\.)\s+/,w={ul:/^(\s*[-+*])\s+/,ol:/^(\s*\d+\.)\s+/,tasklist:/^(\s*[-+*]\s*\[((x|X)| )\])\s+/},x=/\r\n|\r|\n|\u2424/,y=/^[ \u00A0]{0,3}$/,z=/^[\s\u00A0]*$/,A=/(^\s{0,3}> *)(.*)$/,B=/(^\s*(#{1,6})\s*)([^\n]+?)(\s*#*\s*)$/,C=/^ *(=|-){2,}[\s\u00A0]*$/,D=/^\s*[-+*_<\[|#0-9`~=>$]/,E=/^( *(`{3,}|~{3,})[ \t\u00A0]*)([^\n`]+)? *$/,F=/^\s*(`{3,}|~{3,})\s*$/,G=/^\s*\${2}\s*$/,H=/^( {4}|\t)(\s*\S.*)$/,I=/^( {4}|\t)/,J=/^( *[-*_]{3,}) *$/,K=/^\s*\[toc\]\s*$/i,L=/^\s*\[([^\]]+)\]:\s*<?([^\s>]+)>?(?:\s+["'(]([^\n]*)["')])?\s*$/,M=/^\s*\[\^([^\]]+)\]:\s*([^\n]*)$/,N=/^-{3}$/,O=/^ *\|([^\|]+\|.+)\|\s*$/,P=/^\s*\|(.+)\|\s*$/,Q=/^ *\|(\s*[-:]+\s*\|[-| :]*)$/,R=/^\s*([^|\s].*\|.*)\s*$/,S=/^ *([-:]+\s*\|[-| :]*)$/,T=/ *\| */,U="\n",V={},W={},X={},Y={paragraph:{shouldClose:function(a){return a.match(y)?(this.cur.set("tail",1),2):-1},onClose:function(){this.cur._lines.length>1&&this.cur._lines[0].match(z)&&(this.cur.set("ahead",1),this.cur._lines.shift()),!this.cur._lines.length&&this.cur._lines.push(""),this.cur._lines.forEach(function(a){this.cur.append(new p({type:q.line,text:d(a)}))},this),this.cur._lines=void 0,this.cur.set("text","")},onContinue:function(a){this.cur._lines.push(a)}},blockquote:{shouldClose:function(a){return a.trim().length?a.match(A)?0:-1:(this.cur.set("tail",1),2)},onClose:function(){new $(this.cur._lines,this.cur,null,null,this.skips),this.cur._lines=void 0,this.cur.unset("text")},onContinue:function(a){V[this.cur._indent]||(V[this.cur._indent]=new RegExp("^[ ]{0,3}> {0,"+(this.cur._indent||0)+"}")),this.cur._lines.push(a.replace(V[this.cur._indent],""))}},list:{shouldClose:function(a){var b,c=this.cur.getLastChild();if(W[c._indent]||(W[c._indent]=new RegExp("^ {"+c._indent+",}|\\t")),a.match(W[c._indent]))return 0;if(a.match(z))return this.cur.set("tail",(this.cur.get("tail")||0)+1),this.cur.get("tail")>1?2:0;if(b=u[this.cur.get("style")].exec(a))return this.cur.get("style")!=p.ListType.ol?b[3]==this.cur._mark?0:1:0;var d=this.lines[this.ln-1];return d.match(z)?1:-1},onClose:function(){for(var a=this.cur.getLastChild(),b=this.cur.get("tail")||0;b>0;)!a._lines.last().trim().length&&a._lines.pop(),b--;new $(a._lines,a,null,null,this.skips),a._lines=void 0,a._indent=void 0,a._indentDecided=void 0,a.unset("text"),this.cur._mark=void 0,this.cur.unset("text")},onContinue:function(a,b){var c,d=this.cur.getLastChild(),e=this.cur.get("style");if(a.match(z)||this.cur.unset("tail"),!d)return d=new p({type:q.list_item}),this.cur.append(d),d._indent=b,b&&this.cur.set("subindent",b),d._lines=[a.replace(u[e],"")],void(e==p.ListType.task&&d.set("checked",!!u.tasklist.exec(a)[5]));W[d._indent]||(W[d._indent]=new RegExp("^ {"+d._indent+",}|\\t"));var f=a.match(W[d._indent]);return X[d._indent]||(X[d._indent]=new RegExp("^ {2,"+d._indent+"}|\\t")),a=a.replace(X[d._indent],""),!f&&(c=w[e].exec(a))?(b=c[1].replace(/\t/g,"").length+1,b=Math.max(b,File.option.indentSize),d._lines.length>1&&d._lines.last().match(z)?(d._lines.pop(),d.set("tail",1)):d.set("tail",0),this.cur.unset("tail"),new $(d._lines,d,null,null,this.skips),d._lines=void 0,d._indent=void 0,d.unset("text"),d=new p({type:q.list_item}),e==p.ListType.task&&d.set("checked",!!c[3]),this.cur.append(d),d._indent=b,void(d._lines=[a.substring(c[0].length)])):(d._indentDecided||(c=v.exec(a),c&&d._indent&&d._indent<4&&c[1].length&&(d._indent+=c[1].length,this.cur.set("subindent",d._indent),a=a.substring(c[1].length)),d._indentDecided=!!c),void d._lines.push(a))}},fences:{shouldClose:function(a){var b;return(b=F.exec(a))&&this.cur._mark==b[1]?2:0},onContinue:function(a){this.cur._lines.push(a)},onClose:function(){this.cur.set("text",d(this.cur._lines.join("\n"))),this.cur._mark=void 0,this.cur._lines=void 0;var a=this.lines[this.ln+1];void 0!==a&&a.match(z)&&(this.cur.set("tail",1),this.ln++)}},code:{shouldClose:function(a){return a.match(H)?0:this.cur._lines.length>1&&!this.cur._lines.last().match(z)&&a.match(z)?0:1},onClose:function(){this.cur._lines.length>1&&(this.cur._lines.last().match(z)?(this.cur.set("tail",1),this.cur._lines.pop(),this.cur._lines.length>1&&this.cur._lines.last().match(z)&&(this.cur._lines.pop(),this.ln--)):this.cur.set("tail",0)),this.cur.set("text",d(this.cur._lines.join("\n"))),this.cur.attributes.type=q.fences,this.cur._lines=void 0},onContinue:function(a){this.cur._lines.push(a.replace(I,""))}}},Z=function(a,b,c,d,e){a.parent=b,a.cur=null,a.skips=e,a.ln=0,a.blocks=[],a.oldNode=d,a.nodeMap=b||d,a.nodeMap=a.nodeMap?a.nodeMap.get("in"):c},$=function(a,b,c,d,f){var g=a;"string"==typeof a&&(a=a.replace(/\\\\/g,ab.ESCAPE_ESCAPE).replace(/\\\|/g,ab.ESCAPE_VLINE),g=a.split(x),1==g.length&&p.isType(d,q.line)&&(f.enableStartMatch=!0),a.charCodeAt(a.length-1)===U&&(h-=1));var h=g.length;for(this.lines=g,Z(this,b,c,d,f),this.skips.enableMetaBlock=this.skips.enableMetaBlock&&!b;this.ln<=h;this.ln++)e.call(this,g[this.ln],this.ln==h);return this};p.parseFrom=function(a,b,c,d){c=c||{};var e=new p({type:q.raw_edit,"in":b,attachTo:c.noTop?null:b,text:a});return e.parseFrom(c,void 0,d)},p.prototype.parseFrom=function(a,b,c){function d(a){if(p.isType(a,q.list_item)&&!a.get("children").length){var b=new p({type:q.paragraph,text:a.get("text"),parent:a,"in":a.get("in")});return a.set("text",""),b}return null}if(a=a||{},p.isType(this.get("parent"),q.table_row))return this.set("type",q.table_cell),this.set("text",this.safeGetStrAttr("text").replace(/\n|\r/gi,"").replace(/([^\\])\|/gi,"$1|")),!c&&this.toHTML();if(!p.isType(this,q.line,q.raw_edit,q.list_item))return[!c&&this.toHTML(),[this]];var e=d(this)||this,f=a.skips||{};if(b=b||e.get("text"),this.get("type")===q.line&&(b=b.replace(/\r?\n/,"")),f.enableMetaBlock=this.get("attachTo")&&!this.get("before"),f.old_code=f.old_code===!1?!1:!0,this.isBlock(!0)){var g=this.get("before"),h=this.get("after"),i=new $(b,null,e.get("in"),e,f).blocks;return i.length<=1?[!c&&this.toHTML(),[this]]:(i[0].set("before",g),i.last().set("after",h),[!c&&o.NodeCollectionUtils.toHTML(i),i])}};var _={escape:/^\\([\\`*{}\[\]()#+\-.!_>$|<~])/,escape2:/^[\uE013\uE014\uE018]/,autolink:/^<((([^ >]+(@|:\/)[^ >]+))|(\s*www\.[^ >]+))>/,url:/^\uE016([^\uE017]+)\uE017/i,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^\[((?:\[[^\]]*\]|[^\[\]])*)\]\(<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])(.*?)\4[ \t]*)?\)/,image:/^\!\[((?:\[[^\]]*\]|[^\[\]])*)\]\(<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])(.*?)\4[ \t]*)?\)({([^{}\(\)]*)})?/,reflink:/^(!?)\[(inside)\]\s*\[([^\]]*)\]/,strong:/^(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/,em:/^(\*|_)(?=\S)([^\r]*?\S)\1/,highlight:/^(\=\=)(?=\S)([^\r]*?\S)\1/,code:/^(`+)([\s\S]*?[^`])\1(?!`)/,del:/^~~(?=\S)([\s\S]*?\S)~~/,underline:/^<u>([^\r]*?\S)<\/u>/,text:/(\s|\S)+?[^\u200B\uE010-\uE018\uE006\\<!\[_*`{\$\:~\^\=]*/,footnote:/^\[\^([^\]]+)\]/,attr:/^{( *([#.][-\w_\uE006]+ *|[-\w_\uE006]+=[-\w_"'\uE006]+ *)+)}/,html:/(comment|closed|closing)/,emoji:/^(\u200B*):([\w\uE006-]+):(\u200B*)/,inline_math:/^\$.*(?:[^\\])\$/,subscript:/^~(([^\s]|(\\\s))+?)~/,superscript:/^\^(([^\s]|(\\\s))+?)\^/,linebreak:/  $/};
_._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,_._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,_._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b",_.html=i(_.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,_._tag)(),_.link=i(_.link)("inside",_._inside)("href",_._href)(),_.reflink=i(_.reflink)("inside",_._inside)(),_.normal=k({},_),_.pedantic=k({},_.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),_.gfm=_.normal,_.breaks=k({},_.gfm,{text:i(_.gfm.text)("{2,}","*")()}),f.rules=_;{var ab={UNDER_CHAR:"",MATH_CHAR:"",DEF_FOOT_PERFIX_CHAR:"",ESCAPE_SATR:"",ESCAPE_UNDERLINE:"",ESCAPE_EQUAL:"",URL_START:"",URL_END:"",ESCAPE_END_SQUARE_BRACKET:"",ESCAPE_ESCAPE:"",ESCAPE_VLINE:"",ESCAPE_SPACE:""},bb={"":"[^","":"*","":"_","":"=","":"","":"","":"_","":"]"},cb={"\\*":ab.ESCAPE_SATR,"\\=":ab.ESCAPE_EQUAL,"\\_":ab.ESCAPE_UNDERLINE,"\\]":ab.ESCAPE_END_SQUARE_BRACKET};!function(a){var b={};for(var c in a)b[a[c]]="\\"+c;return b}(bb)}f.skipLink={autolink:1,url:1,link:1,reflink:1},f.prototype.output=function(a,b,c,d,e,i){function j(a,b){var c=a.last();c&&c.type===q.plain?c.text+=b:a.push({type:q.plain,text:b})}function k(a){return F="",a.map(function(a){F+=b(a,v)}),F}b=b||this.options.decorate,e=e||{},e.attr=e.attr===!1?!1:!0,File.option.enableInlineMath||(e.inline_math=!0),File.option.enableSubscript||(e.subscript=!0),File.option.enableSuperscript||(e.superscript=!0),File.option.enableHighlight||(e.highlight=!0),i=i||[];var l,m,n,o,p,r=0,s={},u=[],v=this.options;for(d||(a=g(a,!e.url));a;)if(n=this.rules.escape2.exec(a))r+=n[0].length,a=a.substring(n[0].length),u.push({type:q.escape,text:bb[n[0]]});else if(n=this.rules.escape.exec(a))r+=n[0].length,a=a.substring(n[0].length),u.push({type:q.escape,text:n[1]});else if(e.autolink||!(n=this.rules.autolink.exec(a)))if(e.url||!(n=this.rules.url.exec(a)))if(n=this.rules.underline.exec(a))r+=n[0].length,a=a.substring(n[0].length),l=n[0],u.push({type:q.underline,inner:this.output(n[1],b,null,!0),text:n[1]});else if(n=this.rules.tag.exec(a))r+=n[0].length,a=a.substring(n[0].length),l=n[0],u.push({type:q.tag,text:l});else if(!(n=this.rules.link.exec(a))||e.link)if(!(n=this.rules.image.exec(a))||e.image)if(e.reflink||!(n=this.rules.reflink.exec(a)))if(e.footnote||!(n=this.rules.footnote.exec(a)))if(e.attr||!(n=this.rules.attr.exec(a)))if(n=this.rules.strong.exec(a))r+=n[0].length,a=a.substring(n[0].length),u.push({type:q.strong,pattern:n[1],inner:this.output(n[2],b,null,!0)});else if(n=this.rules.em.exec(a))r+=n[0].length,a=a.substring(n[0].length),u.push({type:q.em,pattern:n[1],inner:this.output(n[2],b,null,!0)});else if(n=this.rules.code.exec(a))r+=n[0].length,a=a.substring(n[0].length),u.push({type:q.code,pattern:n[1],text:n[2]});else if(n=this.rules.del.exec(a))r+=n[0].length,a=a.substring(n[0].length),u.push({type:q.del,pattern:"~~",inner:this.output(n[1],b,null,!0)});else if((n=this.rules.emoji.exec(a))&&t.data[n[2]=n[2].replace(/\uE006/g,"_")])a=a.substring(n[0].length),u.push({type:q.emoji,text:n[2],inner:t.data[n[2]]}),!n[1].length&&(i[r]=1),r+=n[0].length,!n[3].length&&(i[r]=1);else{if(!e.subscript&&(n=this.rules.subscript.exec(a))){a=a.substring(n[0].length),n=n[1].split(/\\\s/g);var w=[];n[0]&&w.push({type:q.plain,text:n[0]});for(var x=1;x<n.length;x++)w.push({type:q.escape,text:" "}),n[x]&&w.push({type:q.plain,text:n[x]});u.push({type:q.subscript,inner:k(w)})}if(!e.superscript&&(n=this.rules.superscript.exec(a))){a=a.substring(n[0].length),n=n[1].split(/\\\s/g);var w=[];n[0]&&w.push({type:q.plain,text:n[0]});for(var x=1;x<n.length;x++)w.push({type:q.escape,text:" "}),n[x]&&w.push({type:q.plain,text:n[x]});u.push({type:q.superscript,inner:k(w)})}if(e.inline_math||!(n=this.rules.inline_math.exec(a)))if(e.highlight||!(n=this.rules.highlight.exec(a))){if(n=this.rules.text.exec(a))r+=n[0].length,a=a.substring(n[0].length),!a&&this.rules.linebreak.exec(n[0]||"")?(j(u,n[0].replace(this.rules.linebreak,"")),u.push({type:q.linebreak,text:"  "})):j(u,n[0]||"");else if(a)throw new Error("Infinite loop on byte: "+a.charCodeAt(0))}else r+=n[0].length,a=a.substring(n[0].length),u.push({type:q.highlight,inner:this.output(n[2],b,null,!0),text:n[2]});else{var y=/^\$\$/,z=null,A=0,B="",C=null,D=/\$/,p="$";for(y.exec(n[0])?(z=/{|}|\$\$/g,p="$$"):(z=/{|}|\$/g,p="$"),z.exec(n[0]);C=z.exec(n[0]);){if(D.exec(C[0])&&0>=A&&"\\"!=n[0].substring(C.index-1,C.index)){B=n[0].substring(0,C.index+C[0].length);break}"{"===C[0]?A++:"}"===C[0]&&A--}if(B.length-2*p.length>0&&/[^\s$]/.exec(B)){r+=B.length,a=a.substring(B.length),u.push({type:"inline_math",text:h(B),pattern:p});continue}r+=n[0].length,a=a.substring(n[0].length),j(u,n[0]||"")}}else r+=n[0].length,a=a.substring(n[0].length),u.push({type:q.attr,text:n[0]});else{r+=n[0].length,a=a.substring(n[0].length);var E=(n[2]||n[1]).replace(/\s+/g," ");u.push({type:q.footnote,inner:this.output(n[1],b,null,!0,f.skipLink),text:n[1]})}else{r+=n[0].length,a=a.substring(n[0].length);var E=(n[3]||"").replace(/\s+/g," ");u.push({type:n[1]?"refimg":"reflink",ref:E,inner:this.output(n[2],b,null,!0,f.skipLink),text:n[2],markdown:n[0]})}else r+=n[0].length,a=a.substring(n[0].length),u.push({type:"image",href:h(n[2]),title:n[5],markdown:n[0],alt:n[1]});else r+=n[0].length,a=a.substring(n[0].length),u.push({type:"link",href:h(n[2]),title:n[5],markdown:n[0],inner:n[1]?this.output(n[1],b,null,!0,f.skipLink):"",meta:h(n[0].substring(n[1].length+2))});else a=a.substring(n[0].length),r+=n[1].length,l=n[1],m=l,null===/^\w+:\/\//.exec(l)&&/@/.exec(l)&&(m="mailto://"+m),u.push({type:q.url,href:m,text:l});else r+=n[0].length,a=a.substring(n[0].length),o="",l=n[1],m="@"===n[4]?":"===n[1].charAt(6)?l:"mailto:"+n[1]:l,u.push({type:q.autolink,href:m,text:l});var F=k(u);return d||(F=h(F,s)),F},f.prototype.mangle=function(a){for(var b,c="",d=a.length,e=0;d>e;e++)b=a.charCodeAt(e),Math.random()>.5&&(b="x"+b.toString(16)),c+="&#"+b+";";return c},j.exec=j;var db,eb={};eb.options=eb.setOptions=function(a){return k(eb.defaults,a),eb},eb.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:""},eb.parseInline=function(a,b){return db||(db=new f),db.output(a,null,null,null,b)},eb.InlineLexer=f,eb.quickParse=l,eb.reDefLink=L,c.exports=eb}),define("app/editor/Inline",["app/document/StringUtils","app/document/Node","exoskeleton-master/exoskeleton","jquery/jquery"],function(a,b){"use strict";var c=a("app/document/StringUtils"),d=a("app/document/Node"),e=(d.Node,d.TYPE);window.failImgCache=[],window.loadedImgCache=[];var f=function(a){return c.escapeForPreWrap(a)},g=function(a,b){switch(a.type){case e.strong:return"<strong>"+a.inner+"</strong>";case e.em:return"<em>"+a.inner+"</em>";case e.plain:return c.escape(a.text);case e.code:return"<code>"+c.escape(a.text.trim(),!1,!0)+"</code>";case e.del:return"<del>"+a.inner+"</del>";case e.autolink:return"<a href='"+f(a.href)+"' target='_blank' >"+a.text+"</a>";case e.url:return"<a href='"+f(a.href)+"' target='_blank' >"+a.text+"</a>";case e.tag:if(/^<img/.test(a.text)&&b.forPrint){var d=/(\ssrc=)(['"])([^"']*)(\2)/.exec(a.text);if(d)return d=File.editor.imgEdit.getRealSrc(d[3]).replace(/^file:\/\/\/?/i,"file:///").replace(/\\/g,"/"),a.text.replace(/(\ssrc=)(['"])([^"']*)(\2)/,"$1$2"+d+"$4")}return a.text;case e.link:if("#"==(a.href||"").trim()[0]){var g=a.href.substr(1),h=$("h1, h2, h3, h4, h5, h6").filter(function(){return $(this).text().toLowerCase().trim()==g.toLowerCase().trim()});h.length&&(a.href="#header-"+h.attr("cid"))}return"<a href='"+f(a.href)+"'"+(a.title?" title='"+f(a.title)+"'":"")+">"+a.inner+"</a>";case e.image:var d=b.forPrint?File.editor.imgEdit.getRealSrc(a.href):a.href;return b.forPrint&&File.isNode&&File.option.printPDFByPhantom&&(d=d.replace(/^file:\/\/\/?/i,"file:///").replace(/\\/g,"/")),"<img src='"+f(d)+"' alt='"+f(a.alt)+"' />";case e.footnote:var i=b.nodeMap.foot_list.getNodeByRef(a.text);if(i){var j=f(c.escape(a.text)+b.count),k="<sup><a href='#dfref-"+j+"' name='ref-"+j+"'>"+b.count+"</a></sup>";return b.appendFootnote(i,b),b.count++,k}return"[^"+c.escape(a.text)+"]";case e.escape:return a.text;case e.refimg:var l=b.nodeMap.link_list.getNodeByRef(a.ref||a.text),d=l?f(l.get("href")):void 0,g=l?f(l.get("title")):void 0;return void 0!==d?(b.forPrint&&File.isNode&&File.option.printPDFByPhantom&&(d=d.replace(/^file:\/\/\/?/i,"file:///").replace(/\\/g,"/")),"<img alt='"+a.text+"' src='"+d+"'"+(g?" title='"+g+"'":"")+"></img>"):"!["+a.inner+"]["+c.escape(a.ref)+"]";case e.reflink:var l=b.nodeMap.link_list.getNodeByRef(a.ref||a.text),d=l?f(l.get("href")):void 0,g=l?f(l.get("title")):void 0;return void 0!==d?"<a href='"+d+"' target='_blank'"+(g?" title='"+g+"'":"")+">"+a.inner+"</a>":"["+a.inner+"]["+c.escape(a.ref)+"]";case e.attr:return"";case e.emoji:return a.inner;case e.inline_math:return b.noStyle?a.text:svgCache[a.text.replace(/\u200B/g,"")]||a.text;case e.subscript:return"<sub>"+a.inner+"</sub>";case e.superscript:return"<sup>"+a.inner+"</sup>";case e.underline:return"<u>"+a.inner+"</u>";case e.linebreak:return"<br/>";case e.highlight:return"<mark>"+a.inner+"</mark>";default:return a.inner||""}};b.onErrorEvaluate="if(failImgCache.length>5000){failImgCache.clear();}failImgCache.push(this.getAttribute('src'));this.src='style/imgErr.gif';$(this).closest('.md-image').addClass('md-img-error').removeClass('md-img-loaded');this.onload=''",b.onLoadEvaluate="loadedImgCache.push(this.getAttribute('src'));$(this).closest('.md-image').addClass('md-img-loaded').removeClass('md-img-error');";var h='onerror="'+b.onErrorEvaluate+'" onload ="'+b.onLoadEvaluate+'"',i=function(a){switch(a.type){case e.heading:return"<span class='md-blockmeta'>"+a.meta_before+"</span><span class='md-header-span'>"+a.inner+"</span><span class='md-blockmeta'>"+a.meta_after+"</span>";case e.paragraph:return a.inner;case e.blockquote:return"<span class='md-blockmeta'>"+a.pattern+"</span>"+a.inner;case e.fences:return"<span class='md-blockmeta'>"+a.pattern+"</span><span class='md-lang'>"+c.escape(a.lang)+"</span>";case e.def_footnote:return"<span class='md-blockmeta'>[^</span>"+a.ref+"<span class='md-blockmeta'>]: </span><span class='md-def-content'>"+a.inner+"</span>";case e.def_link:return"<span class='md-blockmeta'>[</span>"+a.ref+"<span class='md-blockmeta'>]: </span><span class='md-def-content'>"+a.inner+"</span>";case e.strong:return"<span md-inline='strong'><span class='md-meta md-before'>"+a.pattern+"</span><strong>"+a.inner+"</strong><span class='md-meta md-after'>"+a.pattern+"</span></span>";case e.em:return"<span md-inline='em'><span class='md-meta md-before'>"+a.pattern+"</span><em>"+a.inner+"</em><span class='md-meta md-after'>"+a.pattern+"</span></span>";case e.highlight:return"<span md-inline='highlight'><span class='md-meta md-before'>==</span><mark>"+a.inner+"</mark><span class='md-meta md-after'>==</span></span>";case e.plain:return"<span md-inline='plain'>"+c.escape(a.text.replace(/\r?\n/gi,""))+"</span>";case e.code:var b=a.text.match(/^\s+/)||"";a.text=a.text.replace(/^\s+/,"");var d=a.text.match(/\s+$/)||"";return"<span md-inline='code' spellcheck='false'><span class='md-meta md-before'>"+a.pattern+b+"</span><code>"+c.escapeForPreWrap(a.text.trim(),!1,!0)+"</code><span class='md-meta md-after'>"+d+a.pattern+"</span></span>";case e.del:return"<span md-inline='del'><span class='md-meta md-before'>"+a.pattern+"</span><del>"+a.inner+"</del><span class='md-meta md-after'>"+a.pattern+"</span></span>";case e.autolink:return"<span md-inline='autolink'><span class='md-meta md-before'>&lt;</span><a href='"+a.href+"'>"+c.escape(a.text)+"</a><span class='md-meta md-after'>&gt;</span></span>";case e.url:return"<span md-inline='url' spellcheck='false'><a href='"+a.href+"'>"+c.escape(a.text)+"</a></span>";case e.tag:return"<span md-inline='tag' class='md-tag' spellcheck='false'>"+c.escapeForPreWrap(a.text,!1,!0)+"</span>";case e.link:var g=a.meta.replace(/^\((<?(?:\([^)]*\)|[^()])*?>?)([ \t]*)((['"])(.*?)\4)?([ \t]*)\)/,function(a,b,d,e,f,g,h){return"(</span><span class='md-content md-url'>"+c.escape(b)+"</span><span class='md-meta'>"+c.escape(d)+"</span><span class='md-content md-link-title'>"+c.escape(e)+"</span><span class='md-meta md-after'>"+c.escape(h)+")</span>"});return"<span md-inline='link' class='"+(a.inner?"":"md-empty-link")+"'><span class='md-meta md-before'>[</span><a spellcheck='false' href='"+a.href+"' >"+a.inner+"</a><span class='md-meta md-before'>]"+g+"</span>";case e.refimg:var i=a.ref||a.text,j=File.editor.nodeMap.link_list.getHrefByRef(i),k=File.editor.imgEdit.getRealSrc(j),l=/^data:/.exec(k),m=c.escape(a.markdown);return/^file:\/\//i.exec(k||"")&&(k+="?lastModify="+imgLastModified),j?l||loadedImgCache.indexOf(k)>-1?"<span md-inline='refimg' contenteditable='false' class='md-image md-ref-image md-img-loaded' data-ref='"+c.escape(i)+"'><span class='md-meta md-before md-content' contenteditable='true'>"+m+"</span><img src='"+f(k)+"' alt='"+f(a.text)+"'></span>":failImgCache.indexOf(k)>-1?"<span md-inline='refimg' data-src='"+f(k)+"' contenteditable='false' class='md-image md-ref-image md-img-error' data-ref='"+f(c.escape(i))+"'><span class='md-meta md-content md-before' contenteditable='true'>"+m+"</span><img src='style/imgErr.gif' alt='"+f(a.text)+"'></span>":"<span md-inline='refimg' contenteditable='false' class='md-image md-ref-image' data-src='"+f(k)+"' data-ref='"+c.escape(i)+"'><span class='md-meta md-before md-content' contenteditable='true'>"+m+"</span><img data-src='"+f(a.href)+"' src='"+k+"' alt='"+f(a.text)+"' "+h+" /></span>":"<span md-inline='refimg' class='md-image md-ref-image md-no-ref' data-ref='"+f(i)+"'><span class='md-meta md-before md-content' contenteditable='true' data-hint='Please define image reference by \n["+f(i)+"]: http://example.png' >"+m+"</span></span>";case e.image:var k=File.editor.imgEdit.getRealSrc(a.href),l=/^data:/.exec(k),m=c.escape(a.markdown),n=f(a.alt),o="md-inline='image' contenteditable='false' data-src='"+f(a.href)+"'";return/^file:\/\//i.exec(k||"")&&(k+="?lastModify="+imgLastModified),l||loadedImgCache.indexOf(k)>-1?"<span "+o+" class='md-image md-img-loaded'><span class='md-meta md-before' contenteditable='true'>"+m+"</span><img src='"+f(k)+"' alt='"+n+"'></span>":failImgCache.indexOf(k)>-1?"<span "+o+" class='md-image md-img-error'><span class='md-meta md-before' contenteditable='true'>"+m+"</span><img src='style/imgErr.gif' alt='"+n+"'></span>":"<span "+o+" class='md-image'><span class='md-meta md-before' contenteditable='true'>"+m+"</span><img data-src='"+f(a.href)+"' src='"+f(k)+"' alt='"+n+"' "+h+" /></span>";case e.footnote:return"<sup md-inline='footnote' class='md-footnote'><span class='md-meta md-before'>[^</span><span class='md-text'>"+a.inner+"</span><span class='md-meta md-after'>]</span></sup>";case e.escape:return"<span md-inline='escape'><span class='md-meta md-before'>\\</span>"+c.escape(a.text)+"</span>";case e.reflink:return"<span md-inline='reflink'><span class='md-meta md-before'>[</span><a data-ref='"+c.escapeForPreWrap(a.ref||a.text)+"' >"+a.inner+"</a><span class='md-meta md-after'>]</span><span class='md-meta md-before'>[</span><span class='md-content'>"+a.ref+"</span><span class='md-meta md-after'>]</span></span>";case e.attr:return"<span md-inline='attr' class='md-attr'>"+c.escape(a.text)+"</span>";case e.emoji:return"<span md-inline='emoji' data-content='"+a.text+"' class='md-emoji' ><span data-emoji='"+a.inner+"' class='md-emoji-span'></span><span class='md-meta'>:"+a.text+":</span></span>";case e.inline_math:return a.text=c.escapeForPreWrap(a.text.replace(/\u200B*/g,"")),!/^\$+$/.exec(a.text)&&svgCache[a.text]?"<span class='md-inline-math' md-inline='inline_math' pattern='"+a.pattern+"'><span class='md-before md-meta'>"+a.pattern+"</span><span class='inline-math-svg math-jax-postprocess'>"+svgCache[a.text]+"</span><span class='md-math-after-sym'></span><span class='md-after md-meta'>"+a.pattern+"</span></span>":"<span class='md-inline-math' md-inline='inline_math' pattern='"+a.pattern+"'><span class='inline-math-svg math-jax-preprocess'>"+c.escape(a.text)+"</span></span>";case e.subscript:return"<sub md-inline='subscript'><span class='md-meta md-before'>~</span>"+a.inner+"<span class='md-meta md-after'>~</span></sub>";case e.superscript:return"<sup md-inline='superscript'><span class='md-meta md-before'>^</span>"+a.inner+"<span class='md-meta md-after'>^</span></sup>";case e.underline:return"<span md-inline='underline'><span class='md-meta md-before'>&lt;u&gt;</span><u>"+a.inner+"</u><span class='md-meta md-after'>&lt;/u&gt;</span></span>";case e.linebreak:return"<span md-inline='linebreak'>  </span>";default:return console.error("unknow type "+a.type),a.text}};b.decorateAsExport=g,b.decorate=i}),define("app/editor/Emoji",["jquery/jquery","exoskeleton-master/exoskeleton"],function(a,b,c){"use strict";var d=a("jquery/jquery"),e=a("exoskeleton-master/exoskeleton"),f=e.Model.extend({initialize:function(a){this.editor=a,this.$container=d("#emoji-auto-suggest"),setTimeout(function(){d.getScript("./app/editor/EmojiSearchMap.js")},1e3)},search:function(a,b){if(!a)return[];var c,d=new RegExp("(^"+a+")|(_"+a+")|(-"+a+")","i"),e=Object.keys(f.data).filter(function(b){return d.exec(b)&&b!==a});if(e.sort(),f.data[a]&&e.unshift(a),c=(window.EmojiSearchMap||{})[a])for(var g=0;g<c.length;g++)-1==e.indexOf(c[g])&&e.push(c[g]);return b.type="emoji",b.token=a,b.match=e,b.found=e.length,b.pageNo=0,b.pageCnt=Math.floor((e.length-1)/5+1),e},showAutoSuggest:function(a,b){if(b.token===a)return!1;var c=this.search(a,b),d="";if(!b.found)return this.$container.hide(),!1;for(var e=0;e<c.length&&40>e;e++)e%5==0&&(d+=(e>0?"</ul>":"")+"<ul data-page='"+e/5+"' style='display:none'>"),d+="<li data-content=':"+c[e]+":' ><span>"+f.data[c[e]]+"</span> <span class='emoji-meta'>:"+c[e]+":</span></li>";return d+="</ul>",this.$container.html(d),this.$container}});f.data={100:"",911:"",1234:"",smile:"",happy:"",joy:"",pleased:"",smiley:"",haha:"",grinning:"",blush:"",proud:"",relaxed:"",wink:"",flirt:"",heart_eyes:"",love:"",crush:"",kissing_heart:"",kissing_closed_eyes:"",kissing:"",kissing_smiling_eyes:"",stuck_out_tongue_winking_eye:"",prank:"",silly:"",stuck_out_tongue_closed_eyes:"",stuck_out_tongue:"",flushed:"",grin:"",pensive:"",relieved:"",whew:"",unamused:"",meh:"",disappointed:"",sad:"",persevere:"",struggling:"",cry:"",tear:"",tears:"",sob:"",bawling:"",sleepy:"",tired:"",disappointed_relieved:"",phew:"",sweat:"",nervous:"",cold_sweat:"",sweat_smile:"",hot:"",weary:"",tired_face:"",upset:"",whine:"",fearful:"",scared:"",shocked:"",oops:"",scream:"",horror:"",angry:"",mad:"",annoyed:"",rage:"",triumph:"",smug:"",confounded:"",laughing:"",satisfied:"",yum:"",tongue:"",lick:"",mask:"",sick:"",ill:"",sunglasses:"",cool:"",sleeping:"",zzz:"",dizzy_face:"",astonished:"",amazed:"",gasp:"",worried:"",frowning:"",anguished:"",stunned:"",smiling_imp:"",devil:"",evil:"",horns:"",imp:"",open_mouth:"",surprise:"",impressed:"",wow:"",grimacing:"",neutral_face:"",confused:"",hushed:"",silence:"",speechless:"",no_mouth:"",mute:"",innocent:"",angel:"",smirk:"",expressionless:"",man_with_gua_pi_mao:"",man_with_turban:"",cop:"",police:"",law:"",construction_worker:"",helmet:"",guardsman:"",baby:"",child:"",newborn:"",boy:"",girl:"",man:"",mustache:"",father:"",dad:"",woman:"",girls:"",older_man:"",older_woman:"",person_with_blond_hair:"",princess:"",blonde:"",crown:"",royal:"",smiley_cat:"",smile_cat:"",heart_eyes_cat:"",kissing_cat:"",smirk_cat:"",scream_cat:"",crying_cat_face:"",joy_cat:"",pouting_cat:"",japanese_ogre:"",monster:"",japanese_goblin:"",see_no_evil:"",monkey:"",blind:"",ignore:"",hear_no_evil:"",deaf:"",speak_no_evil:"",hush:"",skull:"",dead:"",danger:"",poison:"",alien:"",ufo:"",hankey:"",poop:"",shit:"",crap:"",fire:"",burn:"",sparkles:"",shiny:"",star2:"",dizzy:"",star:"",boom:"",collision:"",explode:"",anger:"",sweat_drops:"",water:"",workout:"",droplet:"",dash:"",wind:"",blow:"",fast:"",ear:"",hear:"",sound:"",listen:"",eyes:"",look:"",see:"",watch:"",nose:"",smell:"",taste:"",lips:"",kiss:"","+1":"",thumbsup:"",approve:"",ok:"","-1":"",thumbsdown:"",disapprove:"",bury:"",ok_hand:"",facepunch:"",punch:"",attack:"",fist:"",power:"",v:"",victory:"",peace:"",wave:"",goodbye:"",hand:"",raised_hand:"",highfive:"",stop:"",open_hands:"",point_up_2:"",point_down:"",point_right:"",point_left:"",raised_hands:"",hooray:"",pray:"",please:"",hope:"",wish:"",point_up:"",clap:"",praise:"",applause:"",muscle:"",flex:"",bicep:"",strong:"",walking:"",runner:"",running:"",exercise:"",marathon:"",dancer:"",dress:"",couple:"",date:"",family:"",home:"",parents:"",two_men_holding_hands:"",two_women_holding_hands:"",couplekiss:"",couple_with_heart:"",dancers:"",bunny:"",ok_woman:"",no_good:"",halt:"",information_desk_person:"",raising_hand:"",massage:"",spa:"",haircut:"",beauty:"",nail_care:"",manicure:"",bride_with_veil:"",marriage:"",wedding:"",person_with_pouting_face:"",person_frowning:"",bow:"",respect:"",thanks:"",tophat:"",hat:"",classy:"",king:"",queen:"",womans_hat:"",athletic_shoe:"",sneaker:"",sport:"",mans_shoe:"",shoe:"",sandal:"",high_heel:"",boot:"",shirt:"",tshirt:"",necktie:"",formal:"",womans_clothes:"",running_shirt_with_sash:"",jeans:"",pants:"",kimono:"",bikini:"",beach:"",briefcase:"",business:"",handbag:"",bag:"",pouch:"",purse:"",eyeglasses:"",glasses:"",ribbon:"",closed_umbrella:"",weather:"",rain:"",lipstick:"",makeup:"",yellow_heart:"",blue_heart:"",purple_heart:"",green_heart:"",heart:"",broken_heart:"",heartpulse:"",heartbeat:"",two_hearts:"",sparkling_heart:"",revolving_hearts:"",cupid:"",love_letter:"",email:"",envelope:"",ring:"",engaged:"",gem:"",diamond:"",bust_in_silhouette:"",user:"",busts_in_silhouette:"",users:"",group:"",team:"",speech_balloon:"",comment:"",footprints:"",feet:"",tracks:"",thought_balloon:"",thinking:"",dog:"",pet:"",wolf:"",cat:"",mouse:"",hamster:"",rabbit:"",frog:"",tiger:"",koala:"",bear:"",pig:"",pig_nose:"",cow:"",boar:"",monkey_face:"",horse:"",sheep:"",elephant:"",panda_face:"",penguin:"",bird:"",baby_chick:"",hatched_chick:"",hatching_chick:"",chicken:"",snake:"",turtle:"",slow:"",bug:"",bee:"",honeybee:"",ant:"",beetle:"",snail:"",octopus:"",shell:"",sea:"",tropical_fish:"",fish:"",dolphin:"",flipper:"",whale:"",whale2:"",cow2:"",ram:"",rat:"",water_buffalo:"",tiger2:"",rabbit2:"",dragon:"",racehorse:"",speed:"",goat:"",rooster:"",dog2:"",pig2:"",mouse2:"",ox:"",dragon_face:"",blowfish:"",crocodile:"",camel:"",dromedary_camel:"",desert:"",leopard:"",cat2:"",poodle:"",paw_prints:"",bouquet:"",flowers:"",cherry_blossom:"",flower:"",spring:"",tulip:"",four_leaf_clover:"",luck:"",rose:"",sunflower:"",hibiscus:"",maple_leaf:"",canada:"",leaves:"",leaf:"",fallen_leaf:"",autumn:"",herb:"",ear_of_rice:"",mushroom:"",cactus:"",palm_tree:"",evergreen_tree:"",wood:"",deciduous_tree:"",chestnut:"",seedling:"",plant:"",blossom:"",globe_with_meridians:"",world:"",global:"",international:"",sun_with_face:"",summer:"",full_moon_with_face:"",new_moon_with_face:"",new_moon:"",waxing_crescent_moon:"",first_quarter_moon:"",moon:"",waxing_gibbous_moon:"",full_moon:"",waning_gibbous_moon:"",last_quarter_moon:"",waning_crescent_moon:"",last_quarter_moon_with_face:"",first_quarter_moon_with_face:"",crescent_moon:"",night:"",earth_africa:"",globe:"",earth_americas:"",earth_asia:"",volcano:"",milky_way:"",stars:"",sunny:"",partly_sunny:"",cloud:"",zap:"",lightning:"",thunder:"",umbrella:"",snowflake:"",winter:"",cold:"",snowman:"",christmas:"",cyclone:"",swirl:"",foggy:"",karl:"",rainbow:"",pride:"",ocean:"",bamboo:"",gift_heart:"",chocolates:"",dolls:"",school_satchel:"",mortar_board:"",education:"",college:"",university:"",graduation:"",flags:"",fireworks:"",festival:"",celebration:"",sparkler:"",wind_chime:"",rice_scene:"",jack_o_lantern:"",halloween:"",ghost:"",santa:"",christmas_tree:"",gift:"",present:"",birthday:"",tanabata_tree:"",tada:"",party:"",confetti_ball:"",balloon:"",crossed_flags:"",crystal_ball:"",fortune:"",movie_camera:"",film:"",video:"",camera:"",photo:"",video_camera:"",vhs:"",cd:"",dvd:"",minidisc:"",floppy_disk:"",save:"",computer:"",desktop:"",screen:"",iphone:"",smartphone:"",mobile:"",phone:"",telephone:"",telephone_receiver:"",call:"",pager:"",fax:"",satellite:"",signal:"",tv:"",radio:"",podcast:"",loud_sound:"",volume:"",speaker:"",bell:"",notification:"",no_bell:"",off:"",loudspeaker:"",announcement:"",mega:"",hourglass_flowing_sand:"",time:"",hourglass:"",alarm_clock:"",morning:"",unlock:"",security:"",lock:"","private":"",lock_with_ink_pen:"",closed_lock_with_key:"",key:"",password:"",mag_right:"",bulb:"",idea:"",light:"",flashlight:"",high_brightness:"",low_brightness:"",electric_plug:"",battery:"",mag:"",search:"",zoom:"",bathtub:"",bath:"",shower:"",toilet:"",wc:"",wrench:"",tool:"",nut_and_bolt:"",hammer:"",door:"",smoking:"",cigarette:"",bomb:"",gun:"",shoot:"",weapon:"",hocho:"",knife:"",cut:"",chop:"",pill:"",health:"",medicine:"",syringe:"",hospital:"",needle:"",moneybag:"",dollar:"",cream:"",yen:"",money:"",pound:"",euro:"",credit_card:"",subscription:"",money_with_wings:"",calling:"",incoming:"","e-mail":"",inbox_tray:"",outbox_tray:"",letter:"",envelope_with_arrow:"",incoming_envelope:"",postal_horn:"",mailbox:"",mailbox_closed:"",mailbox_with_mail:"",mailbox_with_no_mail:"",postbox:"","package":"",shipping:"",memo:"",pencil:"",document:"",note:"",page_facing_up:"",page_with_curl:"",bookmark_tabs:"",bar_chart:"",stats:"",metrics:"",chart_with_upwards_trend:"",graph:"",chart_with_downwards_trend:"",scroll:"",clipboard:"",calendar:"",schedule:"",card_index:"",file_folder:"",directory:"",open_file_folder:"",scissors:"",pushpin:"",location:"",paperclip:"",black_nib:"",pencil2:"",straight_ruler:"",triangular_ruler:"",closed_book:"",green_book:"",blue_book:"",orange_book:"",notebook:"",notebook_with_decorative_cover:"",ledger:"",books:"",library:"",book:"",open_book:"",bookmark:"",name_badge:"",microscope:"",science:"",laboratory:"",investigate:"",telescope:"",newspaper:"",press:"",art:"",design:"",paint:"",clapper:"",microphone:"",sing:"",headphones:"",music:"",earphones:"",musical_score:"",musical_note:"",notes:"",musical_keyboard:"",piano:"",violin:"",trumpet:"",saxophone:"",guitar:"",rock:"",space_invader:"",game:"",retro:"",video_game:"",play:"",controller:"",console:"",black_joker:"",flower_playing_cards:"",mahjong:"",game_die:"",dice:"",gambling:"",dart:"",target:"",football:"",sports:"",basketball:"",soccer:"",baseball:"",tennis:"","8ball":"",pool:"",billiards:"",rugby_football:"",bowling:"",golf:"",mountain_bicyclist:"",bicyclist:"",checkered_flag:"",milestone:"",finish:"",horse_racing:"",trophy:"",award:"",contest:"",winner:"",ski:"",snowboarder:"",swimmer:"",surfer:"",fishing_pole_and_fish:"",coffee:"",cafe:"",espresso:"",tea:"",green:"",breakfast:"",sake:"",baby_bottle:"",milk:"",beer:"",drink:"",beers:"",drinks:"",cocktail:"",tropical_drink:"",vacation:"",wine_glass:"",fork_and_knife:"",cutlery:"",pizza:"",hamburger:"",burger:"",fries:"",poultry_leg:"",meat:"",meat_on_bone:"",spaghetti:"",pasta:"",curry:"",fried_shrimp:"",tempura:"",bento:"",sushi:"",fish_cake:"",rice_ball:"",rice_cracker:"",rice:"",ramen:"",noodle:"",stew:"",oden:"",dango:"",egg:"",bread:"",toast:"",doughnut:"",custard:"",icecream:"",ice_cream:"",shaved_ice:"",cake:"",dessert:"",cookie:"",chocolate_bar:"",candy:"",sweet:"",lollipop:"",honey_pot:"",apple:"",green_apple:"",fruit:"",tangerine:"",lemon:"",cherries:"",grapes:"",watermelon:"",strawberry:"",peach:"",melon:"",banana:"",pear:"",pineapple:"",sweet_potato:"",eggplant:"",aubergine:"",tomato:"",corn:"",house:"",house_with_garden:"",school:"",office:"",post_office:"",bank:"",convenience_store:"",love_hotel:"",hotel:"",church:"",department_store:"",european_post_office:"",city_sunrise:"",city_sunset:"",japanese_castle:"",european_castle:"",tent:"",camping:"",factory:"",tokyo_tower:"",japan:"",mount_fuji:"",sunrise_over_mountains:"",sunrise:"",night_with_stars:"",statue_of_liberty:"",bridge_at_night:"",carousel_horse:"",ferris_wheel:"",fountain:"",roller_coaster:"",ship:"",boat:"",sailboat:"",speedboat:"",rowboat:"",anchor:"",rocket:"",launch:"",airplane:"",flight:"",seat:"",helicopter:"",steam_locomotive:"",train:"",tram:"",station:"",mountain_railway:"",train2:"",bullettrain_side:"",bullettrain_front:"",light_rail:"",metro:"",monorail:"",railway_car:"",trolleybus:"",bus:"",oncoming_bus:"",blue_car:"",oncoming_automobile:"",car:"",red_car:"",taxi:"",oncoming_taxi:"",articulated_lorry:"",truck:"",rotating_light:"",emergency:"",police_car:"",oncoming_police_car:"",fire_engine:"",ambulance:"",minibus:"",bike:"",bicycle:"",aerial_tramway:"",suspension_railway:"",mountain_cableway:"",tractor:"",barber:"",busstop:"",ticket:"",vertical_traffic_light:"",semaphore:"",traffic_light:"",warning:"",wip:"",construction:"",beginner:"",fuelpump:"",izakaya_lantern:"",lantern:"",slot_machine:"",hotsprings:"",moyai:"",stone:"",circus_tent:"",performing_arts:"",theater:"",drama:"",round_pushpin:"",triangular_flag_on_post:"",jp:"",kr:"",korea:"",de:"",flag:"",germany:"",cn:"",china:"",us:"",united:"",america:"",fr:"",france:"",french:"",es:"",spain:"",it:"",italy:"",ru:"",russia:"",gb:"",uk:"",british:"",one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",zero:"0",keycap_ten:"",numbers:"",hash:"#",number:"#",symbols:"",arrow_up:"",arrow_down:"",arrow_left:"",arrow_right:"",capital_abcd:"",letters:"",abcd:"",abc:"",alphabet:"",arrow_upper_right:"",arrow_upper_left:"",arrow_lower_right:"",arrow_lower_left:"",left_right_arrow:"",arrow_up_down:"",arrows_counterclockwise:"",sync:"",arrow_backward:"",arrow_forward:"",arrow_up_small:"",arrow_down_small:"",leftwards_arrow_with_hook:"","return":"",arrow_right_hook:"",information_source:"",rewind:"",fast_forward:"",arrow_double_up:"",arrow_double_down:"",arrow_heading_down:"",arrow_heading_up:"",yes:"",twisted_rightwards_arrows:"",shuffle:"",repeat:"",loop:"",repeat_one:"","new":"",fresh:"",up:"",free:"",ng:"",signal_strength:"",wifi:"",cinema:"",movie:"",koko:"",u6307:"",u7a7a:"",u6e80:"",u5408:"",u7981:"",ideograph_advantage:"",u5272:"",u55b6:"",u6709:"",u7121:"",restroom:"",mens:"",womens:"",baby_symbol:"",potable_water:"",put_litter_in_its_place:"",parking:"",wheelchair:"",accessibility:"",no_smoking:"",u6708:"",u7533:"",sa:"",m:"",passport_control:"",baggage_claim:"",airport:"",left_luggage:"",customs:"",accept:"",secret:"",congratulations:"",cl:"",sos:"",help:"",id:"",no_entry_sign:"",block:"",forbidden:"",underage:"",no_mobile_phones:"",do_not_litter:"","non-potable_water":"",no_bicycles:"",no_pedestrians:"",children_crossing:"",no_entry:"",limit:"",eight_spoked_asterisk:"",sparkle:"",negative_squared_cross_mark:"",white_check_mark:"",eight_pointed_black_star:"",heart_decoration:"",vs:"",vibration_mode:"",mobile_phone_off:"",a:"",b:"",ab:"",o2:"",diamond_shape_with_a_dot_inside:"",recycle:"",environment:"",aries:"",taurus:"",gemini:"",cancer:"",leo:"",virgo:"",libra:"",scorpius:"",sagittarius:"",capricorn:"",aquarius:"",pisces:"",ophiuchus:"",six_pointed_star:"",atm:"",chart:"",heavy_dollar_sign:"",currency_exchange:"",copyright:"",registered:"",tm:"",trademark:"",x:"",bangbang:"",interrobang:"",exclamation:"",heavy_exclamation_mark:"",bang:"",question:"",grey_exclamation:"",grey_question:"",o:"",top:"",end:"",back:"",on:"",soon:"",arrows_clockwise:"",clock12:"",clock1230:"",clock1:"",clock130:"",clock2:"",clock230:"",clock3:"",clock330:"",clock4:"",clock430:"",clock5:"",clock530:"",clock6:"",clock7:"",clock8:"",clock9:"",clock10:"",clock11:"",clock630:"",clock730:"",clock830:"",clock930:"",clock1030:"",clock1130:"",heavy_multiplication_x:"",heavy_plus_sign:"",heavy_minus_sign:"",heavy_division_sign:"",spades:"",hearts:"",clubs:"",diamonds:"",white_flower:"",score:"",perfect:"",heavy_check_mark:"",ballot_box_with_check:"",radio_button:"",link:"",curly_loop:"",wavy_dash:"",part_alternation_mark:"",trident:"",black_medium_square:"",white_medium_square:"",black_medium_small_square:"",white_medium_small_square:"",black_small_square:"",white_small_square:"",small_red_triangle:"",black_square_button:"",white_square_button:"",black_circle:"",white_circle:"",red_circle:"",large_blue_circle:"",small_red_triangle_down:"",white_large_square:"",black_large_square:"",large_orange_diamond:"",large_blue_diamond:"",small_orange_diamond:"",small_blue_diamond:""},c.exports=f
}),define("app/document/Node2Mark",["exoskeleton-master/exoskeleton","jquery/jquery","app/document/Node","app/document/StringUtils"],function(a){"use strict";var b=(a("exoskeleton-master/exoskeleton"),a("app/document/Node")),c=b.Node,d=b.NodeMap,e=b.TYPE,f=a("app/document/StringUtils"),g="",h=/\uE027/gi;c.prototype.toMark=function(){var a=i.call(this);return a instanceof Array?a.join("\n").replace(h,""):a};var i=function(){function a(a){if(a.get("children").length)return m(a.get("children"));var b=a.get("text")?a.get("text"):"";return b=b.replace(/(\u200B*):(\u200B*)/g,":").replace(/\u200B\$/,"$")}function b(a,b){j(a,b.get("ahead")||0)}function d(a,b,c){void 0===c&&(c=b.get("after")?1:0),j(a,void 0==b.get("tail")?c:b.get("tail"))}function j(a,b){for(var c=0;b>c;c++)a.push("")}function n(a){return c.isType(a.get("parent"),e.list_item)&&a.get("parent").get("tight")!==!1}var o,p,q,r=[];try{switch(this.get("type")){case e.meta_block:return r.push("---\n"+(this.get("text")||g).replace(/^---/gm,"---").replace(/\n$/g,"")+"\n---"),d(r,this),r;case e.heading:return b(r,this),this.get("pattern")?r=r.concat(this.get("pattern").replace("{0}",a(this)).split("\n")):!c.isType(this.get("parent"),e.list_item)&&File.option.headingStyle&&this.get("depth")<=2?(r.push(a(this)),r.push(1==this.get("depth")?"===":"---")):r.push("#".repeat(this.get("depth"))+" "+a(this)),d(r,this),r;case e.paragraph:b(r,this),p=a(this),r=r.concat(p);var s=this.get("tail");return void 0===s&&this.get("after")&&c.isType(this.get("parent"),e.list_item)&&(s=n(this)?0:void 0),c.isType(this.get("after"),e.paragraph)&&1>s&&this.unset("tail"),c.isType(this.get("after"),e.math_block)&&!this.get("tail")&&(s=0),void 0===s?d(r,this,s):j(r,s),r;case e.line:return p=(this.get("text")||g).replace(/\r*\n+/g,"").replace(/^( {4}|\t)/gm,"$1"),r.push(p),r;case e.blockquote:return b(r,this),p=a(this),c.isType(this.get("before"),e.blockquote)&&r.push(""),q=l(e.blockquote,0,this,this.get("pattern")),p.map(function(a,b){p[b]=a?q+a:q.replace(/\s+$/,"")}),r=r.concat(p),d(r,this),r;case e.list:b(r,this);var t=this.get("style"),u=this.isLoose(),v=this.get("children").length,w=this;if(v){var x=this.getFirstChild(),y=x,z=0;for(u&&this.get("pattern")&&this.get("subindent")&&this.set("pattern",k(t,this.get("pattern").trim(),this.get("subindent")));y;)y.set("tight",!u),p=i.call(y),q=l(t,z,y,this.get("pattern"),(v+"").length),p.map(function(a,b){p[b]=(b?a?" ".repeat(w.get("subindent")||q.length):"":q)+p[b],r.push(p[b].replace(h,""))}),z++,y=y.get("after")}return c.isType(this.get("after"),e.list)&&(!this.get("tail")||this.get("tail"))<2&&this.get("pattern")==this.get("after").get("pattern")&&this.get("style")==this.get("after").get("style")&&(this.unset("tail"),r.push(""),n(this)&&r.push("")),d(r,this,n(this)?0:void 0),r;case e.list_item:p=a(this),p instanceof Array?r=r.concat(p):r.push(p);var s=this.get("tail");return void 0==s&&!this.get("tight")&&this.get("after")&&(s=1),s>0&&r.push(""),r;case e.fences:b(r,this);var A=this.getText();p=A.split("\n"),o=this.get("lang")?(this.get("pattern")||"").trim()||"```{0}":this.get("pattern")||"```{0}";for(var B="$1",C=o.match(/^\s+$/),z=0;z<p.length;z++)p[z]=(C?o:"")+p[z].replace(/^(`{3}|~{3})/gi,B);return!C&&r.push(o.replace(/\{0\}/,f.escape(this.get("lang")||""))),r=r.concat(p),!C&&r.push(o.replace(/\s*\{0\}/,"")),d(r,this),r;case e.math_block:return b(r,this),r.push("$$"),r=r.concat(this.get("text").replace(/(^\n)|(\n$)/g,"").split(/\r?\n/)),r.push("$$"),d(r,this,c.isType(this.get("after"),e.paragraph)&&c.isType(this.get("before"),e.paragraph)?0:1),r;case e.hr:return r.push(this.get("pattern")||"------"),d(r,this),r;case e.def_footnote:return b(r,this),r.push("[^"+this.get("ref")+"]: "+a(this)),d(r,this,!this.get("after")||c.isType(this.get("after"),c.TYPE.def_footnote)?0:1),r;case e.def_link:return b(r,this),r.push("["+this.get("ref")+"]: "+this.safeGetStrAttr("href",!0)+(this.safeGetStrAttr("title",!0).length?'	"'+this.get("title")+'"':"")),d(r,this,!this.get("after")||c.isType(this.get("after"),c.TYPE.def_link)?0:1),r;case e.table:b(r,this);for(var D,E,F,G,H,I,J=[],K=[],L=0,M=this.getFirstChild();M;){for(D=M.getFirstChild(),K[L]=[],E=0;D;)K[L][E]=D.toMark().trim(),D=D.get("after"),0===L&&(J[E]=4),J[E]=Math.max(K[L][E].length,J[E]),J[E]=Math.min(J[E],40),E++;M=M.get("after"),L++}for(L=0;L<K.length;L++){for(F="| ",E=0;E<J.length;E++)G=Math.max(J[E]-K[L][E].length,0),H=this.get("align")[E],"right"==H?F+=" ".repeat(G)+K[L][E]:"center"==H?(I=~~(G/2),F+=" ".repeat(I)+K[L][E]+" ".repeat(G-I)):F+=K[L][E]+" ".repeat(G),F+=" | ";if(r.push(F.replace(/\s$/,"")),0===L){for(F="| ",E=0;E<J.length;E++)H=this.get("align")[E],F+="right"==H?"-".repeat(J[E]-1)+":":"center"==H?":"+"-".repeat(J[E]-2)+":":"left"==H?":"+"-".repeat(J[E]-1):"-".repeat(J[E]),F+=" | ";r.push(F.replace(/\s$/,""))}}return d(r,this),r;case e.table_row:for(var y=this.getFirstChild(),F="| ";y;)F+=y.toMark()+" | ";return F.replace(/\s$/,"");case e.table_cell:return a(this).replace(/\|/g,"\\|").replace(/\\\\\|/g,"\\|");case e.toc:return b(r,this),r.push("[TOC]"),d(r,this),r;default:return a(this)}}catch(N){return console.error(N.stack),r}},j=["-","+","*"],k=function(a,b,d){return d=d||File.option.indentSize,a==e.blockquote?">"+" ".repeat(d-1):a===c.ListType.ol?"{0}."+" ".repeat(d-2||1):a===c.ListType.ul?(b||j[File.option.ulStyle])+" ".repeat(d-1):j[File.option.ulStyle]+" "},l=function(a,b,d,f){var g=File.option.indentSize;return b++,f=f||k(a),(!$.isNumeric(g)||2>g)&&(g=2),a==e.blockquote?f:a===c.ListType.ol?f.replace("{0}",b):a===c.ListType.ul?f:f+(d.get("checked")?"[x] ":"[ ] ")};c.markFromArr=function(a){var b=m(a);return b instanceof Array?b.join("\n").replace(h,""):b};var m=function(a){function b(a){var b=i.call(a);b instanceof Array?c=c.concat(b):d+=b}var c=[],d="";if(a.length)if(a instanceof Array)a.map(function(a){b(a)});else{for(var e=a.at(0);e.get("before");)e=e.get("before");do b(e),e=e.get("after");while(e)}return c.length?c:d};d.prototype.toMark=function(){if(this.blocks.length>0){var a=this.blocks.at(0);a=a.getLastBrother(!0);var b=[],c="";do{var d=i.call(a);d instanceof Array?b=b.concat(d):c+=d,a=a.get("after")}while(a);return b.length?b.join("\n").replace(h,""):c}return""},c.getIndentPrefix=l}),define("app/document/Node2HTML",["exoskeleton-master/exoskeleton","jquery/jquery","app/document/Node","app/document/StringUtils","app/document/MarkParser","app/editor/Inline","app/editor/UndoManager","app/editor/Emoji"],function(a){"use strict";var b=(a("exoskeleton-master/exoskeleton"),a("app/document/Node")),c=b.Node,d=(b.NodeMap,b.TYPE),e=(b.NodeCollectionUtils,a("app/document/StringUtils")),f=a("app/document/MarkParser");c.prototype.toHTML=function(a){function g(a){try{return c.isType(a.get("parent"),d.list_item)&&a.get("parent").get("parent").get("style")===c.ListType.task}catch(b){}return!1}function h(e){var h,i=e.get("children");return a?(g(j)&&(a=$($.parseHTML(a)).attr("contenteditable","true")[0].outerHTML),a):i&&i.length>0?b.NodeCollectionUtils.toHTML(i):(h=e.safeGetStrAttr("text"),c.isType(e,d.paragraph)&&/^\u200b( {4}|\t)/g.exec(h)&&(h=h.replace(/^\u200b( {4}|\t)/g,"$1"),e.set("text",h)),f.parseInline(e.safeGetStrAttr("text"),{attr:!c.isType(e,d.heading)}))}function i(a){var b=g(a)?"contenteditable='true'":"",c=" cid = '"+a.id+"' mdtype = '"+a.get("type")+"' "+b;return c}var j=this;switch(this.get("type")){case d.meta_block:var k=this.get("text")||"";return k=k.match(/^\n$/g)?k.replace(/^\n$/g,"\n\n"):k.replace(/^\n/g,"\n\n").replace(/(\S)\n{1}$/g,"$1\n\n"),"<pre "+i(this)+" class='md-meta-block md-end-block' >"+k+"</pre>";case d.paragraph:return"<p "+i(this)+">"+h(this)+"</p>";case d.line:return"<span class='md-line md-end-block' "+i(this)+">"+h(this)+"</span>";case d.raw_edit:return"<p class='rawedit' contenteditable ='true' "+i(this)+">"+this.safeGetStrAttr("text",!0)+"</p>";case d.heading:return"<h"+this.get("depth")+i(this)+"class='md-end-block md-heading' >"+h(this)+"</h"+this.get("depth")+">";case d.blockquote:return"<blockquote "+i(this)+" >"+h(this)+"</blockquote>";case d.list:var l=this.get("style");return l==c.ListType.task?"<ul class='task-list' style='position:relative;'"+i(this)+">"+h(this)+"</ul>":"<"+l+" class=' "+(l+"-list")+"' "+i(this)+" >"+h(this)+"</"+l+">";case d.list_item:return this.get("parent")&&this.get("parent").get("style")===c.ListType.task?"<li class='task-list-item' contenteditable='false'"+i(this)+"><input type='checkbox' "+(this.get("checked")?"checked":"")+"></input>"+h(this)+"</li>":"<li "+i(this)+" >"+h(this)+"</li>";case d.fences:return"<pre class='md-fences mock-cm md-end-block' contenteditable='false'"+i(this)+">"+(this.get("text")&&this.get("text").trim().length?e.escape(this.get("text")):"<br/>")+"</pre>";case d.hr:return"<div tabindex='-1' contenteditable='false' "+i(this)+" class='md-hr md-end-block' ><hr /></div>";case d.def_footnote:return"<div class='footnotes md-def-footnote md-end-block' contenteditable='false'"+i(this)+"><span class='md-def-name' contenteditable='true'>"+e.escape(this.get("ref")?this.get("ref"):"")+"</span><span class='md-def-split md-def-f' contenteditable='false' ></span><span class='md-def-content' contenteditable='true'>"+h(this)+"</span></div>";case d.def_link:return"<div class='footnotes md-def-link md-end-block' contenteditable='false'"+i(this)+"><span class='md-def-name' contenteditable='true'>"+e.escape(this.get("ref")?this.get("ref"):"")+"</span><span class='md-def-split md-def-f' contenteditable='false' ></span><span class='md-def-content md-def-url md-auto-disp' href='link' contenteditable='true'>"+e.escape(this.get("href"))+"</span><span class='md-def-split md-auto-hide' ></span><span class='md-def-title md-auto-disp md-auto-hide' contenteditable='true'>"+e.escape(this.get("title"))+"</span></div>";case d.table:for(var m=(this.get("align").length,"<table class='md-table' contenteditable='false'"+i(this)+">"),n=this.getFirstChild();n;)m+=n.get("before")?n.toHTML():"<thead>"+n.toHTML()+"</thead><tbody>",n=n.get("after"),n||(m+="</tbody>");return m+="</table>";case d.table_row:for(var o,m="<tr class='md-end-block' "+i(this)+">",n=this.getFirstChild(),p=this.get("parent").get("align"),q=0,r=this.get("before")?"td":"th";n;)o=p[q],o=o?" style='text-align:"+o+";' ":"",m+="<"+r+o+">"+n.toHTML()+"</"+r+">",n=n.get("after"),q++;return m+="</tr>";case d.table_cell:return"<span contenteditable='true' class='td-span' "+i(this)+">"+h(this)+"</span>";case d.math_block:return"<div contenteditable='false' class='mathjax-block md-end-block' id='mathjax-"+this.cid+"' "+i(this)+">$$\n"+e.escape(e.useOrDefault(this.get("text"),"<Empty \\space Math \\space Block>"))+"\n$$</div>";case d.toc:return"<div contenteditable='false' tabindex='-1' class='md-toc md-end-block' "+i(this)+"><div class='md-tooltip-hide md-toc-tooltip'> Table of Contents <button type='button' class='btn md-delete-toc'><span class='glyphicon glyphicon-trash'></span></button></div><p class='md-toc-content'></p></div>";default:return"<p "+i(this)+">unknow type: "+this.get("type")+"</p>"}}}),define("app/document/NodeOperation",["exoskeleton-master/exoskeleton","jquery/jquery","app/document/Node","app/document/StringUtils","app/editor/UndoManager","rangy/rangy-core"],function(a){"use strict";var b=(a("exoskeleton-master/exoskeleton"),a("app/document/Node")),c=b.Node,d=b.TYPE,e=(b.NodeCollectionUtils,a("app/document/StringUtils")),f=a("app/editor/UndoManager"),g=a("rangy/rangy-core.js");c.normalizeNode=function(a){if(0==a.get("children").length){if(c.isType(a,d.paragraph)){var b=new c({type:d.line,text:a.get("text"),parent:a,"in":a.get("in")});return a.unset("text"),b}if(c.isType(a,d.blockquote)){var e=new c({type:d.paragraph,parent:a,"in":a.get("in")});return c.normalizeNode(e)}}};var h=function(a,b){try{var e,f,g=!b.isDeleted()&&b.getClosetParagraphLevel().get("parent");if(g=c.isType(g,d.list_item)&&g.get("parent"),e=c.isType(g,d.list)&&g.get("style"),!e)return;if(f=a.get("text"),f.match(/^(\s{2, }|\t)/))return;e==c.ListType.ol?f=f.replace(/^\s*\d+\.\s*/,""):e==c.ListType.task?f=f.replace(/^\s*[*+-]?[ \t\u00A0]+(\[(x|X)\]|\[ \]\s*)/,""):e==c.ListType.ul&&(f=f.replace(/^\s*[+*-]\s*/,"")),a.set("text",f)}catch(h){}},i=function(a,b,e){return function(f,g){var i,j=!1,k={prev:f,next:g};return f.get("type")==d.line&&(!e&&f.parseFrom(),c.isType(f,d.line)||(j=!0,k.oldCid=f.get("parent").cid,i=f.separateBlockFromLine(),k.prev=i[1],k.opt_prev=i[0])),g.get("type")==d.line&&(!a&&!b&&h(g,f),!e&&g.parseFrom(),c.isType(g,d.line)?a&&c.isType(k.prev,d.math_block,d.fences,d.meta_block)&&(k.prev.set("text",g.get("text")||""),j=!1,g.remove(),k.next=null):(j=!j,i=g.separateBlockFromLine(!0),k.next=i[1],k.opt_next=i[2],c.isType(k.opt_next,d.paragraph)&&c.isType(f,d.line)&&f.get("after")&&f.get("parent").giveChildrenTo(k.opt_next,f.get("after"),null,!0))),j&&(k.prev=c.isType(k.prev,d.line)?k.prev.get("parent"):k.prev,k.next=c.isType(k.next,d.line)?k.next.get("parent"):k.next),!a&&c.isType(k.prev,d.line)?!1:(!k.prev.canContainBlock(!0)&&c.isType(k.prev.get("parent"),d.list_item)&&(b=b||k.prev.get("before"),b||(k.noExit=!0),k.prev.get("parent").get("parent").get("children").toArray().forEach(function(a){a.unset("tail")})),k)}};c.genNormalSplitExitFunc=i,c.prototype.breakOn=function(a,b,e){function g(a){var b=a.get("parent");return c.isType(b,d.list_item)&&!a.get("before")&&!a.get("after")&&!b.get("before")&&!b.get("after")&&b.get("parent").get("attachTo")}function h(h){if(h=h.getClosetBlock(),1>=m&&c.isType(h,d.def_footnote,d.def_footnote)&&!a&&!e&&c.isEmptyBlock(h,null,!0)){var i=f.makeEmptyCommand(b.selection.buildUndo());return i.undo.push(f.buildReplaceUndo(h)),h.unset("ahead"),h.unset("tail"),h.set("type",d.paragraph),c.normalizeNode(h),i.redo.push(f.buildReplaceUndo(h)),i.redo.push({type:"cursor",id:h.getLastChild().cid,start:0}),{command:i,nextFocus:h.getLastChild().cid,oldCid:h.cid,newHtml:h.toHTML()}}if(0==l&&0==m&&!a&&!e&&h.closest(d.blockquote,d.list)&&h.get("parent")&&h.get("parent").canContainBlock(!0)&&!g(h)){var i=f.makeEmptyCommand();i.undo.push(b.selection.buildUndo());var j={},k=h.get("before")&&c.isEmptyBlock(h.get("before"));return j=h.upStream(k),i.undo=i.undo.concat(j.command.undo),i.redo=i.redo.concat(j.command.redo),j.nextFocus=j.nextFocus||h.id,i.redo.push({type:"cursor",id:j.nextFocus,start:0}),j.command=i,j}}function j(g,h){var j,k=f.makeEmptyCommand(),l={},n=h==m&&h>0,o=g.getClosetBlock();return k.undo.push(b.selection.buildUndo()),k.undo.push(c.isType(o.get("parent"),d.list_item)&&!a?b.undo.buildReplaceUndo(o.get("parent")):b.undo.buildReplaceUndo(o)),o.unset("ahead"),o.unset("tail"),c.isType(g,d.line)&&c.isEmptyBlock(g,null,!0)&&(e=!1),l=c.splitAt(g,h,b,i(e,a)),k.redo.push(b.undo.buildReplaceUndo(l.prev)),l.oldCid=l.oldCid||l.prev.cid,l.next&&f.addUndoForInsert(k,l.next),l.opt_prev&&f.addUndoForInsert(k,l.opt_prev),l.opt_next&&f.addUndoForInsert(k,l.opt_next),l.newHtml=j&&j.id==l.oldCid?j.toHTML():"",l.newHtml||[l.opt_prev,l.prev,l.next,l.opt_next].map(function(a){a&&(l.newHtml+=a.toHTML())}),l.nextFocus=c.isType(l.prev,d.meta_block)&&n&&l.prev.get("text").match(/\n\n$/)?l.next.getVeryFirst().id:n&&c.isType(l.prev,d.math_block,d.fences,d.meta_block)?l.prev.getVeryFirst(!0).id:n&&c.isType(l.prev,d.table)?l.prev.getLastChild().getVeryFirst().cid:l.next.getVeryFirst().cid,k.redo.push({type:"cursor",id:l.nextFocus,start:0}),l.command=k,l}function k(a){var e=a.get("parent");if(l==m&&e&&e==b.nodeMap.getFirst()&&c.isType(e,d.paragraph)&&!a.get("before")&&!a.get("after")&&"---"===a.get("text")){var g=b.stylize.insertMetaBlock(!0);return g.command.undo.push(f.buildReplaceUndo(e)),a.set("text",""),g.command.redo.push(f.buildReplaceUndo(e)),g.newHtml=g.node.toHTML()+e.toHTML(),g.nextFocus=g.node.id,g.oldCid=e.id,g}}var l,m;if(c.isType(this,d.def_footnote)){var n=b.getJQueryElem(window.getSelection().baseNode);l=n.closest(".md-def-name").length?b.selection.getOffset(n.closest(".md-def-name")):this.get("ref").length+b.selection.getOffset(n.closest(".md-def-content"))}else l=c.isType(this,d.meta_block)?this.getText(!1).length:b.selection.getOffset(b.findElemById(this.id));if(this.get("children").length)return this.get("children").toArray().map(function(a){b.findElemById(a.id).replaceWith(a.toMark())}),this.clearChildren(),this.set("text",b.findElemById(this.id).text()),j(this,this.get("text").length);if(m=this.getText(!1).length,c.isType(this,d.def_link,d.def_footnote)&&(m+=this.get("ref").length),!this.get("children").length){var o;if(o=h(this.getClosetBlock()))return o;if(o=k(this))return o;if(m>=l)return j(this,l)}},c.isEmptyBlock=function(a,b,f){var g=f?e.isNullOrBlank:e.isNullOrEmpty;if(c.isType(a,b||[]))return!1;if(a.get("children").length){if(c.isType(a,d.paragraph))return 1==a.get("children").length&&g(a.get("children").at(0).get("text"))}else{if(c.isType(a,d.def_link))return g(a.get("ref"))&&g(a.get("href"))&&g(a.get("title"));if(c.isType(a,d.def_footnote))return g(a.get("ref"))&&g(a.get("text"));if(!c.isType(a,d.table_cell,d.table_row,d.hr))return g(a.get("text"))}return!1};var j=function(a,b){return b&&c.isType(a,d.def_link,d.def_footnote)&&c.isEmptyBlock(a)||!b&&c.isType(a,d.meta_block)||c.isType(a,d.heading)&&c.isEmptyBlock(a)?(a.set("type",d.paragraph),a.set("text",""),a.clearChildren(),c.normalizeNode(a),a.id):void 0};c.smartSplit=function(a,b,c){var d,e,f,h=g.createRange();c?(f=$.parseHTML("<span />")[0],a[0].appendChild(f),a.prepend("<span />"),h.moveToBookmark({containerNode:a[0],start:b,end:b}),h.setEndAfter(f),f=h.extractContents(),e=f.querySelectorAll("[md-inline='strong'], [md-inline='em'], [md-inline='del'], [md-inline='code']"),d=a[0].querySelectorAll("[md-inline='strong'], [md-inline='em'], [md-inline='del'], [md-inline='code']")):(a[0].childElementCount<3&&(f=$.parseHTML("<span />")[0],a[0].insertBefore(f,a[0].firstChild),a.append("<span />")),h.moveToBookmark({containerNode:a[0],start:0,end:b}),f&&h.setStart(f,0),f=h.extractContents(),d=f.querySelectorAll("[md-inline='strong'], [md-inline='em'], [md-inline='del'], [md-inline='code']"),e=a[0].querySelectorAll("[md-inline='strong'], [md-inline='em'], [md-inline='del'], [md-inline='code']"));for(var i=0;i<d.length;i++){var j=$(d[i]);j.find(":not(.md-meta)").text().length?j.children(".md-after").length||j.append(j.children(".md-before").clone().removeClass("md-before").addClass("md-after")):j.html("")}for(var i=0;i<e.length;i++){var j=$(e[i]);j.find(":not(.md-meta)").text().length?j.children(".md-before").length||j.prepend(j.children(".md-after").clone().removeClass("md-after").addClass("md-before")):j.html("")}for(var k=f.querySelectorAll("svg"),i=0;i<k.length;i++)k[i].parentElement.removeChild(k[i]);return[$(f).text(),a.textExcludeSVG()]},c.splitAt=function(a,b,e,f){var g,h,j,l=a.clone();if(f=f||i(!1,!0),c.isType(a,d.paragraph,d.line,d.heading,d.list_item))j=c.smartSplit(e.findElemById(a.id),b),g=j[0],h=j[1],c.isType(a.get("parent"),d.list_item)&&a.get("parent").get("parent").get("children").toArray().forEach(function(a){a.unset("tail")});else if(c.isType(a,d.def_link,d.def_footnote)){var m=a.get("ref");if(b<=m.length)a.set("ref",m.substring(0,b)),l.set("ref",m.substring(b)),l.set("href",a.get("href")),l.set("title",a.get("title")),a.set("href",""),a.set("title",""),g="",h=a.get("text");else if(c.isType(a,d.def_link)){var n=a.get("href")||"",o=a.get("title")||"";b<=m.length+n.length?(a.set("title",""),l.set("ref",""),a.set("href",n.substring(0,b-m.length)),l.set("href",n.substring(b-m.length))):(l.set("ref",""),l.set("href",""),a.set("title",o.substring(0,b-m.length-n.length)),l.set("title",o.substring(b-m.length-n.length)))}else{var p=a.get("text")||"";l.set("ref",""),g=p.substring(0,b-m.length),h=p.substring(b-m.length)}}else g=a.getText().substring(0,b),h=a.getText().substring(b);return a.set("text",g),!c.isType(l,d.paragraph,d.def_link)&&l.set("text",h),k(a,l,void 0,f)},c.prototype.separateBlockFromLine=function(a){var b,e,f=this.get("before"),g=this.get("after"),h=this.get("parent"),i=h;return this.detach(),f&&(a?(i=new c({type:d.paragraph,trim:h.get("trim")}),b=h,b.insert(i,!1)):(b=new c({type:d.paragraph,trim:h.get("trim")}),i.insert(b,!0)),i.giveChildrenTo(b,null,f,!0)),g&&(e=new c({type:d.paragraph,trim:h.get("trim")}),i.giveChildrenTo(e,g,null,!0),i.insert(e,!1)),i.copyContentFrom(this),this.giveChildrenTo(i),this.remove(),b&&b.unset("tail"),i&&i.unset("ahead"),i&&i.unset("tail"),e&&e.unset("ahead"),[b,i,e]};var k=function(a,b,c,d){var e,f=a.isBlock(!0);if(c=c||a.get("parent"),a.set("parent",c),a.insert(b),a.unset("tail"),b.unset("ahead"),d&&f&&(f=d(a,b),"object"==typeof f&&(e=f,a=f.prev,b=f.next,f.noExit&&(f=!1))),f)return j(a,!0),b&&(j(b,!1),a.insert(b)),e=e||{prev:a,next:b,oldCid:a.cid};var g=a.get("parent").clone();return g.set("text",""),a.get("parent").giveChildrenTo(g,b,null,!0),k(a.get("parent"),g,void 0,d)};c.getTreePosition=function(a,b){function c(a){return a.get("parent")?1+c(a.get("parent")):0}function d(a,b){return a==b?[a,a,b]:a.get("parent")==b.get("parent")||!a.get("parent")&&!a.get("parent")?[a.get("parent"),a,b]:d(a.get("parent"),b.get("parent"))}if(a==b)return[a,a,b];var e=c(a)-c(b);if(e>0)for(;e>0;)a=a.get("parent"),e--;else if(0>e)for(;0>e;)b=b.get("parent"),e++;return d(a,b)},c.prototype.copyContentFrom=function(a){var b=this;c.property.map(function(c){b.set(c,a.get(c))})},c.prototype.clone=function(){var a=new c;return a.copyContentFrom(this),a.set("in",this.get("in")),a},c.reverseAttrFromElem=function(a,b,c){var d,e=b.attr("mdtype");switch(a.set("type",e),c&&(b.find("[data-emoji]").text(function(){return this.getAttribute("data-emoji")}),b.find(".md-meta, .md-content").remove()),a.set("text",b.text()),e){case a.TYPE.heading:a.set("depth",b[0].tagName.replace(/H/gi,""));break;case a.TYPE.list:a.set("style",b[0].tagName.toLowerCase()),b.hasClass("task-list")&&a.set("style","taskList");break;case a.TYPE.math_block:break;case a.TYPE.fences:a.set("lang",b.attr("lang")||b.find("input.mode").val()),a.set("text",b.find("textarea[id]").val()||b.text());break;case a.TYPE.list_item:a.set("checked","checked"==b.attr("checked"));break;case a.TYPE.def_link:a.set("ref",b.find(".md-def-name").text()),a.set("title",b.find(".md-def-title").text()),a.set("href",b.find(".md-def-content").text());break;case a.TYPE.def_footnote:a.set("text",b.find(".md-def-content").text()),a.set("ref",b.find(".md-def-name").text());break;case a.TYPE.table:d=[],b.find("tbody>tr:first").children().toArray().map(function(a){d[a.cellIndex]=a.style.textAlign,""==a.style.textAlign&&(d[a.cellIndex]=null)}),d.length||b.find("thead>tr:first").children().toArray().map(function(a){d[a.cellIndex]=a.style.textAlign,""==a.style.textAlign&&(d[a.cellIndex]=null)}),a.set("align",d);break;case a.TYPE.table_row:a.set("header",b.closest("thead").length>0)}},c.reverse=function(a,b,d){if(a.length&&a[0].hasAttribute("mdtype")){var e,f,g=new c({"in":b});return c.reverseAttrFromElem(g,a,d),g.get("type")==g.TYPE.table?(a.children().children("tr[mdtype]").toArray().map(function(a){f=c.reverse($(a),b,d),f.set("parent",g),f.set("before",e),e=f}),c.TableEdit.valify(g)):g.get("type")==g.TYPE.table_row?a.children().children("span[mdtype]").toArray().map(function(a){f=c.reverse($(a),b,d),f.set("parent",g),f.set("before",e),e=f}):a.children("[mdtype]").toArray().map(function(a){f=c.reverse($(a),b,d),f.set("parent",g),f.set("before",e),e=f}),g}},c.prototype.downStream=function(a){var b=new c({type:a,parent:this.get("parent"),before:this.get("before"),after:this.get("after"),"in":this.get("in"),attachTo:this.get("attachTo")});this.set("parent",b)},c.prototype.upStream=function(a,b){var e,g=this.get("parent"),h={};if(h.command=b||f.makeEmptyCommand(),g)if(!c.isType(g,d.list_item)||this.get("before")||this.get("after")){h.command.undo.push(f.buildReplaceUndo(g)),h.oldCid=g.id;var i=this.get("after"),j=this.get("before"),k=g.get("type")==d.list_item;if(this.set("parent",g.get("parent")),this.get("type")!==d.table&&(this.get("type")==d.list_item&&(this.set("type",d.paragraph),c.normalizeNode(this),h.nextFocus=this.getFirstChild().cid),g.get("type")==d.list_item)){this.set("type",g.get("type"));var l=new c({type:d.paragraph,"in":this.get("in")});this.giveChildrenTo(l),l.set("parent",this),c.normalizeNode(l)}if(h.newHtml=this.toHTML(),i)if(i.set("before",this.canContainBlock(!1)?this.getFirstChild():null),k){do i.set("parent",this),i=i.get("after");while(i);h.newHtml=this.toHTML()}else{e=g.clone();do i.set("parent",e),i=i.get("after");while(i);h.newHtml+=e.toHTML()}j?(h.command.redo.push(f.buildReplaceUndo(g)),f.addUndoForRemove(h.command,this),g.insert(this),f.addUndoForInsert(h.command,this),h.newHtml=g.toHTML()+h.newHtml):(f.addUndoForRemove(h.command,this),g.insert(this,!0),f.addUndoForInsert(h.command,this),f.addUndoForRemove(h.command,g),g.remove()),e&&(this.insert(e),f.addUndoForInsert(h.command,e))}else{var m=f.buildReplaceUndo(g);this.giveChildrenTo(g),this.remove(),h=g.upStream(),h.command.undo.unshift(m),h.nextFocus=h.nextFocus||g.id}return h},c.prototype.attr=function(a,b,c,f){function g(d,e){var f=c.undo.UndoManager.makeEmptyCommand();return f.undo.push({type:"attr",id:d.id,key:a,value:e||d.safeGetStrAttr(a)}),f.redo.push({type:"attr",key:a,id:d.id,value:b}),f}if(this.get(a)!=b)switch(f||(c.store(),c.undo.completeSnap(!0)),f||"align_idx"==a||c.undo.register(g(this)),b="string"==typeof b?e.escape(b):b,a){case"lang":var h=c.fences.getCm(this.id);h.setOption("mode",getCodeMirrorMode(b)),h.refresh(),this.set("lang",b),f&&$("[cid='"+this.id+"'] input.mode").val(b?b:"").focus();break;case"checked":var i=document.querySelector("[cid='"+this.id+"']>input");b?i.setAttribute("checked","checked"):i.removeAttribute("checked"),i.checked=b||!1,this.set("checked",b||!1);break;case"href-title":if(this.get("type")==d.image){var j=b.split(/\s/);if(c.findElemById(this.id).find("img").attr("src",j[0]),this.set("href",j[0]),this.set("title",j[1]),f){var k=$("[cid='"+this.id+"']");k.hasClass("onfocus")||(k.addClass("onfocus").focus(),c.EditHelper.showTooltipForImage(c,k),$("[cid='"+this.id+"'] input.t-bracket-input").val(b?b:"").focus())}}break;case"alt":if(this.get("type")==d.image&&(c.findElemById(this.id).find("img").attr("alt",b),this.set("alt",b),f)){var k=$("[cid='"+this.id+"']");k.hasClass("onfocus")||(k.addClass("onfocus").focus(),c.EditHelper.showTooltipForImage(c,k),$("[cid='"+this.id+"'] input.t-alt-input").val(b?b:"").focus())}break;case"align_idx":if(this.get("type")==d.table){var l=b[0],m=b[1],k=c.findElemById(this.id);!f&&c.undo.register(g(this,[l,this.get("align")[l]])),this.get("align")[l]=m,m=m?m:"",k.find(".md-table-edit>tr>th:nth-child("+(l+2)+") .btn").removeClass("active").blur(),k.find(".md-table-edit>tr>th:nth-child("+(l+2)+") .md-align-"+m).addClass("active").focus(),k.find("thead:not(.md-table-edit)>tr>th:nth-child("+(l+1)+")").css("text-align",m),k.find("tbody>tr>td:nth-child("+(l+1)+")").css("text-align",m),f&&c.tableEdit.showTableEdit(k)}}},c.prototype.unwrap=function(a){var c=[],d=this,e=this.getFirstChild();do{var f=e.get("after");e.set("parent",d.get("parent")),e.set("attachTo",d.get("attachTo")),e.get("before")||e.set("before",d.get("before")),e.get("after")||e.set("after",d.get("after")),c.push(e),e=f}while(e);return this.remove(!0),a&&a.findElemById(this.cid).replaceWith(b.NodeCollectionUtils.toHTML(c)),c},c.prototype.wrap=function(a,b,c,d){for(var e,f=a,g=[],h={parent:a.get("parent"),before:a.get("before"),after:b?b.get("after"):a.get("after")};f&&f!=h.after;)c&&c.findElemById(f.id).remove(),e=f,f=f.get("after"),this.append(e);h.after&&(h.after.insert(this,!0),d||(g=c.findElemById(h.after.id),g.before(this.toHTML()))),!g.length&&h.before&&(h.before.insert(this,!1),d||(g=c.findElemById(h.before.id),g.after(this.toHTML()))),g.length||(h.parent?(this.set("parent",h.parent),!d&&c&&c.findElemById(h.parent.id).html(this.toHTML())):d||0!==$(c.sessionStr).children().length||(this.set("attachTo",this.get("in")),c&&$(c.sessionStr).html(this.toHTML())))}}),define("rangy/rangy-core.js",[],function(a,b,c){"use strict";var d=function(){function a(a,b){var c=typeof a[b];return c==s||!(c!=r||!a[b])||"unknown"==c}function b(a,b){return!(typeof a[b]!=r||!a[b])}function c(a,b){return typeof a[b]!=t}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&y(a,x)&&A(a,w)}function f(a){return b(a,"body")?a.body:a.getElementsByTagName("body")[0]}function g(c){b(window,"console")&&a(window.console,"log")&&window.console.log(c)}function h(a,b){b?window.alert(a):g(a)}function i(a){C.initialized=!0,C.supported=!1,h("Rangy is not supported on this page in your browser. Reason: "+a,C.config.alertOnFail)}function j(a){h("Rangy warning: "+a,C.config.alertOnWarn)}function k(a){return a.message||a.description||String(a)}function l(){if(!C.initialized){var b,c=!1,d=!1;a(document,"createRange")&&(b=document.createRange(),y(b,v)&&A(b,u)&&(c=!0));var h=f(document);if(!h||"body"!=h.nodeName.toLowerCase())return void i("No body element found");if(h&&a(h,"createTextRange")&&(b=h.createTextRange(),e(b)&&(d=!0)),!c&&!d)return void i("Neither Range nor TextRange are available");C.initialized=!0,C.features={implementsDomRange:c,implementsTextRange:d};var j,l;for(var m in B)(j=B[m])instanceof n&&j.init(j,C);for(var o=0,p=E.length;p>o;++o)try{E[o](C)}catch(q){l="Rangy init listener threw an exception. Continuing. Detail: "+k(q),g(l)}}}function m(a){a=a||window,l();for(var b=0,c=F.length;c>b;++b)F[b](a)}function n(a,b,c){this.name=a,this.dependencies=b,this.initialized=!1,this.supported=!1,this.initializer=c}function o(a,b,c,d){var e=new n(b,c,function(a){if(!a.initialized){a.initialized=!0;try{d(C,a),a.supported=!0}catch(c){var e="Module '"+b+"' failed to load: "+k(c);g(e)}}});B[b]=e}function p(){}function q(){}var r="object",s="function",t="undefined",u=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],v=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],w=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],x=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],y=d(a),z=d(b),A=d(c),B={},C={version:"1.3alpha.20140716",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:y,areHostObjects:z,areHostProperties:A,isTextRange:e,getBody:f},features:{},modules:B,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};C.fail=i,C.warn=j,{}.hasOwnProperty?C.util.extend=function(a,b,c){var d,e;for(var f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],c&&null!==d&&"object"==typeof d&&null!==e&&"object"==typeof e&&C.util.extend(d,e,!0),a[f]=e);return b.hasOwnProperty("toString")&&(a.toString=b.toString),a}:i("hasOwnProperty not supported"),function(){var a=document.createElement("div");a.appendChild(document.createElement("span"));var b,c=[].slice;try{1==c.call(a.childNodes,0)[0].nodeType&&(b=function(a){return c.call(a,0)})}catch(d){}b||(b=function(a){for(var b=[],c=0,d=a.length;d>c;++c)b[c]=a[c];return b}),C.util.toArray=b}();var D;a(document,"addEventListener")?D=function(a,b,c){a.addEventListener(b,c,!1)}:a(document,"attachEvent")?D=function(a,b,c){a.attachEvent("on"+b,c)}:i("Document does not have required addEventListener or attachEvent method"),C.util.addListener=D;var E=[];C.init=l,C.addInitListener=function(a){C.initialized?a(C):E.push(a)};var F=[];C.addCreateMissingNativeApiListener=function(a){F.push(a)},C.createMissingNativeApi=m,n.prototype={init:function(){for(var a,b,c=this.dependencies||[],d=0,e=c.length;e>d;++d){if(b=c[d],a=B[b],!(a&&a instanceof n))throw new Error("required module '"+b+"' not found");if(a.init(),!a.supported)throw new Error("required module '"+b+"' not supported")
}this.initializer(this)},fail:function(a){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+a)},warn:function(a){C.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){C.warn("DEPRECATED: "+a+" in module "+this.name+"is deprecated. Please use "+b+" instead")},createError:function(a){return new Error("Error in Rangy "+this.name+" module: "+a)}},C.createModule=function(a){var b,c;2==arguments.length?(b=arguments[1],c=[]):(b=arguments[2],c=arguments[1]),o(!1,a,c,b)},C.createCoreModule=function(a,b,c){o(!0,a,b,c)},C.RangePrototype=p,C.rangePrototype=new p,C.selectionPrototype=new q;var G=!1,H=function(){G||(G=!0,C.initialized||l())};return typeof window==t?void i("No window found"):typeof document==t?void i("No document found"):(a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",H,!1),D(window,"load",H),C)}(this);d.createCoreModule("DomUtil",[],function(a,b){function c(a){var b;return typeof a.namespaceURI==D||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function d(a){var b=a.parentNode;return 1==b.nodeType?b:null}function e(a){for(var b=0;a=a.previousSibling;)++b;return b}function f(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}}function g(a,b){var c,d=[];for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(H(d,c))return c;return null}function h(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function i(a,b){return h(a,b,!0)}function j(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function k(a){var b=a.nodeType;return 3==b||4==b||8==b}function l(a){if(!a)return!1;var b=a.nodeType;return 3==b||8==b}function m(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function n(a,b,c){var d=a.cloneNode(!1);if(d.deleteData(0,b),a.deleteData(b,a.length-b),m(d,a),c)for(var f,g=0;f=c[g++];)f.node==a&&f.offset>b?(f.node=d,f.offset-=b):f.node==a.parentNode&&f.offset>e(a)&&++f.offset;return d}function o(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=D)return a.ownerDocument;if(typeof a.document!=D)return a.document;if(a.parentNode)return o(a.parentNode);throw b.createError("getDocument: no document found for node")}function p(a){var c=o(a);if(typeof c.defaultView!=D)return c.defaultView;if(typeof c.parentWindow!=D)return c.parentWindow;throw b.createError("Cannot get a window object for node")}function q(a){if(typeof a.contentDocument!=D)return a.contentDocument;if(typeof a.contentWindow!=D)return a.contentWindow.document;throw b.createError("getIframeDocument: No Document object found for iframe element")}function r(a){if(typeof a.contentWindow!=D)return a.contentWindow;if(typeof a.contentDocument!=D)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element")}function s(a){return a&&E.isHostMethod(a,"setTimeout")&&E.isHostObject(a,"document")}function t(a,b,c){var d;if(a?E.isHostProperty(a,"nodeType")?d=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?q(a):o(a):s(a)&&(d=a.document):d=document,!d)throw b.createError(c+"(): Parameter must be a Window object or DOM node");return d}function u(a){for(var b;b=a.parentNode;)a=b;return a}function v(a,c,d,f){var h,i,k,l,m;if(a==d)return c===f?0:f>c?-1:1;if(h=j(d,a,!0))return c<=e(h)?-1:1;if(h=j(a,d,!0))return e(h)<f?-1:1;if(i=g(a,d),!i)throw new Error("comparePoints error: nodes have no common ancestor");if(k=a===i?i:j(a,i,!0),l=d===i?i:j(d,i,!0),k===l)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");for(m=i.firstChild;m;){if(m===k)return-1;if(m===l)return 1;m=m.nextSibling}}function w(a){var b;try{return b=a.parentNode,!1}catch(c){return!0}}function x(a){if(!a)return"[No node]";if(I&&w(a))return"[Broken node]";if(k(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">[index:"+e(a)+",length:"+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return a.nodeName}function y(a){for(var b,c=o(a).createDocumentFragment();b=a.firstChild;)c.appendChild(b);return c}function z(a){this.root=a,this._next=a}function A(a){return new z(a)}function B(a,b){this.node=a,this.offset=b}function C(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var D="undefined",E=a.util;E.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),E.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var F=document.createElement("div");E.areHostMethods(F,["insertBefore","appendChild","cloneNode"]||!E.areHostObjects(F,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),E.isHostProperty(F,"innerHTML")||b.fail("Element is missing innerHTML property");var G=document.createTextNode("test");E.areHostMethods(G,["splitText","deleteData","insertData","appendData","cloneNode"]||!E.areHostObjects(F,["previousSibling","nextSibling","childNodes","parentNode"])||!E.areHostProperties(G,["data"]))||b.fail("Incomplete Text Node implementation");var H=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},I=!1;!function(){var b=document.createElement("b");b.innerHTML="1";var c=b.firstChild;b.innerHTML="<br>",I=w(c),a.features.crashyTextNodes=I}();var J;typeof window.getComputedStyle!=D?J=function(a,b){return p(a).getComputedStyle(a,null)[b]}:typeof document.documentElement.currentStyle!=D?J=function(a,b){return a.currentStyle[b]}:b.fail("No means of obtaining computed style properties found"),z.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a,b,c=this._current=this._next;if(this._current)if(a=c.firstChild)this._next=a;else{for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}},B.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},C.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},C.prototype.toString=function(){return this.message},a.dom={arrayContains:H,isHtmlNamespace:c,parentElement:d,getNodeIndex:e,getNodeLength:f,getCommonAncestor:g,isAncestorOf:h,isOrIsAncestorOf:i,getClosestAncestorIn:j,isCharacterDataNode:k,isTextOrCommentNode:l,insertAfter:m,splitDataNode:n,getDocument:o,getWindow:p,getIframeWindow:r,getIframeDocument:q,getBody:E.getBody,isWindow:s,getContentDocument:t,getRootContainer:u,comparePoints:v,isBrokenNode:w,inspectNode:x,getComputedStyleProperty:J,fragmentFromNodeChildren:y,createIterator:A,DomPosition:B},a.DOMException=C}),d.createCoreModule("DomRange",["DomUtil"],function(a){function b(a,b){return 3!=a.nodeType&&(N(a,b.startContainer)||N(a,b.endContainer))}function c(a){return a.document||O(a.startContainer)}function d(a){return new J(a.parentNode,M(a))}function e(a){return new J(a.parentNode,M(a)+1)}function f(a,b,c){var d=11==a.nodeType?a.firstChild:a;return L(b)?c==b.length?H.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:Q(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function g(a,b,d){if(y(a),y(b),c(b)!=c(a))throw new K("WRONG_DOCUMENT_ERR");var e=P(a.startContainer,a.startOffset,b.endContainer,b.endOffset),f=P(a.endContainer,a.endOffset,b.startContainer,b.startOffset);return d?0>=e&&f>=0:0>e&&f>0}function h(a){for(var b,d,e,f=c(a.range).createDocumentFragment();d=a.next();){if(b=a.isPartiallySelectedSubtree(),d=d.cloneNode(!b),b&&(e=a.getSubtreeIterator(),d.appendChild(h(e)),e.detach()),10==d.nodeType)throw new K("HIERARCHY_REQUEST_ERR");f.appendChild(d)}return f}function i(a,b,c){var d,e;c=c||{stop:!1};for(var f,g;f=a.next();)if(a.isPartiallySelectedSubtree()){if(b(f)===!1)return void(c.stop=!0);if(g=a.getSubtreeIterator(),i(g,b,c),g.detach(),c.stop)return}else for(d=H.createIterator(f);e=d.next();)if(b(e)===!1)return void(c.stop=!0)}function j(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),j(b),b.detach()):a.remove()}function k(a){for(var b,d,e=c(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),d=a.getSubtreeIterator(),b.appendChild(k(d)),d.detach()):a.remove(),10==b.nodeType)throw new K("HIERARCHY_REQUEST_ERR");e.appendChild(b)}return e}function l(a,b,c){var d,e=!(!b||!b.length),f=!!c;e&&(d=new RegExp("^("+b.join("|")+")$"));var g=[];return i(new n(a,!1),function(b){if(!(e&&!d.test(b.nodeType)||f&&!c(b))){var h=a.startContainer;if(b!=h||!L(h)||a.startOffset!=h.length){var i=a.endContainer;b==i&&L(i)&&0==a.endOffset||g.push(b)}}}),g}function m(a){var b="undefined"==typeof a.getName?"Range":a.getName();return"["+b+"("+H.inspectNode(a.startContainer)+":"+a.startOffset+", "+H.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function n(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&L(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||L(this.sc)?R(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||L(this.ec)?R(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function o(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,T(a,d))return e;e=e.parentNode}return null}}function p(a,b){if(bb(a,b))throw new K("INVALID_NODE_TYPE_ERR")}function q(a,b){if(!T(b,a.nodeType))throw new K("INVALID_NODE_TYPE_ERR")}function r(a,b){if(0>b||b>(L(a)?a.length:a.childNodes.length))throw new K("INDEX_SIZE_ERR")}function s(a,b){if(_(a,!0)!==_(b,!0))throw new K("WRONG_DOCUMENT_ERR")}function t(a){if(ab(a,!0))throw new K("NO_MODIFICATION_ALLOWED_ERR")}function u(a,b){if(!a)throw new K(b)}function v(a){return V&&H.isBrokenNode(a)||!T(X,a.nodeType)&&!_(a,!0)}function w(a,b){return b<=(L(a)?a.length:a.childNodes.length)}function x(a){return!!a.startContainer&&!!a.endContainer&&!v(a.startContainer)&&!v(a.endContainer)&&w(a.startContainer,a.startOffset)&&w(a.endContainer,a.endOffset)}function y(a){if(!x(a))throw new Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function z(a,b){y(a);var c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset,g=c===e;L(e)&&f>0&&f<e.length&&Q(e,f,b),L(c)&&d>0&&d<c.length&&(c=Q(c,d,b),g?(f-=d,e=c):e==c.parentNode&&f>=M(c)&&f++,d=0),a.setStartAndEnd(c,d,e,f)}function A(a){a.START_TO_START=hb,a.START_TO_END=ib,a.END_TO_END=jb,a.END_TO_START=kb,a.NODE_BEFORE=lb,a.NODE_AFTER=mb,a.NODE_BEFORE_AND_AFTER=nb,a.NODE_INSIDE=ob}function B(a){A(a),A(a.prototype)}function C(a,b){return function(){y(this);var c,d,f=this.startContainer,g=this.startOffset,h=this.commonAncestorContainer,j=new n(this,!0);f!==h&&(c=R(f,h,!0),d=e(c),f=d.node,g=d.offset),i(j,t),j.reset();var k=a(j);return j.detach(),b(this,f,g,f,g),k}}function D(c,f){function g(a,b){return function(c){q(c,W),q(U(c),X);var f=(a?d:e)(c);(b?h:i)(this,f.node,f.offset)}}function h(a,b,c){var d=a.endContainer,e=a.endOffset;(b!==a.startContainer||c!==a.startOffset)&&((U(b)!=U(d)||1==P(b,c,d,e))&&(d=b,e=c),f(a,b,c,d,e))}function i(a,b,c){var d=a.startContainer,e=a.startOffset;(b!==a.endContainer||c!==a.endOffset)&&((U(b)!=U(d)||-1==P(b,c,d,e))&&(d=b,e=c),f(a,d,e,b,c))}var l=function(){};l.prototype=a.rangePrototype,c.prototype=new l,I.extend(c.prototype,{setStart:function(a,b){p(a,!0),r(a,b),h(this,a,b)},setEnd:function(a,b){p(a,!0),r(a,b),i(this,a,b)},setStartAndEnd:function(){var a=arguments,b=a[0],c=a[1],d=b,e=c;switch(a.length){case 3:e=a[2];break;case 4:d=a[2],e=a[3]}f(this,b,c,d,e)},setBoundary:function(a,b,c){this["set"+(c?"Start":"End")](a,b)},setStartBefore:g(!0,!0),setStartAfter:g(!1,!0),setEndBefore:g(!0,!1),setEndAfter:g(!1,!1),collapse:function(a){y(this),a?f(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):f(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){p(a,!0),f(this,a,0,a,S(a))},selectNode:function(a){p(a,!1),q(a,W);var b=d(a),c=e(a);f(this,b.node,b.offset,c.node,c.offset)},extractContents:C(k,f),deleteContents:C(j,f),canSurroundContents:function(){y(this),t(this.startContainer),t(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},splitBoundaries:function(){z(this)},splitBoundariesPreservingPositions:function(a){z(this,a)},normalizeBoundaries:function(){y(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,d=this.endOffset,e=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,d=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},g=function(e){var f=e.previousSibling;if(f&&f.nodeType==e.nodeType){a=e;var g=e.length;if(b=f.length,e.insertData(0,f.data),f.parentNode.removeChild(f),a==c)d+=b,c=a;else if(c==e.parentNode){var h=M(e);d==h?(c=e,d=g):d>h&&d--}}},h=!0;if(L(c))c.length==d&&e(c);else{if(d>0){var i=c.childNodes[d-1];i&&L(i)&&e(i)}h=!this.collapsed}if(h){if(L(a))0==b&&g(a);else if(b<a.childNodes.length){var j=a.childNodes[b];j&&L(j)&&g(j)}}else a=c,b=d;f(this,a,b,c,d)},collapseToPoint:function(a,b){p(a,!0),r(a,b),this.setStartAndEnd(a,b)}}),B(c)}function E(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:H.getCommonAncestor(a.startContainer,a.endContainer)}function F(a,b,c,d,e){a.startContainer=b,a.startOffset=c,a.endContainer=d,a.endOffset=e,a.document=H.getDocument(b),E(a)}function G(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this.document=a,E(this)}var H=a.dom,I=a.util,J=H.DomPosition,K=a.DOMException,L=H.isCharacterDataNode,M=H.getNodeIndex,N=H.isOrIsAncestorOf,O=H.getDocument,P=H.comparePoints,Q=H.splitDataNode,R=H.getClosestAncestorIn,S=H.getNodeLength,T=H.arrayContains,U=H.getRootContainer,V=a.features.crashyTextNodes;n.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,L(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a,b,c=this._current;!L(c)||c!==this.sc&&c!==this.ec?c.parentNode&&c.parentNode.removeChild(c):(a=c===this.sc?this.so:0,b=c===this.ec?this.eo:c.length,a!=b&&c.deleteData(a,b-a))},isPartiallySelectedSubtree:function(){var a=this._current;return b(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new G(c(this.range));var b=this._current,d=b,e=0,f=b,g=S(b);N(b,this.sc)&&(d=this.sc,e=this.so),N(b,this.ec)&&(f=this.ec,g=this.eo),F(a,d,e,f,g)}return new n(a,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var W=[1,3,4,5,7,8,10],X=[2,9,11],Y=[5,6,10,12],Z=[1,3,4,5,7,8,10,11],$=[1,3,4,5,7,8],_=o([9,11]),ab=o(Y),bb=o([6,10,12]),cb=document.createElement("style"),db=!1;try{cb.innerHTML="<b>x</b>",db=3==cb.firstChild.nodeType}catch(eb){}a.features.htmlParsingConforms=db;var fb=db?function(a){var b=this.startContainer,c=O(b);if(!b)throw new K("INVALID_STATE_ERR");var d=null;return 1==b.nodeType?d=b:L(b)&&(d=H.parentElement(b)),d=null===d||"HTML"==d.nodeName&&H.isHtmlNamespace(O(d).documentElement)&&H.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1),d.innerHTML=a,H.fragmentFromNodeChildren(d)}:function(a){var b=c(this),d=b.createElement("body");return d.innerHTML=a,H.fragmentFromNodeChildren(d)},gb=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],hb=0,ib=1,jb=2,kb=3,lb=0,mb=1,nb=2,ob=3;I.extend(a.rangePrototype,{compareBoundaryPoints:function(a,b){y(this),s(this.startContainer,b.startContainer);var c,d,e,f,g=a==kb||a==hb?"start":"end",h=a==ib||a==hb?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],P(c,d,e,f)},insertNode:function(a){if(y(this),q(a,Z),t(this.startContainer),N(a,this.startContainer))throw new K("HIERARCHY_REQUEST_ERR");var b=f(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){y(this);var a,b;if(this.collapsed)return c(this).createDocumentFragment();if(this.startContainer===this.endContainer&&L(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=c(this).createDocumentFragment(),b.appendChild(a),b;var d=new n(this,!0);return a=h(d),d.detach(),a},canSurroundContents:function(){y(this),t(this.startContainer),t(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},surroundContents:function(a){if(q(a,$),!this.canSurroundContents())throw new K("INVALID_STATE_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);f(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){y(this);for(var a,b=new G(c(this)),d=gb.length;d--;)a=gb[d],b[a]=this[a];return b},toString:function(){y(this);var a=this.startContainer;if(a===this.endContainer&&L(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new n(this,!0);return i(c,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){y(this);var b=a.parentNode,c=M(a);if(!b)throw new K("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return 0>d?e>0?nb:lb:e>0?mb:ob},comparePoint:function(a,b){return y(this),u(a,"HIERARCHY_REQUEST_ERR"),s(a,this.startContainer),P(a,b,this.startContainer,this.startOffset)<0?-1:P(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:fb,toHtml:function(){y(this);var a=this.commonAncestorContainer.parentNode.cloneNode(!1);return a.appendChild(this.cloneContents()),a.innerHTML},intersectsNode:function(a,b){if(y(this),u(a,"NOT_FOUND_ERR"),O(a)!==c(this))return!1;var d=a.parentNode,e=M(a);u(d,"NOT_FOUND_ERR");var f=P(d,e,this.endContainer,this.endOffset),g=P(d,e+1,this.startContainer,this.startOffset);return b?0>=f&&g>=0:0>f&&g>0},isPointInRange:function(a,b){return y(this),u(a,"HIERARCHY_REQUEST_ERR"),s(a,this.startContainer),P(a,b,this.startContainer,this.startOffset)>=0&&P(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a){return g(this,a,!1)},intersectsOrTouchesRange:function(a){return g(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var b=P(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=P(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var b=this.cloneRange();return-1==P(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==P(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new K("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==ob},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,S(a))<=0},containsRange:function(a){var b=this.intersection(a);return null!==b&&a.equals(b)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();return b.setEnd(d,d.length),this.containsRange(b)}return this.containsNodeContents(a)},getNodes:function(a,b){return y(this),l(this,a,b)},getDocument:function(){return c(this)},collapseBefore:function(a){this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){this.setStartAfter(a),this.collapse(!0)},getBookmark:function(b){function d(a){var b=a.cloneContents();if(b.querySelector("text")){for(var c=b.querySelectorAll("svg"),d=0;d<c.length;d++)c[d].parentElement.removeChild(c[d]);return b.textContent.length}return a.toString().length}var e=c(this),f=a.createRange(e);b=b||H.getBody(e),f.selectNodeContents(b);var g=this.intersection(f),h=b.querySelectorAll("text").length,i=0,j=0;return g&&(f.setEnd(g.startContainer,g.startOffset),i=h?d(f):f.toString().length,j=i+(h?d(g):g.toString().length)),{start:i,end:j,containerNode:b}},moveToBookmark:function(a){var b=a.containerNode,c=0;this.setStart(b,0),this.collapse(!0);for(var d,e,f,g,h=[b],i=!1,j=!1;!j&&(d=h.pop());)if(3==d.nodeType)e=c+d.length,!i&&a.start>=c&&a.start<=e&&(this.setStart(d,a.start-c),i=!0),i&&a.end>=c&&a.end<=e&&(this.setEnd(d,a.end-c),j=!0),c=e;else if(!/^text$/i.exec(d.tagName||""))for(g=d.childNodes,f=g.length;f--;)h.push(g[f])},getName:function(){return"DomRange"},equals:function(a){return G.rangesEqual(this,a)},isValid:function(){return x(this)},inspect:function(){return m(this)},detach:function(){}}),D(G,F),I.extend(G,{rangeProperties:gb,RangeIterator:n,copyComparisonConstants:B,createPrototypeRange:D,inspect:m,getRangeDocument:c,rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}}),a.DomRange=G}),d.createCoreModule("WrappedRange",["DomRange"],function(a,b){var c,d,e=a.dom,f=a.util,g=e.DomPosition,h=a.DomRange,i=e.getBody,j=e.getContentDocument,k=e.isCharacterDataNode;if(a.features.implementsDomRange&&!function(){function d(a){for(var b,c=m.length;c--;)b=m[c],a[b]=a.nativeRange[b];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}function g(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e,h=!a.equals(a.nativeRange);(f||g||h)&&(a.setEnd(d,e),a.setStart(b,c))}var k,l,m=h.rangeProperties;c=function(a){if(!a)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=a,d(this)},h.createPrototypeRange(c,g),k=c.prototype,k.selectNode=function(a){this.nativeRange.selectNode(a),d(this)},k.cloneContents=function(){return this.nativeRange.cloneContents()},k.surroundContents=function(a){this.nativeRange.surroundContents(a),d(this)},k.collapse=function(a){this.nativeRange.collapse(a),d(this)},k.cloneRange=function(){return new c(this.nativeRange.cloneRange())},k.refresh=function(){d(this)},k.toString=function(){return this.nativeRange.toString()};var n=document.createTextNode("test");i(document).appendChild(n);var o=document.createRange();o.setStart(n,0),o.setEnd(n,0);try{o.setStart(n,1),k.setStart=function(a,b){this.nativeRange.setStart(a,b),d(this)},k.setEnd=function(a,b){this.nativeRange.setEnd(a,b),d(this)},l=function(a){return function(b){this.nativeRange[a](b),d(this)}}}catch(p){k.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}d(this)},k.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}d(this)},l=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(e){this.nativeRange[b](c),this.nativeRange[a](c)}d(this)}}}k.setStartBefore=l("setStartBefore","setEndBefore"),k.setStartAfter=l("setStartAfter","setEndAfter"),k.setEndBefore=l("setEndBefore","setStartBefore"),k.setEndAfter=l("setEndAfter","setStartAfter"),k.selectNodeContents=function(a){this.setStartAndEnd(a,0,e.getNodeLength(a))},o.selectNodeContents(n),o.setEnd(n,3);var q=document.createRange();q.selectNodeContents(n),q.setEnd(n,4),q.setStart(n,2),k.compareBoundaryPoints=-1==o.compareBoundaryPoints(o.START_TO_END,q)&&1==o.compareBoundaryPoints(o.END_TO_START,q)?function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};var r=document.createElement("div");r.innerHTML="123";var s=r.firstChild,t=i(document);t.appendChild(r),o.setStart(s,1),o.setEnd(s,2),o.deleteContents(),"13"==s.data&&(k.deleteContents=function(){this.nativeRange.deleteContents(),d(this)},k.extractContents=function(){var a=this.nativeRange.extractContents();return d(this),a}),t.removeChild(r),t=null,f.isHostMethod(o,"createContextualFragment")&&(k.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),i(document).removeChild(n),k.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),a.createRange()}}(),a.features.implementsTextRange){var l=function(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var f=c.parentElement(),g=d==f?d:e.getCommonAncestor(d,f);return g==b?g:e.getCommonAncestor(b,g)},m=function(a){return 0==a.compareEndPoints("StartToEnd",a)},n=function(a,b,c,d,f){var h=a.duplicate();h.collapse(c);var i=h.parentElement();if(e.isOrIsAncestorOf(b,i)||(i=b),!i.canHaveHTML){var j=new g(i.parentNode,e.getNodeIndex(i));return{boundaryPosition:j,nodeInfo:{nodeIndex:j.offset,containerElement:j.node}}}var l=e.getDocument(i).createElement("span");l.parentNode&&l.parentNode.removeChild(l);for(var m,n,o,p,q,r=c?"StartToStart":"StartToEnd",s=f&&f.containerElement==i?f.nodeIndex:0,t=i.childNodes.length,u=t,v=u;;){if(v==t?i.appendChild(l):i.insertBefore(l,i.childNodes[v]),h.moveToElementText(l),m=h.compareEndPoints(r,a),0==m||s==u)break;if(-1==m){if(u==s+1)break;s=v}else u=u==s+1?s:v;v=Math.floor((s+u)/2),i.removeChild(l)}if(q=l.nextSibling,-1==m&&q&&k(q)){h.setEndPoint(c?"EndToStart":"EndToEnd",a);var w;if(/[\r\n]/.test(q.data)){var x=h.duplicate(),y=x.text.replace(/\r\n/g,"\r").length;for(w=x.moveStart("character",y);-1==(m=x.compareEndPoints("StartToEnd",x));)w++,x.moveStart("character",1)}else w=h.text.length;p=new g(q,w)}else n=(d||!c)&&l.previousSibling,o=(d||c)&&l.nextSibling,p=o&&k(o)?new g(o,0):n&&k(n)?new g(n,n.data.length):new g(i,e.getNodeIndex(l));return l.parentNode.removeChild(l),{boundaryPosition:p,nodeInfo:{nodeIndex:v,containerElement:i}}},o=function(a,b){var c,d,f,g,h=a.offset,j=e.getDocument(a.node),l=i(j).createTextRange(),m=k(a.node);return m?(c=a.node,d=c.parentNode):(g=a.node.childNodes,c=h<g.length?g[h]:null,d=a.node),f=j.createElement("span"),f.innerHTML="&#feff;",c?d.insertBefore(f,c):d.appendChild(f),l.moveToElementText(f),l.collapse(!b),d.removeChild(f),m&&l[b?"moveStart":"moveEnd"]("character",h),l};if(d=function(a){this.textRange=a,this.refresh()},d.prototype=new h(document),d.prototype.refresh=function(){var a,b,c,d=l(this.textRange);m(this.textRange)?b=a=n(this.textRange,d,!0,!0).boundaryPosition:(c=n(this.textRange,d,!0,!1),a=c.boundaryPosition,b=n(this.textRange,d,!1,!1,c.nodeInfo).boundaryPosition),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},d.prototype.getName=function(){return"WrappedTextRange"},h.copyComparisonConstants(d),d.rangeToTextRange=function(a){if(a.collapsed)return o(new g(a.startContainer,a.startOffset),!0);var b=o(new g(a.startContainer,a.startOffset),!0),c=o(new g(a.endContainer,a.endOffset),!1),d=i(h.getRangeDocument(a)).createTextRange();return d.setEndPoint("StartToStart",b),d.setEndPoint("EndToEnd",c),d},a.WrappedTextRange=d,!a.features.implementsDomRange||a.config.preferTextRange){var p=function(){return this}();"undefined"==typeof p.Range&&(p.Range=d),a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),i(a).createTextRange()},a.WrappedRange=d}}a.createRange=function(c){return c=j(c,b,"createRange"),new a.WrappedRange(a.createNativeRange(c))},a.createRangyRange=function(a){return a=j(a,b,"createRangyRange"),new h(a)},a.createIframeRange=function(c){return b.deprecationNotice("createIframeRange()","createRange(iframeEl)"),a.createRange(c)},a.createIframeRangyRange=function(c){return b.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),a.createRangyRange(c)},a.addCreateMissingNativeApiListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(c)}),c=b=null})}),d.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,b){function c(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function d(a,c){if(a){if(C.isWindow(a))return a;if(a instanceof r)return a.win;var d=C.getContentDocument(a,b,c);return C.getWindow(d)}return window}function e(a){return d(a,"getWinSelection").getSelection()}function f(a){return d(a,"getDocSelection").document.selection}function g(a){var b=!1;return a.anchorNode&&(b=1==C.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b}function h(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function i(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function j(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function k(b){var c;return b instanceof F?(c=a.createNativeRange(b.getDocument()),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset)):b instanceof G?c=b.nativeRange:J.implementsDomRange&&b instanceof C.getWindow(b.startContainer).Range&&(c=b),c}function l(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;c>b;++b)if(!C.isAncestorOf(a[0],a[b]))return!1;return!0}function m(a){var c=a.getNodes();if(!l(c))throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function n(a){return!!a&&"undefined"!=typeof a.text}function o(a,b){var c=new G(b);a._ranges=[c],h(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function p(b){if(b._ranges.length=0,"None"==b.docSelection.type)j(b);else{var c=b.docSelection.createRange();if(n(c))o(b,c);else{b.rangeCount=c.length;for(var d,e=L(c.item(0)),f=0;f<b.rangeCount;++f)d=a.createRange(e),d.selectNode(c.item(f)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,h(b,b._ranges[b.rangeCount-1],!1)}}}function q(a,c){for(var d=a.docSelection.createRange(),e=m(c),f=L(d.item(0)),g=M(f).createControlRange(),h=0,i=d.length;i>h;++h)g.add(d.item(h));try{g.add(e)}catch(j){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),p(a)}function r(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function s(a){a.win=a.anchorNode=a.focusNode=a._ranges=null,a.rangeCount=a.anchorOffset=a.focusOffset=0,a.detached=!0}function t(a,b){for(var c,d,e=bb.length;e--;)if(c=bb[e],d=c.selection,"deleteAll"==b)s(d);else if(c.win==a)return"delete"==b?(bb.splice(e,1),!0):d;return"deleteAll"==b&&(bb.length=0),null}function u(a,c){for(var d,e=L(c[0].startContainer),f=M(e).createControlRange(),g=0,h=c.length;h>g;++g){d=m(c[g]);try{f.add(d)}catch(i){throw b.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}f.select(),p(a)}function v(a,b){if(a.win.document!=L(b))throw new H("WRONG_DOCUMENT_ERR")
}function w(b){return function(c,d){var e;this.rangeCount?(e=this.getRangeAt(0),e["set"+(b?"Start":"End")](c,d)):(e=a.createRange(this.win.document),e.setStartAndEnd(c,d)),this.setSingleRange(e,this.isBackward())}}function x(a){var b=[],c=new I(a.anchorNode,a.anchorOffset),d=new I(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;g>f;++f)b[f]=F.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.config.checkSelectionRanges=!0;var y,z,A="boolean",B="number",C=a.dom,D=a.util,E=D.isHostMethod,F=a.DomRange,G=a.WrappedRange,H=a.DOMException,I=C.DomPosition,J=a.features,K="Control",L=C.getDocument,M=C.getBody,N=F.rangesEqual,O=E(window,"getSelection"),P=D.isHostObject(document,"selection");J.implementsWinGetSelection=O,J.implementsDocSelection=P;var Q=P&&(!O||a.config.preferTextRange);Q?(y=f,a.isSelectionValid=function(a){var b=d(a,"isSelectionValid").document,c=b.selection;return"None"!=c.type||L(c.createRange().parentElement())==b}):O?(y=e,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=y;var R=y(),S=a.createNativeRange(document),T=M(document),U=D.areHostProperties(R,["anchorNode","focusNode","anchorOffset","focusOffset"]);J.selectionHasAnchorAndFocus=U;var V=E(R,"extend");J.selectionHasExtend=V;var W=typeof R.rangeCount==B;J.selectionHasRangeCount=W;var X=!1,Y=!0,Z=V?function(b,c){var d=F.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.addRange(k(e)),b.extend(c.startContainer,c.startOffset)}:null;D.areHostMethods(R,["addRange","getRangeAt","removeAllRanges"])&&typeof R.rangeCount==B&&J.implementsDomRange&&!function(){var b=window.getSelection();if(b){for(var c=b.rangeCount,d=[],e=g(b),f=0;c>f;++f)d[f]=b.getRangeAt(f);for(f=0;c>f;++f)0==f&&e?Z?Z(b,d[f]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),b.addRange(d[f])):b.addRange(d[f])}}(),J.selectionSupportsMultipleRanges=X,J.collapsedNonEditableSelectionsSupported=Y;var $,_=!1;T&&E(T,"createControlRange")&&($=T.createControlRange(),D.areHostProperties($,["item","add"])&&(_=!0)),J.implementsControlRange=_,z=U?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var ab;E(R,"getRangeAt")?ab=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:U&&(ab=function(b){var c=L(b.anchorNode),d=a.createRange(c);return d.setStartAndEnd(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&d.setStartAndEnd(b.focusNode,b.focusOffset,b.anchorNode,b.anchorOffset),d}),r.prototype=a.selectionPrototype;var bb=[],cb=function(a){if(a&&a instanceof r)return a.refresh(),a;a=d(a,"getNativeSelection");var b=t(a),c=y(a),e=P?f(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh()):(b=new r(c,e,a),bb.push({win:a,selection:b})),b};a.getSelection=cb,a.getIframeSelection=function(c){return b.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),a.getSelection(C.getIframeWindow(c))};var db=r.prototype;if(!Q&&U&&D.areHostMethods(R,["removeAllRanges","addRange"])){db.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),j(this)};var eb=function(a,b){Z(a.nativeSelection,b),a.refresh()};db.addRange=W?function(b,d){if(_&&P&&this.docSelection.type==K)q(this,b);else if(c(d)&&V)eb(this,b);else{var e;if(X?e=this.rangeCount:(this.removeAllRanges(),e=0),this.nativeSelection.addRange(k(b).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==e+1){if(a.config.checkSelectionRanges){var f=ab(this.nativeSelection,this.rangeCount-1);f&&!N(f,b)&&(b=new G(f))}this._ranges[this.rangeCount-1]=b,h(this,b,hb(this.nativeSelection)),this.isCollapsed=z(this)}else this.refresh()}}:function(a,b){c(b)&&V?eb(this,a):(this.nativeSelection.addRange(k(a)),this.refresh())},db.setRanges=function(a){if(_&&a.length>1)u(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;c>b;++b)this.addRange(a[b])}}}else{if(!(E(R,"empty")&&E(S,"select")&&_&&Q))return b.fail("No means of selecting a Range or TextRange was found"),!1;db.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=L(this.anchorNode);else if(this.docSelection.type==K){var b=this.docSelection.createRange();b.length&&(a=L(b.item(0)))}if(a){var c=M(a).createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}j(this)},db.addRange=function(b){this.docSelection.type==K?q(this,b):(a.WrappedTextRange.rangeToTextRange(b).select(),this._ranges[0]=b,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,h(this,b,!1))},db.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?u(this,a):b&&this.addRange(a[0])}}db.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new H("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var fb;if(Q)fb=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=M(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==K?p(b):n(c)?o(b,c):j(b)};else if(E(R,"getRangeAt")&&typeof R.rangeCount==B)fb=function(b){if(_&&P&&b.docSelection.type==K)p(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;d>c;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));h(b,b._ranges[b.rangeCount-1],hb(b.nativeSelection)),b.isCollapsed=z(b)}else j(b)};else{if(!U||typeof R.isCollapsed!=A||typeof S.collapsed!=A||!J.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;fb=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=ab(c,0),a._ranges=[b],a.rangeCount=1,i(a),a.isCollapsed=z(a)):j(a)}}db.refresh=function(a){var b=a?this._ranges.slice(0):null,c=this.anchorNode,d=this.anchorOffset;if(fb(this),a){var e=b.length;if(e!=this._ranges.length)return!0;if(this.anchorNode!=c||this.anchorOffset!=d)return!0;for(;e--;)if(!N(b[e],this._ranges[e]))return!0;return!1}};var gb=function(a,b){var c=a.getAllRanges();a.removeAllRanges();for(var d=0,e=c.length;e>d;++d)N(b,c[d])||a.addRange(c[d]);a.rangeCount||j(a)};db.removeRange=_?function(a){if(this.docSelection.type==K){for(var b,c=this.docSelection.createRange(),d=m(a),e=L(c.item(0)),f=M(e).createControlRange(),g=!1,h=0,i=c.length;i>h;++h)b=c.item(h),b!==d||g?f.add(c.item(h)):g=!0;f.select(),p(this)}else gb(this,a)}:function(a){gb(this,a)};var hb;!Q&&U&&J.implementsDomRange?(hb=g,db.isBackward=function(){return hb(this)}):hb=db.isBackward=function(){return!1},db.isBackwards=db.isBackward,db.toString=function(){for(var a=[],b=0,c=this.rangeCount;c>b;++b)a[b]=""+this._ranges[b];return a.join("")},db.collapse=function(b,c){v(this,b);var d=a.createRange(b);d.collapseToPoint(b,c),this.setSingleRange(d),this.isCollapsed=!0},db.collapseToStart=function(){if(!this.rangeCount)throw new H("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},db.collapseToEnd=function(){if(!this.rangeCount)throw new H("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},db.selectAllChildren=function(b){v(this,b);var c=a.createRange(b);c.selectNodeContents(b),this.setSingleRange(c)},db.deleteFromDocument=function(){if(_&&P&&this.docSelection.type==K){for(var a,b=this.docSelection.createRange();b.length;)a=b.item(0),b.remove(a),a.parentNode.removeChild(a);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();if(c.length){this.removeAllRanges();for(var d=0,e=c.length;e>d;++d)c[d].deleteContents();this.addRange(c[e-1])}}},db.eachRange=function(a,b){for(var c=0,d=this._ranges.length;d>c;++c)if(a(this.getRangeAt(c)))return b},db.getAllRanges=function(){var a=[];return this.eachRange(function(b){a.push(b)}),a},db.setSingleRange=function(a,b){this.removeAllRanges(),this.addRange(a,b)},db.callMethodOnEachRange=function(a,b){var c=[];return this.eachRange(function(d){c.push(d[a].apply(d,b))}),c},db.setStart=w(!0),db.setEnd=w(!1),a.rangePrototype.select=function(a){cb(this.getDocument()).setSingleRange(this,a)},db.changeEachRange=function(a){var b=[],c=this.isBackward();this.eachRange(function(c){a(c),b.push(c)}),this.removeAllRanges(),c&&1==b.length?this.addRange(b[0],"backward"):this.setRanges(b)},db.containsNode=function(a,b){return this.eachRange(function(c){return c.containsNode(a,b)},!0)},db.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}},db.moveToBookmark=function(b){for(var c,d,e=[],f=0;c=b.rangeBookmarks[f++];)d=a.createRange(this.win),d.moveToBookmark(c),e.push(d);b.backward?this.setSingleRange(e[0],"backward"):this.setRanges(e)},db.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},db.getName=function(){return"WrappedSelection"},db.inspect=function(){return x(this)},db.detach=function(){t(this.win,"delete"),s(this)},r.detachAll=function(){t(null,"deleteAll")},r.inspect=x,r.isDirectionBackward=c,a.Selection=r,a.selectionPrototype=db,a.addCreateMissingNativeApiListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return cb(a)}),a=null})}),c.exports=d}),define("app/editor/Fences",["codemirror/lib/codemirror","app/document/StringUtils","jquery/jquery","exoskeleton-master/exoskeleton","autoComplete","app/document/Node","app/editor/KeyMaster","codemirror/addon/selection/mark-selection","codemirror/addon/edit/closebrackets","codemirror/addon/edit/closetag","codemirror/addon/mode/overlay"],function(a,b,c){"use strict";{var d=a("codemirror/lib/codemirror"),e=a("app/document/StringUtils"),f=a("jquery/jquery"),g=a("exoskeleton-master/exoskeleton"),h=a("autoComplete.js"),i=a("app/document/Node"),j=a("app/editor/KeyMaster");j.map}Node=i.Node;var k=(a("codemirror/addon/selection/mark-selection"),a("codemirror/addon/edit/closebrackets"),a("codemirror/addon/edit/closetag"),a("codemirror/addon/mode/overlay"),["javascript","java","json","typescript","clojure","coffeescript","css","less","scss","gfm","markdown","xml","haskell","html","lua","lisp","commonlisp","pascal","perl","php","php+HTML","python","cython","ruby","shell","sh","sql","sql lite","mssql","mysql","CQL","mariadb","cassandra","plsql","tiddlywiki","wiki","vb","basic","visual basic","vbscript","velocity","verilog","xquery","yaml","go","groovy","nginx","octave","c","clike","c++","cpp","objective-c","csharp","c#","squirrel","ceylon","kotlin","tex","latex","swift","scala","R","D","diff","erlang","http","jade","rst","rust","jinja2","reStructuredText","asp","jsp","erb","ejs","embeddedjs","powershell","dockerfile","jsx","react","vue","nsis","mathematica","tiki wiki","properties","ini","livescript"]);!function(a){var b=a.commands.delLineLeft;a.commands.delLineLeft=function(c){try{return 0==c.getCursor().ch?a.commands.delCharBefore(c):b(c)}catch(d){}}}(d);var l=function(a,b){var c=[];return k.map(function(b){0==b.toLowerCase().indexOf(a.toLowerCase())&&c.push(b)}),c.sort(),c.length<4&&k.map(function(b){b.toLowerCase().indexOf(a.toLowerCase())>0&&c.push(b)}),b&&1==c.length&&c[0]==a?[]:c},m=function(a,b){var c=this,d=a.find("input.mode").change(function(){b.attr("lang",f(this).val(),c.editor,!1)});return h.enable(d[0],{hintsFetcher:function(a,b){b(l(a))}}),a};window.getCodeMirrorMode=function(a,b){if(a=a?a.toLowerCase():"",a=a.replace(/^\s*\.*lang(uage)*-/g,""))switch(a){case"javascript":case"text/javascript":case"js":return a="javascript";case"json":return a={name:"javascript",json:!0};case"text/typescript":case"typescript":return a={name:"javascript",typescript:!0};case"clojure":return a;case"coffee":case"coffeescript":return a;case"css":case"less":return a;case"scss":return a="text/x-scss";case"gfm":case"github flavored markdown":return a="gfm";case"markdown":return a;case"xml":return a;case"haskell":return a;case"htmlmixed":case"html":return a="htmlmixed";case"lua":return a;case"lisp":case"commonlisp":case"common lisp":return a="commonlisp";case"pascal":return a;case"perl":return a;case"php+HTML":return"application/x-httpd-php";case"php":return"text/x-php";case"cython":return a="text/x-cython";case"python":return a="text/x-python";case"ruby":return a;case"shell":case"sh":case"bash":return a="shell";case"sql":case"sql lite":return a="text/x-sql";case"mssql":return a="text/x-mssql";case"mysql":return a="text/x-mysql";case"mariadb":return a="text/x-mariadb";case"cassandra":case"cql":return a="text/x-cassandra";case"plsql":return a="text/x-plsql";case"stex":case"tex":case"latex":return a="stex";case"tiddlywiki":case"wiki":return a="tiddlywiki";case"vb":case"visual basic":case"basic":return a="vb";case"vbscript":return a;case"velocity":return a;case"verilog":return a="text/x-verilog";case"xquery":return a;case"yaml":return a;case"go":return a;case"groovy":return a;case"nginx":return a;case"octave":return a;case"c":case"clike":return a="text/x-csrc";case"c++":case"cpp":case"cc":return a="text/x-c++src";case"obj-c":case"objc":case"objective c":case"objective-c":return a="text/x-objectivec";case"text/x-scala":case"scala":a="text/x-scala";case"csharp":case"c#":a="text/x-csharp";case"java":return a="text/x-java";case"squirrel":return a="text/x-squirrel";case"ceylon":return a="text/x-ceylon";case"kotlin":return a="text/x-kotlin";case"swift":return a="text/swift";case"r":case"rlang":case"r-lang":return a="text/x-rsrc";case"d":return a;case"diff":return a;case"erlang":return a;case"http":return a;case"jade":return a;case"rst":case"restructuredtext":return a="rst";case"rust":return a;case"jinja2":return a;case"aspx":case"asp":case"asp.net":return a="application/x-aspx";case"jsp":return a="application/x-jsp";case"erb":return a="application/x-erb";case"ejs":case"embeddedjs":case"embedded javaScript":return a="application/x-ejs";case"powershell":return"application/x-powershell";case"dockerfile":return"text/x-dockerfile";case"jsx":case"react":return"text/jsx";case"vue.js":case"vue":case"vue-template":return"script/x-vue";case"nsis":return"text/x-nsis";case"mathematica":return"text/x-mathematica";case"tiki":case"tiki wiki":return"tiki";case"properties":case"ini":return"text/x-properties";case"livescript":return"text/x-livescript"}return b?null:a};var n=g.Model.extend({initialize:function(a){var b=this;this.editor=a,this.queue={},this.cachedCharWidth,this.$container=f("#fences-auto-suggest"),f(document).on("losefocus",".md-fences",function(){var a,c=f(this);b.syncToNode(this.getAttribute("cid")),setTimeout(function(){(a=b.queue[c.attr("cid")])&&0===f(document.activeElement).closest(".md-fences").length&&(a.setCursor(a.getCursor()),c.find(".md-tooltip-hide").hide())},100)}).on("mousedown",".autoComplt-list li",function(){return f("input.mode:focus").val(this.textContent),!1}),this.lazyload()},showAutoSuggest:function(a,b){if(b.token===a)return!1;var c=l(a,!0),d="";if(b.type="fences",b.token=a,b.match=c,b.found=c.length,b.pageNo=0,b.pageCnt=Math.floor((c.length-1)/5+1),!b.found)return this.$container.hide(),!1;for(var e=0;e<c.length&&40>e;e++)e%5==0&&(d+=(e>0?"</ul>":"")+"<ul data-page='"+e/5+"' style='display:none'>"),d+="<li data-content='"+c[e]+"' > "+c[e]+"</span></li>";return d+="</ul>",this.$container.html(d),this.$container},clickEventHandled:function(a,b){var c,d,e;this.queue[b]||(e=window.scrollY,this.getCm(b),e-=window.scrollY,window.scrollBy(0,e),c=document.elementFromPoint(a.clientX,a.clientY),c&&(a.stopPropagation(),d=document.createEvent("MouseEvents"),d.initMouseEvent("mousedown",!0,!0,c.ownerDocument.defaultView,1,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button),c.dispatchEvent(d)),this.editor.refocus(b))},getCm:function(a){if(this.queue[a]){if(f("[cid='"+a+"'] textarea").length)return this.queue[a];delete this.queue[a]}return this.queue[a]?void 0:this.addCodeBlock(a)},getValue:function(a){return this.queue[a]?this.queue[a].getValue():this.editor.findElemById(a).text()},addCodeBlock:function(a){function b(a){{var b=(j.findElemById(a.cid),j.getNode(a.cid)),c=j.undo.UndoManager,d=c.makeEmptyCommand();b.get("before")}k.beforeDeleteFences(a.cid),d.undo.push({type:"fences-pos",pos:a.getCursor(),id:a.cid}),c.append(d,j.UserOp.backToParagraph(j,b,!1)),j.undo.register(d)}function c(a,c){var e,f=c.which||c.keyCode,g=d.keyName(c);if("Up"==d.keyNames[f]){if(0===(a.getCursor()||{}).line&&!c.metaKey&&!c.shiftKey&&!c.ctrlKey)return j.selection.moveUpOrDown(!0,c),c.codemirrorIgnore;c.stopPropagation()}else if("Down"==d.keyNames[f]){if((a.getCursor()||{}).line>=a.lineCount()-1&&!c.metaKey&&!c.shiftKey&&!c.ctrlKey)return j.selection.moveUpOrDown(!1,c),c.codemirrorIgnore;c.stopPropagation()}else if("Backspace"==d.keyNames[f]){if(e=a.doc.getCursor(),a.doc.lineCount()<=1&&!e.line&&!e.ch)return b(a),c.preventDefault(),c.codemirrorIgnore;c.stopPropagation()}(d.keyMap.macDefault[g]||d.keyMap.pcDefault[g])&&c.stopPropagation()}function e(b){j.undo.completeSnap(!0),f(b.display.input).closest(".md-fences").find(".md-tooltip-hide").show(),j.refocus(a.id)}function g(a,b){if(3===b.which){var c,d=a.findWordAt(a.getCursor());a.setSelections([d]),c=j.selection.buildUndo(),setTimeout(function(){j.undo.exeCommand(c)},100)}}function h(){j.brush.updateWordCount()}function i(a){File.isTypeWriterMode&&j.selection.typeWriterScroll(f(a.display.wrapper).find(".CodeMirror-activeline"))}var j=this.editor,k=this;if("string"==typeof a&&(a=this.editor.getNode(a)),!this.queue[a.id]&&a.get("type")==a.TYPE.fences){var l="<textarea id = 'for-fence-"+a.id+"' />",n=f("[cid = "+a.id+"]").removeClass("mock-cm");n.html(l),l=f("#for-fence-"+a.id)[0],l.value=a.safeGetStrAttr("text").replace(/\r?\n$/,"").replace(/\u200b```/gi,"```"),this.queue[a.id]=d.fromTextArea(l,{lineWrapping:!0,mode:getCodeMirrorMode(a.get("lang")),styleSelectedText:!0,maxHighlightLength:1/0,viewportMargin:1/0,styleActiveLine:!0,autoCloseBrackets:!File.option.noPairingMatch,autoCloseTags:!File.option.noPairingMatch,theme:" inner",lineNumbers:File.option.showLineNumbersForFence},this.editor,a.id),a.get("history")&&this.queue[a.id].setHistory(a.get("history")),this.queue[a.id].off("keydown",c),this.queue[a.id].on("keydown",c),this.queue[a.id].off("focus",e),this.queue[a.id].on("focus",e),this.queue[a.id].off("mousedown",g),this.queue[a.id].on("mousedown",g),this.queue[a.id].off("changes",h),this.queue[a.id].on("changes",h),this.queue[a.id].off("cursorActivity",i),this.queue[a.id].on("cursorActivity",i),f("[cid = "+a.id+"] .CodeMirror").before("<div class= 'code-tooltip md-tooltip-hide' align='right'><input class='mode' type='text' value='"+(a.get("lang")?a.get("lang"):"")+"' placeholder='select a language'></div> "),m.call(this,n,a)}return this.queue[a.id]},focus:function(a){this.editor.undo.completeSnap(!0);var b="string"==typeof a?a:a.id;this.getCm(b),window.getSelection().removeAllRanges(),setTimeout(function(){f("[cid = "+b+"] textarea").focus(),this.editor.refocus(b)},50)},getFocused:function(){for(var a in this.queue)if(this.queue.hasOwnProperty(a)&&this.queue[a].hasFocus())return this.queue[a]},updateCodeNum:function(){for(var a in this.queue)this.editor.getNode(a)||delete this.queue[a]},syncToNode:function(a){var b,c;b="string"==typeof a?this.editor.getNode(a):a,b&&(c=this.getCm(b.id),c.save(),b.set("history",c.doc.history),editor.findElemById(b.id).children().length?b.set("text",this.queue[b.id].getValue()):b.set("text",""))},refreshEditor:function(a,b){var c=this,d=0;for(var e in this.queue)this.editor.getNode(e)&&this.editor.findElemById(e).find(".CodeMirror").length?(b&&this.queue[e].refresh(),d++):(delete this.queue[e],Node.isType(this.editor.getNode(e),Node.TYPE.fences)&&this.addCodeBlock(e));var g=f("[mdtype='fences']").toArray(),h=this.editor,i=File.option.showLineNumbersForFence?40:0,j=0;g.length!=d&&g.map(function(b){h.getNode(b.getAttribute("cid")).get("lang")?c.addCodeBlock(b.getAttribute("cid")):(a||i>j)&&(c.addCodeBlock(b.getAttribute("cid")),j++)})},lazyload:function(){var b=this;a.async(window.debugMode?"codemirror/mode.min.js":File.isMac?"lib/codemirror/mode.min.js":"lib.asar/codemirror/mode.min.js",function(){b.modeLoaded=!0,b.refreshEditor(),console.debug("codemirror mode is loaded")})},addToUndoManager:function(a){this.editor.undo.register({undo:[{type:"fences",cmd:"undo",id:a.cid}],redo:[{type:"fences",cmd:"redo",id:a.cid}]})},jumpCmEnd:function(a){var b=this.getCm(a),c=0,d=0;b&&(c=b.doc.lastLine(),d=b.doc.getLine(c).length,b.focus(),b.setCursor({line:c,ch:d}))},jumpCmBegin:function(a){var b=this.getCm(a);b.focus(),b.setCursor({line:0,ch:0})},beforeDeleteFences:function(a,b){var c,d;"string"==typeof a?(c=this.queue[a],d=this.editor.getNode(a)):(d=a,c=this.queue[d.id]),c&&(d.set("text",c.getValue()),d.set("history",c.doc.history),c.toTextArea(),c.doc.history=null,delete this.queue[d.id],b&&b.map(function(a){a&&(a.id==d.id&&a.json&&a.json.content&&a.json.content.type==d.TYPE.fences?(a.json.content.text=d.get("text"),a.json.content.history=d.get("history")):Array.isArray(a.json)&&a.json.map(function(a){a.id==d.id&&a.content.type==d.TYPE.fences&&(a.content.text=d.get("text"),a.content.history=d.get("history"))}))}))},deletionMonitor:function(a){var b=this;a.find("[mdtype='fences']").toArray().map(function(a){b.beforeDeleteFences(a.getAttribute("cid"))})},searchOn:function(a,b,c){function d(a){return{token:function(b){var d=!c.wholeWord||!b.pos||!/[a-z_\\u00C0-\\u024f]/.exec(b.string.substring(b.pos-1,b.pos));return!d||!b.match(f)||c.wholeWord&&/[a-z_\\u00C0-\\u024f]/.exec(b.string.substr(b.pos,b.pos+1))?(b.next(),b.pos=b.string.toLowerCase().indexOf(a,b.pos),!~b.pos&&b.skipToEnd(),null):"search-hit"}}}this.searchStatus=this.searchStatus||{},this.searchStatus.overlay=this.searchStatus.overlay||{};var f=new RegExp("^"+e.escapeRegExp(b),c.caseSensitive?"":"i");this.searchStatus.overlay[a.cid||"source"]=d(b),a.addOverlay(this.searchStatus.overlay[a.cid||"source"])},clearSearchOn:function(a){this.searchStatus&&a.removeOverlay(this.searchStatus.overlay[a.cid||"source"])},clearSearchAll:function(){if(this.editor.sourceView.inSourceMode)return this.searchStatus&&this.editor.sourceView.cm.removeOverlay(this.searchStatus.overlay.source),void(this.searchStatus=null);if(this.searchStatus&&this.searchStatus.overlay)for(var a in this.queue)this.queue.hasOwnProperty(a)&&this.searchStatus.overlay[a]&&this.queue[a].removeOverlay(this.searchStatus.overlay[a])}});c.exports=n,window.CodeMirror=d,window.Fences=n}),define("codemirror/lib/codemirror",[],function(a,b,c){c.exports=function(){"use strict";function a(c,d,e,f){if(!(this instanceof a))return new a(c,d,e,f);this.options=d=d||{},cf(qg,d,!1),o(d);var g=d.value;"string"==typeof g&&(g=new Og(g,d.mode)),this.doc=g;var h=this.display=new b(c,g);h.wrapper.CodeMirror=this,k(this),i(this),d.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),d.autofocus&&!Wf&&nc(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new Xe},Gf&&setTimeout(df(mc,this,!0),20),qc(this);var j=this;Yb(this,function(){j.curOp.forceUpdate=!0,qe(j,g),d.autofocus&&!Wf||lf()==h.input?setTimeout(df(Mc,j),20):Nc(j);for(var a in rg)rg.hasOwnProperty(a)&&rg[a](j,d[a],sg);for(var b=0;b<wg.length;++b)wg[b](j)}),j.editor=e,j.cid=f}function b(a,b){var c=this,d=c.input=gf("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none");Mf?d.style.width="1000px":d.setAttribute("wrap","off"),Vf&&(d.style.border="1px solid black"),d.setAttribute("autocorrect","off"),d.setAttribute("autocapitalize","off"),d.setAttribute("spellcheck","false"),c.inputDiv=gf("div",[d],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),c.scrollbarH=gf("div",[gf("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar"),c.scrollbarV=gf("div",[gf("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),c.scrollbarFiller=gf("div",null,"CodeMirror-scrollbar-filler"),c.gutterFiller=gf("div",null,"CodeMirror-gutter-filler"),c.lineDiv=gf("div",null,"CodeMirror-code"),c.selectionDiv=gf("div",null,null,"position: relative; z-index: 1"),c.cursorDiv=gf("div",null,"CodeMirror-cursors"),c.measure=gf("div",null,"CodeMirror-measure"),c.lineMeasure=gf("div",null,"CodeMirror-measure"),c.lineSpace=gf("div",[c.measure,c.lineMeasure,c.selectionDiv,c.cursorDiv,c.lineDiv],null,"position: relative; outline: none"),c.mover=gf("div",[gf("div",[c.lineSpace],"CodeMirror-lines")],null,"position: relative"),c.sizer=gf("div",[c.mover],"CodeMirror-sizer"),c.heightForcer=gf("div",null,null,"position: absolute; height: "+Zg+"px; width: 1px;"),c.gutters=gf("div",null,"CodeMirror-gutters"),c.lineGutter=null,c.scroller=gf("div",[c.sizer,c.heightForcer,c.gutters],"CodeMirror-scroll"),c.scroller.setAttribute("tabIndex","-1"),c.wrapper=gf("div",[c.inputDiv,c.scrollbarH,c.scrollbarV,c.scrollbarFiller,c.gutterFiller,c.scroller],"CodeMirror"),Hf&&(c.gutters.style.zIndex=-1,c.scroller.style.paddingRight=0),Vf&&(d.style.width="0px"),Mf||(c.scroller.draggable=!0),Rf&&(c.inputDiv.style.height="1px",c.inputDiv.style.position="absolute"),Hf&&(c.scrollbarH.style.minHeight=c.scrollbarV.style.minWidth="18px"),a.appendChild?a.appendChild(c.wrapper):a(c.wrapper),c.viewFrom=c.viewTo=b.first,c.view=[],c.externalMeasured=null,c.viewOffset=0,c.lastSizeC=0,c.updateLineNumbers=null,c.lineNumWidth=c.lineNumInnerWidth=c.lineNumChars=null,c.prevInput="",c.alignWidgets=!1,c.pollingFast=!1,c.poll=new Xe,c.cachedCharWidth=c.cachedTextHeight=c.cachedPaddingH=null,c.inaccurateSelection=!1,c.maxLine=null,c.maxLineLength=0,c.maxLineChanged=!1,c.wheelDX=c.wheelDY=c.wheelStartX=c.wheelStartY=null,c.shift=!1}function c(b){b.doc.mode=a.getMode(b.options,b.doc.modeOption),d(b)}function d(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null)}),a.doc.frontier=a.doc.first,sb(a,100),a.state.modeGen++,a.curOp&&cc(a)}function e(a){a.options.lineWrapping?(of(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth=""):(nf(a.display.wrapper,"CodeMirror-wrap"),n(a)),g(a),cc(a),Jb(a),setTimeout(function(){q(a)},100)}function f(a){var b=Ub(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/Vb(a.display)-3);return function(e){if(Rd(a.doc,e))return 0;var f=0;if(e.widgets)for(var g=0;g<e.widgets.length;g++)e.widgets[g].height&&(f+=e.widgets[g].height);return c?f+(Math.ceil(e.text.length/d)||1)*b:f+b}}function g(a){var b=a.doc,c=f(a);b.iter(function(a){var b=c(a);b!=a.height&&ue(a,b)})}function h(a){var b=Bg[a.options.keyMap],c=b.style;a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(c?" cm-keymap-"+c:"")}function i(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Jb(a)}function j(a){k(a),cc(a),setTimeout(function(){s(a)},20)}function k(a){var b=a.display.gutters,c=a.options.gutters;hf(b);for(var d=0;d<c.length;++d){var e=c[d],f=b.appendChild(gf("div",null,"CodeMirror-gutter "+e));"CodeMirror-linenumbers"==e&&(a.display.lineGutter=f,f.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=d?"":"none",l(a)}function l(a){var b=a.display.gutters.offsetWidth;a.display.sizer.style.marginLeft=b+"px",a.display.scrollbarH.style.left=a.options.fixedGutter?b+"px":0}function m(a){if(0==a.height)return 0;for(var b,c=a.text.length,d=a;b=Kd(d);){var e=b.find(0,!0);d=e.from.line,c+=e.from.ch-e.to.ch}for(d=a;b=Ld(d);){var e=b.find(0,!0);c-=d.text.length-e.from.ch,d=e.to.line,c+=d.text.length-e.to.ch}return c}function n(a){var b=a.display,c=a.doc;b.maxLine=re(c,c.first),b.maxLineLength=m(b.maxLine),b.maxLineChanged=!0,c.iter(function(a){var c=m(a);c>b.maxLineLength&&(b.maxLineLength=c,b.maxLine=a)})}function o(a){var b=_e(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):b>-1&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function p(a){var b=a.display.scroller;return{clientHeight:b.clientHeight,barHeight:a.display.scrollbarV.clientHeight,scrollWidth:b.scrollWidth,clientWidth:b.clientWidth,barWidth:a.display.scrollbarH.clientWidth,docHeight:Math.round(a.doc.height+xb(a.display))}}function q(a,b){b||(b=p(a));var c=a.display,d=b.docHeight+Zg,e=b.scrollWidth>b.clientWidth,f=d>b.clientHeight;if(f?(c.scrollbarV.style.display="block",c.scrollbarV.style.bottom=e?qf(c.measure)+"px":"0",c.scrollbarV.firstChild.style.height=Math.max(0,d-b.clientHeight+(b.barHeight||c.scrollbarV.clientHeight))+"px"):(c.scrollbarV.style.display="",c.scrollbarV.firstChild.style.height="0"),e?(c.scrollbarH.style.display="block",c.scrollbarH.style.right=f?qf(c.measure)+"px":"0",c.scrollbarH.firstChild.style.width=b.scrollWidth-b.clientWidth+(b.barWidth||c.scrollbarH.clientWidth)+"px"):(c.scrollbarH.style.display="",c.scrollbarH.firstChild.style.width="0"),e&&f?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=c.scrollbarFiller.style.width=qf(c.measure)+"px"):c.scrollbarFiller.style.display="",e&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",c.gutterFiller.style.height=qf(c.measure)+"px",c.gutterFiller.style.width=c.gutters.offsetWidth+"px"):c.gutterFiller.style.display="",Sf&&0===qf(c.measure)){c.scrollbarV.style.minWidth=c.scrollbarH.style.minHeight=Tf?"18px":"12px";var g=function(b){Pe(b)!=c.scrollbarV&&Pe(b)!=c.scrollbarH&&Zb(a,tc)(b)};Vg(c.scrollbarV,"mousedown",g),Vg(c.scrollbarH,"mousedown",g)}}function r(a,b,c){var d=c&&null!=c.top?c.top:a.scroller.scrollTop;d=Math.floor(d-wb(a));var e=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight,f=we(b,d),g=we(b,e);if(c&&c.ensure){var h=c.ensure.from.line,i=c.ensure.to.line;if(f>h)return{from:h,to:we(b,xe(re(b,h))+a.wrapper.clientHeight)};if(Math.min(i,b.lastLine())>=g)return{from:we(b,xe(re(b,i))-a.wrapper.clientHeight),to:i}}return{from:f,to:g}}function s(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var d=v(b)-b.scroller.scrollLeft+a.doc.scrollLeft,e=b.gutters.offsetWidth,f=d+"px",g=0;g<c.length;g++)if(!c[g].hidden){a.options.fixedGutter&&c[g].gutter&&(c[g].gutter.style.left=f);var h=c[g].alignable;if(h)for(var i=0;i<h.length;i++)h[i].style.left=f}a.options.fixedGutter&&(b.gutters.style.left=d+e+"px")}}function t(a){if(!a.options.lineNumbers)return!1;var b=a.doc,c=u(a.options,b.first+b.size-1),d=a.display;if(c.length!=d.lineNumChars){var e=d.measure.appendChild(gf("div",[gf("div",c)],"CodeMirror-linenumber CodeMirror-gutter-elt")),f=e.firstChild.offsetWidth,g=e.offsetWidth-f;return d.lineGutter.style.width="",d.lineNumInnerWidth=Math.max(f,d.lineGutter.offsetWidth-g)+g+2,d.lineNumWidth=d.lineNumInnerWidth+g,d.lineNumChars=d.lineNumInnerWidth?c.length:-1,d.lineGutter.style.width=d.lineNumWidth+"px",l(a),!0}return!1}function u(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function v(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function w(a,b,c){for(var d,e=a.display.viewFrom,f=a.display.viewTo,g=r(a.display,a.doc,b),h=!0;;h=!1){var i=a.display.scroller.clientWidth;if(!x(a,g,c))break;d=!0,a.display.maxLineChanged&&!a.options.lineWrapping&&y(a);var j=p(a);if(ob(a),z(a,j),q(a,j),Mf&&a.options.lineWrapping&&A(a,j),h&&a.options.lineWrapping&&i!=a.display.scroller.clientWidth)c=!0;else if(c=!1,b&&null!=b.top&&(b={top:Math.min(j.docHeight-Zg-j.clientHeight,b.top)}),g=r(a.display,a.doc,b),g.from>=a.display.viewFrom&&g.to<=a.display.viewTo)break}return a.display.updateLineNumbers=null,d&&(Re(a,"update",a),(a.display.viewFrom!=e||a.display.viewTo!=f)&&Re(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo)),d}function x(a,b,c){var d=a.display,e=a.doc;
if(!d.wrapper.offsetWidth)return void ec(a);if(!(!c&&b.from>=d.viewFrom&&b.to<=d.viewTo&&0==ic(a))){t(a)&&ec(a);var f=D(a),g=e.first+e.size,h=Math.max(b.from-a.options.viewportMargin,e.first),i=Math.min(g,b.to+a.options.viewportMargin);d.viewFrom<h&&h-d.viewFrom<20&&(h=Math.max(e.first,d.viewFrom)),d.viewTo>i&&d.viewTo-i<20&&(i=Math.min(g,d.viewTo)),bg&&(h=Pd(a.doc,h),i=Qd(a.doc,i));var j=h!=d.viewFrom||i!=d.viewTo||d.lastSizeC!=d.wrapper.clientHeight;hc(a,h,i),d.viewOffset=xe(re(a.doc,d.viewFrom)),a.display.mover.style.top=d.viewOffset+"px";var k=ic(a);if(j||0!=k||c){var l=lf();return k>4&&(d.lineDiv.style.display="none"),E(a,d.updateLineNumbers,f),k>4&&(d.lineDiv.style.display=""),l&&lf()!=l&&l.offsetHeight&&l.focus(),hf(d.cursorDiv),hf(d.selectionDiv),j&&(d.lastSizeC=d.wrapper.clientHeight,sb(a,400)),B(a),!0}}}function y(a){var b=a.display,c=Cb(a,b.maxLine,b.maxLine.text.length).left;b.maxLineChanged=!1;var d=Math.max(0,c+3),e=Math.max(0,b.sizer.offsetLeft+d+Zg-b.scroller.clientWidth);b.sizer.style.minWidth=d+"px",e<a.doc.scrollLeft&&Cc(a,Math.min(b.scroller.scrollLeft,e),!0)}function z(a,b){a.display.sizer.style.minHeight=a.display.heightForcer.style.top=b.docHeight+"px",a.display.gutters.style.height=Math.max(b.docHeight,b.clientHeight-Zg)+"px"}function A(a,b){a.display.sizer.offsetWidth+a.display.gutters.offsetWidth<a.display.scroller.clientWidth-1&&(a.display.sizer.style.minHeight=a.display.heightForcer.style.top="0px",a.display.gutters.style.height=b.docHeight+"px")}function B(a){for(var b=a.display,c=b.lineDiv.offsetTop,d=0;d<b.view.length;d++){var e,f=b.view[d];if(!f.hidden){if(Hf){var g=f.node.offsetTop+f.node.offsetHeight;e=g-c,c=g}else{var h=f.node.getBoundingClientRect();e=h.bottom-h.top}var i=f.line.height-e;if(2>e&&(e=Ub(b)),(i>.001||-.001>i)&&(ue(f.line,e),C(f.line),f.rest))for(var j=0;j<f.rest.length;j++)C(f.rest[j])}}}function C(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b)a.widgets[b].height=a.widgets[b].node.offsetHeight}function D(a){for(var b=a.display,c={},d={},e=b.gutters.firstChild,f=0;e;e=e.nextSibling,++f)c[a.options.gutters[f]]=e.offsetLeft,d[a.options.gutters[f]]=e.offsetWidth;return{fixedPos:v(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function E(a,b,c){function d(b){var c=b.nextSibling;return Mf&&Xf&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b),c}for(var e=a.display,f=a.options.lineNumbers,g=e.lineDiv,h=g.firstChild,i=e.view,j=e.viewFrom,k=0;k<i.length;k++){var l=i[k];if(l.hidden);else if(l.node){for(;h!=l.node;)h=d(h);var m=f&&null!=b&&j>=b&&l.lineNumber;l.changes&&(_e(l.changes,"gutter")>-1&&(m=!1),F(a,l,j,c)),m&&(hf(l.lineNumber),l.lineNumber.appendChild(document.createTextNode(u(a.options,j)))),h=l.node.nextSibling}else{var n=N(a,l,j,c);g.insertBefore(n,h)}j+=l.size}for(;h;)h=d(h)}function F(a,b,c,d){for(var e=0;e<b.changes.length;e++){var f=b.changes[e];"text"==f?J(a,b):"gutter"==f?L(a,b,c,d):"class"==f?K(b):"widget"==f&&M(b,d)}b.changes=null}function G(a){return a.node==a.text&&(a.node=gf("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),Hf&&(a.node.style.zIndex=2)),a.node}function H(a){var b=a.bgClass?a.bgClass+" "+(a.line.bgClass||""):a.line.bgClass;if(b&&(b+=" CodeMirror-linebackground"),a.background)b?a.background.className=b:(a.background.parentNode.removeChild(a.background),a.background=null);else if(b){var c=G(a);a.background=c.insertBefore(gf("div",null,b),c.firstChild)}}function I(a,b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,b.measure=c.measure,c.built):ee(a,b)}function J(a,b){var c=b.text.className,d=I(a,b);b.text==b.node&&(b.node=d.pre),b.text.parentNode.replaceChild(d.pre,b.text),b.text=d.pre,d.bgClass!=b.bgClass||d.textClass!=b.textClass?(b.bgClass=d.bgClass,b.textClass=d.textClass,K(b)):c&&(b.text.className=c)}function K(a){H(a),a.line.wrapClass?G(a).className=a.line.wrapClass:a.node!=a.text&&(a.node.className="");var b=a.textClass?a.textClass+" "+(a.line.textClass||""):a.line.textClass;a.text.className=b||""}function L(a,b,c,d){b.gutter&&(b.node.removeChild(b.gutter),b.gutter=null);var e=b.line.gutterMarkers;if(a.options.lineNumbers||e){var f=0===c||c===a.lineCount()-1||(c+1)%10===0?" CodeMirror-linenumber-show":"",g=G(b),h=b.gutter=g.insertBefore(gf("div",null,"CodeMirror-gutter-wrapper","position: absolute; left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px"),b.text);if(!a.options.lineNumbers||e&&e["CodeMirror-linenumbers"]||(b.lineNumber=h.appendChild(gf("div",u(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt"+f,"left: "+d.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.display.lineNumInnerWidth+"px"))),e)for(var i=0;i<a.options.gutters.length;++i){var j=a.options.gutters[i],k=e.hasOwnProperty(j)&&e[j];k&&h.appendChild(gf("div",[k],"CodeMirror-gutter-elt","left: "+d.gutterLeft[j]+"px; width: "+d.gutterWidth[j]+"px"))}}}function M(a,b){a.alignable&&(a.alignable=null);for(var c,d=a.node.firstChild;d;d=c){var c=d.nextSibling;"CodeMirror-linewidget"==d.className&&a.node.removeChild(d)}O(a,b)}function N(a,b,c,d){var e=I(a,b);return b.text=b.node=e.pre,e.bgClass&&(b.bgClass=e.bgClass),e.textClass&&(b.textClass=e.textClass),K(b),L(a,b,c,d),O(b,d),b.node}function O(a,b){if(P(a.line,a,b,!0),a.rest)for(var c=0;c<a.rest.length;c++)P(a.rest[c],a,b,!1)}function P(a,b,c,d){if(a.widgets)for(var e=G(b),f=0,g=a.widgets;f<g.length;++f){var h=g[f],i=gf("div",[h.node],"CodeMirror-linewidget");h.handleMouseEvents||(i.ignoreEvents=!0),Q(h,i,b,c),d&&h.above?e.insertBefore(i,b.gutter||b.text):e.appendChild(i),Re(h,"redraw")}}function Q(a,b,c,d){if(a.noHScroll){(c.alignable||(c.alignable=[])).push(b);var e=d.wrapperWidth;b.style.left=d.fixedPos+"px",a.coverGutter||(e-=d.gutterTotalWidth,b.style.paddingLeft=d.gutterTotalWidth+"px"),b.style.width=e+"px"}a.coverGutter&&(b.style.zIndex=5,b.style.position="relative",a.noHScroll||(b.style.marginLeft=-d.gutterTotalWidth+"px"))}function R(a){return cg(a.line,a.ch)}function S(a,b){return dg(a,b)<0?b:a}function T(a,b){return dg(a,b)<0?a:b}function U(a,b){this.ranges=a,this.primIndex=b}function V(a,b){this.anchor=a,this.head=b}function W(a,b){var c=a[b];a.sort(function(a,b){return dg(a.from(),b.from())}),b=_e(a,c);for(var d=1;d<a.length;d++){var e=a[d],f=a[d-1];if(dg(f.to(),e.from())>=0){var g=T(f.from(),e.from()),h=S(f.to(),e.to()),i=f.empty()?e.from()==e.head:f.from()==f.head;b>=d&&--b,a.splice(--d,2,new V(i?h:g,i?g:h))}}return new U(a,b)}function X(a,b){return new U([new V(a,b||a)],0)}function Y(a,b){return Math.max(a.first,Math.min(b,a.first+a.size-1))}function Z(a,b){if(b.line<a.first)return cg(a.first,0);var c=a.first+a.size-1;return b.line>c?cg(c,re(a,c).text.length):$(b,re(a,b.line).text.length)}function $(a,b){var c=a.ch;return null==c||c>b?cg(a.line,b):0>c?cg(a.line,0):a}function _(a,b){return b>=a.first&&b<a.first+a.size}function ab(a,b){for(var c=[],d=0;d<b.length;d++)c[d]=Z(a,b[d]);return c}function bb(a,b,c,d){if(a.cm&&a.cm.display.shift||a.extend){var e=b.anchor;if(d){var f=dg(c,e)<0;f!=dg(d,e)<0?(e=c,c=d):f!=dg(c,d)<0&&(c=d)}return new V(e,c)}return new V(d||c,c)}function cb(a,b,c,d){ib(a,new U([bb(a,a.sel.primary(),b,c)],0),d)}function db(a,b,c){for(var d=[],e=0;e<a.sel.ranges.length;e++)d[e]=bb(a,a.sel.ranges[e],b[e],null);var f=W(d,a.sel.primIndex);ib(a,f,c)}function eb(a,b,c,d){var e=a.sel.ranges.slice(0);e[b]=c,ib(a,W(e,a.sel.primIndex),d)}function fb(a,b,c,d){ib(a,X(b,c),d)}function gb(a,b){var c={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new V(Z(a,b[c].anchor),Z(a,b[c].head))}};return Xg(a,"beforeSelectionChange",a,c),a.cm&&Xg(a.cm,"beforeSelectionChange",a.cm,c),c.ranges!=b.ranges?W(c.ranges,c.ranges.length-1):b}function hb(a,b,c){var d=a.history.done,e=$e(d);e&&e.ranges?(d[d.length-1]=b,jb(a,b,c)):ib(a,b,c)}function ib(a,b,c){jb(a,b,c),Fe(a,a.sel,a.cm?a.cm.curOp.id:0/0,c)}function jb(a,b,c){(Ve(a,"beforeSelectionChange")||a.cm&&Ve(a.cm,"beforeSelectionChange"))&&(b=gb(a,b));var d=dg(b.primary().head,a.sel.primary().head)<0?-1:1;kb(a,mb(a,b,d,!0)),c&&c.scroll===!1||!a.cm||fd(a.cm)}function kb(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,Ue(a.cm)),Re(a,"cursorActivity",a))}function lb(a){kb(a,mb(a,a.sel,null,!1),_g)}function mb(a,b,c,d){for(var e,f=0;f<b.ranges.length;f++){var g=b.ranges[f],h=nb(a,g.anchor,c,d),i=nb(a,g.head,c,d);(e||h!=g.anchor||i!=g.head)&&(e||(e=b.ranges.slice(0,f)),e[f]=new V(h,i))}return e?W(e,b.primIndex):b}function nb(a,b,c,d){var e=!1,f=b,g=c||1;a.cantEdit=!1;a:for(;;){var h=re(a,f.line);if(h.markedSpans)for(var i=0;i<h.markedSpans.length;++i){var j=h.markedSpans[i],k=j.marker;if((null==j.from||(k.inclusiveLeft?j.from<=f.ch:j.from<f.ch))&&(null==j.to||(k.inclusiveRight?j.to>=f.ch:j.to>f.ch))){if(d&&(Xg(k,"beforeCursorEnter"),k.explicitlyCleared)){if(h.markedSpans){--i;continue}break}if(!k.atomic)continue;var l=k.find(0>g?-1:1);if(0==dg(l,f)&&(l.ch+=g,l.ch<0?l=l.line>a.first?Z(a,cg(l.line-1)):null:l.ch>h.text.length&&(l=l.line<a.first+a.size-1?cg(l.line+1,0):null),!l)){if(e)return d?(a.cantEdit=!0,cg(a.first,0)):nb(a,b,c,!0);e=!0,l=b,g=-g}f=l;continue a}}return f}}function ob(a){for(var b=a.display,c=a.doc,d=document.createDocumentFragment(),e=document.createDocumentFragment(),f=0;f<c.sel.ranges.length;f++){var g=c.sel.ranges[f],h=g.empty();(h||a.options.showCursorWhenSelecting)&&pb(a,g,d),h||qb(a,g,e)}if(a.options.moveInputWithCursor){var i=Pb(a,c.sel.primary().head,"div"),j=b.wrapper.getBoundingClientRect(),k=b.lineDiv.getBoundingClientRect(),l=Math.max(0,Math.min(b.wrapper.clientHeight-10,i.top+k.top-j.top)),m=Math.max(0,Math.min(b.wrapper.clientWidth-10,i.left+k.left-j.left));b.inputDiv.style.top=l+"px",b.inputDiv.style.left=m+"px"}jf(b.cursorDiv,d),jf(b.selectionDiv,e)}function pb(a,b,c){var d=Pb(a,b.head,"div"),e=c.appendChild(gf("div","","CodeMirror-cursor"));if(e.style.left=d.left+"px",e.style.top=d.top+"px",e.style.height=Math.max(0,d.bottom-d.top)*a.options.cursorHeight+"px",d.other){var f=c.appendChild(gf("div","","CodeMirror-cursor CodeMirror-secondarycursor"));f.style.display="",f.style.left=d.other.left+"px",f.style.top=d.other.top+"px",f.style.height=.85*(d.other.bottom-d.other.top)+"px"}}function qb(a,b,c){function d(a,b,c,d){0>b&&(b=0),b=Math.round(b),d=Math.round(d),h.appendChild(gf("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==c?k-a:c)+"px; height: "+(d-b)+"px"))}function e(b,c,e){function f(c,d){return Ob(a,cg(b,c),"div",l,d)}var h,i,l=re(g,b),m=l.text.length;return tf(ye(l),c||0,null==e?m:e,function(a,b,g){var l,n,o,p=f(a,"left");if(a==b)l=p,n=o=p.left;else{if(l=f(b-1,"right"),"rtl"==g){var q=p;p=l,l=q}n=p.left,o=l.right}null==c&&0==a&&(n=j),l.top-p.top>3&&(d(n,p.top,null,p.bottom),n=j,p.bottom<l.top&&d(n,p.bottom,null,l.top)),null==e&&b==m&&(o=k),(!h||p.top<h.top||p.top==h.top&&p.left<h.left)&&(h=p),(!i||l.bottom>i.bottom||l.bottom==i.bottom&&l.right>i.right)&&(i=l),j+1>n&&(n=j),d(n,l.top,o-n,l.bottom)}),{start:h,end:i}}var f=a.display,g=a.doc,h=document.createDocumentFragment(),i=yb(a.display),j=i.left,k=f.lineSpace.offsetWidth-i.right,l=b.from(),m=b.to();if(l.line==m.line)e(l.line,l.ch,m.ch);else{var n=re(g,l.line),o=re(g,m.line),p=Nd(n)==Nd(o),q=e(l.line,l.ch,p?n.text.length+1:null).end,r=e(m.line,p?0:null,m.ch).start;p&&(q.top<r.top-2?(d(q.right,q.top,null,q.bottom),d(j,r.top,r.left,r.bottom)):d(q.right,q.top,r.left-q.right,q.bottom)),q.bottom<r.top&&d(j,q.bottom,null,r.top)}c.appendChild(h)}function rb(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="",a.options.cursorBlinkRate>0&&(b.blinker=setInterval(function(){b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate))}}function sb(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,df(tb,a))}function tb(a){var b=a.doc;if(b.frontier<b.first&&(b.frontier=b.first),!(b.frontier>=a.display.viewTo)){var c=+new Date+a.options.workTime,d=yg(b.mode,vb(a,b.frontier));Yb(a,function(){b.iter(b.frontier,Math.min(b.first+b.size,a.display.viewTo+500),function(e){if(b.frontier>=a.display.viewFrom){var f=e.styles,g=ae(a,e,d,!0);e.styles=g.styles,g.classes?e.styleClasses=g.classes:e.styleClasses&&(e.styleClasses=null);for(var h=!f||f.length!=e.styles.length,i=0;!h&&i<f.length;++i)h=f[i]!=e.styles[i];h&&dc(a,b.frontier,"text"),e.stateAfter=yg(b.mode,d)}else ce(a,e.text,d),e.stateAfter=b.frontier%5==0?yg(b.mode,d):null;return++b.frontier,+new Date>c?(sb(a,a.options.workDelay),!0):void 0})})}}function ub(a,b,c){for(var d,e,f=a.doc,g=c?-1:b-(a.doc.mode.innerMode?1e3:100),h=b;h>g;--h){if(h<=f.first)return f.first;var i=re(f,h-1);if(i.stateAfter&&(!c||h<=f.frontier))return h;var j=ch(i.text,null,a.options.tabSize);(null==e||d>j)&&(e=h-1,d=j)}return e}function vb(a,b,c){var d=a.doc,e=a.display;if(!d.mode.startState)return!0;var f=ub(a,b,c),g=f>d.first&&re(d,f-1).stateAfter;return g=g?yg(d.mode,g):zg(d.mode),d.iter(f,b,function(c){ce(a,c.text,g);var h=f==b-1||f%5==0||f>=e.viewFrom&&f<e.viewTo;c.stateAfter=h?yg(d.mode,g):null,++f}),c&&(d.frontier=f),g}function wb(a){return a.lineSpace.offsetTop}function xb(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function yb(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=jf(a.measure,gf("pre","x")),c=window.getComputedStyle?window.getComputedStyle(b):b.currentStyle,d={left:parseInt(c.paddingLeft),right:parseInt(c.paddingRight)};return isNaN(d.left)||isNaN(d.right)||(a.cachedPaddingH=d),d}function zb(a,b,c){var d=a.options.lineWrapping,e=d&&a.display.scroller.clientWidth;if(!b.measure.heights||d&&b.measure.width!=e){var f=b.measure.heights=[];if(d){b.measure.width=e;for(var g=b.text.firstChild.getClientRects(),h=0;h<g.length-1;h++){var i=g[h],j=g[h+1];Math.abs(i.bottom-j.bottom)>2&&f.push((i.bottom+j.top)/2-c.top)}}f.push(c.bottom-c.top)}}function Ab(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=0;d<a.rest.length;d++)if(a.rest[d]==b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(var d=0;d<a.rest.length;d++)if(ve(a.rest[d])>c)return{map:a.measure.maps[d],cache:a.measure.caches[d],before:!0}}function Bb(a,b){b=Nd(b);var c=ve(b),d=a.display.externalMeasured=new ac(a.doc,b,c);d.lineN=c;var e=d.built=ee(a,d);return d.text=e.pre,jf(a.display.lineMeasure,e.pre),d}function Cb(a,b,c,d){return Fb(a,Eb(a,b),c,d)}function Db(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[fc(a,b)];var c=a.display.externalMeasured;return c&&b>=c.lineN&&b<c.lineN+c.size?c:void 0}function Eb(a,b){var c=ve(b),d=Db(a,c);d&&!d.text?d=null:d&&d.changes&&F(a,d,c,D(a)),d||(d=Bb(a,b));var e=Ab(d,b,c);return{line:b,view:d,rect:null,map:e.map,cache:e.cache,before:e.before,hasHeights:!1}}function Fb(a,b,c,d){b.before&&(c=-1);var e,f=c+(d||"");return b.cache.hasOwnProperty(f)?e=b.cache[f]:(b.rect||(b.rect=b.view.text.getBoundingClientRect()),b.hasHeights||(zb(a,b.view,b.rect),b.hasHeights=!0),e=Gb(a,b,c,d),e.bogus||(b.cache[f]=e)),{left:e.left,right:e.right,top:e.top,bottom:e.bottom}}function Gb(a,b,c,d){for(var e,f,g,h,i=b.map,j=0;j<i.length;j+=3){var k=i[j],l=i[j+1];if(k>c?(f=0,g=1,h="left"):l>c?(f=c-k,g=f+1):(j==i.length-3||c==l&&i[j+3]>c)&&(g=l-k,f=g-1,c>=l&&(h="right")),null!=f){if(e=i[j+2],k==l&&d==(e.insertLeft?"left":"right")&&(h=d),"left"==d&&0==f)for(;j&&i[j-2]==i[j-3]&&i[j-1].insertLeft;)e=i[(j-=3)+2],h="left";if("right"==d&&f==l-k)for(;j<i.length-3&&i[j+3]==i[j+4]&&!i[j+5].insertLeft;)e=i[(j+=3)+2],h="right";break}}var m;if(3==e.nodeType){for(;f&&ff(b.line.text.charAt(k+f));)--f;for(;l>k+g&&ff(b.line.text.charAt(k+g));)++g;if(If&&0==f&&g==l-k)m=e.parentNode.getBoundingClientRect();else if(Lf&&a.options.lineWrapping){var n=fh(e,f,g).getClientRects();m=n.length?n["right"==d?n.length-1:0]:fg}else m=fh(e,f,g).getBoundingClientRect()}else{f>0&&(h=d="right");var n;m=a.options.lineWrapping&&(n=e.getClientRects()).length>1?n["right"==d?n.length-1:0]:e.getBoundingClientRect()}if(If&&!f&&(!m||!m.left&&!m.right)){var o=e.parentNode.getClientRects()[0];m=o?{left:o.left,right:o.left+Vb(a.display),top:o.top,bottom:o.bottom}:fg}for(var p,q=(m.bottom+m.top)/2-b.rect.top,r=b.view.measure.heights,j=0;j<r.length-1&&!(q<r[j]);j++);p=j?r[j-1]:0,q=r[j];var s={left:("right"==h?m.right:m.left)-b.rect.left,right:("left"==h?m.left:m.right)-b.rect.left,top:p,bottom:q};return m.left||m.right||(s.bogus=!0),s}function Hb(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function Ib(a){a.display.externalMeasure=null,hf(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)Hb(a.display.view[b])}function Jb(a){Ib(a),a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null,a.options.lineWrapping||(a.display.maxLineChanged=!0),a.display.lineNumChars=null}function Kb(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Lb(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function Mb(a,b,c,d){if(b.widgets)for(var e=0;e<b.widgets.length;++e)if(b.widgets[e].above){var f=Ud(b.widgets[e]);c.top+=f,c.bottom+=f}if("line"==d)return c;d||(d="local");var g=xe(b);if("local"==d?g+=wb(a.display):g-=a.display.viewOffset,"page"==d||"window"==d){var h=a.display.lineSpace.getBoundingClientRect();g+=h.top+("window"==d?0:Lb());var i=h.left+("window"==d?0:Kb());c.left+=i,c.right+=i}return c.top+=g,c.bottom+=g,c}function Nb(a,b,c){if("div"==c)return b;var d=b.left,e=b.top;if("page"==c)d-=Kb(),e-=Lb();else if("local"==c||!c){var f=a.display.sizer.getBoundingClientRect();d+=f.left,e+=f.top}var g=a.display.lineSpace.getBoundingClientRect();return{left:d-g.left,top:e-g.top}}function Ob(a,b,c,d,e){return d||(d=re(a.doc,b.line)),Mb(a,d,Cb(a,d,b.ch,e),c)}function Pb(a,b,c,d,e){function f(b,f){var g=Fb(a,e,b,f?"right":"left");return f?g.left=g.right:g.right=g.left,Mb(a,d,g,c)}function g(a,b){var c=h[b],d=c.level%2;return a==uf(c)&&b&&c.level<h[b-1].level?(c=h[--b],a=vf(c)-(c.level%2?0:1),d=!0):a==vf(c)&&b<h.length-1&&c.level<h[b+1].level&&(c=h[++b],a=uf(c)-c.level%2,d=!1),d&&a==c.to&&a>c.from?f(a-1):f(a,d)}d=d||re(a.doc,b.line),e||(e=Eb(a,d));var h=ye(d),i=b.ch;if(!h)return f(i);var j=Bf(h,i),k=g(i,j);return null!=rh&&(k.other=g(i,rh)),k}function Qb(a,b){var c=0,b=Z(a.doc,b);a.options.lineWrapping||(c=Vb(a.display)*b.ch);var d=re(a.doc,b.line),e=xe(d)+wb(a.display);return{left:c,right:c,top:e,bottom:e+d.height}}function Rb(a,b,c,d){var e=cg(a,b);return e.xRel=d,c&&(e.outside=!0),e}function Sb(a,b,c){var d=a.doc;if(c+=a.display.viewOffset,0>c)return Rb(d.first,0,!0,-1);var e=we(d,c),f=d.first+d.size-1;if(e>f)return Rb(d.first+d.size-1,re(d,f).text.length,!0,1);0>b&&(b=0);for(var g=re(d,e);;){var h=Tb(a,g,e,b,c),i=Ld(g),j=i&&i.find(0,!0);if(!i||!(h.ch>j.from.ch||h.ch==j.from.ch&&h.xRel>0))return h;e=ve(g=j.to.line)}}function Tb(a,b,c,d,e){function f(d){var e=Pb(a,cg(c,d),"line",b,j);return h=!0,g>e.bottom?e.left-i:g<e.top?e.left+i:(h=!1,e.left)}var g=e-xe(b),h=!1,i=2*a.display.wrapper.clientWidth,j=Eb(a,b),k=ye(b),l=b.text.length,m=wf(b),n=xf(b),o=f(m),p=h,q=f(n),r=h;if(d>q)return Rb(c,n,r,1);for(;;){if(k?n==m||n==Df(b,m,1):1>=n-m){for(var s=o>d||q-d>=d-o?m:n,t=d-(s==m?o:q);ff(b.text.charAt(s));)++s;var u=Rb(c,s,s==m?p:r,-1>t?-1:t>1?1:0);return u}var v=Math.ceil(l/2),w=m+v;if(k){w=m;for(var x=0;v>x;++x)w=Df(b,w,1)}var y=f(w);y>d?(n=w,q=y,(r=h)&&(q+=1e3),l=v):(m=w,o=y,p=h,l-=v)}}function Ub(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==eg){eg=gf("pre");for(var b=0;49>b;++b)eg.appendChild(document.createTextNode("x")),eg.appendChild(gf("br"));eg.appendChild(document.createTextNode("x"))}jf(a.measure,eg);var c=eg.offsetHeight/50;return c>3&&(a.cachedTextHeight=c),hf(a.measure),c||1}function Vb(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=gf("span","xxxxxxxxxx"),c=gf("pre",[b]);jf(a.measure,c);var d=b.getBoundingClientRect(),e=(d.right-d.left)/10;return e>2&&(a.cachedCharWidth=e),e||10}function Wb(a){a.curOp={viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,id:++gg},Yg++||(Rg=[])}function Xb(a){var b=a.curOp,c=a.doc,d=a.display;if(a.curOp=null,b.updateMaxLine&&n(a),b.viewChanged||b.forceUpdate||null!=b.scrollTop||b.scrollToPos&&(b.scrollToPos.from.line<d.viewFrom||b.scrollToPos.to.line>=d.viewTo)||d.maxLineChanged&&a.options.lineWrapping){var e=w(a,{top:b.scrollTop,ensure:b.scrollToPos},b.forceUpdate);a.display.scroller.offsetHeight&&(a.doc.scrollTop=a.display.scroller.scrollTop)}if(!e&&b.selectionChanged&&ob(a),e||b.startHeight==a.doc.height||q(a),null!=b.scrollTop&&d.scroller.scrollTop!=b.scrollTop){var f=Math.max(0,Math.min(d.scroller.scrollHeight-d.scroller.clientHeight,b.scrollTop));d.scroller.scrollTop=d.scrollbarV.scrollTop=c.scrollTop=f}if(null!=b.scrollLeft&&d.scroller.scrollLeft!=b.scrollLeft){var g=Math.max(0,Math.min(d.scroller.scrollWidth-d.scroller.clientWidth,b.scrollLeft));d.scroller.scrollLeft=d.scrollbarH.scrollLeft=c.scrollLeft=g,s(a)}if(b.scrollToPos){var h=bd(a,Z(a.doc,b.scrollToPos.from),Z(a.doc,b.scrollToPos.to),b.scrollToPos.margin);b.scrollToPos.isCursor&&a.state.focused&&ad(a,h)}b.selectionChanged&&rb(a),a.state.focused&&b.updateInput&&mc(a,b.typing);var i=b.maybeHiddenMarkers,j=b.maybeUnhiddenMarkers;if(i)for(var k=0;k<i.length;++k)i[k].lines.length||Xg(i[k],"hide");if(j)for(var k=0;k<j.length;++k)j[k].lines.length&&Xg(j[k],"unhide");var l;if(--Yg||(l=Rg,Rg=null),b.changeObjs&&Xg(a,"changes",a,b.changeObjs),l)for(var k=0;k<l.length;++k)l[k]();if(b.cursorActivityHandlers)for(var k=0;k<b.cursorActivityHandlers.length;k++)b.cursorActivityHandlers[k](a)}function Yb(a,b){if(a.curOp)return b();Wb(a);try{return b()}finally{Xb(a)}}function Zb(a,b){return function(){if(a.curOp)return b.apply(a,arguments);Wb(a);try{return b.apply(a,arguments)}finally{Xb(a)}}}function $b(a){return function(){if(this.curOp)return a.apply(this,arguments);Wb(this);try{return a.apply(this,arguments)}finally{Xb(this)}}}function _b(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);Wb(b);try{return a.apply(this,arguments)}finally{Xb(b)}}}function ac(a,b,c){this.line=b,this.rest=Od(b),this.size=this.rest?ve($e(this.rest))-c+1:1,this.node=this.text=null,this.hidden=Rd(a,b)}function bc(a,b,c){for(var d,e=[],f=b;c>f;f=d){var g=new ac(a.doc,re(a.doc,f),f);d=f+g.size,e.push(g)}return e}function cc(a,b,c,d){null==b&&(b=a.doc.first),null==c&&(c=a.doc.first+a.doc.size),d||(d=0);var e=a.display;if(d&&c<e.viewTo&&(null==e.updateLineNumbers||e.updateLineNumbers>b)&&(e.updateLineNumbers=b),a.curOp.viewChanged=!0,b>=e.viewTo)bg&&Pd(a.doc,b)<e.viewTo&&ec(a);else if(c<=e.viewFrom)bg&&Qd(a.doc,c+d)>e.viewFrom?ec(a):(e.viewFrom+=d,e.viewTo+=d);else if(b<=e.viewFrom&&c>=e.viewTo)ec(a);else if(b<=e.viewFrom){var f=gc(a,c,c+d,1);f?(e.view=e.view.slice(f.index),e.viewFrom=f.lineN,e.viewTo+=d):ec(a)}else if(c>=e.viewTo){var f=gc(a,b,b,-1);f?(e.view=e.view.slice(0,f.index),e.viewTo=f.lineN):ec(a)}else{var g=gc(a,b,b,-1),h=gc(a,c,c+d,1);g&&h?(e.view=e.view.slice(0,g.index).concat(bc(a,g.lineN,h.lineN)).concat(e.view.slice(h.index)),e.viewTo+=d):ec(a)}var i=e.externalMeasured;i&&(c<i.lineN?i.lineN+=d:b<i.lineN+i.size&&(e.externalMeasured=null))}function dc(a,b,c){a.curOp.viewChanged=!0;var d=a.display,e=a.display.externalMeasured;if(e&&b>=e.lineN&&b<e.lineN+e.size&&(d.externalMeasured=null),!(b<d.viewFrom||b>=d.viewTo)){var f=d.view[fc(a,b)];if(null!=f.node){var g=f.changes||(f.changes=[]);-1==_e(g,c)&&g.push(c)}}}function ec(a){a.display.viewFrom=a.display.viewTo=a.doc.first,a.display.view=[],a.display.viewOffset=0}function fc(a,b){if(b>=a.display.viewTo)return null;if(b-=a.display.viewFrom,0>b)return null;for(var c=a.display.view,d=0;d<c.length;d++)if(b-=c[d].size,0>b)return d}function gc(a,b,c,d){var e,f=fc(a,b),g=a.display.view;if(!bg)return{index:f,lineN:c};for(var h=0,i=a.display.viewFrom;f>h;h++)i+=g[h].size;if(i!=b){if(d>0){if(f==g.length-1)return null;e=i+g[f].size-b,f++}else e=i-b;b+=e,c+=e}for(;Pd(a.doc,c)!=c;){if(f==(0>d?0:g.length-1))return null;c+=d*g[f-(0>d?1:0)].size,f+=d}return{index:f,lineN:c}}function hc(a,b,c){var d=a.display,e=d.view;0==e.length||b>=d.viewTo||c<=d.viewFrom?(d.view=bc(a,b,c),d.viewFrom=b):(d.viewFrom>b?d.view=bc(a,b,d.viewFrom).concat(d.view):d.viewFrom<b&&(d.view=d.view.slice(fc(a,b))),d.viewFrom=b,d.viewTo<c?d.view=d.view.concat(bc(a,d.viewTo,c)):d.viewTo>c&&(d.view=d.view.slice(0,fc(a,c)))),d.viewTo=c}function ic(a){for(var b=a.display.view,c=0,d=0;d<b.length;d++){var e=b[d];e.hidden||e.node&&!e.changes||++c}return c}function jc(a){a.display.pollingFast||a.display.poll.set(a.options.pollInterval,function(){lc(a),a.state.focused&&jc(a)})}function kc(a){function b(){var d=lc(a);d||c?(a.display.pollingFast=!1,jc(a)):(c=!0,a.display.poll.set(60,b))}var c=!1;a.display.pollingFast=!0,a.display.poll.set(20,b)}function lc(a){var b=a.display.input,c=a.display.prevInput,d=a.doc;if(!a.state.focused||oh(b)&&!c||pc(a)||a.options.disableInput)return!1;a.state.pasteIncoming&&a.state.fakedLastChar&&(b.value=b.value.substring(0,b.value.length-1),a.state.fakedLastChar=!1);var e=b.value;if(e==c&&!a.somethingSelected())return!1;if(Lf&&!If&&a.display.inputHasSelection===e)return mc(a),!1;var f=!a.curOp;f&&Wb(a),a.display.shift=!1;for(var g=0,h=Math.min(c.length,e.length);h>g&&c.charCodeAt(g)==e.charCodeAt(g);)++g;for(var i=e.slice(g),j=nh(i),k=a.state.pasteIncoming&&j.length>1&&d.sel.ranges.length==j.length,l=d.sel.ranges.length-1;l>=0;l--){var m=d.sel.ranges[l],n=m.from(),o=m.to();g<c.length?n=cg(n.line,n.ch-(c.length-g)):a.state.overwrite&&m.empty()&&!a.state.pasteIncoming&&(o=cg(o.line,Math.min(re(d,o.line).text.length,o.ch+$e(j).length)));var p=a.curOp.updateInput,q={from:n,to:o,text:k?[j[l]]:j,origin:a.state.pasteIncoming?"paste":a.state.cutIncoming?"cut":"+input"};if(Vc(a.doc,q),Re(a,"inputRead",a,q),i&&!a.state.pasteIncoming&&a.options.electricChars&&a.options.smartIndent&&m.head.ch<100&&(!l||d.sel.ranges[l-1].head.line!=m.head.line)){var r=a.getModeAt(m.head);if(r.electricChars){for(var s=0;s<r.electricChars.length;s++)if(i.indexOf(r.electricChars.charAt(s))>-1){hd(a,m.head.line,"smart");break}}else if(r.electricInput){var t=pg(q);r.electricInput.test(re(d,t.line).text.slice(0,t.ch))&&hd(a,m.head.line,"smart")}}}return fd(a),a.curOp.updateInput=p,a.curOp.typing=!0,e.length>1e3||e.indexOf("\n")>-1?b.value=a.display.prevInput="":a.display.prevInput=e,f&&Xb(a),a.state.pasteIncoming=a.state.cutIncoming=!1,!0}function mc(a,b){var c,d,e=a.doc;if(a.somethingSelected()){a.display.prevInput="";var f=e.sel.primary();c=ph&&(f.to().line-f.from().line>100||(d=a.getSelection()).length>1e3);var g=c?"-":d||a.getSelection();a.display.input.value=g,a.state.focused&&eh(a.display.input),Lf&&!If&&(a.display.inputHasSelection=g)}else b||(a.display.prevInput=a.display.input.value="",Lf&&!If&&(a.display.inputHasSelection=null));a.display.inaccurateSelection=c}function nc(a){"nocursor"==a.options.readOnly||Wf&&lf()==a.display.input||a.display.input.focus()}function oc(a){a.state.focused||(nc(a),Mc(a))}function pc(a){return a.options.readOnly||a.doc.cantEdit}function qc(a){function b(){a.state.focused&&setTimeout(df(nc,a),0)}function c(){null==h&&(h=setTimeout(function(){h=null,g.cachedCharWidth=g.cachedTextHeight=g.cachedPaddingH=jh=null,a.setSize()},100))}function d(){kf(document.body,g.wrapper)?setTimeout(d,5e3):Wg(window,"resize",c)}function e(b){Te(a,b)||Ug(b)}function f(b){if(a.somethingSelected())g.inaccurateSelection&&(g.prevInput="",g.inaccurateSelection=!1,g.input.value=a.getSelection(),eh(g.input));else{for(var c="",d=[],e=0;e<a.doc.sel.ranges.length;e++){var f=a.doc.sel.ranges[e].head.line,h={anchor:cg(f,0),head:cg(f+1,0)};d.push(h),c+=a.getRange(h.anchor,h.head)}"cut"==b.type?a.setSelections(d,null,_g):(g.prevInput="",g.input.value=c,eh(g.input))}"cut"==b.type&&(a.state.cutIncoming=!0)}var g=a.display;Vg(g.scroller,"mousedown",Zb(a,tc)),Gf?Vg(g.scroller,"dblclick",Zb(a,function(b){if(!Te(a,b)){var c=sc(a,b);if(c&&!yc(a,b)&&!rc(a.display,b)){Sg(b);var d=md(a.doc,c);cb(a.doc,d.anchor,d.head)}}})):Vg(g.scroller,"dblclick",function(b){Te(a,b)||Sg(b)}),Vg(g.lineSpace,"selectstart",function(a){rc(g,a)||Sg(a)}),_f||Vg(g.scroller,"contextmenu",function(b){Oc(a,b)}),Vg(g.scroller,"scroll",function(){g.scroller.clientHeight&&(Bc(a,g.scroller.scrollTop),Cc(a,g.scroller.scrollLeft,!0),Xg(a,"scroll",a))}),Vg(g.scrollbarV,"scroll",function(){g.scroller.clientHeight&&Bc(a,g.scrollbarV.scrollTop)}),Vg(g.scrollbarH,"scroll",function(){g.scroller.clientHeight&&Cc(a,g.scrollbarH.scrollLeft)}),Vg(g.scroller,"mousewheel",function(b){Dc(a,b)}),Vg(g.scroller,"DOMMouseScroll",function(b){Dc(a,b)}),Vg(g.scrollbarH,"mousedown",b),Vg(g.scrollbarV,"mousedown",b),Vg(g.wrapper,"scroll",function(){g.wrapper.scrollTop=g.wrapper.scrollLeft=0});var h;Vg(window,"resize",c),setTimeout(d,5e3),Vg(g.input,"keyup",Zb(a,Kc)),Vg(g.input,"input",function(){Lf&&!If&&a.display.inputHasSelection&&(a.display.inputHasSelection=null),kc(a)}),Vg(g.input,"keydown",Zb(a,Ic)),Vg(g.input,"keypress",Zb(a,Lc)),Vg(g.input,"focus",df(Mc,a)),Vg(g.input,"blur",df(Nc,a)),a.options.dragDrop&&(Vg(g.scroller,"dragstart",function(b){Ac(a,b)}),Vg(g.scroller,"dragenter",e),Vg(g.scroller,"dragover",e),Vg(g.scroller,"drop",Zb(a,zc))),Vg(g.scroller,"paste",function(b){rc(g,b)||(a.state.pasteIncoming=!0,nc(a),kc(a))}),Vg(g.input,"paste",function(){if(Mf&&!a.state.fakedLastChar&&!(new Date-a.state.lastMiddleDown<200)){var b=g.input.selectionStart,c=g.input.selectionEnd;g.input.value+="$",g.input.selectionStart=b,g.input.selectionEnd=c,a.state.fakedLastChar=!0}a.state.pasteIncoming=!0,kc(a)}),Vg(g.input,"cut",f),Vg(g.input,"copy",f),Rf&&Vg(g.sizer,"mouseup",function(){lf()==g.input&&g.input.blur(),nc(a)})}function rc(a,b){for(var c=Pe(b);c!=a.wrapper;c=c.parentNode)if(!c||c.ignoreEvents||c.parentNode==a.sizer&&c!=a.mover)return!0}function sc(a,b,c,d){var e=a.display;if(!c){var f=Pe(b);if(f==e.scrollbarH||f==e.scrollbarV||f==e.scrollbarFiller||f==e.gutterFiller)return null}var g,h,i=e.lineSpace.getBoundingClientRect();try{g=b.clientX-i.left,h=b.clientY-i.top}catch(b){return null}var j,k=Sb(a,g,h);if(d&&1==k.xRel&&(j=re(a.doc,k.line).text).length==k.ch){var l=ch(j,j.length,a.options.tabSize)-j.length;k=cg(k.line,Math.round((g-yb(a.display).left)/Vb(a.display))-l)}return k}function tc(a){if(!Te(this,a)){var b=this,c=b.display;if(c.shift=a.shiftKey,rc(c,a))return void(Mf||(c.scroller.draggable=!1,setTimeout(function(){c.scroller.draggable=!0},100)));if(!yc(b,a)){var d=sc(b,a);switch(window.focus(),Qe(a)){case 1:d?uc(b,a,d):Pe(a)==c.scroller&&Sg(a);break;case 2:Mf&&(b.state.lastMiddleDown=+new Date),d&&cb(b.doc,d),setTimeout(df(nc,b),20),Sg(a);break;case 3:_f&&Oc(b,a)}}}}function uc(a,b,c){setTimeout(df(oc,a),0);var d,e=+new Date;ig&&ig.time>e-400&&0==dg(ig.pos,c)?d="triple":hg&&hg.time>e-400&&0==dg(hg.pos,c)?(d="double",ig={time:e,pos:c}):(d="single",hg={time:e,pos:c});var f=a.doc.sel,g=Xf?b.metaKey:b.ctrlKey;a.options.dragDrop&&mh&&!g&&!pc(a)&&"single"==d&&f.contains(c)>-1&&f.somethingSelected()?vc(a,b,c):wc(a,b,c,d,g)}function vc(a,b,c){var d=a.display,e=Zb(a,function(f){Mf&&(d.scroller.draggable=!1),a.state.draggingText=!1,Wg(document,"mouseup",e),Wg(d.scroller,"drop",e),Math.abs(b.clientX-f.clientX)+Math.abs(b.clientY-f.clientY)<10&&(Sg(f),cb(a.doc,c),nc(a),Gf&&!If&&setTimeout(function(){document.body.focus(),nc(a)},20))});Mf&&(d.scroller.draggable=!0),a.state.draggingText=e,d.scroller.dragDrop&&d.scroller.dragDrop(),Vg(document,"mouseup",e),Vg(d.scroller,"drop",e)}function wc(a,b,c,d,e){function f(b){if(0!=dg(p,b))if(p=b,"rect"==d){for(var e=[],f=a.options.tabSize,g=ch(re(j,c.line).text,c.ch,f),h=ch(re(j,b.line).text,b.ch,f),i=Math.min(g,h),n=Math.max(g,h),o=Math.min(c.line,b.line),q=Math.min(a.lastLine(),Math.max(c.line,b.line));q>=o;o++){var r=re(j,o).text,s=Ye(r,i,f);
i==n?e.push(new V(cg(o,s),cg(o,s))):r.length>s&&e.push(new V(cg(o,s),cg(o,Ye(r,n,f))))}e.length||e.push(new V(c,c)),ib(j,W(m.ranges.slice(0,l).concat(e),l),ah)}else{var t=k,u=t.anchor,v=b;if("single"!=d){if("double"==d)var w=md(j,b);else var w=new V(cg(b.line,0),Z(j,cg(b.line+1,0)));dg(w.anchor,u)>0?(v=w.head,u=T(t.from(),w.anchor)):(v=w.anchor,u=S(t.to(),w.head))}var e=m.ranges.slice(0);e[l]=new V(Z(j,u),v),ib(j,W(e,l),ah)}}function g(b){var c=++s,e=sc(a,b,!0,"rect"==d);if(e)if(0!=dg(e,p)){oc(a),f(e);var h=r(i,j);(e.line>=h.to||e.line<h.from)&&setTimeout(Zb(a,function(){s==c&&g(b)}),150)}else{var k=b.clientY<q.top?-20:b.clientY>q.bottom?20:0;k&&setTimeout(Zb(a,function(){s==c&&(i.scroller.scrollTop+=k,g(b))}),50)}}function h(b){s=1/0,Sg(b),nc(a),Wg(document,"mousemove",t),Wg(document,"mouseup",u),j.history.lastSelOrigin=null}var i=a.display,j=a.doc;Sg(b);var k,l,m=j.sel;if(e?(l=j.sel.contains(c),k=l>-1?j.sel.ranges[l]:new V(c,c)):k=j.sel.primary(),b.altKey)d="rect",e||(k=new V(c,c)),c=sc(a,b,!0,!0),l=-1;else if("double"==d){var n=md(j,c);k=a.display.shift||j.extend?bb(j,k,n.anchor,n.head):n}else if("triple"==d){var o=new V(cg(c.line,0),Z(j,cg(c.line+1,0)));k=a.display.shift||j.extend?bb(j,k,o.anchor,o.head):o}else k=bb(j,k,c);e?l>-1?eb(j,l,k,ah):(l=j.sel.ranges.length,ib(j,W(j.sel.ranges.concat([k]),l),{scroll:!1,origin:"*mouse"})):(l=0,ib(j,new U([k],0),ah));var p=c,q=i.wrapper.getBoundingClientRect(),s=0,t=Zb(a,function(a){(Lf&&!Jf?a.buttons:Qe(a))?g(a):h(a)}),u=Zb(a,h);Vg(document,"mousemove",t),Vg(document,"mouseup",u)}function xc(a,b,c,d,e){try{var f=b.clientX,g=b.clientY}catch(b){return!1}if(f>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;d&&Sg(b);var h=a.display,i=h.lineDiv.getBoundingClientRect();if(g>i.bottom||!Ve(a,c))return Oe(b);g-=i.top-h.viewOffset;for(var j=0;j<a.options.gutters.length;++j){var k=h.gutters.childNodes[j];if(k&&k.getBoundingClientRect().right>=f){var l=we(a.doc,g),m=a.options.gutters[j];return e(a,c,a,l,m,b),Oe(b)}}}function yc(a,b){return xc(a,b,"gutterClick",!0,Re)}function zc(a){var b=this;if(!Te(b,a)&&!rc(b.display,a)){Sg(a),Gf&&(jg=+new Date);var c=sc(b,a,!0),d=a.dataTransfer.files;if(c&&!pc(b))if(d&&d.length&&window.FileReader&&window.File)for(var e=d.length,f=Array(e),g=0,h=function(a,d){var h=new FileReader;h.onload=Zb(b,function(){if(f[d]=h.result,++g==e){c=Z(b.doc,c);var a={from:c,to:c,text:nh(f.join("\n")),origin:"paste"};Vc(b.doc,a),hb(b.doc,X(c,pg(a)))}}),h.readAsText(a)},i=0;e>i;++i)h(d[i],i);else{if(b.state.draggingText&&b.doc.sel.contains(c)>-1)return b.state.draggingText(a),void setTimeout(df(nc,b),20);try{var f=a.dataTransfer.getData("Text");if(f){var j=b.state.draggingText&&b.listSelections();if(jb(b.doc,X(c,c)),j)for(var i=0;i<j.length;++i)_c(b.doc,"",j[i].anchor,j[i].head,"drag");b.replaceSelection(f,"around","paste"),nc(b)}}catch(a){}}}}function Ac(a,b){if(Gf&&(!a.state.draggingText||+new Date-jg<100))return void Ug(b);if(!Te(a,b)&&!rc(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.setDragImage&&!Qf)){var c=gf("img",null,null,"position: fixed; left: 0; top: 0;");c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",Pf&&(c.width=c.height=1,a.display.wrapper.appendChild(c),c._top=c.offsetTop),b.dataTransfer.setDragImage(c,0,0),Pf&&c.parentNode.removeChild(c)}}function Bc(a,b){Math.abs(a.doc.scrollTop-b)<2||(a.doc.scrollTop=b,Ff||w(a,{top:b}),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbarV.scrollTop!=b&&(a.display.scrollbarV.scrollTop=b),Ff&&w(a),sb(a,100))}function Cc(a,b,c){(c?b==a.doc.scrollLeft:Math.abs(a.doc.scrollLeft-b)<2)||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,s(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbarH.scrollLeft!=b&&(a.display.scrollbarH.scrollLeft=b))}function Dc(a,b){var c=b.wheelDeltaX,d=b.wheelDeltaY;null==c&&b.detail&&b.axis==b.HORIZONTAL_AXIS&&(c=b.detail),null==d&&b.detail&&b.axis==b.VERTICAL_AXIS?d=b.detail:null==d&&(d=b.wheelDelta);var e=a.display,f=e.scroller;if(c&&f.scrollWidth>f.clientWidth||d&&f.scrollHeight>f.clientHeight){if(d&&Xf&&Mf)a:for(var g=b.target,h=e.view;g!=f;g=g.parentNode)for(var i=0;i<h.length;i++)if(h[i].node==g){a.display.currentWheelTarget=g;break a}if(c&&!Ff&&!Pf&&null!=lg)return d&&Bc(a,Math.max(0,Math.min(f.scrollTop+d*lg,f.scrollHeight-f.clientHeight))),Cc(a,Math.max(0,Math.min(f.scrollLeft+c*lg,f.scrollWidth-f.clientWidth))),Sg(b),void(e.wheelStartX=null);if(d&&null!=lg){var j=d*lg,k=a.doc.scrollTop,l=k+e.wrapper.clientHeight;0>j?k=Math.max(0,k+j-50):l=Math.min(a.doc.height,l+j+50),w(a,{top:k,bottom:l})}20>kg&&(null==e.wheelStartX?(e.wheelStartX=f.scrollLeft,e.wheelStartY=f.scrollTop,e.wheelDX=c,e.wheelDY=d,setTimeout(function(){if(null!=e.wheelStartX){var a=f.scrollLeft-e.wheelStartX,b=f.scrollTop-e.wheelStartY,c=b&&e.wheelDY&&b/e.wheelDY||a&&e.wheelDX&&a/e.wheelDX;e.wheelStartX=e.wheelStartY=null,c&&(lg=(lg*kg+c)/(kg+1),++kg)}},200)):(e.wheelDX+=c,e.wheelDY+=d))}}function Ec(a,b,c){if("string"==typeof b&&(b=Ag[b],!b))return!1;a.display.pollingFast&&lc(a)&&(a.display.pollingFast=!1);var d=a.display.shift,e=!1;try{pc(a)&&(a.state.suppressEdits=!0),c&&(a.display.shift=!1),e=b(a)!=$g}finally{a.display.shift=d,a.state.suppressEdits=!1}return e}function Fc(a){var b=a.state.keyMaps.slice(0);return a.options.extraKeys&&b.push(a.options.extraKeys),b.push(a.options.keyMap),b}function Gc(a,b){var c=od(a.options.keyMap),d=c.auto;clearTimeout(mg),d&&!Dg(b)&&(mg=setTimeout(function(){od(a.options.keyMap)==c&&(a.options.keyMap=d.call?d.call(null,a):d,h(a))},50));var e=Eg(b,!0),f=!1;if(!e)return!1;var g=Fc(a),i=g.reduce(function(a,b){if(Bg[b]){var c=Bg[b][e];return a||"undo"==c||"redo"==c}return a},!1);return i?!0:(f=b.shiftKey?Cg("Shift-"+e,g,function(b){return Ec(a,b,!0)})||Cg(e,g,function(b){return("string"==typeof b?/^go[A-Z]/.test(b):b.motion)?Ec(a,b):void 0}):Cg(e,g,function(b){return Ec(a,b)}),f&&"throwEvent"!=f&&(Sg(b),rb(a),Re(a,"keyHandled",a,e,b)),f)}function Hc(a,b,c){var d=Cg("'"+c+"'",Fc(a),function(b){return Ec(a,b,!0)});return d&&(Sg(b),rb(a),Re(a,"keyHandled",a,"'"+c+"'",b)),d}function Ic(a){var b=this;if(oc(b),!Te(b,a)){Gf&&27==a.keyCode&&(a.returnValue=!1);var c=a.keyCode;b.display.shift=16==c||a.shiftKey;var d=Gc(b,a);Pf&&(og=d?c:null,!d&&88==c&&!ph&&(Xf?a.metaKey:a.ctrlKey)&&b.replaceSelection("",null,"cut")),18!=c||/\bCodeMirror-crosshair\b/.test(b.display.lineDiv.className)||Jc(b)}}function Jc(a){function b(a){18!=a.keyCode&&a.altKey||(nf(c,"CodeMirror-crosshair"),Wg(document,"keyup",b),Wg(document,"mouseover",b))}var c=a.display.lineDiv;of(c,"CodeMirror-crosshair"),Vg(document,"keyup",b),Vg(document,"mouseover",b)}function Kc(a){Te(this,a)||16==a.keyCode&&(this.doc.sel.shift=!1)}function Lc(a){var b=this;if(!Te(b,a)){var c=a.keyCode,d=a.charCode;if(Pf&&c==og)return og=null,void Sg(a);if(!(Pf&&(!a.which||a.which<10)||Rf)||!Gc(b,a)){var e=String.fromCharCode(null==d?c:d);Hc(b,a,e)||(Lf&&!If&&(b.display.inputHasSelection=null),kc(b))}}}function Mc(a){"nocursor"!=a.options.readOnly&&(a.state.focused||(Xg(a,"focus",a),a.state.focused=!0,of(a.display.wrapper,"CodeMirror-focused"),a.curOp||""==a.display.prevInput||(mc(a),Mf&&setTimeout(df(mc,a,!0),0))),jc(a),rb(a))}function Nc(a){a.state.focused&&(Xg(a,"blur",a),a.state.focused=!1,nf(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.display.shift=!1)},150)}function Oc(a,b){function c(){if(null!=e.input.selectionStart){var b=e.input.value=""+(a.somethingSelected()?e.input.value:"");e.prevInput="",e.input.selectionStart=1,e.input.selectionEnd=b.length}}function d(){if(e.inputDiv.style.position="relative",e.input.style.cssText=i,If&&(e.scrollbarV.scrollTop=e.scroller.scrollTop=g),jc(a),null!=e.input.selectionStart){(!Lf||If)&&c(),clearTimeout(ng);var b=0,d=function(){""==e.prevInput&&0==e.input.selectionStart?Zb(a,Ag.selectAll)(a):b++<10?ng=setTimeout(d,500):mc(a)};ng=setTimeout(d,200)}}if(!Te(a,b,"contextmenu")){var e=a.display;if(!rc(e,b)&&!Pc(a,b)){var f=sc(a,b),g=e.scroller.scrollTop;if(f&&!Pf){var h=a.options.resetSelectionOnContextMenu;h&&-1==a.doc.sel.contains(f)&&Zb(a,ib)(a.doc,X(f),_g);var i=e.input.style.cssText;if(e.inputDiv.style.position="absolute",e.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(b.clientY-5)+"px; left: "+(b.clientX-5)+"px; z-index: 1000; background: "+(Lf?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",nc(a),mc(a),a.somethingSelected()||(e.input.value=e.prevInput=" "),Lf&&!If&&c(),_f){Ug(b);var j=function(){Wg(window,"mouseup",j),setTimeout(d,20)};Vg(window,"mouseup",j)}else setTimeout(d,50)}}}}function Pc(a,b){return Ve(a,"gutterContextMenu")?xc(a,b,"gutterContextMenu",!1,Xg):!1}function Qc(a,b){if(dg(a,b.from)<0)return a;if(dg(a,b.to)<=0)return pg(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;return a.line==b.to.line&&(d+=pg(b).ch-b.to.ch),cg(c,d)}function Rc(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var e=a.sel.ranges[d];c.push(new V(Qc(e.anchor,b),Qc(e.head,b)))}return W(c,a.sel.primIndex)}function Sc(a,b,c){return a.line==b.line?cg(c.line,a.ch-b.ch+c.ch):cg(c.line+(a.line-b.line),a.ch)}function Tc(a,b,c){for(var d=[],e=cg(a.first,0),f=e,g=0;g<b.length;g++){var h=b[g],i=Sc(h.from,e,f),j=Sc(pg(h),e,f);if(e=h.to,f=j,"around"==c){var k=a.sel.ranges[g],l=dg(k.head,k.anchor)<0;d[g]=new V(l?j:i,l?i:j)}else d[g]=new V(i,i)}return new U(d,a.sel.primIndex)}function Uc(a,b,c){var d={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){this.canceled=!0}};return c&&(d.update=function(b,c,d,e){b&&(this.from=Z(a,b)),c&&(this.to=Z(a,c)),d&&(this.text=d),void 0!==e&&(this.origin=e)}),Xg(a,"beforeChange",a,d),a.cm&&Xg(a.cm,"beforeChange",a.cm,d),d.canceled?null:{from:d.from,to:d.to,text:d.text,origin:d.origin}}function Vc(a,b,c){if(a.cm){if(!a.cm.curOp)return Zb(a.cm,Vc)(a,b,c);if(a.cm.state.suppressEdits)return}if(!(Ve(a,"beforeChange")||a.cm&&Ve(a.cm,"beforeChange"))||(b=Uc(a,b,!0))){var d=ag&&!c&&Dd(a,b.from,b.to);if(d)for(var e=d.length-1;e>=0;--e)Wc(a,{from:d[e].from,to:d[e].to,text:e?[""]:b.text});else Wc(a,b)}}function Wc(a,b){if(1!=b.text.length||""!=b.text[0]||0!=dg(b.from,b.to)){var c=Rc(a,b);De(a,b,c,a.cm?a.cm.curOp.id:0/0),Zc(a,b,c,Ad(a,b));var d=[];pe(a,function(a,c){c||-1!=_e(d,a.history)||(Ne(a.history,b),d.push(a.history)),Zc(a,b,null,Ad(a,b))})}}function Xc(a,b,c){if(!a.cm||!a.cm.state.suppressEdits){for(var d,e=a.history,f=a.sel,g="undo"==b?e.done:e.undone,h="undo"==b?e.undone:e.done,i=0;i<g.length&&(d=g[i],c?!d.ranges||d.equals(a.sel):d.ranges);i++);if(i!=g.length){for(e.lastOrigin=e.lastSelOrigin=null;d=g.pop(),d.ranges;){if(Ge(d,h),c&&!d.equals(a.sel))return void ib(a,d,{clearRedo:!1});f=d}var j=[];Ge(f,h),h.push({changes:j,generation:e.generation}),e.generation=d.generation||++e.maxGeneration;for(var k=Ve(a,"beforeChange")||a.cm&&Ve(a.cm,"beforeChange"),i=d.changes.length-1;i>=0;--i){var l=d.changes[i];if(l.origin=b,k&&!Uc(a,l,!1))return void(g.length=0);j.push(Ae(a,l));var m=i?Rc(a,l,null):$e(g);Zc(a,l,m,Cd(a,l)),a.cm&&fd(a.cm);var n=[];pe(a,function(a,b){b||-1!=_e(n,a.history)||(Ne(a.history,l),n.push(a.history)),Zc(a,l,null,Cd(a,l))})}}}}function Yc(a,b){a.first+=b,a.sel=new U(af(a.sel.ranges,function(a){return new V(cg(a.anchor.line+b,a.anchor.ch),cg(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm&&cc(a.cm,a.first,a.first-b,b)}function Zc(a,b,c,d){if(a.cm&&!a.cm.curOp)return Zb(a.cm,Zc)(a,b,c,d);if(b.to.line<a.first)return void Yc(a,b.text.length-1-(b.to.line-b.from.line));if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var e=b.text.length-1-(a.first-b.from.line);Yc(a,e),b={from:cg(a.first,0),to:cg(b.to.line+e,b.to.ch),text:[$e(b.text)],origin:b.origin}}var f=a.lastLine();b.to.line>f&&(b={from:b.from,to:cg(f,re(a,f).text.length),text:[b.text[0]],origin:b.origin}),b.removed=se(a,b.from,b.to),c||(c=Rc(a,b,null)),a.cm?$c(a.cm,b,d):me(a,b,d),jb(a,c,_g)}}function $c(a,b,c){var d=a.doc,e=a.display,g=b.from,h=b.to,i=!1,j=g.line;a.options.lineWrapping||(j=ve(Nd(re(d,g.line))),d.iter(j,h.line+1,function(a){return a==e.maxLine?(i=!0,!0):void 0})),d.sel.contains(b.from,b.to)>-1&&Ue(a),me(d,b,c,f(a)),a.options.lineWrapping||(d.iter(j,g.line+b.text.length,function(a){var b=m(a);b>e.maxLineLength&&(e.maxLine=a,e.maxLineLength=b,e.maxLineChanged=!0,i=!1)}),i&&(a.curOp.updateMaxLine=!0)),d.frontier=Math.min(d.frontier,g.line-1),sb(a,400);var k=b.text.length-(h.line-g.line)-1;g.line!=h.line||1!=b.text.length||le(a.doc,b)?cc(a,g.line,h.line+1,k):dc(a,g.line,"text");var l=Ve(a,"changes"),n=Ve(a,"change");if(n||l){var o={from:g,to:h,text:b.text,removed:b.removed,origin:b.origin};n&&Re(a,"change",a,o),l&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(o)}}function _c(a,b,c,d,e){if(d||(d=c),dg(d,c)<0){var f=d;d=c,c=f}"string"==typeof b&&(b=nh(b)),Vc(a,{from:c,to:d,text:b,origin:e})}function ad(a,b){var c=a.display,d=c.sizer.getBoundingClientRect(),e=null;if(b.top+d.top<0?e=!0:b.bottom+d.top>(window.innerHeight||document.documentElement.clientHeight)&&(e=!1),null!=e&&!Uf){var f=gf("div","",null,"position: absolute; top: "+(b.top-c.viewOffset-wb(a.display))+"px; height: "+(b.bottom-b.top+Zg)+"px; left: "+b.left+"px; width: 2px;");a.display.lineSpace.appendChild(f),f.scrollIntoView(e),a.display.lineSpace.removeChild(f)}}function bd(a,b,c,d){for(null==d&&(d=0);;){var e=!1,f=Pb(a,b),g=c&&c!=b?Pb(a,c):f,h=dd(a,Math.min(f.left,g.left),Math.min(f.top,g.top)-d,Math.max(f.left,g.left),Math.max(f.bottom,g.bottom)+d),i=a.doc.scrollTop,j=a.doc.scrollLeft;if(null!=h.scrollTop&&(Bc(a,h.scrollTop),Math.abs(a.doc.scrollTop-i)>1&&(e=!0)),null!=h.scrollLeft&&(Cc(a,h.scrollLeft),Math.abs(a.doc.scrollLeft-j)>1&&(e=!0)),!e)return f}}function cd(a,b,c,d,e){var f=dd(a,b,c,d,e);null!=f.scrollTop&&Bc(a,f.scrollTop),null!=f.scrollLeft&&Cc(a,f.scrollLeft)}function dd(a,b,c,d,e){var f=a.display,g=Ub(a.display);0>c&&(c=0);var h=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:f.scroller.scrollTop,i=f.scroller.clientHeight-Zg,j={},k=a.doc.height+xb(f),l=g>c,m=e>k-g;if(h>c)j.scrollTop=l?0:c;else if(e>h+i){var n=Math.min(c,(m?k:e)-i);n!=h&&(j.scrollTop=n)}var o=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:f.scroller.scrollLeft,p=f.scroller.clientWidth-Zg;b+=f.gutters.offsetWidth,d+=f.gutters.offsetWidth;var q=f.gutters.offsetWidth,r=q+10>b;return o+q>b||r?(r&&(b=0),j.scrollLeft=Math.max(0,b-10-q)):d>p+o-3&&(j.scrollLeft=d+10-p),j}function ed(a,b,c){(null!=b||null!=c)&&gd(a),null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:a.curOp.scrollLeft)+b),null!=c&&(a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function fd(a){gd(a);var b=a.getCursor(),c=b,d=b;a.options.lineWrapping||(c=b.ch?cg(b.line,b.ch-1):b,d=cg(b.line,b.ch+1)),a.curOp.scrollToPos={from:c,to:d,margin:a.options.cursorScrollMargin,isCursor:!0}}function gd(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=Qb(a,b.from),d=Qb(a,b.to),e=dd(a,Math.min(c.left,d.left),Math.min(c.top,d.top)-b.margin,Math.max(c.right,d.right),Math.max(c.bottom,d.bottom)+b.margin);a.scrollTo(e.scrollLeft,e.scrollTop)}}function hd(a,b,c,d){var e,f=a.doc;null==c&&(c="add"),"smart"==c&&(a.doc.mode.indent?e=vb(a,b):c="prev");var g=a.options.tabSize,h=re(f,b),i=ch(h.text,null,g);h.stateAfter&&(h.stateAfter=null);var j,k=h.text.match(/^\s*/)[0];if(d||/\S/.test(h.text)){if("smart"==c&&(j=a.doc.mode.indent(e,h.text.slice(k.length),h.text),j==$g)){if(!d)return;c="prev"}}else j=0,c="not";var l="",m=0;if("prev"==c?b>f.first?(l=re(f,b-1).text,j=ch(l,null,g),l=k?"":l.match(/^\s*/)[0]):j=0:"add"==c?j=i+a.options.indentUnit:"subtract"==c?j=i-a.options.indentUnit:"number"==typeof c&&(j=i+c),j=Math.max(0,j),l&&!k);else{if(l="",a.options.indentWithTabs)for(var n=Math.floor(j/g);n;--n)m+=g,l+="	";j>m&&(l+=Ze(j-m))}if(l!=k)_c(a.doc,l,cg(b,0),cg(b,k.length),"+input");else for(var n=0;n<f.sel.ranges.length;n++){var o=f.sel.ranges[n];if(o.head.line==b&&o.head.ch<k.length){var m=cg(b,k.length);eb(f,n,new V(m,m));break}}h.stateAfter=null}function id(a,b,c,d){var e=b,f=b,g=a.doc;return"number"==typeof b?f=re(g,Y(g,b)):e=ve(b),null==e?null:(d(f,e)&&dc(a,e,c),f)}function jd(a,b){for(var c=a.doc.sel.ranges,d=[],e=0;e<c.length;e++){for(var f=b(c[e]);d.length&&dg(f.from,$e(d).to)<=0;){var g=d.pop();if(dg(g.from,f.from)<0){f.from=g.from;break}}d.push(f)}Yb(a,function(){for(var b=d.length-1;b>=0;b--)_c(a.doc,"",d[b].from,d[b].to,"+delete");fd(a)})}function kd(a,b,c,d,e){function f(){var b=h+c;return b<a.first||b>=a.first+a.size?l=!1:(h=b,k=re(a,b))}function g(a){var b=(e?Df:Ef)(k,i,c,!0);if(null==b){if(a||!f())return l=!1;i=e?(0>c?xf:wf)(k):0>c?k.text.length:0}else i=b;return!0}var h=b.line,i=b.ch,j=c,k=re(a,h),l=!0;if("char"==d)g();else if("column"==d)g(!0);else if("word"==d||"group"==d)for(var m=null,n="group"==d,o=!0;!(0>c)||g(!o);o=!1){var p=k.text.charAt(i)||"\n",q=hh(p)?"w":n&&"\n"==p?"n":!n||/\s/.test(p)?null:"p";if(!n||o||q||(q="s"),m&&m!=q){0>c&&(c=1,g());break}if(q&&(m=q),c>0&&!g(!o))break}var r=nb(a,cg(h,i),j,!0);return l||(r.hitSide=!0),r}function ld(a,b,c,d){var e,f=a.doc,g=b.left;if("page"==d){var h=Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);e=b.top+c*(h-(0>c?1.5:.5)*Ub(a.display))}else"line"==d&&(e=c>0?b.bottom+3:b.top-3);for(;;){var i=Sb(a,g,e);if(!i.outside)break;if(0>c?0>=e:e>=f.height){i.hitSide=!0;break}e+=5*c}return i}function md(a,b){var c=re(a,b.line).text,d=b.ch,e=b.ch;if(c){(b.xRel<0||e==c.length)&&d?--d:++e;for(var f=c.charAt(d),g=hh(f)?hh:/\s/.test(f)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!hh(a)};d>0&&g(c.charAt(d-1));)--d;for(;e<c.length&&g(c.charAt(e));)++e}return new V(cg(b.line,d),cg(b.line,e))}function nd(b,c,d,e){a.defaults[b]=c,d&&(rg[b]=e?function(a,b,c){c!=sg&&d(a,b,c)}:d)}function od(a){return"string"==typeof a?Bg[a]:a}function pd(a,b,c,d,e){if(d&&d.shared)return qd(a,b,c,d,e);if(a.cm&&!a.cm.curOp)return Zb(a.cm,pd)(a,b,c,d,e);var f=new Gg(a,e),g=dg(b,c);if(d&&cf(d,f,!1),g>0||0==g&&f.clearWhenEmpty!==!1)return f;if(f.replacedWith&&(f.collapsed=!0,f.widgetNode=gf("span",[f.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||(f.widgetNode.ignoreEvents=!0),d.insertLeft&&(f.widgetNode.insertLeft=!0)),f.collapsed){if(Md(a,b.line,b,c,f)||b.line!=c.line&&Md(a,c.line,b,c,f))throw new Error("Inserting collapsed marker partially overlapping an existing one");bg=!0}f.addToHistory&&De(a,{from:b,to:c,origin:"markText"},a.sel,0/0);var h,i=b.line,j=a.cm;if(a.iter(i,c.line+1,function(a){j&&f.collapsed&&!j.options.lineWrapping&&Nd(a)==j.display.maxLine&&(h=!0),f.collapsed&&i!=b.line&&ue(a,0),xd(a,new ud(f,i==b.line?b.ch:null,i==c.line?c.ch:null)),++i}),f.collapsed&&a.iter(b.line,c.line+1,function(b){Rd(a,b)&&ue(b,0)}),f.clearOnEnter&&Vg(f,"beforeCursorEnter",function(){f.clear()}),f.readOnly&&(ag=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory()),f.collapsed&&(f.id=++Hg,f.atomic=!0),j){if(h&&(j.curOp.updateMaxLine=!0),f.collapsed)cc(j,b.line,c.line+1);else if(f.className||f.title||f.startStyle||f.endStyle)for(var k=b.line;k<=c.line;k++)dc(j,k,"text");f.atomic&&lb(j.doc),Re(j,"markerAdded",j,f)}return f}function qd(a,b,c,d,e){d=cf(d),d.shared=!1;var f=[pd(a,b,c,d,e)],g=f[0],h=d.widgetNode;return pe(a,function(a){h&&(d.widgetNode=h.cloneNode(!0)),f.push(pd(a,Z(a,b),Z(a,c),d,e));for(var i=0;i<a.linked.length;++i)if(a.linked[i].isParent)return;g=$e(f)}),new Ig(f,g)}function rd(a){return a.findMarks(cg(a.first,0),a.clipPos(cg(a.lastLine())),function(a){return a.parent})}function sd(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.find(),f=a.clipPos(e.from),g=a.clipPos(e.to);if(dg(f,g)){var h=pd(a,f,g,d.primary,d.primary.type);d.markers.push(h),h.parent=d}}}function td(a){for(var b=0;b<a.length;b++){var c=a[b],d=[c.primary.doc];pe(c.primary.doc,function(a){d.push(a)});for(var e=0;e<c.markers.length;e++){var f=c.markers[e];-1==_e(d,f.doc)&&(f.parent=null,c.markers.splice(e--,1))}}}function ud(a,b,c){this.marker=a,this.from=b,this.to=c}function vd(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function wd(a,b){for(var c,d=0;d<a.length;++d)a[d]!=b&&(c||(c=[])).push(a[d]);return c}function xd(a,b){a.markedSpans=a.markedSpans?a.markedSpans.concat([b]):[b],b.marker.attachLine(a)}function yd(a,b,c){if(a)for(var d,e=0;e<a.length;++e){var f=a[e],g=f.marker,h=null==f.from||(g.inclusiveLeft?f.from<=b:f.from<b);if(h||f.from==b&&"bookmark"==g.type&&(!c||!f.marker.insertLeft)){var i=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);(d||(d=[])).push(new ud(g,f.from,i?null:f.to))}}return d}function zd(a,b,c){if(a)for(var d,e=0;e<a.length;++e){var f=a[e],g=f.marker,h=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);if(h||f.from==b&&"bookmark"==g.type&&(!c||f.marker.insertLeft)){var i=null==f.from||(g.inclusiveLeft?f.from<=b:f.from<b);(d||(d=[])).push(new ud(g,i?null:f.from-b,null==f.to?null:f.to-b))}}return d}function Ad(a,b){var c=_(a,b.from.line)&&re(a,b.from.line).markedSpans,d=_(a,b.to.line)&&re(a,b.to.line).markedSpans;if(!c&&!d)return null;var e=b.from.ch,f=b.to.ch,g=0==dg(b.from,b.to),h=yd(c,e,g),i=zd(d,f,g),j=1==b.text.length,k=$e(b.text).length+(j?e:0);if(h)for(var l=0;l<h.length;++l){var m=h[l];if(null==m.to){var n=vd(i,m.marker);n?j&&(m.to=null==n.to?null:n.to+k):m.to=e}}if(i)for(var l=0;l<i.length;++l){var m=i[l];if(null!=m.to&&(m.to+=k),null==m.from){var n=vd(h,m.marker);n||(m.from=k,j&&(h||(h=[])).push(m))}else m.from+=k,j&&(h||(h=[])).push(m)}h&&(h=Bd(h)),i&&i!=h&&(i=Bd(i));var o=[h];if(!j){var p,q=b.text.length-2;if(q>0&&h)for(var l=0;l<h.length;++l)null==h[l].to&&(p||(p=[])).push(new ud(h[l].marker,null,null));for(var l=0;q>l;++l)o.push(p);o.push(i)}return o}function Bd(a){for(var b=0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&c.marker.clearWhenEmpty!==!1&&a.splice(b--,1)}return a.length?a:null}function Cd(a,b){var c=Je(a,b),d=Ad(a,b);if(!c)return d;if(!d)return c;for(var e=0;e<c.length;++e){var f=c[e],g=d[e];if(f&&g)a:for(var h=0;h<g.length;++h){for(var i=g[h],j=0;j<f.length;++j)if(f[j].marker==i.marker)continue a;f.push(i)}else g&&(c[e]=g)}return c}function Dd(a,b,c){var d=null;if(a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&-1!=_e(d,c)||(d||(d=[])).push(c)}}),!d)return null;for(var e=[{from:b,to:c}],f=0;f<d.length;++f)for(var g=d[f],h=g.find(0),i=0;i<e.length;++i){var j=e[i];if(!(dg(j.to,h.from)<0||dg(j.from,h.to)>0)){var k=[i,1],l=dg(j.from,h.from),m=dg(j.to,h.to);(0>l||!g.inclusiveLeft&&!l)&&k.push({from:j.from,to:h.from}),(m>0||!g.inclusiveRight&&!m)&&k.push({from:h.to,to:j.to}),e.splice.apply(e,k),i+=k.length-1}}return e}function Ed(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function Fd(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function Gd(a){return a.inclusiveLeft?-1:0}function Hd(a){return a.inclusiveRight?1:0}function Id(a,b){var c=a.lines.length-b.lines.length;if(0!=c)return c;var d=a.find(),e=b.find(),f=dg(d.from,e.from)||Gd(a)-Gd(b);if(f)return-f;var g=dg(d.to,e.to)||Hd(a)-Hd(b);return g?g:b.id-a.id}function Jd(a,b){var c,d=bg&&a.markedSpans;if(d)for(var e,f=0;f<d.length;++f)e=d[f],e.marker.collapsed&&null==(b?e.from:e.to)&&(!c||Id(c,e.marker)<0)&&(c=e.marker);return c}function Kd(a){return Jd(a,!0)}function Ld(a){return Jd(a,!1)}function Md(a,b,c,d,e){var f=re(a,b),g=bg&&f.markedSpans;if(g)for(var h=0;h<g.length;++h){var i=g[h];if(i.marker.collapsed){var j=i.marker.find(0),k=dg(j.from,c)||Gd(i.marker)-Gd(e),l=dg(j.to,d)||Hd(i.marker)-Hd(e);if(!(k>=0&&0>=l||0>=k&&l>=0)&&(0>=k&&(dg(j.to,c)||Hd(i.marker)-Gd(e))>0||k>=0&&(dg(j.from,d)||Gd(i.marker)-Hd(e))<0))return!0}}}function Nd(a){for(var b;b=Kd(a);)a=b.find(-1,!0).line;return a}function Od(a){for(var b,c;b=Ld(a);)a=b.find(1,!0).line,(c||(c=[])).push(a);return c}function Pd(a,b){var c=re(a,b),d=Nd(c);return c==d?b:ve(d)}function Qd(a,b){if(b>a.lastLine())return b;var c,d=re(a,b);if(!Rd(a,d))return b;for(;c=Ld(d);)d=c.find(1,!0).line;return ve(d)+1}function Rd(a,b){var c=bg&&b.markedSpans;if(c)for(var d,e=0;e<c.length;++e)if(d=c[e],d.marker.collapsed){if(null==d.from)return!0;if(!d.marker.widgetNode&&0==d.from&&d.marker.inclusiveLeft&&Sd(a,b,d))return!0}}function Sd(a,b,c){if(null==c.to){var d=c.marker.find(1,!0);return Sd(a,d.line,vd(d.line.markedSpans,c.marker))}if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var e,f=0;f<b.markedSpans.length;++f)if(e=b.markedSpans[f],e.marker.collapsed&&!e.marker.widgetNode&&e.from==c.to&&(null==e.to||e.to!=c.from)&&(e.marker.inclusiveLeft||c.marker.inclusiveRight)&&Sd(a,b,e))return!0}function Td(a,b,c){xe(b)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&ed(a,null,c)}function Ud(a){return null!=a.height?a.height:(kf(document.body,a.node)||jf(a.cm.display.measure,gf("div",[a.node],null,"position: relative")),a.height=a.node.offsetHeight)}function Vd(a,b,c,d){var e=new Jg(a,c,d);return e.noHScroll&&(a.display.alignWidgets=!0),id(a,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);if(null==e.insertAt?c.push(e):c.splice(Math.min(c.length-1,Math.max(0,e.insertAt)),0,e),e.line=b,!Rd(a.doc,b)){var d=xe(b)<a.doc.scrollTop;ue(b,b.height+Ud(e)),d&&ed(a,null,e.height),a.curOp.forceUpdate=!0}return!0}),e}function Wd(a,b,c,d){a.text=b,a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null),null!=a.order&&(a.order=null),Ed(a),Fd(a,c);var e=d?d(a):1;e!=a.height&&ue(a,e)}function Xd(a){a.parent=null,Ed(a)}function Yd(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:new RegExp("(?:^|s)"+c[2]+"(?:$|s)").test(b[d])||(b[d]+=" "+c[2])}return a}function Zd(b,c){if(b.blankLine)return b.blankLine(c);if(b.innerMode){var d=a.innerMode(b,c);return d.mode.blankLine?d.mode.blankLine(d.state):void 0}}function $d(a,b,c){for(var d=0;10>d;d++){var e=a.token(b,c);if(b.pos>b.start)return e}if("gfm"==a.name)return b.pos=b.start+1,null;throw new Error("Mode "+a.name+" failed to advance stream.")}function _d(b,c,d,e,f,g,h){var i=d.flattenSpans;null==i&&(i=b.options.flattenSpans);var j,k=0,l=null,m=new Fg(c,b.options.tabSize);for(""==c&&Yd(Zd(d,e),g);!m.eol();){if(m.pos>b.options.maxHighlightLength?(i=!1,h&&ce(b,c,e,m.pos),m.pos=c.length,j=null):j=Yd($d(d,m,e),g),b.options.addModeClass){var n=a.innerMode(d,e).mode.name;n&&(j="m-"+(j?n+" "+j:n))}i&&l==j||(k<m.start&&f(m.start,l),k=m.start,l=j),m.start=m.pos}for(;k<m.pos;){var o=Math.min(m.pos,k+5e4);f(o,l),k=o}}function ae(a,b,c,d){var e=[a.state.modeGen],f={},g=ve(b);"object"==typeof c&&(c.lineBefore=a.getLine(g-1),c.lineAfter=a.getLine(g+1)),_d(a,b.text,a.doc.mode,c,function(a,b){e.push(a,b)},f,d);for(var h=0;h<a.state.overlays.length;++h){var i=a.state.overlays[h],j=1,k=0;_d(a,b.text,i.mode,"visiblespace"===i.mode.name?c.base:!0,function(a,b){for(var c=j;a>k;){var d=e[j];d>a&&e.splice(j,1,a,e[j+1],d),j+=2,k=Math.min(a,d)}if(b)if(i.opaque)e.splice(c,j-c,a,"cm-overlay "+b),j=c+2;else for(;j>c;c+=2){var f=e[c+1];e[c+1]=(f?f+" ":"")+"cm-overlay "+b}},f)}return{styles:e,classes:f.bgClass||f.textClass?f:null}}function be(a,b){if(!b.styles||b.styles[0]!=a.state.modeGen){var c=ae(a,b,b.stateAfter=vb(a,ve(b)));b.styles=c.styles,c.classes?b.styleClasses=c.classes:b.styleClasses&&(b.styleClasses=null)}return b.styles}function ce(a,b,c,d){var e=a.doc.mode,f=new Fg(b,a.options.tabSize);for(f.start=f.pos=d||0,""==b&&Zd(e,c);!f.eol()&&f.pos<=a.options.maxHighlightLength;)$d(e,f,c),f.start=f.pos}function de(a,b){if(!a||/^\s*$/.test(a))return null;var c=b.addModeClass?Mg:Lg;return c[a]||(c[a]=a.replace(/\S+/g,"cm-$&"))}function ee(a,b){var c=gf("span",null,null,Mf?"padding-right: .1px":null),d={pre:gf("pre",[c]),content:c,col:0,pos:0,cm:a};b.measure={};for(var e=0;e<=(b.rest?b.rest.length:0);e++){var f,g=e?b.rest[e-1]:b.line;d.pos=0,d.addToken=ge,(Lf||Mf)&&a.getOption("lineWrapping")&&(d.addToken=he(d.addToken)),sf(a.display.measure)&&(f=ye(g))&&(d.addToken=ie(d.addToken,f)),d.map=[],ke(g,d,be(a,g)),g.styleClasses&&(g.styleClasses.bgClass&&(d.bgClass=pf(g.styleClasses.bgClass,d.bgClass||"")),g.styleClasses.textClass&&(d.textClass=pf(g.styleClasses.textClass,d.textClass||""))),0==d.map.length&&d.map.push(0,0,d.content.appendChild(rf(a.display.measure))),0==e?(b.measure.map=d.map,b.measure.cache={}):((b.measure.maps||(b.measure.maps=[])).push(d.map),(b.measure.caches||(b.measure.caches=[])).push({}))}return Xg(a,"renderLine",a,b.line,d.pre),d}function fe(a){var b=gf("span","","cm-invalidchar");return b.title="\\u"+a.charCodeAt(0).toString(16),b}function ge(a,b,c,d,e,f){if(b){var g=a.cm.options.specialChars,h=!1;if(g.test(b))for(var i=document.createDocumentFragment(),j=0;;){g.lastIndex=j;var k=g.exec(b),l=k?k.index-j:b.length-j;if(l){var m=document.createTextNode(b.slice(j,j+l));i.appendChild(If?gf("span",[m]):m),a.map.push(a.pos,a.pos+l,m),a.col+=l,a.pos+=l}if(!k)break;if(j+=l+1,"	"==k[0]){var n=a.cm.options.tabSize,o=n-a.col%n,m=i.appendChild(gf("span",Ze(o),"cm-tab"));a.col+=o}else{var m=a.cm.options.specialCharPlaceholder(k[0]);i.appendChild(If?gf("span",[m]):m),a.col+=1}a.map.push(a.pos,a.pos+1,m),a.pos++}else{a.col+=b.length;var i=document.createTextNode(b);a.map.push(a.pos,a.pos+b.length,i),If&&(h=!0),a.pos+=b.length}if(c||d||e||h){var p=c||"";d&&(p+=d),e&&(p+=e);var q=gf("span",[i],p);return f&&(q.title=f),a.content.appendChild(q)}a.content.appendChild(i)}}function he(a){function b(a){for(var b=" ",c=0;c<a.length-2;++c)b+=c%2?" ":"";return b+=" "}return function(c,d,e,f,g,h){a(c,d.replace(/ {3,}/g,b),e,f,g,h)}}function ie(a,b){return function(c,d,e,f,g,h){e=e?e+" cm-force-border":"cm-force-border";for(var i=c.pos,j=i+d.length;;){for(var k=0;k<b.length;k++){var l=b[k];if(l.to>i&&l.from<=i)break}if(l.to>=j)return a(c,d,e,f,g,h);a(c,d.slice(0,l.to-i),e,f,null,h),f=null,d=d.slice(l.to-i),i=l.to}}}function je(a,b,c,d){var e=!d&&c.widgetNode;e&&(a.map.push(a.pos,a.pos+b,e),a.content.appendChild(e)),a.pos+=b}function ke(a,b,c){var d=a.markedSpans,e=a.text,f=0;if(d)for(var g,h,i,j,k,l,m=e.length,n=0,o=1,p="",q=0;;){if(q==n){h=i=j=k="",l=null,q=1/0;for(var r=[],s=0;s<d.length;++s){var t=d[s],u=t.marker;t.from<=n&&(null==t.to||t.to>n)?(null!=t.to&&q>t.to&&(q=t.to,i=""),u.className&&(h+=" "+u.className),u.startStyle&&t.from==n&&(j+=" "+u.startStyle),u.endStyle&&t.to==q&&(i+=" "+u.endStyle),u.title&&!k&&(k=u.title),u.collapsed&&(!l||Id(l.marker,u)<0)&&(l=t)):t.from>n&&q>t.from&&(q=t.from),"bookmark"==u.type&&t.from==n&&u.widgetNode&&r.push(u)}if(l&&(l.from||0)==n&&(je(b,(null==l.to?m+1:l.to)-n,l.marker,null==l.from),null==l.to))return;if(!l&&r.length)for(var s=0;s<r.length;++s)je(b,0,r[s])}if(n>=m)break;for(var v=Math.min(m,q);;){if(p){var w=n+p.length;if(!l){var x=w>v?p.slice(0,v-n):p;b.addToken(b,x,g?g+h:h,j,n+x.length==q?i:"",k)}if(w>=v){p=p.slice(v-n),n=v;break}n=w,j=""}p=e.slice(f,f=c[o++]),g=de(c[o++],b.cm.options)}}else for(var o=1;o<c.length;o+=2)b.addToken(b,e.slice(f,f=c[o]),de(c[o+1],b.cm.options))}function le(a,b){return 0==b.from.ch&&0==b.to.ch&&""==$e(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function me(a,b,c,d){function e(a){return c?c[a]:null}function f(a,c,e){Wd(a,c,e,d),Re(a,"change",a,b)}var g=b.from,h=b.to,i=b.text,j=re(a,g.line),k=re(a,h.line),l=$e(i),m=e(i.length-1),n=h.line-g.line;if(le(a,b)){for(var o=0,p=[];o<i.length-1;++o)p.push(new Kg(i[o],e(o),d));f(k,k.text,m),n&&a.remove(g.line,n),p.length&&a.insert(g.line,p)}else if(j==k)if(1==i.length)f(j,j.text.slice(0,g.ch)+l+j.text.slice(h.ch),m);else{for(var p=[],o=1;o<i.length-1;++o)p.push(new Kg(i[o],e(o),d));p.push(new Kg(l+j.text.slice(h.ch),m,d)),f(j,j.text.slice(0,g.ch)+i[0],e(0)),a.insert(g.line+1,p)}else if(1==i.length)f(j,j.text.slice(0,g.ch)+i[0]+k.text.slice(h.ch),e(0)),a.remove(g.line+1,n);
else{f(j,j.text.slice(0,g.ch)+i[0],e(0)),f(k,l+k.text.slice(h.ch),m);for(var o=1,p=[];o<i.length-1;++o)p.push(new Kg(i[o],e(o),d));n>1&&a.remove(g.line+1,n-1),a.insert(g.line+1,p)}Re(a,"change",a,b)}function ne(a){this.lines=a,this.parent=null;for(var b=0,c=0;b<a.length;++b)a[b].parent=this,c+=a[b].height;this.height=c}function oe(a){this.children=a;for(var b=0,c=0,d=0;d<a.length;++d){var e=a[d];b+=e.chunkSize(),c+=e.height,e.parent=this}this.size=b,this.height=c,this.parent=null}function pe(a,b,c){function d(a,e,f){if(a.linked)for(var g=0;g<a.linked.length;++g){var h=a.linked[g];if(h.doc!=e){var i=f&&h.sharedHist;(!c||i)&&(b(h.doc,i),d(h.doc,a,i))}}}d(a,null,!0)}function qe(a,b){if(b.cm)throw new Error("This document is already in use.");a.doc=b,b.cm=a,g(a),c(a),a.options.lineWrapping||n(a),a.options.mode=b.modeOption,cc(a)}function re(a,b){if(b-=a.first,0>b||b>=a.size)throw new Error("There is no line "+(b+a.first)+" in the document.");for(var c=a;!c.lines;)for(var d=0;;++d){var e=c.children[d],f=e.chunkSize();if(f>b){c=e;break}b-=f}return c.lines[b]}function se(a,b,c){var d=[],e=b.line;return a.iter(b.line,c.line+1,function(a){var f=a.text;e==c.line&&(f=f.slice(0,c.ch)),e==b.line&&(f=f.slice(b.ch)),d.push(f),++e}),d}function te(a,b,c){var d=[];return a.iter(b,c,function(a){d.push(a.text)}),d}function ue(a,b){var c=b-a.height;if(c)for(var d=a;d;d=d.parent)d.height+=c}function ve(a){if(null==a.parent)return null;for(var b=a.parent,c=_e(b.lines,a),d=b.parent;d;b=d,d=d.parent)for(var e=0;d.children[e]!=b;++e)c+=d.children[e].chunkSize();return c+b.first}function we(a,b){var c=a.first;a:do{for(var d=0;d<a.children.length;++d){var e=a.children[d],f=e.height;if(f>b){a=e;continue a}b-=f,c+=e.chunkSize()}return c}while(!a.lines);for(var d=0;d<a.lines.length;++d){var g=a.lines[d],h=g.height;if(h>b)break;b-=h}return c+d}function xe(a){a=Nd(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var e=c.lines[d];if(e==a)break;b+=e.height}for(var f=c.parent;f;c=f,f=c.parent)for(var d=0;d<f.children.length;++d){var g=f.children[d];if(g==c)break;b+=g.height}return b}function ye(a){var b=a.order;return null==b&&(b=a.order=sh(a.text)),b}function ze(a){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=a||1}function Ae(a,b){var c={from:R(b.from),to:pg(b),text:se(a,b.from,b.to)};return He(a,c,b.from.line,b.to.line+1),pe(a,function(a){He(a,c,b.from.line,b.to.line+1)},!0),c}function Be(a){for(;a.length;){var b=$e(a);if(!b.ranges)break;a.pop()}}function Ce(a,b){return b?(Be(a.done),$e(a.done)):a.done.length&&!$e(a.done).ranges?$e(a.done):a.done.length>1&&!a.done[a.done.length-2].ranges?(a.done.pop(),$e(a.done)):void 0}function De(a,b,c,d){var e=a.history;e.undone.length=0;var f,g=+new Date,h=(b.text||[]).length>1;if(!h&&(e.lastOp==d||e.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&e.lastModTime>g-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0)))&&(f=Ce(e,e.lastOp==d))){var i=$e(f.changes);0==dg(b.from,b.to)&&0==dg(b.from,i.to)?i.to=pg(b):f.changes.push(Ae(a,b))}else{"setValue"!=b.origin&&a.cm.cid&&a.cm.editor.fences.addToUndoManager(a.cm);var j=$e(e.done);for(j&&j.ranges||Ge(a.sel,e.done),f={changes:[Ae(a,b)],generation:e.generation},e.done.push(f);e.done.length>e.undoDepth;)e.done.shift(),e.done[0].ranges||e.done.shift()}e.done.push(c),e.generation=++e.maxGeneration,e.lastModTime=e.lastSelTime=g,e.lastOp=d,e.lastOrigin=e.lastSelOrigin=b.origin,i||Xg(a,"historyAdded")}function Ee(a,b,c,d){var e=b.charAt(0);return"*"==e||"+"==e&&c.ranges.length==d.ranges.length&&c.somethingSelected()==d.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}function Fe(a,b,c,d){var e=a.history,f=d&&d.origin;c==e.lastOp||f&&e.lastSelOrigin==f&&(e.lastModTime==e.lastSelTime&&e.lastOrigin==f||Ee(a,f,$e(e.done),b))?e.done[e.done.length-1]=b:Ge(b,e.done),e.lastSelTime=+new Date,e.lastSelOrigin=f,e.lastOp=c,d&&d.clearRedo!==!1&&Be(e.undone)}function Ge(a,b){var c=$e(b);c&&c.ranges&&c.equals(a)||b.push(a)}function He(a,b,c,d){var e=b["spans_"+a.id],f=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((e||(e=b["spans_"+a.id]={}))[f]=c.markedSpans),++f})}function Ie(a){if(!a)return null;for(var b,c=0;c<a.length;++c)a[c].marker.explicitlyCleared?b||(b=a.slice(0,c)):b&&b.push(a[c]);return b?b.length?b:null:a}function Je(a,b){var c=b["spans_"+a.id];if(!c)return null;for(var d=0,e=[];d<b.text.length;++d)e.push(Ie(c[d]));return e}function Ke(a,b,c){for(var d=0,e=[];d<a.length;++d){var f=a[d];if(f.ranges)e.push(c?U.prototype.deepCopy.call(f):f);else{var g=f.changes,h=[];e.push({changes:h});for(var i=0;i<g.length;++i){var j,k=g[i];if(h.push({from:k.from,to:k.to,text:k.text}),b)for(var l in k)(j=l.match(/^spans_(\d+)$/))&&_e(b,Number(j[1]))>-1&&($e(h)[l]=k[l],delete k[l])}}}return e}function Le(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function Me(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e],g=!0;if(f.ranges){f.copied||(f=a[e]=f.deepCopy(),f.copied=!0);for(var h=0;h<f.ranges.length;h++)Le(f.ranges[h].anchor,b,c,d),Le(f.ranges[h].head,b,c,d)}else{for(var h=0;h<f.changes.length;++h){var i=f.changes[h];if(c<i.from.line)i.from=cg(i.from.line+d,i.from.ch),i.to=cg(i.to.line+d,i.to.ch);else if(b<=i.to.line){g=!1;break}}g||(a.splice(0,e+1),e=0)}}}function Ne(a,b){var c=b.from.line,d=b.to.line,e=b.text.length-(d-c)-1;Me(a.done,c,d,e),Me(a.undone,c,d,e)}function Oe(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function Pe(a){return a.target||a.srcElement}function Qe(a){var b=a.which;return null==b&&(1&a.button?b=1:2&a.button?b=3:4&a.button&&(b=2)),Xf&&a.ctrlKey&&1==b&&(b=3),b}function Re(a,b){function c(a){return function(){a.apply(null,e)}}var d=a._handlers&&a._handlers[b];if(d){var e=Array.prototype.slice.call(arguments,2);Rg||(++Yg,Rg=[],setTimeout(Se,0));for(var f=0;f<d.length;++f)Rg.push(c(d[f]))}}function Se(){--Yg;var a=Rg;Rg=null;for(var b=0;b<a.length;++b)a[b]()}function Te(a,b,c){return Xg(a,c||b.type,a,b),Oe(b)||b.codemirrorIgnore}function Ue(a){var b=a._handlers&&a._handlers.cursorActivity;if(b)for(var c=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]),d=0;d<b.length;++d)-1==_e(c,b[d])&&c.push(b[d])}function Ve(a,b){var c=a._handlers&&a._handlers[b];return c&&c.length>0}function We(a){a.prototype.on=function(a,b){Vg(this,a,b)},a.prototype.off=function(a,b){Wg(this,a,b)}}function Xe(){this.id=null}function Ye(a,b,c){for(var d=0,e=0;;){var f=a.indexOf("	",d);-1==f&&(f=a.length);var g=f-d;if(f==a.length||e+g>=b)return d+Math.min(g,b-e);if(e+=f-d,e+=c-e%c,d=f+1,e>=b)return d}}function Ze(a){for(;dh.length<=a;)dh.push($e(dh)+" ");return dh[a]}function $e(a){return a[a.length-1]}function _e(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return c;return-1}function af(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=b(a[d],d);return c}function bf(a,b){var c;if(Object.create)c=Object.create(a);else{var d=function(){};d.prototype=a,c=new d}return b&&cf(b,c),c}function cf(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||c===!1&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function df(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function ef(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function ff(a){return a.charCodeAt(0)>=768&&ih.test(a)}function gf(a,b,c,d){var e=document.createElement(a);if(c&&(e.className=c),d&&(e.style.cssText=d),"string"==typeof b)e.appendChild(document.createTextNode(b));else if(b)for(var f=0;f<b.length;++f)e.appendChild(b[f]);return e}function hf(a){for(var b=a.childNodes.length;b>0;--b)a.removeChild(a.firstChild);return a}function jf(a,b){return hf(a).appendChild(b)}function kf(a,b){if(a.contains)return a.contains(b);for(;b=b.parentNode;)if(b==a)return!0}function lf(){return document.activeElement}function mf(a){return new RegExp("\\b"+a+"\\b\\s*")}function nf(a,b){var c=mf(b);c.test(a.className)&&(a.className=a.className.replace(c,""))}function of(a,b){mf(b).test(a.className)||(a.className+=" "+b)}function pf(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)c[d]&&!mf(c[d]).test(b)&&(b+=" "+c[d]);return b}function qf(a){if(null!=jh)return jh;var b=gf("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return jf(a,b),b.offsetWidth&&(jh=b.offsetHeight-b.clientHeight),jh||0}function rf(a){if(null==kh){var b=gf("span","");jf(a,gf("span",[b,document.createTextNode("x")])),0!=a.firstChild.offsetHeight&&(kh=b.offsetWidth<=1&&b.offsetHeight>2&&!Hf)}return kh?gf("span",""):gf("span","",null,"display: inline-block; width: 1px; margin-right: -1px")}function sf(a){if(null!=lh)return lh;var b=jf(a,document.createTextNode("AA")),c=fh(b,0,1).getBoundingClientRect();if(c.left==c.right)return!1;var d=fh(b,1,2).getBoundingClientRect();return lh=d.right-c.right<3}function tf(a,b,c,d){if(!a)return d(b,c,"ltr");for(var e=!1,f=0;f<a.length;++f){var g=a[f];(g.from<c&&g.to>b||b==c&&g.to==b)&&(d(Math.max(g.from,b),Math.min(g.to,c),1==g.level?"rtl":"ltr"),e=!0)}e||d(b,c,"ltr")}function uf(a){return a.level%2?a.to:a.from}function vf(a){return a.level%2?a.from:a.to}function wf(a){var b=ye(a);return b?uf(b[0]):0}function xf(a){var b=ye(a);return b?vf($e(b)):a.text.length}function yf(a,b){var c=re(a.doc,b),d=Nd(c);d!=c&&(b=ve(d));var e=ye(d),f=e?e[0].level%2?xf(d):wf(d):0;return cg(b,f)}function zf(a,b){for(var c,d=re(a.doc,b);c=Ld(d);)d=c.find(1,!0).line,b=null;var e=ye(d),f=e?e[0].level%2?wf(d):xf(d):d.text.length;return cg(null==b?ve(d):b,f)}function Af(a,b,c){var d=a[0].level;return b==d?!0:c==d?!1:c>b}function Bf(a,b){rh=null;for(var c,d=0;d<a.length;++d){var e=a[d];if(e.from<b&&e.to>b)return d;if(e.from==b||e.to==b){if(null!=c)return Af(a,e.level,a[c].level)?(e.from!=e.to&&(rh=c),d):(e.from!=e.to&&(rh=d),c);c=d}}return c}function Cf(a,b,c,d){if(!d)return b+c;do b+=c;while(b>0&&ff(a.text.charAt(b)));return b}function Df(a,b,c,d){var e=ye(a);if(!e)return Ef(a,b,c,d);for(var f=Bf(e,b),g=e[f],h=Cf(a,b,g.level%2?-c:c,d);;){if(h>g.from&&h<g.to)return h;if(h==g.from||h==g.to)return Bf(e,h)==f?h:(g=e[f+=c],c>0==g.level%2?g.to:g.from);if(g=e[f+=c],!g)return null;h=c>0==g.level%2?Cf(a,g.to,-1,d):Cf(a,g.from,1,d)}}function Ef(a,b,c,d){var e=b+c;if(d)for(;e>0&&ff(a.text.charAt(e));)e+=c;return 0>e||e>a.text.length?null:e}var Ff=/gecko\/\d/i.test(navigator.userAgent),Gf=/MSIE \d/.test(navigator.userAgent),Hf=Gf&&(null==document.documentMode||document.documentMode<8),If=Gf&&(null==document.documentMode||document.documentMode<9),Jf=Gf&&(null==document.documentMode||document.documentMode<10),Kf=/Trident\/([7-9]|\d{2,})\./.test(navigator.userAgent),Lf=Gf||Kf,Mf=/WebKit\//.test(navigator.userAgent),Nf=Mf&&/Qt\/\d+\.\d+/.test(navigator.userAgent),Of=/Chrome\//.test(navigator.userAgent),Pf=/Opera\//.test(navigator.userAgent),Qf=/Apple Computer/.test(navigator.vendor),Rf=/KHTML\//.test(navigator.userAgent),Sf=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),Tf=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Uf=/PhantomJS/.test(navigator.userAgent),Vf=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Wf=Vf||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),Xf=Vf||/Mac/.test(navigator.platform),Yf=/win/i.test(navigator.platform),Zf=Pf&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);Zf&&(Zf=Number(Zf[1])),Zf&&Zf>=15&&(Pf=!1,Mf=!0);var $f=Xf&&(Nf||Pf&&(null==Zf||12.11>Zf)),_f=Ff||Lf&&!If,ag=!1,bg=!1,cg=a.Pos=function(a,b){return this instanceof cg?(this.line=a,void(this.ch=b)):new cg(a,b)},dg=a.cmpPos=function(a,b){return a.line-b.line||a.ch-b.ch};U.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];if(0!=dg(c.anchor,d.anchor)||0!=dg(c.head,d.head))return!1}return!0},deepCopy:function(){for(var a=[],b=0;b<this.ranges.length;b++)a[b]=new V(R(this.ranges[b].anchor),R(this.ranges[b].head));return new U(a,this.primIndex)},somethingSelected:function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},contains:function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c];if(dg(b,d.from())>=0&&dg(a,d.to())<=0)return c}return-1}},V.prototype={from:function(){return T(this.anchor,this.head)},to:function(){return S(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var eg,fg={left:0,right:0,top:0,bottom:0},gg=0;a.posFromMouse=sc;var hg,ig,jg=0,kg=0,lg=null;Lf?lg=-.53:Ff?lg=15:Of?lg=-.7:Qf&&(lg=-1/3);var mg,ng,og=null,pg=a.changeEnd=function(a){return a.text?cg(a.from.line+a.text.length-1,$e(a.text).length+(1==a.text.length?a.from.ch:0)):a.to};a.prototype={constructor:a,focus:function(){window.focus(),nc(this),kc(this)},findWordAt:function(a){return md(this.doc,a)},setOption:function(a,b){var c=this.options,d=c[a];(c[a]!=b||"mode"==a)&&(c[a]=b,rg.hasOwnProperty(a)&&Zb(this,rg[a])(this,b,d))},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](a)},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||"string"!=typeof b[c]&&b[c].name==a)return b.splice(c,1),!0},addOverlay:$b(function(b,c){var d=b.token?b:a.getMode(this.options,b);if(d.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:d,modeSpec:b,opaque:c&&c.opaque}),this.state.modeGen++,cc(this)}),removeOverlay:$b(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;if(d==a||"string"==typeof a&&d.name==a)return b.splice(c,1),this.state.modeGen++,void cc(this)}}),indentLine:$b(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract"),_(this.doc,a)&&hd(this,a,b,c)}),indentSelection:$b(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;d<b.length;d++){var e=b[d];if(e.empty())e.head.line>c&&(hd(this,e.head.line,a,!0),c=e.head.line,d==this.doc.sel.primIndex&&fd(this));else{var f=Math.max(c,e.from().line),g=e.to();c=Math.min(this.lastLine(),g.line-(g.ch?0:1))+1;for(var h=f;c>h;++h)hd(this,h,a)}}}),getTokenAt:function(a,b){var c=this.doc;a=Z(c,a);var d=vb(this,a.line,b),e=this.doc.mode,f=re(c,a.line),g=new Fg(f.text,this.options.tabSize);for("object"==typeof d&&(d.lineBefore=this.getLine(a.line-1),d.lineAfter=this.getLine(a.line+1));g.pos<a.ch&&!g.eol();){g.start=g.pos;var h=$d(e,g,d)}return{start:g.start,end:g.pos,string:g.current(),type:h||null,state:d}},getTokenTypeAt:function(a){a=Z(this.doc,a);var b,c=be(this,re(this.doc,a.line)),d=0,e=(c.length-1)/2,f=a.ch;if(0==f)b=c[2];else for(;;){var g=d+e>>1;if((g?c[2*g-1]:0)>=f)e=g;else{if(!(c[2*g+1]<f)){b=c[2*g+2];break}d=g+1}}var h=b?b.indexOf("cm-overlay "):-1;return 0>h?b:0==h?null:b.slice(0,h-1)},getModeAt:function(b){var c=this.doc.mode;return c.innerMode?a.innerMode(c,this.getTokenAt(b).state).mode:c},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var c=[];if(!xg.hasOwnProperty(b))return xg;var d=xg[b],e=this.getModeAt(a);if("string"==typeof e[b])d[e[b]]&&c.push(d[e[b]]);else if(e[b])for(var f=0;f<e[b].length;f++){var g=d[e[b][f]];g&&c.push(g)}else e.helperType&&d[e.helperType]?c.push(d[e.helperType]):d[e.name]&&c.push(d[e.name]);for(var f=0;f<d._global.length;f++){var h=d._global[f];h.pred(e,this)&&-1==_e(c,h.val)&&c.push(h.val)}return c},getStateAfter:function(a,b){var c=this.doc;return a=Y(c,null==a?c.first+c.size-1:a),vb(this,a+1,b)},cursorCoords:function(a,b){var c,d=this.doc.sel.primary();return c=null==a?d.head:"object"==typeof a?Z(this.doc,a):a?d.from():d.to(),Pb(this,c,b||"page")},charCoords:function(a,b){return Ob(this,Z(this.doc,a),b||"page")},coordsChar:function(a,b){return a=Nb(this,a,b||"page"),Sb(this,a.left,a.top)},lineAtHeight:function(a,b){return a=Nb(this,{top:a,left:0},b||"page").top,we(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b){var c=!1,d=this.doc.first+this.doc.size-1;a<this.doc.first?a=this.doc.first:a>d&&(a=d,c=!0);var e=re(this.doc,a);return Mb(this,e,{top:0,left:0},b||"page").top+(c?this.doc.height-xe(e):0)},defaultTextHeight:function(){return Ub(this.display)},defaultCharWidth:function(){return Vb(this.display)},setGutterMarker:$b(function(a,b,c){return id(this,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});return d[b]=c,!c&&ef(d)&&(a.gutterMarkers=null),!0})}),clearGutter:$b(function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,dc(b,d,"gutter"),ef(c.gutterMarkers)&&(c.gutterMarkers=null)),++d})}),addLineClass:$b(function(a,b,c){return id(this,a,"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"wrapClass";if(a[d]){if(new RegExp("(?:^|\\s)"+c+"(?:$|\\s)").test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:$b(function(a,b,c){return id(this,a,"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"wrapClass",e=a[d];if(!e)return!1;if(null==c)a[d]=null;else{var f=e.match(new RegExp("(?:^|\\s+)"+c+"(?:$|\\s+)"));if(!f)return!1;var g=f.index+f[0].length;a[d]=e.slice(0,f.index)+(f.index&&g!=e.length?" ":"")+e.slice(g)||null}return!0})}),addLineWidget:$b(function(a,b,c){return Vd(this,a,b,c)}),removeLineWidget:function(a){a.clear()},lineInfo:function(a){if("number"==typeof a){if(!_(this.doc,a))return null;var b=a;if(a=re(this.doc,a),!a)return null}else{var b=ve(a);if(null==b)return null}return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,d,e){var f=this.display;a=Pb(this,Z(this.doc,a));var g=a.bottom,h=a.left;if(b.style.position="absolute",f.sizer.appendChild(b),"over"==d)g=a.top;else if("above"==d||"near"==d){var i=Math.max(f.wrapper.clientHeight,this.doc.height),j=Math.max(f.sizer.clientWidth,f.lineSpace.clientWidth);("above"==d||a.bottom+b.offsetHeight>i)&&a.top>b.offsetHeight?g=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=i&&(g=a.bottom),h+b.offsetWidth>j&&(h=j-b.offsetWidth)}b.style.top=g+"px",b.style.left=b.style.right="","right"==e?(h=f.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==e?h=0:"middle"==e&&(h=(f.sizer.clientWidth-b.offsetWidth)/2),b.style.left=h+"px"),c&&cd(this,h,g,h+b.offsetWidth,g+b.offsetHeight)},triggerOnKeyDown:$b(Ic),triggerOnKeyPress:$b(Lc),triggerOnKeyUp:$b(Kc),execCommand:function(a){return Ag.hasOwnProperty(a)?Ag[a](this):void 0},findPosH:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);for(var f=0,g=Z(this.doc,a);b>f&&(g=kd(this.doc,g,e,c,d),!g.hitSide);++f);return g},moveH:$b(function(a,b){var c=this;c.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?kd(c.doc,d.head,a,b,c.options.rtlMoveVisually):0>a?d.from():d.to()},bh)}),deleteH:$b(function(a,b){var c=this.doc.sel,d=this.doc;c.somethingSelected()?d.replaceSelection("",null,"+delete"):jd(this,function(c){var e=kd(d,c.head,a,b,!1);return 0>a?{from:e,to:c.head}:{from:c.head,to:e}})}),findPosV:function(a,b,c,d){var e=1,f=d;0>b&&(e=-1,b=-b);for(var g=0,h=Z(this.doc,a);b>g;++g){var i=Pb(this,h,"div");if(null==f?f=i.left:i.left=f,h=ld(this,i,e,c),h.hitSide)break}return h},moveV:$b(function(a,b){var c=this,d=this.doc,e=[],f=!c.display.shift&&!d.extend&&d.sel.somethingSelected();if(d.extendSelectionsBy(function(g){if(f)return 0>a?g.from():g.to();var h=Pb(c,g.head,"div");null!=g.goalColumn&&(h.left=g.goalColumn),e.push(h.left);var i=ld(c,h,a,b);return"page"==b&&g==d.sel.primary()&&ed(c,null,Ob(c,i,"div").top-h.top),i},bh),e.length)for(var g=0;g<d.sel.ranges.length;g++)d.sel.ranges[g].goalColumn=e[g]}),toggleOverwrite:function(a){(null==a||a!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?of(this.display.cursorDiv,"CodeMirror-overwrite"):nf(this.display.cursorDiv,"CodeMirror-overwrite"),Xg(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return lf()==this.display.input},scrollTo:$b(function(a,b){(null!=a||null!=b)&&gd(this),null!=a&&(this.curOp.scrollLeft=a),null!=b&&(this.curOp.scrollTop=b)}),getScrollInfo:function(){var a=this.display.scroller,b=Zg;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-b,width:a.scrollWidth-b,clientHeight:a.clientHeight-b,clientWidth:a.clientWidth-b}},scrollIntoView:$b(function(a,b){if(null==a?(a={from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:cg(a,0),to:null}:null==a.from&&(a={from:a,to:null}),a.to||(a.to=a.from),a.margin=b||0,null!=a.from.line)gd(this),this.curOp.scrollToPos=a;else{var c=dd(this,Math.min(a.from.left,a.to.left),Math.min(a.from.top,a.to.top)-a.margin,Math.max(a.from.right,a.to.right),Math.max(a.from.bottom,a.to.bottom)+a.margin);this.scrollTo(c.scrollLeft,c.scrollTop)}}),setSize:$b(function(a,b){function c(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}null!=a&&(this.display.wrapper.style.width=c(a)),null!=b&&(this.display.wrapper.style.height=c(b)),this.options.lineWrapping&&Ib(this),this.curOp.forceUpdate=!0,Xg(this,"refresh",this)}),operation:function(a){return Yb(this,a)},refresh:$b(function(){var a=this.display.cachedTextHeight;cc(this),this.curOp.forceUpdate=!0,Jb(this),this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop),l(this),(null==a||Math.abs(a-Ub(this.display))>.5)&&g(this),Xg(this,"refresh",this)}),swapDoc:$b(function(a){var b=this.doc;return b.cm=null,qe(this,a),Jb(this),mc(this),this.scrollTo(a.scrollLeft,a.scrollTop),Re(this,"swapDoc",this,b),b}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},We(a);var qg=a.defaults={},rg=a.optionHandlers={},sg=a.Init={toString:function(){return"CodeMirror.Init"}};nd("value","",function(a,b){a.setValue(b)},!0),nd("mode",null,function(a,b){a.doc.modeOption=b,c(a)},!0),nd("indentUnit",2,c,!0),nd("indentWithTabs",!1),nd("smartIndent",!0),nd("tabSize",4,function(a){d(a),Jb(a),cc(a)},!0),nd("specialChars",/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\ufeff]/g,function(a,b){a.options.specialChars=new RegExp(b.source+(b.test("	")?"":"|	"),"g"),a.refresh()},!0),nd("specialCharPlaceholder",fe,function(a){a.refresh()},!0),nd("electricChars",!0),nd("rtlMoveVisually",!Yf),nd("wholeLineUpdateBefore",!0),nd("theme","default",function(a){i(a),j(a)},!0),nd("keyMap","default",h),nd("extraKeys",null),nd("lineWrapping",!1,e,!0),nd("gutters",[],function(a){o(a.options),j(a)},!0),nd("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?v(a.display)+"px":"0",a.refresh()},!0),nd("coverGutterNextToScrollbar",!1,q,!0),nd("lineNumbers",!1,function(a){o(a.options),j(a)},!0),nd("firstLineNumber",1,j,!0),nd("lineNumberFormatter",function(a){return a},j,!0),nd("showCursorWhenSelecting",!1,ob,!0),nd("resetSelectionOnContextMenu",!0),nd("readOnly",!1,function(a,b){"nocursor"==b?(Nc(a),a.display.input.blur(),a.display.disabled=!0):(a.display.disabled=!1,b||mc(a))}),nd("disableInput",!1,function(a,b){b||mc(a)},!0),nd("dragDrop",!0),nd("cursorBlinkRate",530),nd("cursorScrollMargin",0),nd("cursorHeight",1),nd("workTime",100),nd("workDelay",100),nd("flattenSpans",!0,d,!0),nd("addModeClass",!1,d,!0),nd("pollInterval",100),nd("undoDepth",100,function(a,b){a.doc.history.undoDepth=b}),nd("historyEventDelay",1250),nd("viewportMargin",10,function(a){a.refresh()},!0),nd("maxHighlightLength",1e4,d,!0),nd("moveInputWithCursor",!0,function(a,b){b||(a.display.inputDiv.style.top=a.display.inputDiv.style.left=0)}),nd("tabindex",null,function(a,b){a.display.input.tabIndex=b||""}),nd("autofocus",null);var tg=a.modes={},ug=a.mimeModes={};a.defineMode=function(b,c){if(a.defaults.mode||"null"==b||(a.defaults.mode=b),arguments.length>2){c.dependencies=[];for(var d=2;d<arguments.length;++d)c.dependencies.push(arguments[d])}tg[b]=c},a.defineMIME=function(a,b){ug[a]=b},a.resolveMode=function(b){if("string"==typeof b&&ug.hasOwnProperty(b))b=ug[b];else if(b&&"string"==typeof b.name&&ug.hasOwnProperty(b.name)){var c=ug[b.name];"string"==typeof c&&(c={name:c}),b=bf(c,b),b.name=c.name}else if("string"==typeof b&&/^[\w\-]+\/[\w\-]+\+xml$/.test(b))return a.resolveMode("application/xml");return"string"==typeof b?{name:b}:b||{name:"null"}},a.getMode=function(b,c){var c=a.resolveMode(c),d=tg[c.name];if(!d)return a.getMode(b,"text/plain");var e=d(b,c);if(vg.hasOwnProperty(c.name)){var f=vg[c.name];for(var g in f)f.hasOwnProperty(g)&&(e.hasOwnProperty(g)&&(e["_"+g]=e[g]),e[g]=f[g])}if(e.name=c.name,c.helperType&&(e.helperType=c.helperType),c.modeProps)for(var g in c.modeProps)e[g]=c.modeProps[g];return e},a.defineMode("null",function(){return{token:function(a){a.skipToEnd()},startState:function(){return{}}}}),a.defineMIME("text/plain","null");var vg=a.modeExtensions={};a.extendMode=function(a,b){var c=vg.hasOwnProperty(a)?vg[a]:vg[a]={};cf(b,c)},a.defineExtension=function(b,c){a.prototype[b]=c},a.defineDocExtension=function(a,b){Og.prototype[a]=b},a.defineOption=nd;var wg=[];a.defineInitHook=function(a){wg.push(a)};var xg=a.helpers={};a.registerHelper=function(b,c,d){xg.hasOwnProperty(b)||(xg[b]=a[b]={_global:[]}),xg[b][c]=d},a.registerGlobalHelper=function(b,c,d,e){a.registerHelper(b,c,e),xg[b]._global.push({pred:d,val:e})};var yg=a.copyState=function(a,b){if(b===!0)return b;if(a.copyState)return a.copyState(b);var c={};for(var d in b){var e=b[d];e instanceof Array&&(e=e.concat([])),c[d]=e}return c},zg=a.startState=function(a,b,c){return a.startState?a.startState(b,c):!0};a.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);if(!c||!c.mode||c.mode==a)break;b=c.state,a=c.mode}return c&&!c.mode&&(c=void 0),c||{mode:a,state:b}};var Ag=a.commands={selectAll:function(a){a.setSelection(cg(a.firstLine(),0),cg(a.lastLine()),_g)},singleSelection:function(a){a.setSelection(a.getCursor("anchor"),a.getCursor("head"),_g)},killLine:function(a){jd(a,function(b){if(b.empty()){var c=re(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:cg(b.head.line+1,0)}:{from:b.head,to:cg(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){jd(a,function(b){return{from:cg(b.from().line,0),to:Z(a.doc,cg(b.to().line+1,0))}})},delLineLeft:function(a){jd(a,function(a){return{from:cg(a.from().line,0),to:a.from()}})},undo:function(a){a.undo()},redo:function(a){a.redo()},undoSelection:function(a){a.undoSelection()},redoSelection:function(a){a.redoSelection()},goDocStart:function(a){a.extendSelection(cg(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(cg(a.lastLine()))},goLineStart:function(a){a.extendSelectionsBy(function(b){return yf(a,b.head.line)},bh)},goLineStartSmart:function(a){a.extendSelectionsBy(function(b){var c=yf(a,b.head.line),d=a.getLineHandle(c.line),e=ye(d);if(!e||0==e[0].level){var f=Math.max(0,d.text.search(/\S/)),g=b.head.line==c.line&&b.head.ch<=f&&b.head.ch;return cg(c.line,g?0:f)}return c},bh)},goLineEnd:function(a){a.extendSelectionsBy(function(b){return zf(a,b.head.line)},bh)},goLineRight:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div")},bh)},goLineLeft:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:c},"div")},bh)},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("	")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,e=0;e<c.length;e++){var f=c[e].from(),g=ch(a.getLine(f.line),f.ch,d);b.push(new Array(d-g%d+1).join(" "))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){Yb(a,function(){for(var b=a.listSelections(),c=0;c<b.length;c++){var d=b[c].head,e=re(a.doc,d.line).text;d.ch>0&&d.ch<e.length-1&&a.replaceRange(e.charAt(d.ch)+e.charAt(d.ch-1),cg(d.line,d.ch-1),cg(d.line,d.ch+1))}})},newlineAndIndent:function(a){Yb(a,function(){for(var b=a.listSelections().length,c=0;b>c;c++){var d=a.listSelections()[c];a.replaceRange("\n",d.anchor,d.head,"+input"),a.indentLine(d.from().line+1,null,!0),fd(a)}})},toggleOverwrite:function(a){a.toggleOverwrite()}},Bg=a.keyMap={};Bg.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Bg.pcDefault={"Ctrl-A":"selectAll","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Bg.macDefault={"Cmd-A":"selectAll","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection",fallthrough:["basic","emacsy"]},Bg.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},Bg["default"]=Xf?Bg.macDefault:Bg.pcDefault;var Cg=a.lookupKey=function(a,b,c){function d(b){b=od(b);var e=b[a];if(e===!1)return"stop";if(null!=e&&c(e))return!0;if(b.nofallthrough)return"stop";var f=b.fallthrough;if(null==f)return!1;if("[object Array]"!=Object.prototype.toString.call(f))return d(f);for(var g=0;g<f.length;++g){var h=d(f[g]);if(h)return h}return!1}for(var e=0;e<b.length;++e){var f=d(b[e]);if(f)return"stop"!=f}},Dg=a.isModifierKey=function(a){var b=qh[a.keyCode];return"Ctrl"==b||"Alt"==b||"Shift"==b||"Mod"==b},Eg=a.keyName=function(a,b){if(Pf&&34==a.keyCode&&a["char"])return!1;var c=qh[a.keyCode];return null==c||a.altGraphKey?!1:(a.altKey&&(c="Alt-"+c),($f?a.metaKey:a.ctrlKey)&&(c="Ctrl-"+c),($f?a.ctrlKey:a.metaKey)&&(c="Cmd-"+c),!b&&a.shiftKey&&(c="Shift-"+c),c)};a.fromTextArea=function(b,c,d,e){function f(){b.value=l.getValue()
}if(c||(c={}),c.value=b.value,!c.tabindex&&b.tabindex&&(c.tabindex=b.tabindex),!c.placeholder&&b.placeholder&&(c.placeholder=b.placeholder),null==c.autofocus){var g=lf();c.autofocus=g==b||null!=b.getAttribute("autofocus")&&g==document.body}if(b.form&&(Vg(b.form,"submit",f),!c.leaveSubmitMethodAlone)){var h=b.form,i=h.submit;try{var j=h.submit=function(){f(),h.submit=i,h.submit(),h.submit=j}}catch(k){}}b.style.display="none";var l=a(function(a){b.parentNode.insertBefore(a,b.nextSibling)},c,d,e);return l.save=f,l.getTextArea=function(){return b},l.toTextArea=function(){f(),b.parentNode.removeChild(l.getWrapperElement()),b.style.display="",b.form&&(Wg(b.form,"submit",f),"function"==typeof b.form.submit&&(b.form.submit=i))},l};var Fg=a.StringStream=function(a,b){this.pos=this.start=0,this.string=a,this.tabSize=b||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};Fg.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(a){var b=this.string.charAt(this.pos);if("string"==typeof a)var c=b==a;else var c=b&&(a.test?a.test(b):a(b));return c?(++this.pos,b):void 0},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){var b=this.string.indexOf(a,this.pos);return b>-1?(this.pos=b,!0):void 0},backUp:function(a){this.pos-=a},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=ch(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?ch(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return ch(this.string,null,this.tabSize)-(this.lineStart?ch(this.string,this.lineStart,this.tabSize):0)},match:function(a,b,c){if("string"!=typeof a){var d=this.string.slice(this.pos).match(a);return d&&d.index>0?null:(d&&b!==!1&&(this.pos+=d[0].length),d)}var e=function(a){return c?a.toLowerCase():a},f=this.string.substr(this.pos,a.length);return e(f)==e(a)?(b!==!1&&(this.pos+=a.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}}};var Gg=a.TextMarker=function(a,b){this.lines=[],this.type=b,this.doc=a};We(Gg),Gg.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;if(b&&Wb(a),Ve(this,"clear")){var c=this.find();c&&Re(this,"clear",c.from,c.to)}for(var d=null,e=null,f=0;f<this.lines.length;++f){var g=this.lines[f],h=vd(g.markedSpans,this);a&&!this.collapsed?dc(a,ve(g),"text"):a&&(null!=h.to&&(e=ve(g)),null!=h.from&&(d=ve(g))),g.markedSpans=wd(g.markedSpans,h),null==h.from&&this.collapsed&&!Rd(this.doc,g)&&a&&ue(g,Ub(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(var f=0;f<this.lines.length;++f){var i=Nd(this.lines[f]),j=m(i);j>a.display.maxLineLength&&(a.display.maxLine=i,a.display.maxLineLength=j,a.display.maxLineChanged=!0)}null!=d&&a&&this.collapsed&&cc(a,d,e+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&lb(a.doc)),a&&Re(a,"markerCleared",a,this),b&&Xb(a),this.parent&&this.parent.clear()}},Gg.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);for(var c,d,e=0;e<this.lines.length;++e){var f=this.lines[e],g=vd(f.markedSpans,this);if(null!=g.from&&(c=cg(b?f:ve(f),g.from),-1==a))return c;if(null!=g.to&&(d=cg(b?f:ve(f),g.to),1==a))return d}return c&&{from:c,to:d}},Gg.prototype.changed=function(){var a=this.find(-1,!0),b=this,c=this.doc.cm;a&&c&&Yb(c,function(){var d=a.line,e=ve(a.line),f=Db(c,e);if(f&&(Hb(f),c.curOp.selectionChanged=c.curOp.forceUpdate=!0),c.curOp.updateMaxLine=!0,!Rd(b.doc,d)&&null!=b.height){var g=b.height;b.height=null;var h=Ud(b)-g;h&&ue(d,d.height+h)}})},Gg.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=_e(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)},Gg.prototype.detachLine=function(a){if(this.lines.splice(_e(this.lines,a),1),!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;(b.maybeHiddenMarkers||(b.maybeHiddenMarkers=[])).push(this)}};var Hg=0,Ig=a.SharedTextMarker=function(a,b){this.markers=a,this.primary=b;for(var c=0;c<a.length;++c)a[c].parent=this};We(Ig),Ig.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();Re(this,"clear")}},Ig.prototype.find=function(a,b){return this.primary.find(a,b)};var Jg=a.LineWidget=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.cm=a,this.node=b};We(Jg),Jg.prototype.clear=function(){var a=this.cm,b=this.line.widgets,c=this.line,d=ve(c);if(null!=d&&b){for(var e=0;e<b.length;++e)b[e]==this&&b.splice(e--,1);b.length||(c.widgets=null);var f=Ud(this);Yb(a,function(){Td(a,c,-f),dc(a,d,"widget"),ue(c,Math.max(0,c.height-f))})}},Jg.prototype.changed=function(){var a=this.height,b=this.cm,c=this.line;this.height=null;var d=Ud(this)-a;d&&Yb(b,function(){b.curOp.forceUpdate=!0,Td(b,c,d),ue(c,c.height+d)})};var Kg=a.Line=function(a,b,c){this.text=a,Fd(this,b),this.height=c?c(this):1};We(Kg),Kg.prototype.lineNo=function(){return ve(this)};var Lg={},Mg={};ne.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;d>c;++c){var e=this.lines[c];this.height-=e.height,Xd(e),Re(e,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c,this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(var d=0;d<b.length;++d)b[d].parent=this},iterN:function(a,b,c){for(var d=a+b;d>a;++a)if(c(this.lines[a]))return!0}},oe.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],e=d.chunkSize();if(e>a){var f=Math.min(b,e-a),g=d.height;if(d.removeInner(a,f),this.height-=g-d.height,e==f&&(this.children.splice(c--,1),d.parent=null),0==(b-=f))break;a=0}else a-=e}if(this.size-b<25&&(this.children.length>1||!(this.children[0]instanceof ne))){var h=[];this.collapse(h),this.children=[new ne(h)],this.children[0].parent=this}},collapse:function(a){for(var b=0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length,this.height+=c;for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(f>=a){if(e.insertInner(a,b,c),e.lines&&e.lines.length>50){for(;e.lines.length>50;){var g=e.lines.splice(e.lines.length-25,25),h=new ne(g);e.height-=h.height,this.children.splice(d+1,0,h),h.parent=this}this.maybeSpill()}break}a-=f}},maybeSpill:function(){if(!(this.children.length<=10)){var a=this;do{var b=a.children.splice(a.children.length-5,5),c=new oe(b);if(a.parent){a.size-=c.size,a.height-=c.height;var d=_e(a.parent.children,a);a.parent.children.splice(d+1,0,c)}else{var e=new oe(a.children);e.parent=a,a.children=[e,c],a=e}c.parent=a.parent}while(a.children.length>10);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(f>a){var g=Math.min(b,f-a);if(e.iterN(a,g,c))return!0;if(0==(b-=g))break;a=0}else a-=f}}};var Ng=0,Og=a.Doc=function(a,b,c){if(!(this instanceof Og))return new Og(a,b,c);null==c&&(c=0),oe.call(this,[new ne([new Kg("",null)])]),this.first=c,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.frontier=c;var d=cg(c,0);this.sel=X(d),this.history=new ze(null),this.id=++Ng,this.modeOption=b,"string"==typeof a&&(a=nh(a)),me(this,{from:d,to:d,text:a}),ib(this,X(d),_g)};Og.prototype=bf(oe.prototype,{constructor:Og,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=te(this,this.first,this.first+this.size);return a===!1?b:b.join(a||"\n")},setValue:_b(function(a,b){var c=cg(this.first,0),d=this.first+this.size-1;Vc(this,{from:c,to:cg(d,re(this,d).text.length),text:nh(a),origin:b||"setValue"},!0),ib(this,X(c))}),replaceRange:function(a,b,c,d){b=Z(this,b),c=c?Z(this,c):b,_c(this,a,b,c,d)},getRange:function(a,b,c){var d=se(this,Z(this,a),Z(this,b));return c===!1?d:d.join(c||"\n")},getLine:function(a){var b=this.getLineHandle(a);return b&&b.text},getLineHandle:function(a){return _(this,a)?re(this,a):void 0},getLineNumber:function(a){return ve(a)},getLineHandleVisualStart:function(a){return"number"==typeof a&&(a=re(this,a)),Nd(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return Z(this,a)},getCursor:function(a){var b,c=this.sel.primary();return b=null==a||"head"==a?c.head:"anchor"==a?c.anchor:"end"==a||"to"==a||a===!1?c.to():c.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:_b(function(a,b,c){fb(this,Z(this,"number"==typeof a?cg(a,b||0):a),null,c)}),setSelection:_b(function(a,b,c){fb(this,Z(this,a),Z(this,b||a),c)}),extendSelection:_b(function(a,b,c){cb(this,Z(this,a),b&&Z(this,b),c)}),extendSelections:_b(function(a,b){db(this,ab(this,a,b))}),extendSelectionsBy:_b(function(a,b){db(this,af(this.sel.ranges,a),b)}),setSelections:_b(function(a,b,c){if(a.length){for(var d=0,e=[];d<a.length;d++)e[d]=new V(Z(this,a[d].anchor),Z(this,a[d].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex)),ib(this,W(e,b),c)}}),addSelection:_b(function(a,b,c){var d=this.sel.ranges.slice(0);d.push(new V(Z(this,a),Z(this,b||a))),ib(this,W(d,d.length-1),c)}),getSelection:function(a){for(var b,c=this.sel.ranges,d=0;d<c.length;d++){var e=se(this,c[d].from(),c[d].to());b=b?b.concat(e):e}return a===!1?b:b.join(a||"\n")},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var e=se(this,c[d].from(),c[d].to());a!==!1&&(e=e.join(a||"\n")),b[d]=e}return b},replaceSelection:_b(function(a,b,c){for(var d=[],e=0;e<this.sel.ranges.length;e++)d[e]=a;this.replaceSelections(d,b,c||"+input")}),replaceSelections:function(a,b,c){for(var d=[],e=this.sel,f=0;f<e.ranges.length;f++){var g=e.ranges[f];d[f]={from:g.from(),to:g.to(),text:nh(a[f]),origin:c}}for(var h=b&&"end"!=b&&Tc(this,d,b),f=d.length-1;f>=0;f--)Vc(this,d[f]);h?hb(this,h):this.cm&&fd(this.cm)},undo:_b(function(){Xc(this,"undo")}),redo:_b(function(){Xc(this,"redo")}),undoSelection:_b(function(){Xc(this,"undo",!0)}),redoSelection:_b(function(){Xc(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;for(var d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=new ze(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){return a&&(this.history.lastOp=this.history.lastOrigin=null),this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:Ke(this.history.done),undone:Ke(this.history.undone)}},setHistory:function(a){var b=this.history=new ze(this.history.maxGeneration);b.done=Ke(a.done.slice(0),null,!0),b.undone=Ke(a.undone.slice(0),null,!0)},markText:function(a,b,c){return pd(this,Z(this,a),Z(this,b),c,"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared};return a=Z(this,a),pd(this,a,a,c,"bookmark")},findMarksAt:function(a){a=Z(this,a);var b=[],c=re(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var e=c[d];(null==e.from||e.from<=a.ch)&&(null==e.to||e.to>=a.ch)&&b.push(e.marker.parent||e.marker)}return b},findMarks:function(a,b,c){a=Z(this,a),b=Z(this,b);var d=[],e=a.line;return this.iter(a.line,b.line+1,function(f){var g=f.markedSpans;if(g)for(var h=0;h<g.length;h++){var i=g[h];e==a.line&&a.ch>i.to||null==i.from&&e!=a.line||e==b.line&&i.from>b.ch||c&&!c(i.marker)||d.push(i.marker.parent||i.marker)}++e}),d},getAllMarks:function(){var a=[];return this.iter(function(b){var c=b.markedSpans;if(c)for(var d=0;d<c.length;++d)null!=c[d].from&&a.push(c[d].marker)}),a},posFromIndex:function(a){var b,c=this.first;return this.iter(function(d){var e=d.text.length+1;return e>a?(b=a,!0):(a-=e,void++c)}),Z(this,cg(c,b))},indexFromPos:function(a){a=Z(this,a);var b=a.ch;return a.line<this.first||a.ch<0?0:(this.iter(this.first,a.line,function(a){b+=a.text.length+1}),b)},copy:function(a){var b=new Og(te(this,this.first,this.first+this.size),this.modeOption,this.first);return b.scrollTop=this.scrollTop,b.scrollLeft=this.scrollLeft,b.sel=this.sel,b.extend=!1,a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory())),b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from),null!=a.to&&a.to<c&&(c=a.to);var d=new Og(te(this,b,c),a.mode||this.modeOption,b);return a.sharedHist&&(d.history=this.history),(this.linked||(this.linked=[])).push({doc:d,sharedHist:a.sharedHist}),d.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}],sd(d,rd(this)),d},unlinkDoc:function(b){if(b instanceof a&&(b=b.doc),this.linked)for(var c=0;c<this.linked.length;++c){var d=this.linked[c];if(d.doc==b){this.linked.splice(c,1),b.unlinkDoc(this),td(rd(this));break}}if(b.history==this.history){var e=[b.id];pe(b,function(a){e.push(a.id)},!0),b.history=new ze(null),b.history.done=Ke(this.history.done,e),b.history.undone=Ke(this.history.undone,e)}},iterLinkedDocs:function(a){pe(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),Og.prototype.eachLine=Og.prototype.iter;var Pg="iter insert remove copy getEditor".split(" ");for(var Qg in Og.prototype)Og.prototype.hasOwnProperty(Qg)&&_e(Pg,Qg)<0&&(a.prototype[Qg]=function(a){return function(){return a.apply(this.doc,arguments)}}(Og.prototype[Qg]));We(Og);var Rg,Sg=a.e_preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},Tg=a.e_stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},Ug=a.e_stop=function(a){Sg(a),Tg(a)},Vg=a.on=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent("on"+b,c);else{var d=a._handlers||(a._handlers={}),e=d[b]||(d[b]=[]);e.push(c)}},Wg=a.off=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else{var d=a._handlers&&a._handlers[b];if(!d)return;for(var e=0;e<d.length;++e)if(d[e]==c){d.splice(e,1);break}}},Xg=a.signal=function(a,b){var c=a._handlers&&a._handlers[b];if(c)for(var d=Array.prototype.slice.call(arguments,2),e=0;e<c.length;++e)c[e].apply(null,d)},Yg=0,Zg=30,$g=a.Pass={toString:function(){return"CodeMirror.Pass"}},_g={scroll:!1},ah={origin:"*mouse"},bh={origin:"+move"};Xe.prototype.set=function(a,b){clearTimeout(this.id),this.id=setTimeout(b,a)};var ch=a.countColumn=function(a,b,c,d,e){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));for(var f=d||0,g=e||0;;){var h=a.indexOf("	",f);if(0>h||h>=b)return g+(b-f);g+=h-f,g+=c-g%c,f=h+1}},dh=[""],eh=function(a){a.select()};Vf?eh=function(a){a.selectionStart=0,a.selectionEnd=a.value.length}:Lf&&(eh=function(a){try{a.select()}catch(b){}}),[].indexOf&&(_e=function(a,b){return a.indexOf(b)}),[].map&&(af=function(a,b){return a.map(b)});var fh,gh=/[\u00df\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,hh=a.isWordChar=function(a){return/\w/.test(a)||a>""&&(a.toUpperCase()!=a.toLowerCase()||gh.test(a))},ih=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;fh=document.createRange?function(a,b,c){var d=document.createRange();return d.setEnd(a,c),d.setStart(a,b),d}:function(a,b,c){var d=document.body.createTextRange();return d.moveToElementText(a.parentNode),d.collapse(!0),d.moveEnd("character",c),d.moveStart("character",b),d},Gf&&(lf=function(){try{return document.activeElement}catch(a){return document.body}});var jh,kh,lh,mh=function(){if(If)return!1;var a=gf("div");return"draggable"in a||"dragDrop"in a}(),nh=a.splitLines=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;d>=b;){var e=a.indexOf("\n",b);-1==e&&(e=a.length);var f=a.slice(b,"\r"==a.charAt(e-1)?e-1:e),g=f.indexOf("\r");-1!=g?(c.push(f.slice(0,g)),b+=g+1):(c.push(f),b=e+1)}return c}:function(a){return a.split(/\r\n?|\n/)},oh=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},ph=function(){var a=gf("div");return"oncopy"in a?!0:(a.setAttribute("oncopy","return;"),"function"==typeof a.oncopy)}(),qh={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};a.keyNames=qh,function(){for(var a=0;10>a;a++)qh[a+48]=qh[a+96]=String(a);for(var a=65;90>=a;a++)qh[a]=String.fromCharCode(a);for(var a=1;12>=a;a++)qh[a+111]=qh[a+63235]="F"+a}();var rh,sh=function(){function a(a){return 247>=a?c.charAt(a):a>=1424&&1524>=a?"R":a>=1536&&1773>=a?d.charAt(a-1536):a>=1774&&2220>=a?"r":a>=8192&&8203>=a?"w":8204==a?"b":"L"}function b(a,b,c){this.level=a,this.from=b,this.to=c}var c="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",d="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",e=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,f=/[stwN]/,g=/[LRr]/,h=/[Lb1n]/,i=/[1n]/,j="L";return function(c){if(!e.test(c))return!1;for(var d,k=c.length,l=[],m=0;k>m;++m)l.push(d=a(c.charCodeAt(m)));for(var m=0,n=j;k>m;++m){var d=l[m];"m"==d?l[m]=n:n=d}for(var m=0,o=j;k>m;++m){var d=l[m];"1"==d&&"r"==o?l[m]="n":g.test(d)&&(o=d,"r"==d&&(l[m]="R"))}for(var m=1,n=l[0];k-1>m;++m){var d=l[m];"+"==d&&"1"==n&&"1"==l[m+1]?l[m]="1":","!=d||n!=l[m+1]||"1"!=n&&"n"!=n||(l[m]=n),n=d}for(var m=0;k>m;++m){var d=l[m];if(","==d)l[m]="N";else if("%"==d){for(var p=m+1;k>p&&"%"==l[p];++p);for(var q=m&&"!"==l[m-1]||k>p&&"1"==l[p]?"1":"N",r=m;p>r;++r)l[r]=q;m=p-1}}for(var m=0,o=j;k>m;++m){var d=l[m];"L"==o&&"1"==d?l[m]="L":g.test(d)&&(o=d)}for(var m=0;k>m;++m)if(f.test(l[m])){for(var p=m+1;k>p&&f.test(l[p]);++p);for(var s="L"==(m?l[m-1]:j),t="L"==(k>p?l[p]:j),q=s||t?"L":"R",r=m;p>r;++r)l[r]=q;m=p-1}for(var u,v=[],m=0;k>m;)if(h.test(l[m])){var w=m;for(++m;k>m&&h.test(l[m]);++m);v.push(new b(0,w,m))}else{var x=m,y=v.length;for(++m;k>m&&"L"!=l[m];++m);for(var r=x;m>r;)if(i.test(l[r])){r>x&&v.splice(y,0,new b(1,x,r));var z=r;for(++r;m>r&&i.test(l[r]);++r);v.splice(y,0,new b(2,z,r)),x=r}else++r;m>x&&v.splice(y,0,new b(1,x,m))}return 1==v[0].level&&(u=c.match(/^\s+/))&&(v[0].from=u[0].length,v.unshift(new b(0,0,u[0].length))),1==$e(v).level&&(u=c.match(/\s+$/))&&($e(v).to-=u[0].length,v.push(new b(0,k-u[0].length,k))),v[0].level!=$e(v).level&&v.push(new b(v[0].level,k,k)),v}}();return a.version="4.0.4",a}()}),define("autoComplete",[],function(a,b,c){var d=a("jquery/jquery"),e=function(){var a=0,b={autoCompltListClass:"autoComplt-list",autoCompltHintClass:"autoComplt-hint",autoCompltHintSelectedClass:"autoComplt-hint-selected",maxHintNum:10,autoCompltDelay:100,listStatus:{attr:"data-listStatus",open:"open"},keyCode:{up:38,down:40,esc:27,enter:13,left:37,right:39},defaultStyles:{autoCompltList:{maxHeight:"none",border:"1px solid #aaa",padding:"0",margin:"0",zIndex:99,overflowX:"hidden",overflowY:"auto",display:"none",position:"absolute",backgroundColor:"#fff"},autoCompltHint:{height:"1.5em",padding:"2px 6px 2px 10px",margin:"6px 0",overflow:"hidden",listStyleType:"none",color:"#000",backgroundColor:"#fff",cursor:"default",fontSize:"1em"},autoCompltHintSelected:{color:"#fff",backgroundColor:"#3399ff"}},adjStyleAttrs:{autoCompltList:["border","maxHeight","backgroundColor"],autoCompltHint:["height","padding","margin","color","backgroundColor","fontSize"],autoCompltHintSelected:["color","backgroundColor"]}},c=function(a){return a=a||window.event,a.target=a.target||a.srcElement,a},e=function(a,b,c){a.addEventListener?a.addEventListener(b,c):a.attachEvent&&a.attachEvent("on"+b,c)},f=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c):a.detachEvent&&a.detachEvent("on"+b,c)},g=function(a,b){var c=null;if(window.getComputedStyle)c=window.getComputedStyle(a)[b]||null;else if(a.currentStyle){c=a.currentStyle&&a.currentStyle[b];var d,e,f=a.style;null==c&&f&&f[b]&&(c=f[b]),d=f.left,e=a.runtimeStyle&&a.runtimeStyle.left,e&&(a.runtimeStyle.left=a.currentStyle.left),f.left="fontSize"===b?"1em":c,c=f.pixelLeft+"px",f.left=d,e&&(a.runtimeStyle.left=e)}return c},h={buildElem:function(a){var b=document.createElement("DIV");return b.innerHTML=a,b.firstChild.cloneNode(!0)},buildHint:function(a,c){if("string"==typeof a&&a){var a=this.buildElem('<li class="'+b.autoCompltHintClass+'">'+a+"</li>");return a.style.height=a.style.lineHeight=c.autoCompltHint.height,a.style.padding=c.autoCompltHint.padding,a.style.margin=c.autoCompltHint.margin,a.style.overflow=c.autoCompltHint.overflow,a.style.listStyleType=c.autoCompltHint.listStyleType,a.style.color=c.autoCompltHint.color,a.style.backgroundColor=c.autoCompltHint.backgroundColor,a.style.cursor=c.autoCompltHint.cursor,a.style.fontSize=c.autoCompltHint.fontSize,a}return null},buildList:function(a){var c=this.buildElem('<ul class="'+b.autoCompltListClass+'"></ul>');return c.style.maxHeight=a.autoCompltList.maxHeight,c.style.border=a.autoCompltList.border,c.style.padding=a.autoCompltList.padding,c.style.margin=a.autoCompltList.margin,c.style.zIndex=a.autoCompltList.zIndex,c.style.overflowX=a.autoCompltList.overflowX,c.style.overflowY=a.autoCompltList.overflowY,c.style.display=a.autoCompltList.display,c.style.position=a.autoCompltList.position,c.style.backgroundColor=a.autoCompltList.backgroundColor,c}},i=function(a){this.uiElem=null,this.assocInput=a,this.mouseOnList=!1,this.pauseMouseoverSelection=!1,this.pauseMouseoutDeselection=!1,this.maxHintNum=b.maxHintNum,this.styles=JSON.parse(JSON.stringify(b.defaultStyles))};i.prototype.genList=function(){if(!this.uiElem){var a=this;this.uiElem=h.buildList(this.styles),e(this.uiElem,"mouseover",function(b){b=c(b),a.isHint(b.target)&&(a.select(b.target),a.autoScroll())}),e(this.uiElem,"mouseout",function(b){b=c(b),a.deselect()}),e(this.uiElem,"mousedown",function(b){a.mouseOnList=!0,"INPUT"!==a.assocInput.tagName&&a.getSelected()&&b.preventDefault()}),e(this.uiElem,"mouseup",function(b){b=c(b),a.isHint(b.target)&&(a.select(b.target),k(a.assocInput,a.getSelected().innerHTML),a.assocInput.autoComplt.close(),d(a.assocInput).trigger("change"))}),document.body.appendChild(this.uiElem)}},i.prototype.isHint=function(a){if(a&&"object"==typeof a&&1===a.nodeType){var c=" "+a.className+" ";return c.indexOf(" "+b.autoCompltHintClass+" ")>=0}return!1},i.prototype.putHints=function(a){var b=0;if(a instanceof Array){var c,d,e=[];for(d=Math.min(a.length,this.maxHintNum),c=0;d>c;c++)e.push(h.buildHint(a[c],this.styles)),e[e.length-1]||e.pop();if(e.length>0){var f=document.createDocumentFragment();for(c=0,b=e.length;b>c;c++)f.appendChild(e[c]);this.clearHints(),this.genList(),this.uiElem.appendChild(f)}}return b},i.prototype.clearHints=function(){this.uiElem&&(this.uiElem.innerHTML="")},i.prototype.isOpen=function(){return this.uiElem?this.uiElem.getAttribute(b.listStatus.attr)==b.listStatus.open:!1},i.prototype.open=function(){var a;if(this.uiElem&&(a=this.uiElem.querySelectorAll("."+b.autoCompltHintClass))&&a.length){var c,d;for(d=this.assocInput.getBoundingClientRect(),this.uiElem.style.top=(document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)+d.bottom+"px",this.uiElem.style.left=d.left+"px",d=d.right-d.left-parseFloat(g(this.uiElem,"borderLeftWidth"))-parseFloat(g(this.uiElem,"borderRightWidth")),this.uiElem.style.width=d+"px",c=0,d=0;c<a.length;c++)d+=parseFloat(g(a[c],"height"))+parseFloat(g(a[c],"paddingTop"))+parseFloat(g(a[c],"paddingBottom")),a[c+1]&&(d+=Math.max(parseFloat(g(a[c],"marginBottom")),parseFloat(g(a[c+1],"marginTop"))));d+=parseFloat(g(a[0],"marginTop"))+parseFloat(g(a[a.length-1],"marginBottom")),this.uiElem.style.height=d+1+"px",this.uiElem.setAttribute(b.listStatus.attr,b.listStatus.open),this.uiElem.style.display="block"}},i.prototype.close=function(){this.uiElem&&!a&&(this.mouseOnList=!1,this.uiElem.parentNode.removeChild(this.uiElem),this.uiElem=null,d(this.assocInput).trigger("change"))},i.prototype.autoScroll=function(){var a=this.getSelected();if(a){var b,c=0,d=0,e=a.clientHeight,f=parseFloat(g(a,"marginTop")),h=parseFloat(g(a,"marginBottom"));for(b=a.previousSibling,d=e+(b?Math.max(f,h):f);b;)c+=e,b=b.previousSibling,c+=b?Math.max(f,h):f;(this.uiElem.clientHeight+this.uiElem.scrollTop-c<d||c-this.uiElem.scrollTop<d)&&(this.uiElem.scrollTop=c)}},i.prototype.select=function(a){if(this.uiElem){var c=null;if(this.isHint(a))c=a;else if("number"==typeof a&&(a>=0||-1===a)){var d=this.uiElem.querySelectorAll("."+b.autoCompltHintClass);d.length>0&&(c=+a,c=-1===c||c>d.length-1?d.length-1:c,c=d[c])}null!==c&&(this.deselect(),c.className+=" "+b.autoCompltHintSelectedClass,c.style.color=this.styles.autoCompltHintSelected.color,c.style.backgroundColor=this.styles.autoCompltHintSelected.backgroundColor)}},i.prototype.deselect=function(){if(this.uiElem){var a=this.getSelected();a&&(a.className=b.autoCompltHintClass,a.style.color=this.styles.autoCompltHint.color,a.style.backgroundColor=this.styles.autoCompltHint.backgroundColor)}},i.prototype.getSelected=function(){return this.uiElem?this.uiElem.querySelector("."+b.autoCompltHintSelectedClass)||null:null};var j=function(a){return"INPUT"==a.tagName?a.value:a.innerText},k=function(a,b){"INPUT"==a.tagName?a.value=b:a.innerText=b},l={enable:function(a,c){if(a&&1===a.nodeType&&!a.autoComplt){a.autoComplt={};var g=b.autoCompltDelay,h=!0,l="",m=null,n=new i(a),o=function(){if(j(this).length>0&&h&&"function"==typeof m&&l!==j(this)){var b={};b.call=function(){m.call(b.that,b.compltTarget,b.openHint)},b.that=a,b.compltTarget=l=j(this),b.openHint=function(c){if(b.compltTarget===l)if(n.putHints(c)){var e=d(a).offset();e.top+=a.offsetHeight+5,n.open(),d(n.uiElem).css("min-width",100),d(n.uiElem).offset(e)}else b.that.autoComplt.close()},setTimeout(b.call,g)}},p=function(){if(h){var a=n.getSelected();a?k(this,a.innerHTML):k(this,l)}},q=function(){n.mouseOnList&&"INPUT"==a.tagName&&(a.focus(),n.mouseOnList=!1),a.autoComplt.close()},r=function(c){if(h)if("keydown"==c.type){if(c.keyCode===b.keyCode.enter)return c.preventDefault();if(n.isOpen()&&(c.keyCode===b.keyCode.up||c.keyCode===b.keyCode.down)){var e=n.getSelected();c.keyCode===b.keyCode.up?(c.preventDefault(),e?e.previousSibling?n.select(e.previousSibling):n.deselect():n.select(-1)):c.keyCode===b.keyCode.down&&(c.preventDefault(),e?e.nextSibling?n.select(e.nextSibling):n.deselect():n.select(0)),n.autoScroll(),p.call(a)}}else if("keyup"==c.type){var f=!1;switch(c.keyCode){case b.keyCode.up:case b.keyCode.down:c.preventDefault();break;case b.keyCode.left:case b.keyCode.right:break;case b.keyCode.esc:n.isOpen()&&(a.value=l,a.autoComplt.close());break;case b.keyCode.enter:n.isOpen()&&(p.call(a),a.autoComplt.close(),d(a).trigger("change"));break;default:f=!0}f&&o.call(a)}};return a.autoComplt.setHintsFetcher=function(a){return"function"==typeof a?(m=a,!0):!1},a.autoComplt.config=function(a){if(a instanceof Object){var b,c={};return b=Math.floor(a.delay),b>0&&(g=c.delay=b),b=Math.floor(a.maxHintNum),b>0&&(n.maxHintNum=c.maxHintNum=b),c}return!1},a.autoComplt.setStyles=function(a,c){var d,e,f=!1;switch(a){case b.autoCompltListClass:d=n.styles.autoCompltList,e=b.adjStyleAttrs.autoCompltList;break;case b.autoCompltHintClass:d=n.styles.autoCompltHint,e=b.adjStyleAttrs.autoCompltHint;break;case b.autoCompltHintSelectedClass:d=n.styles.autoCompltHintSelected,e=b.adjStyleAttrs.autoCompltHintSelected}if(c instanceof Object&&d&&e)for(var g=0;g<e.length;g++)("string"==typeof c[e[g]]||"number"==typeof c[e[g]])&&(f||(f={}),f[e[g]]=d[e[g]]=c[e[g]]);return f},a.autoComplt.close=function(){l="",n.close()},a.autoComplt.enable=function(){h=!0},a.autoComplt.disable=function(){this.close(),h=!1},a.autoComplt.destroy=function(){f(a,"blur",q),f(a,"keyup",r),f(a,"keydown",r),this.close(),delete a.autoComplt},e(a,"blur",q),e(a,"keyup",r),e(a,"keydown",r),c instanceof Object&&(a.autoComplt.config(c),a.autoComplt.setHintsFetcher(c.hintsFetcher)),a}return null}};return l}();c.exports=e}),define("codemirror/addon/selection/mark-selection.js",[],function(a){"use strict";var b=a("codemirror/lib/codemirror");!function(a){function b(a){a.operation(function(){g(a)})}function c(a){a.state.markedSelection.length&&a.operation(function(){e(a)
})}function d(a,b,c,d){if(0!=j(b,c))for(var e=a.state.markedSelection,f=a.state.markedSelectionStyle,g=b.line;;){var k=g==b.line?b:i(g,0),l=g+h,m=l>=c.line,n=m?c:i(l,0),o=a.markText(k,n,{className:f});if(null==d?e.push(o):e.splice(d++,0,o),m)break;g=l}}function e(a){for(var b=a.state.markedSelection,c=0;c<b.length;++c)b[c].clear();b.length=0}function f(a){e(a);for(var b=a.listSelections(),c=0;c<b.length;c++)d(a,b[c].from(),b[c].to())}function g(a){if(!a.somethingSelected())return e(a);if(a.listSelections().length>1)return f(a);var b=a.getCursor("start"),c=a.getCursor("end"),g=a.state.markedSelection;if(!g.length)return d(a,b,c);var i=g[0].find(),k=g[g.length-1].find();if(!i||!k||c.line-b.line<h||j(b,k.to)>=0||j(c,i.from)<=0)return f(a);for(;j(b,i.from)>0;)g.shift().clear(),i=g[0].find();for(j(b,i.from)<0&&(i.to.line-b.line<h?(g.shift().clear(),d(a,b,i.to,0)):d(a,b,i.from,0));j(c,k.to)<0;)g.pop().clear(),k=g[g.length-1].find();j(c,k.to)>0&&(c.line-k.from.line<h?(g.pop().clear(),d(a,k.from,c)):d(a,k.to,c))}a.defineOption("styleSelectedText",!1,function(d,g,h){var i=h&&h!=a.Init;g&&!i?(d.state.markedSelection=[],d.state.markedSelectionStyle="string"==typeof g?g:"CodeMirror-selectedtext",f(d),d.on("cursorActivity",b),d.on("change",c)):!g&&i&&(d.off("cursorActivity",b),d.off("change",c),e(d),d.state.markedSelection=d.state.markedSelectionStyle=null)});var h=8,i=a.Pos,j=a.cmpPos}(b)}),define("codemirror/addon/edit/closebrackets",["codemirror/lib/codemirror"],function(a){var b=a("codemirror/lib/codemirror");!function(){function a(a,c){var d=a.getRange(b.Pos(c.line,c.ch-1),b.Pos(c.line,c.ch+1));return 2==d.length?d:null}function c(c){for(var d={name:"autoCloseBrackets",Backspace:function(d){if(d.somethingSelected())return b.Pass;var e=d.getCursor(),f=a(d,e);return f&&c.indexOf(f)%2==0?void d.replaceRange("",b.Pos(e.line,e.ch-1),b.Pos(e.line,e.ch+1)):b.Pass}},e="",f=0;f<c.length;f+=2)(function(a,c){function f(b){var d=b.getSelection();b.replaceSelection(a+d+c)}function h(a){var d=a.getCursor(),e=a.getRange(d,b.Pos(d.line,d.ch+1));return e!=c||a.somethingSelected()?b.Pass:void a.execCommand("goCharRight")}a!=c&&(e+=c),d["'"+a+"'"]=function(d){if("'"==a&&"comment"==d.getTokenAt(d.getCursor()).type)return b.Pass;if(d.somethingSelected())return f(d);if(a!=c||h(d)==b.Pass){var i=d.getCursor(),j=b.Pos(i.line,i.ch+1),k=d.getLine(i.line),l=k.charAt(i.ch),m=i.ch>0?k.charAt(i.ch-1):"";if(a==c&&b.isWordChar(m))return b.Pass;if(!(k.length==i.ch||e.indexOf(l)>=0||g.test(l)))return b.Pass;d.replaceSelection(a+c,{head:j,anchor:j}),d.execCommand("goCharRight")}},a!=c&&(d["'"+c+"'"]=h)})(c.charAt(f),c.charAt(f+1));return d}function d(c){return function(d){var e=d.getCursor(),f=a(d,e);return f&&c.indexOf(f)%2==0?void d.operation(function(){var a=b.Pos(e.line+1,0);d.replaceSelection("\n\n",{anchor:a,head:a},"+input"),d.execCommand("goLineDown"),d.indentLine(e.line+1,"add",!0),d.indentLine(e.line+2,"subtract",!0)}):b.Pass}}var e="()[]{}''\"\"",f="[]{}",g=/\s/;b.defineOption("autoCloseBrackets",!1,function(a,g,h){if(h!=b.Init&&h&&a.removeKeyMap("autoCloseBrackets"),g){var i=e,j=f;"string"==typeof g?i=g:"object"==typeof g&&(null!=g.pairs&&(i=g.pairs),null!=g.explode&&(j=g.explode));var k=c(i);j&&(k.Enter=d(j)),a.addKeyMap(k)}})}()}),define("codemirror/addon/edit/closetag",["codemirror/lib/codemirror"],function(a){var b=a("codemirror/lib/codemirror");!function(){function a(a){var c=a.getCursor(),g=a.getTokenAt(c),h=b.innerMode(a.getMode(),g.state),i=h.state;if("xml"!=h.mode.name||!i.tagName)return b.Pass;var j=a.getOption("autoCloseTags"),k="html"==h.mode.configuration,l="object"==typeof j&&j.dontCloseTags||k&&e,m="object"==typeof j&&j.indentTags||k&&f,n=i.tagName;g.end>c.ch&&(n=n.slice(0,n.length-g.end+c.ch));var o=n.toLowerCase();if(!n||"string"==g.type&&(g.end!=c.ch||!/[\"\']/.test(g.string.charAt(g.string.length-1))||1==g.string.length)||"tag"==g.type&&"closeTag"==i.type||g.string.indexOf("/")==g.string.length-1||l&&d(l,o)>-1||b.scanForClosingTag&&b.scanForClosingTag(a,c,n,Math.min(a.lastLine()+1,c.line+50)))return b.Pass;var p=m&&d(m,o)>-1,q=p?b.Pos(c.line+1,0):b.Pos(c.line,c.ch+1);a.replaceSelection(">"+(p?"\n\n":"")+"</"+n+">",{head:q,anchor:q}),a.execCommand("goCharRight"),p&&(a.indentLine(c.line+1,null,!0),a.indentLine(c.line+2,null))}function c(a){var c=a.getCursor(),d=a.getTokenAt(c),e=b.innerMode(a.getMode(),d.state),f=e.state;if("string"==d.type||"<"!=d.string.charAt(0)||d.start!=c.ch-1||"xml"!=e.mode.name)return b.Pass;var g=f.context&&f.context.tagName;g&&a.replaceSelection("/"+g+">","end")}function d(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;++c)if(a[c]==b)return c;return-1}b.defineOption("autoCloseTags",!1,function(d,e,f){if(f!=b.Init&&f&&d.removeKeyMap("autoCloseTags"),e){var g={name:"autoCloseTags"};("object"!=typeof e||e.whenClosing)&&(g["'/'"]=function(a){return c(a)}),("object"!=typeof e||e.whenOpening)&&(g["'>'"]=function(b){return a(b)}),d.addKeyMap(g)}});var e=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],f=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"]}()}),define("codemirror/addon/mode/overlay",[],function(a){"use strict";var b=a("codemirror/lib/codemirror");b.overlayMode=b.overlayParser=function(a,c,d){return{startState:function(){return{base:b.startState(a),overlay:b.startState(c),basePos:0,baseCur:null,overlayPos:0,overlayCur:null}},copyState:function(d){return{base:b.copyState(a,d.base),overlay:b.copyState(c,d.overlay),basePos:d.basePos,baseCur:null,overlayPos:d.overlayPos,overlayCur:null}},token:function(b,e){return b.start==e.basePos&&(e.base.lineBefore=e.lineBefore,e.base.lineAfter=e.lineAfter,e.baseCur=a.token(b,e.base),e.basePos=b.pos),b.start==e.overlayPos&&(b.pos=b.start,e.overlayCur=c.token(b,e.overlay),e.overlayPos=b.pos),b.pos=Math.min(e.basePos,e.overlayPos),b.eol()&&(e.basePos=e.overlayPos=0),null==e.overlayCur?e.baseCur:null!=e.baseCur&&d?e.baseCur+" "+e.overlayCur:e.overlayCur},indent:a.indent&&function(b,c){return a.indent(b.base,c)},electricChars:a.electricChars,innerMode:function(b){return{state:b.base,mode:a}},blankLine:function(b){a.blankLine&&a.blankLine(b.base),c.blankLine&&c.blankLine(b.overlay)}}}}),define("app/editor/MathBlock",["codemirror/lib/codemirror","jquery/jquery","exoskeleton-master/exoskeleton","app/document/Node","app/document/StringUtils","codemirror/addon/display/placeholder","codemirror/mode/stex/stex","app/editor/UndoManager","app/editor/KeyMaster"],function(a,b,c){"use strict";var d,e=a("codemirror/lib/codemirror"),f=a("jquery/jquery"),g=a("exoskeleton-master/exoskeleton"),h=a("app/document/Node"),i=h.Node,j=(a("codemirror/addon/display/placeholder"),a("codemirror/mode/stex/stex"),a("app/editor/UndoManager"),a("app/document/StringUtils")),k=a("app/editor/KeyMaster"),l=k.map,m=g.Model.extend({initialize:function(a){this.editor=a,this.queue={},this.preview,this.bindEvent()},bindEvent:function(){var a=this,b=this.editor;f(this.editor.sessionStr).on("mousedown","[cid].mathjax-block",function(b){return 1==b.which?(a.startEditing(f(this)),!1):void 0}).on("click mousedown",".jax-trigger-delete-button",function(){a.remove(f(this).closest("[cid]"))}).on("click",".jax-trigger-finish-button",function(){a.stopEditing(a.currentCm.cid),window.getSelection().removeAllRanges(),b.refocus(null)}).on("losefocus",".md-mathjax-panel",function(){a.stopEditing(this.getAttribute("cid"))}).on("keydown",".mathjax-block",function(b){var c=event.keyCode||event.which;return"Enter"===l[c]?(a.startEditing(f(this)),b.stopPropagation(),b.preventDefault()):void 0})},renderAll:function(){var a=document.querySelectorAll(".mathjax-block");q()&&(d.labels=d.eqlabels=d.IDs=d.eqIDs={});for(var b=0;b<a.length;b++){var c=a[b],e=this.editor.getNode(c.getAttribute("cid"));MathJax.Hub.Queue(["BeforeRender",r,e,!0],["Typeset",MathJax.Hub,c.getAttribute("id")],["AfterRender",r,e])}},getTex:function(a){return this.editor.findElemById(a).find("script").text()},getCidAndElem:function(a){var b=a,c=a;return"string"==typeof a?c=this.editor.findElemById(b):b=c.attr("cid"),[b,c]},syncToNode:function(a){var b="string"==typeof a?this.editor.getNode(a):a;(this.currentCm||{}).cid===b.cid?(b.set("history",this.currentCm.doc.history),b.set("text",this.currentCm.getValue())):b.set("text",this.getTex(b.cid))},remove:function(a){var b,c=this.getCidAndElem(a),d=c[0],e=c[1],g=editor.getNode(d),h=editor.undo.UndoManager,j=h.makeEmptyCommand(),k=(g.get("before"),this.currentCm);this.editor.undo.completeSnap(!0),this.beforeDeleteFences(g),j.undo.push(k&&k.cid===g.cid?{type:"fences-pos",pos:k.getCursor(),id:k.cid}:this.editor.selection.buildUndo()),j.undo.push(h.buildReplaceUndo(g)),g.set("type",g.TYPE.paragraph),g.set("text",""),i.normalizeNode(g),j.redo.push(h.buildReplaceUndo(g)),b=f(f.parseHTML(g.toHTML())[0]),e.replaceWith(b),editor.selection.jumpIntoElemEnd(b),j.redo.push(editor.selection.buildUndo()),editor.undo.register(j),this.currentCm=void 0},deletionMonitor:function(a){var b=this;a.find(".md-mathjax-panel[cid]").toArray().map(function(a){b.currentCm.cid===a.getAttribute("cid")&&this.beforeDeleteFences(a.getAttribute("cid"))})},beforeDeleteFences:function(a,b){var c=this.editor.getNode(a);this.syncToNode(a),this.currentCm=void 0,b&&b.map(function(a){a&&(a.id==c.id&&a.json&&a.json.content&&a.json.content.type==c.TYPE.math_block?(a.json.content.text=c.get("text"),a.json.content.history=c.get("history")):Array.isArray(a.json)&&a.json.map(function(a){a.id==c.id&&a.content.type==c.TYPE.math_block&&(a.content.text=c.get("text"),a.content.history=c.get("history"))}))})},stopEditing:function(a){if(a=a||(this.currentCm||{}).cid){var b=this.getCidAndElem(a),c=b[0],d=b[1],e=d[0].querySelectorAll(".mathjax-candidate"),g="hidden"===e[0].style.visibility?e[1]:e[0];this.syncToNode(c),g.className="mathjax-block",g.setAttribute("cid",c),g.setAttribute("mdtype","math_block"),g.setAttribute("id","math-jax"+c),d.replaceWith(f(g)),this.currentCm=void 0}},startEditing:function(a){function b(a,b,c){var d=a.querySelector(".CodeMirror").CodeMirror,e=a.querySelector(".md-mathjax-preview");e.textContent="$$\n"+d.getValue()+"\n$$",MathJax.Hub.Queue(["BeforeRender",r,c,!1],["Typeset",MathJax.Hub,e]),r.Init(e,a.querySelector(".md-mathjax-buffer"),function(){var a=b.doc.getValue().trim();return"$$\n"+(a||"<Empty \\space Math \\space Block>")+"\n$$"},c),r.Update()}function c(a){var b=e(k[0].querySelector(".md-mathjax-input"),{styleSelectedText:!0,lineWrapping:!0,mode:"stex",placeholder:"Input Math Tex here",theme:" inner",autoCloseBrackets:!File.option.noPairingMatch,value:j.get("text").trim()},a,g);return j.get("history")&&b.setHistory(j.get("history")),b.doc.on("change",function(){r.Update()}),b.on("blur",function(a){try{j.set("history",a.doc.history),j.set("text",a.getValue())}catch(b){console.warn(b.stack)}}),b.on("focus",function(){a.undo.completeSnap(!0),a.refocus(j.id)}),b.on("keydown",function(b,c){var d=c.which||c.keyCode;if("Up"==e.keyNames[d])return a.selection.moveUpOrDown(!0,c),c.codemirrorIgnore;if("Down"==e.keyNames[d])return a.selection.moveUpOrDown(!1,c),c.codemirrorIgnore;if("Backspace"==e.keyNames[d]){if(!b.getValue().length)return a.mathBlock.remove(b.cid),c.preventDefault(),c.codemirrorIgnore}else if("Enter"==e.keyNames[d]&&(c.ctrlKey||c.metaKey)){var f=b.cid;return a.mathBlock.stopEditing(b.cid),c.stopPropagation(),a.findElemById(f).focus(),a.UserOp.insertParagraph(),c.codemirrorIgnore}var g=e.keyName(c);i.isType(e.keyMap.macDefault[g]||e.keyMap.pcDefault[g],"undo","redo")||c.stopPropagation()}),a.refocus(j.id),b.focus(),b}var d=this.getCidAndElem(a),g=d[0],h=d[1],j=(this.editor,this.editor.getNode(g));if(g)if(this.currentCm&&this.currentCm.cid===g)this.currentCm.focus();else{this.currentCm&&(this.stopEditing(this.currentCm.cid),this.editor.refocus(null));var k=f("#componenet>.md-mathjax-panel").clone(!0).attr("cid",g);k.children(".code-tooltip-p").removeClass("code-tooltip-p").addClass("code-tooltip"),h.replaceWith(k),this.currentCm=c(this.editor),b(k[0],this.currentCm,j),this.currentCm.focus(),this.currentCm.execCommand("<Empty \\space Math \\space Block>"==this.currentCm.getValue()?"selectAll":"goDocEnd")}return this.currentCm},copyAsTex:function(){var a=f(document.activeElement).closest("[cid]").find("script")[0].textContent.trim();console.debug(a),this.editor.UserOp.setClipboard(null,null,a,!0)},copyAsMathML:function(){var a=MathJax.Hub.getAllJax(f(document.activeElement).closest("[cid]")[0])[0],b=this.editor;n(a,function(a){console.debug(a),b.UserOp.setClipboard("<pre class='md-fences' lang='xml'>"+j.escape(a)+"</pre>",null,a,!0)})},copyAsImage:function(){var a=document.activeElement.querySelector("svg"),b=this.editor;b.UserOp.setClipboard(b.EditHelper.SVG2HtmlImg(a),null,null,!0)}}),n=function(a,b){var c;try{c=a.root.toMathML("")}catch(d){if(!d.restart)throw d;return MathJax.Callback.After([n,a,b],d.restart)}MathJax.Callback(b)(c)},o=[],p=[],q=function(){return d=MathJax.Extension["TeX/AMSmath"]},r={delay:0,preview:null,buffer:null,timeout:null,mjRunning:!1,oldText:null,maxIgnored:3,curIgnored:0,Init:function(a,b,c,d){this.preview=a,this.buffer=b,this.getTextFunc=c,this.node=d},SwapBuffers:function(){var a=this.preview,b=this.buffer;this.buffer=a,this.preview=b,a.style.visibility="hidden",a.style.position="absolute",b.style.position="",b.style.visibility=""},Update:function(){this.callback()},CreatePreview:function(){if(this.curIgnored=0,r.timeout=null,!this.mjRunning){var a=this.getTextFunc();a!==this.oldtext&&(this.buffer.textContent=this.oldtext=a,this.mjRunning=!0,MathJax.Hub.Queue(["BeforeRender",this,this.node,!1],["Typeset",MathJax.Hub,this.buffer],["AfterRender",this,this.node],["PreviewDone",this,this.node]))}},PreviewDone:function(){this.mjRunning=!1,this.SwapBuffers()},BeforeRender:function(a,b){q()&&(b?(a.unset("mathLabel"),a.unset("mathEqLabel")):((a.get("mathLabel")||[]).map(function(a){delete d.labels[a]}),(a.get("mathEqLabel")||[]).map(function(a){delete d.eqlabels[a]})),o=Object.keys(d.labels).clone(),p=Object.keys(d.eqlabels).clone())},AfterRender:function(a){if(q()){var b=[],c=[];for(var e in d.labels)-1==o.indexOf(e)&&b.push(e);for(var f in d.eqlabels)-1==p.indexOf(f)&&c.push(f);a.set("mathLabel",b),a.set("mathEqLabel",c)}}};r.callback=MathJax.Callback(["CreatePreview",r]),r.callback.autoReset=!0,m.Preview=r,c.exports=m}),define("codemirror/addon/display/placeholder",["codemirror/lib/codemirror"],function(a){"use strict";var b=a("codemirror/lib/codemirror");!function(){function a(a){a.state.placeholder&&(a.state.placeholder.parentNode.removeChild(a.state.placeholder),a.state.placeholder=null)}function c(b){a(b);var c=b.state.placeholder=document.createElement("pre");c.style.cssText="height: 0; overflow: visible",c.className="CodeMirror-placeholder",c.appendChild(document.createTextNode(b.getOption("placeholder"))),b.display.lineSpace.insertBefore(c,b.display.lineSpace.firstChild)}function d(a){f(a)&&c(a)}function e(b){var d=b.getWrapperElement(),e=f(b);d.className=d.className.replace(" CodeMirror-empty","")+(e?" CodeMirror-empty":""),e?c(b):a(b)}function f(a){return 1===a.lineCount()&&""===a.getLine(0)}b.defineOption("placeholder","",function(c,f,g){var h=g&&g!=b.Init;if(f&&!h)c.on("blur",d),c.on("change",e),e(c);else if(!f&&h){c.off("blur",d),c.off("change",e),a(c);var i=c.getWrapperElement();i.className=i.className.replace(" CodeMirror-empty","")}f&&!c.hasFocus()&&d(c)})}()}),define("codemirror/mode/stex/stex",[],function(a){var b=a("codemirror/lib/codemirror");b.defineMode("stex",function(){function a(a,b){a.cmdState.push(b)}function b(a){return a.cmdState.length>0?a.cmdState[a.cmdState.length-1]:null}function c(a){var b=a.cmdState.pop();b&&b.closeBracket()}function d(a){for(var b=a.cmdState,c=b.length-1;c>=0;c--){var d=b[c];if("DEFAULT"!=d.name)return d}return{styleIdentifier:function(){return null}}}function e(a,b,c){return function(){this.name=a,this.bracketNo=0,this.style=b,this.styles=c,this.argument=null,this.styleIdentifier=function(){return this.styles[this.bracketNo-1]||null},this.openBracket=function(){return this.bracketNo++,"bracket"},this.closeBracket=function(){}}}function f(a,b){a.f=b}function g(c,e){var g;if(c.match(/^\\[a-zA-Z@]+/)){var l=c.current().slice(1);return g=k[l]||k.DEFAULT,g=new g,a(e,g),f(e,j),g.style}if(c.match(/^\\[$&%#{}_]/))return"tag";if(c.match(/^\\[,;!\/\\]/))return"tag";if(c.match("\\["))return f(e,function(a,b){return i(a,b,"\\]")}),"keyword";if(c.match("$$"))return f(e,function(a,b){return i(a,b,"$$")}),"keyword";if(c.match("$"))return f(e,function(a,b){return i(a,b,"$")}),"keyword";var m=c.next();return"%"==m?(c.eol()||f(e,h),"comment"):"}"==m||"]"==m?(g=b(e))?(g.closeBracket(m),f(e,j),"bracket"):"error":"{"==m||"["==m?(g=k.DEFAULT,g=new g,a(e,g),"bracket"):/\d/.test(m)?(c.eatWhile(/[\w.%]/),"atom"):(c.eatWhile(/[\w\-_]/),g=d(e),"begin"==g.name&&(g.argument=c.current()),g.styleIdentifier())}function h(a,b){return a.skipToEnd(),f(b,g),"comment"}function i(a,b,c){if(a.eatSpace())return null;if(a.match(c))return f(b,g),"keyword";if(a.match(/^\\[a-zA-Z@]+/))return"tag";if(a.match(/^[a-zA-Z]+/))return"variable-2";if(a.match(/^\\[$&%#{}_]/))return"tag";if(a.match(/^\\[,;!\/]/))return"tag";if(a.match(/^[\^_&]/))return"tag";if(a.match(/^[+\-<>|=,\/@!*:;'"`~#?]/))return null;if(a.match(/^(\d+\.\d*|\d*\.\d+|\d+)/))return"number";var d=a.next();return"{"==d||"}"==d||"["==d||"]"==d||"("==d||")"==d?"bracket":"%"==d?(a.eol()||a.skipToEnd(),"comment"):"error"}function j(a,d){var e,h=a.peek();return"{"==h||"["==h?(e=b(d),e.openBracket(h),a.eat(h),f(d,g),"bracket"):/[ \t\r]/.test(h)?(a.eat(h),null):(f(d,g),c(d),g(a,d))}var k={};return k.importmodule=e("importmodule","tag",["string","builtin"]),k.documentclass=e("documentclass","tag",["","atom"]),k.usepackage=e("usepackage","tag",["atom"]),k.begin=e("begin","tag",["atom"]),k.end=e("end","tag",["atom"]),k.DEFAULT=function(){this.name="DEFAULT",this.style="tag",this.styleIdentifier=this.openBracket=this.closeBracket=function(){}},{startState:function(){return{cmdState:[],f:g}},copyState:function(a){return{cmdState:a.cmdState.slice(),f:a.f}},token:function(a,b){return b.f(a,b)}}}),b.defineMIME("text/x-stex","stex"),b.defineMIME("text/x-latex","stex")}),define("app/editor/MathInline",["jquery/jquery","exoskeleton-master/exoskeleton","app/document/Node","app/document/StringUtils","app/editor/UndoManager","app/editor/KeyMaster","app/editor/EditHelper","rangy/rangy-core","rangy/rangy-classapplier"],function(a,b,c){"use strict";{var d=a("jquery/jquery"),e=a("exoskeleton-master/exoskeleton"),f=a("app/document/Node"),g=(f.Node,a("app/editor/UndoManager"),a("app/editor/KeyMaster")),h=a("app/editor/EditHelper"),i=(g.map,a("app/document/StringUtils")),j=a("rangy/rangy-core.js");a("rangy/rangy-classapplier"),/Apple Computer/.test(navigator.vendor)}window.svgCache={};var k=function(a){var b=d(a),c=b.textExcludeSVG().replace(/\u200B*/g,"");if(!/^\$+$/.exec(c))return MathJax.Hub.Queue(["Typeset",MathJax.Hub,a],function(){if(a.querySelector(".noError")&&a.querySelector("script").classList.add("math-jax-error"),!a.classList.contains("math-jax-postprocess")){var d=b.parent().attr("pattern")||"$",e=b.removeClass("math-jax-preprocess").addClass("math-jax-postprocess").before("<span class='md-before md-meta'>"+d+"</span>").after("<span class='md-math-after-sym'></span><span class='md-after md-meta'>"+d+"</span>")[0].innerHTML;svgCache[c]=e.replace(" xlink="," xmlns:xlink=").replace(/NS\d+:href/g,"xlink:href")}}),!0},l=function(a,b,c){if(b.length){MathJax.Hub.Queue(function(){a.brush.pause()}),MathJax.Hub.Queue(["setRenderer",MathJax.Hub,"SVG"]);for(var d=0;d<b.length;d++)k(b[d]);c&&MathJax.Hub.Queue(function(){a.undo.exeCommand(c)}),MathJax.Hub.Queue(function(){a.brush.resume()})}},m=function(){var a=this.editor;d(this.editor.sessionStr).on("cursorChange",function(b){var c,e=b.cursor||a.selection.getRangy();return e?(c=d(e.commonAncestorContainer).closest(".md-inline-math.md-expand"),void(c.length?o(a,c):p(a))):p(a)}).on("mousedown",".md-inline-math svg",function(){p(a),d(".md-expand").removeClass("md-expand");var b=d(this).closest(".md-inline-math"),c=b.addClass("md-expand").find("script");a.selection.selectAllElem(c),o(a,b)})},n=null,o=function(a,b){var c=d("#math-inline-preview"),e=d("#math-inline-preview-content"),f=b.clone().find("svg").remove().end().text();n=function(){var b=MathJax.Hub.getAllJax(e[0])[0],f=d(".md-inline-math.md-expand"),g=f.attr("pattern"),i=f.find("script"),j=(i.text()||f.find(".math-jax-preprocess").text()).replace(/\u200B*/g,""),k=n;if(b)return i.height()?void(svgCache[j]||MathJax.Hub.Queue(["Text",b,j.replace("$$"==g?/(^\$\$)|(\$\$$)/g:/(^\$)|(\$$)/g,"")],function(){h.fixPopoverPosition(i,c)})):d(a.sessionStr).off("inline-math-changed",k)},(c.hasClass("md-math-inline-prep-preview")||"none"===c[0].style.display)&&/^\$/.exec(f)&&(c.removeClass("md-math-inline-prep-preview"),MathJax.Hub.Queue(["setRenderer",MathJax.Hub,"SVG"]),e.text(f),MathJax.Hub.Queue(["Typeset",MathJax.Hub,e[0]],function(){c.show(),h.fixPopoverPosition(b.find("script"),c),d(a.sessionStr).on("inline-math-changed",n)}))},p=function(a){var b=d("#math-inline-preview");"none"!==b[0].style.display&&b.hide(),n&&(d(a.sessionStr).off("inline-math-changed",n),n=null)},q=function(){var a=this.editor.selection.getRangy();return d(a.commonAncestorContainer).closest(".md-inline-math")},r=function(a,b){var c;try{c=a.root.toMathML("")}catch(d){if(!d.restart)throw d;return MathJax.Callback.After([r,a,b],d.restart)}MathJax.Callback(b)(c)},s=e.Model.extend({initialize:function(a){this.editor=a,this.queue={},m.call(this),this.mathPrepApplier=j.createClassApplier("md-math-prep")},brush:function(a,b){var c=a.querySelectorAll(".math-jax-preprocess");return l.call(this,this.editor,c,b&&a.getAttribute("cid")===b.startId?b:null),c.length},showAutoSuggest:function(a){if(File.option.enableInlineMath){d(".md-math-prep").removeClass("md-math-prep"),this.mathPrepApplier.applyToRange(a);var b=d("#math-inline-preview").show().addClass("md-math-inline-prep-preview").css("width","auto");b.find("#math-inline-preview-content").text("<Empty Inline Math>"),h.fixPopoverPosition(d(".md-math-prep"),b)}},renderAll:function(){var a=document.querySelectorAll(".math-jax-preprocess");l.call(this,this.editor,a)},tryCloseInlinePreview:function(){p(this.editor)},copyAsTex:function(){var a=q.call(this),b=a.attr("pattern"),c=a.text().replace("$$"==b?/(^\$\$)|(\$\$$)/g:/(^\$)|(\$$)/g,"");console.debug(c),this.editor.UserOp.setClipboard(null,null,c,!0)},copyAsMathML:function(){var a=d("#math-inline-preview-content")[0],b=MathJax.Hub.getAllJax(a)[0],c=this.editor;r(b,function(a){console.debug(a),c.UserOp.setClipboard("<pre class='md-fences' lang='xml'>"+i.escape(a)+"</pre>",null,a,!0)})},copyAsImage:function(){var a=document.querySelector("#math-inline-preview-content svg"),b=this.editor;b.UserOp.setClipboard(b.EditHelper.SVG2HtmlImg(a),null,null,!0)}});c.exports=s}),define("rangy/rangy-classapplier",[],function(a){"use strict";var b=a("rangy/rangy-core");!function(a){a.createModule("ClassApplier",["WrappedSelection"],function(a,b){function c(a,b){for(var c in a)if(a.hasOwnProperty(c)&&b(c,a[c])===!1)return!1;return!0}function d(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function e(a,b){return a.className&&new RegExp("(?:^|\\s)"+b+"(?:\\s|$)").test(a.className)}function f(a,b){a.className?e(a,b)||(a.className+=" "+b):a.className=b}function g(a){return a&&a.split(/\s+/).sort().join(" ")}function h(a){return g(a.className)}function i(a,b){return h(a)==h(b)}function j(a,b,c,d,e){var f=a.node,g=a.offset,h=f,i=g;f==d&&g>e&&++i,f!=b||g!=c&&g!=c+1||(h=d,i+=e-c),f==b&&g>c+1&&--i,a.node=h,a.offset=i}function k(a,b,c){a.node==b&&a.offset>c&&--a.offset}function l(a,b,c,d){-1==c&&(c=b.childNodes.length);for(var e,f=a.parentNode,g=H.getNodeIndex(a),h=0;e=d[h++];)j(e,f,g,b,c);b.childNodes.length==c?b.appendChild(a):b.insertBefore(a,b.childNodes[c])}function m(a,b){for(var c,d=a.parentNode,e=H.getNodeIndex(a),f=0;c=b[f++];)k(c,d,e);a.parentNode.removeChild(a)}function n(a,b,c,d,e){for(var f,g=[];f=a.firstChild;)l(f,b,c++,e),g.push(f);return d&&m(a,e),g}function o(a,b){return n(a,a.parentNode,H.getNodeIndex(a),!0,b)}function p(a,b){var c=a.cloneRange();c.selectNodeContents(b);var d=c.intersection(a),e=d?d.toString():"";return""!=e}function q(a){for(var b,c=a.getNodes([3]),d=0;(b=c[d])&&!p(a,b);)++d;for(var e=c.length-1;(b=c[e])&&!p(a,b);)--e;return c.slice(d,e+1)}function r(a,b){if(a.attributes.length!=b.attributes.length)return!1;for(var c,d,e,f=0,g=a.attributes.length;g>f;++f)if(c=a.attributes[f],e=c.name,"class"!=e){if(d=b.attributes.getNamedItem(e),null===c!=(null===d))return!1;if(c.specified!=d.specified)return!1;if(c.specified&&c.nodeValue!==d.nodeValue)return!1}return!0}function s(a,b){for(var c,d=0,e=a.attributes.length;e>d;++d)if(c=a.attributes[d].name,(!b||!J(b,c))&&a.attributes[d].specified&&"class"!=c)return!0;return!1}function t(a,b){return c(b,function(b,c){if("object"==typeof c){if(!t(a[b],c))return!1}else if(a[b]!==c)return!1})}function u(a){var b;return a&&1==a.nodeType&&((b=a.parentNode)&&9==b.nodeType&&"on"==b.designMode||O(a)&&!O(a.parentNode))}function v(a){return(O(a)||1!=a.nodeType&&O(a.parentNode))&&!u(a)}function w(a){return a&&1==a.nodeType&&!P.test(N(a,"display"))}function x(a){if(0==a.data.length)return!0;if(Q.test(a.data))return!1;var b=N(a.parentNode,"whiteSpace");switch(b){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(a.data))return!1}return w(a.previousSibling)||w(a.nextSibling)}function y(a){var b,c,d=[];for(b=0;c=a[b++];)d.push(new I(c.startContainer,c.startOffset),new I(c.endContainer,c.endOffset));return d}function z(a,b){for(var c,d,e,f=0,g=a.length;g>f;++f)c=a[f],d=b[2*f],e=b[2*f+1],c.setStartAndEnd(d.node,d.offset,e.node,e.offset)}function A(a,b){return H.isCharacterDataNode(a)?0==b?!!a.previousSibling:b==a.length?!!a.nextSibling:!0:b>0&&b<a.childNodes.length}function B(a,c,d,e){var f,g,h=0==d;if(H.isAncestorOf(c,a))return a;if(H.isCharacterDataNode(c)){var i=H.getNodeIndex(c);if(0==d)d=i;else{if(d!=c.length)throw b.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+d+" in "+c.data);d=i+1}c=c.parentNode}if(A(c,d)){f=c.cloneNode(!1),g=c.parentNode,f.id&&f.removeAttribute("id");for(var j,k=0;j=c.childNodes[d];)l(j,f,k++,e);return l(f,g,H.getNodeIndex(c)+1,e),c==a?f:B(a,g,H.getNodeIndex(f),e)}if(a!=c){f=c.parentNode;var m=H.getNodeIndex(c);return h||m++,B(a,f,m,e)}return a}function C(a,b){return a.namespaceURI==b.namespaceURI&&a.tagName.toLowerCase()==b.tagName.toLowerCase()&&i(a,b)&&r(a,b)&&"inline"==N(a,"display")&&"inline"==N(b,"display")}function D(a){var b=a?"nextSibling":"previousSibling";return function(c,d){var e=c.parentNode,f=c[b];if(f){if(f&&3==f.nodeType)return f}else if(d&&(f=e[b],f&&1==f.nodeType&&C(e,f))){var g=f[a?"firstChild":"lastChild"];if(g&&3==g.nodeType)return g}return null}}function E(a){this.isElementMerge=1==a.nodeType,this.textNodes=[];var b=this.isElementMerge?a.lastChild:a;b&&(this.textNodes[0]=b)}function F(a,b,e){var f,g,h,i,j=this;j.cssClass=j.className=a;var k=null,l={};if("object"==typeof b&&null!==b){for(e=b.tagNames,k=b.elementProperties,l=b.elementAttributes,g=0;i=T[g++];)b.hasOwnProperty(i)&&(j[i]=b[i]);f=b.normalize}else f=b;j.normalize="undefined"==typeof f?!0:f,j.attrExceptions=[];var m=document.createElement(j.elementTagName);j.elementProperties=j.copyPropertiesToElement(k,m,!0),c(l,function(a){j.attrExceptions.push(a)}),j.elementAttributes=l,j.elementSortedClassName=j.elementProperties.hasOwnProperty("className")?j.elementProperties.className:a,j.applyToAnyTagName=!1;var n=typeof e;if("string"==n)"*"==e?j.applyToAnyTagName=!0:j.tagNames=d(e.toLowerCase()).split(/\s*,\s*/);else if("object"==n&&"number"==typeof e.length)for(j.tagNames=[],g=0,h=e.length;h>g;++g)"*"==e[g]?j.applyToAnyTagName=!0:j.tagNames.push(e[g].toLowerCase());else j.tagNames=[j.elementTagName]}function G(a,b,c){return new F(a,b,c)}var H=a.dom,I=H.DomPosition,J=H.arrayContains,K=H.isHtmlNamespace,L="span",M=function(){function a(a,b,c){return b&&c?" ":""}return function(b,c){b.className&&(b.className=b.className.replace(new RegExp("(^|\\s)"+c+"(\\s|$)"),a))}}(),N=H.getComputedStyleProperty,O=function(){var a=document.createElement("div");return"boolean"==typeof a.isContentEditable?function(a){return a&&1==a.nodeType&&a.isContentEditable}:function(a){return a&&1==a.nodeType&&"false"!=a.contentEditable?"true"==a.contentEditable||O(a.parentNode):!1}}(),P=/^inline(-block|-table)?$/i,Q=/[^\r\n\t\f \u200B]/,R=D(!1),S=D(!0);E.prototype={doMerge:function(a){var b=this.textNodes,c=b[0];if(b.length>1){for(var d,e,f,g,h=H.getNodeIndex(c),i=[],j=0,k=0,l=b.length;l>k;++k){if(d=b[k],e=d.parentNode,k>0&&(e.removeChild(d),e.hasChildNodes()||e.parentNode.removeChild(e),a))for(f=0;g=a[f++];)g.node==d&&(g.node=c,g.offset+=j),g.node==e&&g.offset>h&&(--g.offset,g.offset==h+1&&l-1>k&&(g.node=c,g.offset=j));i[k]=d.data,j+=d.data.length}c.data=i.join("")}return c.data},getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){for(var a=[],b=0,c=this.textNodes.length;c>b;++b)a[b]="'"+this.textNodes[b].data+"'";return"[Merge("+a.join(",")+")]"}};var T=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],U={};F.prototype={elementTagName:L,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(a,b,c){var d,e,h,i,j,k,l={};for(var m in a)if(a.hasOwnProperty(m))if(i=a[m],j=b[m],"className"==m)f(b,i),f(b,this.className),b[m]=g(b[m]),c&&(l[m]=b[m]);else if("style"==m){e=j,c&&(l[m]=h={});for(d in a[m])e[d]=i[d],c&&(h[d]=e[d]);this.attrExceptions.push(m)}else b[m]=i,c&&(l[m]=b[m],k=U.hasOwnProperty(m)?U[m]:m,this.attrExceptions.push(k));return c?l:""},copyAttributesToElement:function(a,b){for(var c in a)a.hasOwnProperty(c)&&b.setAttribute(c,a[c])},hasClass:function(a){return 1==a.nodeType&&J(this.tagNames,a.tagName.toLowerCase())&&e(a,this.className)},getSelfOrAncestorWithClass:function(a){for(;a;){if(this.hasClass(a))return a;a=a.parentNode}return null},isModifiable:function(a){return!this.applyToEditableOnly||v(a)},isIgnorableWhiteSpaceNode:function(a){return this.ignoreWhiteSpace&&a&&3==a.nodeType&&x(a)},postApply:function(a,b,c,d){for(var e,f,g,h=a[0],i=a[a.length-1],j=[],k=h,l=i,m=0,n=i.length,o=0,p=a.length;p>o;++o)f=a[o],g=R(f,!d),g?(e||(e=new E(g),j.push(e)),e.textNodes.push(f),f===h&&(k=e.textNodes[0],m=k.length),f===i&&(l=e.textNodes[0],n=e.getLength())):e=null;var q=S(i,!d);if(q&&(e||(e=new E(i),j.push(e)),e.textNodes.push(q)),j.length){for(o=0,p=j.length;p>o;++o)j[o].doMerge(c);b.setStartAndEnd(k,m,l,n)}},createContainer:function(a){var b=a.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,b,!1),this.copyAttributesToElement(this.elementAttributes,b),f(b,this.className),this.onElementCreate&&this.onElementCreate(b,this),b},applyToTextNode:function(a){var b=a.parentNode;if(1==b.childNodes.length&&this.useExistingElements&&K(b)&&J(this.tagNames,b.tagName.toLowerCase())&&t(b,this.elementProperties))f(b,this.className);else{var c=this.createContainer(H.getDocument(a));a.parentNode.insertBefore(c,a),c.appendChild(a)}},isRemovable:function(a){return K(a)&&a.tagName.toLowerCase()==this.elementTagName&&h(a)==this.elementSortedClassName&&t(a,this.elementProperties)&&!s(a,this.attrExceptions)&&this.isModifiable(a)},isEmptyContainer:function(a){var b=a.childNodes.length;return 1==a.nodeType&&this.isRemovable(a)&&(0==b||1==b&&this.isEmptyContainer(a.firstChild))},removeEmptyContainers:function(a){for(var b,c=this,d=a.getNodes([1],function(a){return c.isEmptyContainer(a)
}),e=[a],f=y(e),g=0;b=d[g++];)m(b,f);z(e,f)},undoToTextNode:function(a,b,c,d){if(!b.containsNode(c)){var e=b.cloneRange();e.selectNode(c),e.isPointInRange(b.endContainer,b.endOffset)&&(B(c,b.endContainer,b.endOffset,d),b.setEndAfter(c)),e.isPointInRange(b.startContainer,b.startOffset)&&(c=B(c,b.startContainer,b.startOffset,d))}this.isRemovable(c)?o(c,d):M(c,this.className)},applyToRange:function(a,b){b=b||[];var c=y(b||[]);a.splitBoundariesPreservingPositions(c),this.removeEmptyElements&&this.removeEmptyContainers(a);var d=q(a);if(d.length){for(var e,f=0;e=d[f++];)this.isIgnorableWhiteSpaceNode(e)||this.getSelfOrAncestorWithClass(e)||!this.isModifiable(e)||this.applyToTextNode(e,c);e=d[d.length-1],a.setStartAndEnd(d[0],0,e,e.length),this.normalize&&this.postApply(d,a,c,!1),z(b,c)}},applyToRanges:function(a){for(var b=a.length;b--;)this.applyToRange(a[b],a);return a},applyToSelection:function(b){var c=a.getSelection(b);c.setRanges(this.applyToRanges(c.getAllRanges()))},undoToRange:function(a,b){b=b||[];var c=y(b);a.splitBoundariesPreservingPositions(c),this.removeEmptyElements&&this.removeEmptyContainers(a,c);var d,e,f=q(a),g=f[f.length-1];if(f.length){for(var h=0,i=f.length;i>h;++h)d=f[h],e=this.getSelfOrAncestorWithClass(d),e&&this.isModifiable(d)&&this.undoToTextNode(d,a,e,c),a.setStartAndEnd(f[0],0,g,g.length);this.normalize&&this.postApply(f,a,c,!0),z(b,c)}},undoToRanges:function(a){for(var b=a.length;b--;)this.undoToRange(a[b],a);return a},undoToSelection:function(b){var c=a.getSelection(b),d=a.getSelection(b).getAllRanges();this.undoToRanges(d),c.setRanges(d)},isAppliedToRange:function(a){if(a.collapsed||""==a.toString())return!!this.getSelfOrAncestorWithClass(a.commonAncestorContainer);var b=a.getNodes([3]);if(b.length)for(var c,d=0;c=b[d++];)if(!this.isIgnorableWhiteSpaceNode(c)&&p(a,c)&&this.isModifiable(c)&&!this.getSelfOrAncestorWithClass(c))return!1;return!0},isAppliedToRanges:function(a){var b=a.length;if(0==b)return!1;for(;b--;)if(!this.isAppliedToRange(a[b]))return!1;return!0},isAppliedToSelection:function(b){var c=a.getSelection(b);return this.isAppliedToRanges(c.getAllRanges())},toggleRange:function(a){this.isAppliedToRange(a)?this.undoToRange(a):this.applyToRange(a)},toggleSelection:function(a){this.isAppliedToSelection(a)?this.undoToSelection(a):this.applyToSelection(a)},getElementsWithClassIntersectingRange:function(a){var b=[],c=this;return a.getNodes([3],function(a){var d=c.getSelfOrAncestorWithClass(a);d&&!J(b,d)&&b.push(d)}),b},detach:function(){}},F.util={hasClass:e,addClass:f,removeClass:M,hasSameClasses:i,replaceWithOwnChildren:o,elementsHaveSameNonClassAttributes:r,elementHasNonClassAttributes:s,splitNodeAt:B,isEditableElement:O,isEditingHost:u,isEditable:v},a.CssClassApplier=a.ClassApplier=F,a.createCssClassApplier=a.createClassApplier=G})}(b)}),define("app/editor/Brush",["exoskeleton-master/exoskeleton","jquery/jquery","app/document/StringUtils","app/document/MarkParser","app/document/Node","app/editor/Inline","app/editor/UndoManager","app/editor/Emoji","app/editor/Stylize","rangy/rangy-core","app/editor/UndoManager","app/editor/EditHelper"],function(a,b,c){"use strict";function d(a){var b=a.parent().closest("[md-inline]");return b.length?d(b):a.closest("[md-inline]")}var e=a("exoskeleton-master/exoskeleton"),f=a("app/document/StringUtils"),g=a("app/document/MarkParser"),h=a("app/document/Node"),i=h.Node,j=h.TYPE,k=a("app/editor/Stylize"),l=a("app/editor/UndoManager"),m=a("app/editor/EditHelper"),n=a("rangy/rangy-core.js"),o=function(a){this.editor=a,this.queue=[],this.interval=150,this.inline=new g.InlineLexer,this.articleArea=document.querySelector(this.editor.sessionStr),t.call(this)},p=null,q=null,r={},s=function(a,b){if(!a&&!b)return void a.brush.hideAutoComplete();try{a.brush.pause(),q?a.focusCid=q.id||q.startId:a.refocus(void 0,void 0,!0),a.undo.completeSnap(!0);var c=p,d=n.createRange(),e=l.makeEmptyCommand(q||a.selection.buildUndo()),f=a.getNode(a.focusCid);if(e.undo.push(l.buildReplaceUndo(f)),d.moveToBookmark(c),a.selection.deRange(d),d.deleteContents(),d.insertNode(document.createTextNode(b)),c.start=c.start+=b.length,c.end=c.start,a.store(a.focusCid,!0),d.moveToBookmark(c),e.redo.push(l.buildReplaceUndo(f)),a.selection.setRange(d),e.redo.push(a.selection.buildUndo()),a.undo.register(e),"fences"==r.type){var g=f.breakOn(!1,a),h=a.findElemById(g.oldCid);h.replaceWith(g.newHtml),a.selection.jumpIntoElemBegin(a.findElemById(g.nextFocus)),a.undo.register(g.command)}else a.brush.addToQueue(a.focusCid,!0)}catch(i){console.error(i.stack)}a.brush.hideAutoComplete(),a.brush.resume(!0)},t=function(){var a=this.editor;$(document).click(function(){document.activeElement!==a.brush.articleArea&&a.brush.hideAutoComplete()}),$(".auto-suggest-container").on("mousedown","li[data-content]",function(){q=a.selection.buildUndo()}).on("click","li[data-content]",function(){s(a,this.getAttribute("data-content"))})},u=function(a){if(!a||!a.length)return!1;var b=window.getSelection().getRangeAt(0),c=b.getClientRects()[0],d="none"==a[0].style.display,e=c.left-15;return d&&(e=e+200>window.innerWidth?window.innerWidth-200:e,a.css({top:c.bottom,left:e}).show()),a.find("[data-page]").hide().filter("[data-page="+r.pageNo+"]").show(),!0};o.prototype={addToQueue:function(a,b){b=b||!1,f.isNullOrEmpty(a)||this.queue.push({cid:a,inlineOnly:b})},run:function(){var a=this;this.timerID||(this.timerID=window.setInterval(function(){a.brushQueue()},this.interval))},pause:function(){clearInterval(this.timerID),this.timerID=null},resume:function(a){a&&this.brushQueue(),this.run()},restart:function(){this.queue=[],this.run()},updateWordCount:function(){if(File.isMac)app.document.updateWordCount(m.getWordCount(this.articleArea.innerText));else if(File.isNodeHtml){var a=m.getWordCount(this.articleArea.innerText);$("#footer-word-count").text(a+" Words"),$("#footer-word-count-td").text(a),document.body.classList.contains("pin-outline")&&document.querySelector("#info-panel-tab-file.active")&&File.FileInfoPanel.updateContentAnalyze(a)}},brushNode:function(a){var b=this.editor.selection.buildUndo();x.call(this,a,{},b,!1)&&this.editor.undo.exeCommand(b)},brushQueue:function(){var a=this,b={},c=a.queue.length;if(!this.editor.isIME){if(a.queue.length>0&&!File.isLocked){var d=a.editor.selection.buildUndo(),e=!1;a.queue.map(function(c){b[c.cid]||(e=x.call(a,c.cid,b,d,c.inlineOnly)||e,b[c.cid]=1)}),a.queue=[],e&&d&&a.editor.undo.exeCommand(d),this.expand(!0)}c&&(this.updateWordCount(),this.triggerAutoComplete())}},applyAutocompleteByKey:function(){q=null,s(this.editor,$(".auto-suggest-container:visible .active").attr("data-content"))},triggerAutoComplete:function(a){function b(){if(q&&q.collapsed){var a=$(q.endContainer).closest(".md-lang"),b=a.text(),c=a.prev().text().length;if(b)return p={start:c,end:c+b.length,containerNode:a.closest("[mdtype]")[0]},b}}function c(){var a,b=/\w+$/,c=/^\w+/,e=h+i;f=b.exec(h)||[""],d=c.exec(i)||[""],a=f[0]+d[0];try{if(c.exec(a))return{context:e,start:void 0===f.index?h.length:f.index,length:a.length}}catch(g){}}var d,e,f=null,g=this.editor.selection.getTextAround(),h=g[0],i=g[1],j=g[2],k=this.editor.getJQueryElem((this.editor.selection.getRangy()||{}).commonAncestorContainer),l=k.closest(".md-inline-math").length,m=a&&File.option.enableInlineMath,n=a||File.option.autoToggleEmojiAutoComplete||r.found&&"emoji"==r.type,o=!1,q=this.editor.selection.getRangy();if(j&&q&&q.collapsed&&(h||i)){if(e=b.call(this))return void u(this.editor.fences.showAutoSuggest(e,r));if(n&&(f=y.exec(h)))return d=/^(\w*:*)(\s|$)/.exec(i||""),null!==d&&u(this.editor.emoji.showAutoSuggest(f[1]+d[1],r)),j.start-=f[1].length+1,j.end+=d[1].length,void(p=j);if(o&&(e=c()))return u(this.editor.word.showAutoSuggest(e.context,e.start,e.length,r)),j.start-=f[0].length,j.end+=d[0].length,void(p=j);if(m&&(e=/\$?\$$/.exec(h))&&0==$(".md-expand.md-inline-math").length){var s,t=(/^\$+/.exec(i)||"").length;if(t<=e[0].length)return s="$".repeat(e[0].length-t),s.length&&(this.editor.undo.snap(editor.focusCid,2),q.insertNode(document.createTextNode(s)),q.collapse(!0)),this.editor.lastCursor=this.editor.selection.buildUndo(),j.start-=e[0].length,j.end+=e[0].length,q.moveToBookmark(j),this.editor.mathInline.showAutoSuggest(q),this.editor.restoreLastCursor(null,!0),void(p=null)}}else{if(!l)return this.hideAutoComplete();k.trigger("inline-math-changed")}this.hideAutoComplete()},changeAutoCompleteSelection:function(a,b){var c,d=$(".auto-suggest-container:visible"),e=d.find(".active");if(d.length&&r.pageCnt){if(b&&b.preventDefault(),!e.length)return void(e=d.find("ul:first>li:first").addClass("active"));e.length&&(e=e.removeClass("active")[a?"prev":"next"]().addClass("active")),e.length||(r.pageNo+=a?-1:1,r.pageNo<0?r.pageNo=r.pageCnt-1:r.pageNo>=r.pageCnt&&(r.pageNo=0),c=d.find("[data-page]").hide().filter("[data-page="+r.pageNo+"]").show(),a?c.find("li:last").addClass("active"):c.find("li:first").addClass("active"))}},hideAutoComplete:function(){r={},p=null,$(".auto-suggest-container").hide()},expand:function(){function a(b,c){if(!b.prevAll(":not(.md-meta, .md-content)").text().length){var d=b.parent();return d.hasClass("[mdtype]")||d[0].contains(c)?b:a(d,c)}return b}function b(a,c){if(!a.nextAll(":not(.md-meta, .md-content)").text().length){var d=a.parent();return d.hasClass("[mdtype]")||d[0].contains(c)?a:b(d,c)}return a}function c(a,b){if(a.commonAncestorContainer.nodeType===document.TEXT_NODE){if(b>0&&a.endOffset+b<=a.commonAncestorContainer.length)return a.setEnd(a.commonAncestorContainer,a.endOffset+b),a;if(0>b&&a.startOffset+b>=0)return a.setStart(a.commonAncestorContainer,a.startOffset+b),a}var c=$(a.startContainer).closest("[cid]")[0],d=a.getBookmark(c);return b>0?d.end+=b:d.start+=b,a.moveToBookmark(d),a}function e(c){try{var d,e=c.commonAncestorContainer;if(0==c.startOffset){var f=editor.getJQueryElem(c.startContainer);f.closest(".md-expand").length||f[0].hasAttribute("cid")||f[0].querySelector("[cid]")||(d=f.closest("[cid]")[0],f=a(f,e.contains&&e.contains(d)?d:e),c.setStartBefore(f[0]))}if(c.endOffset==(c.endContainer.nodeType===document.TEXT_NODE?c.endContainer.length:c.endContainer.childNodes.length)){var g=editor.getJQueryElem(c.endContainer);g.closest(".md-expand").length||g[0].hasAttribute("cid")||g[0].querySelector("[cid]")||(d=g.closest("[cid]")[0],g=b(g,e.contains&&e.contains(d)?d:e),c.setEndAfter(g[0]))}}catch(h){console.warn(h)}return c}function f(a,b){void 0===b?a.removeAttr("contenteditable"):a.attr("contenteditable",b)}if(!this.editor.isIME){var g=this.editor.selection,h=g.getRangy(),k=g.rangy,l=h?h.cloneRange():null;if(h&&!File.isLocked){this.editor.selection.deRange(h);var m=this.editor.getJQueryElem(h.commonAncestorContainer);if(this.editor.stylize.putBookmark(l,this.editor.stylize.buildBookmark(m)),i.isType(document.activeElement.tagName,"INPUT","TEXTAREA")||document.activeElement.hasAttribute("tabindex"))return $(".md-expand").removeClass("md-expand"),$(this.editor.sessionStr).trigger("cursorChange",this.editor.styleBookmark);if(h.collapsed){var n,o=d(m),p=m.closest("[mdtype]"),q=p.attr("contenteditable"),r=[],s=o.visibleText().length;if(!p.length||i.isType(p.attr("mdtype"),j.fences,j.math_block))return $(this.editor.sessionStr).trigger("cursorChange",this.editor.styleBookmark);p.attr("contenteditable",!1),window.getSelection().baseOffset===s&&s<o.text().length?(n=o.addClass("md-expand"),l=k.createRange(),l.collapseToPoint(o[0],o[0].childNodes.length),this.editor.selection.setRange(l)):(c(h,-1),n=p[0]!=$(h.startContainer).closest("[mdtype]")[0]?o:d(this.editor.getJQueryElem(h.startContainer)),h.startContainer===h.endContainer&&(h.toString().length&&h.collapse(!1),c(h,1))),f(p,q)}else n=d(this.editor.getJQueryElem(h.startContainer));if(r=d(this.editor.getJQueryElem(h.endContainer)),!r.length&&(r=n),n.length&&r.length){l=e(l,n,r)||l;var t=l&&!l.collapsed;$(".md-expand").removeClass("md-expand"),n.length?w.call(this,n):w.call(this,r),n.length&&r.length&&n.next().is(r)&&!r.hasClass("md-img-loaded")&&w.call(this,r,!0)}else $(".md-expand").removeClass("md-expand");t&&this.editor.selection.setRange(l,!0);var u=window.getSelection().anchorNode;u&&(3===u.nodeType||u.hasAttribute&&u.hasAttribute("contenteditable"))&&this.editor.selection.deRange(this.editor.selection.getRangy(),!0),$(this.editor.sessionStr).trigger("cursorChange",this.editor.styleBookmark)}else $(".md-expand").removeClass("md-expand")}},isAutoCompleteShown:function(){return $(".auto-suggest-container:visible").length},focusContainer:function(a){v.call(this,a)}};var v=function(a){var b=a.closest("tr.md-end-block, li[cid]")[0],c=a[0];if(b&&c){for(;b!==c&&b.contains(c);){if(c.previousSibling&&c.previousSibling.hasAttribute&&c.previousSibling.hasAttribute("cid"))return!1;c=c.parentElement}b.classList.add("md-focus-container")}},w=function(a,b){b||($(".md-expand").removeClass("md-expand").closest("[cid]").removeClass("md-focus"),$(".md-focus-container").removeClass("md-focus-container")),a.length&&v(a.addClass("md-expand").trigger("expand").closest("[cid]").addClass("md-focus"))},x=function(a,b,c,d){function f(a){for(var b=0;b<a.attributes.length;b++)i.isType(a.attributes[b].name,"cid","contenteditable","style","id","for")&&a.removeAttributeNode(a.attributes[b])}function h(a){for(var b=a.querySelectorAll("*"),c=0;c<b.length;c++)f(b[c]);f(a)}function l(a,b,c,d,e,f){var g,i=c.innerHtml,j=a.clone(),f=c.cursorDiff,k=$($.parseHTML("<div>"+i+"</div>")[0]);return j.find(".md-inline-math.md-expand").text(function(){return this.textContent}),j.find(".md-expand").removeClass("md-expand"),h(j[0]),h(k[0]),j.html().replace(/\s*class=\"\"/gi,"")!=k.html().replace(/\s*class=\"\"/gi,"")?(a.html(i),e.mathInline.brush(a[0],d,!0),g=!0):j.find(".math-jax-preprocess").length&&e.mathInline.brush(a[0],d,!0),m(d,f,c.command,b,e)||g}function m(a,b,c,d,f){return b.length&&f.focusCid===d.cid?(a&&(c&&c.undo.unshift(e.utils.clone(a)),a.start=p(b,a.start),a.end=p(b,a.end),c&&c.redo.push(e.utils.clone(a))),f.undo.register(c),!0):!1}function n(a,b,c,d,f){var g=c.cursorDiff||[];return c.replaceCid?f.findElemById(c.replaceCid).replaceWith(c.html):a.closest("p").replaceWith(c.html),f.focusCid&&f.focusCid!==b.cid||(f.focusCid=c.focus,f.focusCid&&v(f.findElemById(f.focusCid)),d&&(c.command.undo.unshift(e.utils.clone(d)),g.length&&(d.start=p(g,d.start),d.end=p(g,d.end)),d.startId=c.focus,d.endId=c.focus,d.start-=c.offset,d.end-=c.offset,c.command.redo.push(e.utils.clone(d))),f.undo.register(c.command)),!0}function o(a,b,c,d,e){return c.blockChanged?n(a,b,c,d,e):l(a,b,c,d,e)}function p(a,b){var c=b;for(var d in a)void 0!==d&&b>=d&&(c+=a[d]);return c}try{var q,r,s=a,t=a;if("string"==typeof a?s=this.editor.getNode(a):t=s.id,!s)return;if(i.isType(s,j.meta_block))return;if(k.CONST.NoInline.indexOf(s.get("type"))>-1)return;if(s.get("children").length)return s.get("children").toArray().map(function(a){b&&(b[a.id]=1),x.call(this,a,b,c,d)},this),!0;if(q=this.editor.findElemById(t).addClass("md-expand"),s.get("type")==j.def_footnote){var u=[];return r=this.inline.output(q.children(".md-def-content").text(),null,null,null,null,u),q.children(".md-def-content").html(r),m(c,u,null,s,this.editor),!0}var w=File.option.enableInlineMath?q.textExcludeSVG():q.text();return r=g.quickParse(w,this,s,d||!i.isType(s,j.line)),o(q,s,r,c,this.editor)}catch(y){console.debug(y.stack)}},y=/:(\w+)$/;c.exports=o}),define("app/editor/Stylize",["exoskeleton-master/exoskeleton","jquery/jquery","app/document/StringUtils","app/document/Node","app/editor/UndoManager","rangy/rangy-core"],function(a,b,c){"use strict";var d=a("exoskeleton-master/exoskeleton"),e=a("app/document/StringUtils"),f=a("app/document/Node"),g=a("app/editor/UndoManager"),h=f.Node,i=f.TYPE,j=f.NodeCollectionUtils,k=a("rangy/rangy-core.js"),l=function(){return File.isMac?app.clipboard.paste():File.isNode?reqnode("electron").remote.clipboard.readText():""},m=function(a,b,c,d){function e(a){var d=a.find('[md-inline="'+b+'"]').children(".md-meta");c&&(c.end-=d.text().length),d.remove()}var f=k.createRange();if(a[0].hasAttribute("mdtype")&&(a.wrapInner("<span></span>"),a=$(a[0].firstChild)),c?(c.containerNode=a[0],f.moveToBookmark(c)):f.selectNode(a[0]),f.commonAncestorContainer.nodeType==document.ELEMENT_NODE&&f.commonAncestorContainer.getAttribute("md-inline")==b)e($(f.commonAncestorContainer));else{for(var g=document.createElement("SPAN"),h=f.extractContents(),i=0;i<h.childNodes.length;i++)g.appendChild(h.childNodes[i].cloneNode(!0));e($(g)),f.insertNode(g),f.selectNode(g)}o.call(this,f,b,a[0],d?c:null)},n=function(a,b){return b.collapsed&&a[2]===a[1]&&h.isType(a[1],i.line)?[a[0],a[1].getLastBrother(!0),a[1].getLastBrother(!1)]:a},o=function(a,b,c,d){console.debug("surroundStyle"+b);var f,g,j,k,m,n,o=r.SyntaxMap[b];if(d){var p,q=this.editor.getJQueryElem(a.startContainer),s=this.editor.getJQueryElem(a.endContainer);if(q.closest("md-before").length||q.closest("md-content").length?(a.setStartBefore(q.closest("[md-inline]")[0]),p=!0):q.closest("md-meta").length&&(a.setStartAfter(q.closest("[md-inline]")[0]),p=!0),s.closest("md-after").length||q.closest("md-content").length?(a.setEndAfter(q.closest("[md-inline]")[0]),p=!0):s.closest("md-meta").length&&(a.setEndBefore(q.closest("[md-inline]")[0]),p=!0),f=a.toString(),a.collapsed||0===f.trim())return;g=p?g||a.getBookmark(c||a.commonAncestorContainer):d instanceof Object?d:{start:d,end:d}}else f=a.toString();j=/^\s+/g.exec(f),k=/\s+$/g.exec(f),j=j?j[0].length:0,k=k?k[0].length:0,(j||k)&&(g=g||a.getBookmark(c||a.commonAncestorContainer),g.start+=j,g.end-=k,a.moveToBookmark(g)),m=o[1],n=l(),h.isType(b,i.link)&&(e.isURL(f)?m="]("+f+")":e.isURL(n)&&(m="]("+n+")")),h.isType(b,i.image)&&(e.isImg(f)?m="]("+f+")":e.isImg(n)&&(m="]("+n+")")),a.insertNodeAtEnd(document.createTextNode(m)),a.insertNode(document.createTextNode(o[0])),d&&(a.moveToBookmark(h.isType(b,i.link)?{containerNode:c,start:g.start+3+f.length,end:g.end+m.length}:{containerNode:c,start:g.start+o[0].length,end:g.end+o[0].length}),editor.selection.setRange(a))},p=function(a,b){function c(a){var e=a.get("children");return e.length?e.toArray().map(c):d.stylize.canContainInline(a.get("type"))&&(d.stylize.putStyleInBlock(d.findElemById(a.id),b,void 0,void 0,!0),d.store(a),d.brush.addToQueue(a.id)),a}var d=this.editor,e=d.selection.getDetailPos(a.startContainer,a.startOffset),f=d.selection.getDetailPos(a.endContainer,a.endOffset),i=d.getMarkElem(e[0]),j=d.getMarkElem(f[0]),k=d.findNodeByElem(i),l=d.findNodeByElem(j),m=h.getTreePosition(k,l),n=m[1],o=m[2],p=g.makeEmptyCommand(d.selection.buildUndo()),q=a.cloneRange(),r=a.cloneRange(),s=n;for(p.undo.push(g.buildReplaceUndo(n)),r.setEndAfter(i[0]),this.canContainInline(k)&&(this.putStyleInBlock(i,b,r.getBookmark(i[0]),void 0,!0),d.store(k,!0)),d.UserOp.decorateOneSide(k,n,"after",c),p.redo.push(g.buildReplaceUndo(n)),d.brush.addToQueue(i.attr("cid")),s=n.get("after");s&&s!==o;)p.undo.push(g.buildReplaceUndo(s)),c(s),p.redo.push(g.buildReplaceUndo(s)),s=s.get("after");l&&l!=n&&(q.setStartBefore(j[0]),p.undo.push(g.buildReplaceUndo(o)),this.canContainInline(l)&&(this.putStyleInBlock(j,b,q.getBookmark(j[0]),void 0,!0),d.store(l,!0)),d.UserOp.decorateOneSide(l,o,"before",c),p.redo.push(g.buildReplaceUndo(o)),d.brush.addToQueue(j.attr("cid"))),p.redo.push(d.selection.buildUndo()),d.undo.register(p),$(".md-expand").removeClass("md-expand")},q=d.Model.extend({initialize:function(a){this.editor=a,this.CONST=r,this.putBookmark(null,{block:[]})},removeStyle:function(a){a.children(".md-meta").remove()},canContainInline:function(a){return a.jquery&&(a=a.attr("mdtype")),h.isType(a,i.line,i.def_footnote,i.heading,i.table_cell)},putStyle:function(a,b){this.editor.selection.deRange(a);var c=this.editor.getMarkElem(a.commonAncestorContainer),d=r.InsertInline.indexOf(b)>-1;if(d&&(c=this.editor.getMarkElem(a.startContainer)),c.length&&0===c.find("[mdtype]").length&&this.canContainInline(c)){var e=g.makeEmptyCommand(this.editor.selection.buildUndo()),f=this.editor.store(c.attr("cid"));e.undo.push(g.buildReplaceUndo(f)),this.putStyleForRange(c,b,a,!0),this.editor.store(c.attr("cid")),e.redo.push(g.buildReplaceUndo(f)),e.redo.push(this.editor.selection.buildUndo()),this.editor.undo.register(e),this.editor.brush.addToQueue(f.id,!0)}else if(!d)return p.call(this,a,b)},putStyleInBlock:function(a,b,c,d,e){if(!e||0!=a.text().length){a[0].hasAttribute("mdtype")&&a.addClass("md-expand");try{m.call(this,a,b,c,d)}catch(f){console.error(f)}}},putStyleForRange:function(a,b,c,d){var e=c.getBookmark(a[0]);a[0].hasAttribute("mdtype")&&c.commonAncestorContainer.nodeType!=document.TEXT_NODE&&a.addClass("md-expand"),m.call(this,a,b,e,d)},addStyle:function(a,b){console.debug("addStyle "+b);var c,d=r.SyntaxMap[b],f=document.createElement("SPAN");f.className="md-meta md-expand",f.setAttribute("md-inline",b),"link"==b&&(c=l(),e.isURL(c)&&(d[1]="]("+c+")")),f.appendChild(document.createTextNode(d[0]+d[1])),a.insertNode(f),a.moveToBookmark({containerNode:f,start:d[0].length,end:d[0].length}),this.editor.selection.rangy.getSelection().setSingleRange(a)},detach:function(a,b){var c;return a.collapsed&&(c=$.parseHTML("<div>"+a.toHtml()+"</div>")[0],c.querySelector('[md-inline="'+b+'"]'))?!0:$(a.commonAncestorContainer).closest('[md-inline="'+b+'"]').length},canToggleStyle:function(a,b,c){var d=function(a){for(var b=0;b<a.CONST.NoInline.length;b++)if(a.hasStyle(a.CONST.NoInline[b]))return!0}(this);return this.hasStyle(a)?!0:d||/(md-meta|md-content)(\s+|$)/g.exec(b[0].className)&&!c||/md-blockmeta/g.exec(b[0].className)?!1:!d},clearStyle:function(){if(window.getSelection().rangeCount&&"INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName&&!File.isLocked){this.editor.brush.pause(!0),this.editor.undo.completeSnap(!0);var a=this.editor.selection.getRangy();if(a){for(var b,c=g.makeEmptyCommand(editor.selection.buildUndo()),d=editor.selection.getDetailPos(a.startContainer,a.startOffset),e=editor.selection.getDetailPos(a.endContainer,a.endOffset),f=editor.getMarkElem(d[0]),i=editor.getMarkElem(e[0]),j=editor.findNodeByElem(f),k=editor.findNodeByElem(i),l=h.getTreePosition(j,k),m=l[1],n=l[2],o=m;o&&o!=n.get("after");)b=o,o=o.get("after"),c.undo.push(g.buildReplaceUndo(b)),this.editor.findElemById(b.id).find(".md-meta, .md-content").remove(),this.editor.store(b.id),this.editor.brush.addToQueue(b.id),c.redo.push(g.buildReplaceUndo(b));this.editor.undo.register(c)}this.editor.brush.resume(),this.editor.brush.expand()}},toggleStyle:function(a){if(window.getSelection().rangeCount&&"INPUT"!=document.activeElement.tagName&&"TEXTAREA"!=document.activeElement.tagName&&!File.isLocked){var b,c=this.editor.selection.getRangy(),d=this.hasStyle(a),e=this.editor.getJQueryElem(c.commonAncestorContainer),f=this.editor.getMarkElem(c.commonAncestorContainer),g=f.attr("cid"),j=h.isType(a,i.link,i.image)&&a;if(this.editor.undo.completeSnap(!0),g&&this.editor.undo.snap(g,2),!d){var k=this.editor.getJQueryElem(c.startContainer);"link"==a&&(d=k.closest('[md-inline="reflink"], [md-inline="autolink"]').length),"image"==a&&(d=k.closest('[md-inline="refimg"], .md-url').length)}this.editor.brush.pause();do{if(!this.canToggleStyle(a,e,c.collapsed))return void console.debug("cannot toggle style");if(d){var l,m=e.closest('[md-inline="'+a+'"]');m.length||"link"!=a||(m=e.closest('[md-inline="reflink"], [md-inline="autolink"]')),"image"==a&&(m.length?l=/!\[([^\]]*)\]/.exec(m.text())[1]:l||(m=e.closest('[md-inline="refimg"]'),m.length?l=/!\[((?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*)\]/.exec(m.text())[1]:(m=e.closest(".md-url").closest("[md-inline]"),m.length&&(l="!"+m.text())))),l?(m.text(l),this.editor.selection.selectAllElem(m)):m.children(".md-meta, .md-content").remove()}else{if(!c.collapsed){this.putStyle(c,a);break}b=c.getBookmark(f[0]).start;var n=f.text();n[b]&&n[b].trim().length?(f.addClass("md-expand"),this.editor.selection.selectWord(j),c=this.editor.selection.getRangy(),c.collapsed?this.addStyle(c,a):o.call(this,c,a,f[0],b)):this.addStyle(c,a)}if(this.editor.brush.addToQueue(f.attr("cid")),a==i.inline_math&&!d){var p=this.editor;setTimeout(function(){p.brush.triggerAutoComplete(!0)},100)}}while(!1);this.editor.brush.resume(!0)}},putBookmark:function(a,b){return this.editor.styleBookmark={cursor:a,style:b}},buildBookmark:function(a){var b,c={inline:[],block:[]},d=this.editor.selection.getRangy(),a=a||d&&this.editor.getJQueryElem(d.commonAncestorContainer)||$(),e=a.closest("[md-inline]"),f=a;if(0==a.length)return c;for(;e.length;)b=e.attr("md-inline"),this.CONST.LinkList.indexOf(b)>-1&&(b="link"),c.inline.push(b),f=e,e=e.parent().closest("[md-inline]");for(e=f.closest("[mdtype]");e.length;)b=e.attr("mdtype"),c.block.push(b===i.heading?"header"+e[0].tagName.substring(1):b===i.list?this.editor.findNodeByElem(e).get("style"):b),e=e.parent().closest("[mdtype]");return c},hasStyle:function(a){var b=this.editor.styleBookmark.style;return b?(b.inline||[]).indexOf(a)>-1||(b.block||[]).indexOf(a)>-1:void 0},changeBlock:function(a,b){function c(a,c){var d,h,i=b.getClosetParagraphLevel();return e(a,c,!0),d=b.separateBlockFromLine(!1),h=(d[0]?d[0].toHTML():"")+d[1].toHTML()+(d[2]?d[2].toHTML():""),d[0]&&g.addUndoForInsert(f,d[0]),d[2]&&g.addUndoForInsert(f,d[2]),m.findElemById(i.id).replaceWith(h),d[1]}function e(a,c,d){return b.set("type",i.heading),b.set("depth",a),b.set("pattern",c),d||(m.findElemById(b.id).replaceWith(b.toHTML()),f.redo.push(g.buildReplaceUndo(b))),b}b=b||this.editor.getNode(null,!0);var f,j,k,l=r.getMenuBlockType(b),m=this.editor,n=b.cid;if(!h.isType(b,i.table,i.table_row,i.table_cell,i.blockquote,i.list)&&!File.isLocked&&(m.lastCursor=m.selection.buildUndo(),l!=a&&l)){if(m.undo.completeSnap(!0),h.isType(l,i.fences)&&(m.fences.syncToNode(b.cid),m.fences.beforeDeleteFences(b)),f=g.makeEmptyCommand(m.lastCursor),f.undo.push(g.buildReplaceUndo(b.getClosetParagraphLevel())),h.isType(l,i.def_link)&&b.set("text",b.get("href")+(b.get("tittle")?' "'+b.get("tittle")+'"':"")),0==a.indexOf("header")?(k=a.substr(6)-0,j=b.get("pattern"),j&&/-|=/.exec(j)?j=2>=k?j.replace(/-|=/g,1==k?"=":"-"):void 0:j&&(j=j.replace(/#+/g,"#".repeat(k))),b=h.isType(b,i.line)?c(k,j):e(k,j)):(b.set("type",a),b.set("pattern",void 0)),h.isType(l,i.meta_block,i.fences)&&h.isType(b,i.paragraph)){b.set("type",i.raw_edit);var o=m.simpleParse(b);m.findElemById(o[2]).replaceWith(o[1]),o&&g.append(f,o[0])}else h.normalizeNode(b),f.redo.push(g.buildReplaceUndo(b)),m.findElemById(b.id).replaceWith(b.toHTML());var p=d.utils.clone(f.undo[0]);p.startId===n&&(p.startId=b.cid),p.endId===n&&(p.endId=b.cid),p.id===n&&(p.id=b.cid),m.undo.exeCommand(p),f.redo.push(p),m.undo.register(f),h.isType(l,i.def_link,i.def_footnote)&&h.isType(a,i.def_link,i.def_footnote)&&m.refresh(),m.refocus()}},insertMetaBlock:function(a){if(!File.isLocked){var b=this.editor.nodeMap.getFirst();if(!h.isType(b,i.meta_block)){this.editor.undo.completeSnap(!0),this.editor.lastCursor=this.editor.selection.buildUndo();var c=g.makeEmptyCommand(this.editor.lastCursor||this.editor.selection.buildUndo()),d=new h({type:i.meta_block,"in":this.editor.nodeMap,attachTo:this.editor.nodeMap,after:b,text:""});return g.addUndoForInsert(c,d),a?{command:c,node:d}:(this.editor.findElemById(b.cid).before(d.toHTML()),this.editor.selection.restoreSelection(this.editor.findElemById(d.cid),0),c.redo.push(this.editor.selection.buildUndo()),this.editor.undo.register(c),$(this.editor.sessionStr).trigger("cursorChange"),this.editor.selection.scrollAdjust(),this.editor.refocus(d.cid),d)}}},insertBlock:function(a,b){function c(a,b){a.set("in",b),a.get("children").toArray().map(function(a){c(a,b)})}if(!File.isLocked){var d,e=(this.editor.selection.getRangy(),this.editor.getNode(null,!0)),f=r.getMenuBlockType(e),j=this.editor;if(this.editor.lastCursor=this.editor.selection.buildUndo(),f==a||!f||!h.isType(e,i.paragraph,i.heading,i.line))return void(b&&b.remove());this.editor.undo.completeSnap(!0),d=g.makeEmptyCommand(this.editor.lastCursor),d.undo.push(g.buildReplaceUndo(e.getClosetParagraphLevel()));var k,l=h.splitAt(e,this.editor.lastCursor.start,j,h.genNormalSplitExitFunc(!1,!0)),m=l.prev,n=b||new h({type:a,text:""}),o=l.next,p="",q=a==i.hr?(o||opt_next||m.get("after")).id:n.id,s=this.editor.findElemById(e.getClosetParagraphLevel().id);m.insert(n,!1),g.addUndoForInsert(d,n),d.redo.push(j.undo.buildReplaceUndo(l.prev)),b&&c(b,e.get("in")),o&&h.isEmptyBlock(o)&&a!=i.hr?(o.remove(),o=null):o&&g.addUndoForInsert(d,o),l.opt_next&&g.addUndoForInsert(d,l.opt_next),l.opt_prev&&g.addUndoForInsert(d,l.opt_prev),h.isEmptyBlock(m)&&(g.addUndoForRemove(d,m),m.remove(),m=null),[l.opt_prev,m,n,o,l.opt_next].map(function(a){a&&(p+=a.toHTML())}),s.replaceWith(p),this.editor.refresh(),k=this.editor.findElemById(q),this.editor.selection.jumpIntoElemBegin(k),this.editor.lastCursor=this.editor.selection.buildUndo(),d.redo.push(this.editor.lastCursor),this.editor.undo.register(d),a==i.fences?(this.editor.fences.getCm(n.id),this.editor.fences.focus(n.id)):a==i.math_block&&this.editor.mathBlock.startEditing(n.id),this.editor.refocus(),$(this.editor.sessionStr).trigger("cursorChange"),this.editor.selection.scrollAdjust()}},toggleIndent:function(a){function b(a,b,c){return b=b||a,c&&c.get("type")==i.blockquote?p.collapsed||!a.get("before")&&!b.get("after"):!1}function c(c,d,e){c=c.getClosetBlock(),d=d&&d.getClosetBlock();var f=c.get("parent");if(b(c,d,f))g.addUndoForUnwrap(e,f),f.unwrap(m);else{var i=new h({type:a,"in":c.get("in")});i.wrap(c,d,m),g.addUndoForWrap(e,i),m.refresh()}}function d(a,b){b=(b||a).getClosetParagraphLevel(),a=a.getClosetParagraphLevel();var c=a.get("parent");if(p.collapsed){if(!a.get("before")&&!b.get("after")&&c&&h.isType(c.get("parent"),i.list))return c.get("parent")}else if(c&&h.isType(c.getClosetBlock(),i.list))return c.getClosetBlock()}function e(a,b,c){if(b=b||a,a.get("parent")==b.get("parent")&&h.isType(a,i.line)){var d,e=a.get("parent"),f=[];if(c.undo.push(g.buildReplaceUndo(e)),f.push(e),b.get("after")&&(d=new h({type:i.paragraph}),e.giveChildrenTo(d,b.get("after"),null,!0),f.push(d),e.insert(d),c.redo.push(g.buildReplaceUndo(e)),g.addUndoForInsert(c,d)),a.get("before")&&(d=new h({type:i.paragraph}),e.giveChildrenTo(d,null,a.get("before"),!0),f.unshift(d),e.insert(d,!0),c.redo.push(g.buildReplaceUndo(e)),g.addUndoForInsert(c,d)),a!=b){for(var k,l=f.indexOf(e)+1,n=[],o=a.get("after");o!=b.get("after");)d=new h({type:i.paragraph}),k=o,o=o.get("after"),k.detach(),k.set("parent",d),n.push(d),f.splice(l,0,d),l++;e.insertArray(n,!1,!0),g.addUndoForInsertArray(c,n)}f.length>1&&m.findElemById(e.cid).replaceWith(j.toHTML(f))}}function f(a,b,c,f){var j=d(a,b);if(j)j.get("style")===f?(j.get("children").models.clone().map(function(a){g.addUndoForUnwrap(c,a),a.unwrap()}),g.addUndoForUnwrap(c,j),j.unwrap(m)):(c.undo.push(g.buildReplaceUndo(j)),j.set("style",f),m.findElemById(j.id).replaceWith(j.toHTML()),c.redo.push(g.buildReplaceUndo(j)));else{b=b||a,e(a,b,c),a=a.getClosetParagraphLevel(),b=b.getClosetParagraphLevel();for(var k,l=a,n=[],o=b.get("after");l&&l!=o;){var p=new h({type:i.list_item,"in":a.get("in")});k=l,l=l.get("after"),p.wrap(k,k,m,!0),n.push(p),g.addUndoForWrap(c,p)}j=new h({type:i.list,style:f,"in":a.get("in")}),j.wrap(n[0],n.last(),m),g.addUndoForWrap(c,j),m.refresh()}}var k,l,m=this.editor,o=g.makeEmptyCommand(m.selection.buildUndo()),p=this.editor.selection.getRangy();if(!(h.isType(document.activeElement.tagName,"INPUT","TEXTAREA")&&!this.editor.fences.getFocused()||File.isLocked)){if(this.editor.undo.completeSnap(!0),this.editor.store(),this.editor.lastCursor=this.editor.selection.buildUndo(),p){var q=m.selection.getDetailPos(p.startContainer,p.startOffset),r=m.selection.getDetailPos(p.endContainer,p.endOffset),s=m.getMarkElem(q[0]),t=m.getMarkElem(r[0]),u=m.findNodeByElem(s),v=m.findNodeByElem(t),w=h.getTreePosition(u,v),x=n(w,p);k=x[1],l=x[1]===x[2]?null:x[2]}else k=this.editor.findNodeByElem(this.editor.getMarkElem());k&&(this.editor.brush.pause(!0),a==i.blockquote?(k=k.getClosetParagraphLevel(),l=l&&l.getClosetParagraphLevel(),c(k,l,o)):f(k,l,o,a),o.redo.push(this.editor.lastCursor),this.editor.undo.exeCommand(this.editor.lastCursor),this.editor.undo.register(o),this.editor.brush.resume(),this.editor.refocus(),this.editor.selection.scrollAdjust())
}},changeHeadingLevel:function(a,b){var c=null;if(a.get("type")==i.line)b&&(c="header6");else if(a.get("type")==i.heading){var d=a.get("depth")-0;d-=b?1:-1,7==d?c="paragraph":d>0&&(c="header"+(d+""))}c&&this.changeBlock(c)}}),r={SyntaxMap:{strong:["**","**"],em:["*","*"],code:["`","`"],del:["~~","~~"],underline:["<u>","</u>"],footnote:["[^"," ]"],link:["[","]()"],image:["![","]()"],highlight:["==","=="],superscript:["^","^"],subscript:["~","~"],inline_math:["$","$"]},NormalBlockMap:{line:"Paragraph",paragraph:"Paragraph",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",header6:"Header 6",def_link:"Link Refrence",def_footnote:"Footnote"},InsertInline:["link","image","footnote","inline_math"],LinkList:["autolink","reflink","link"],NoInline:["hr","fences","def_link","code","meta_block","math_block","toc"],Selectable:["hr","math_block","toc"],InsertBlock:["table","fences","hr"],StyleToNameMap:{paragraph:"Paragraph",header1:"Heading 1",header2:"Heading 2",header3:"Heading 3",header4:"Heading 4",header5:"Heading 5",header6:"Heading 6",def_link:"Link Refrence",def_footnote:"Footnote",table:"Table",fences:"Fences",quote:"Quote",blockquote:"Quote",hr:"Horizontal Line",meta_block:"YAML Front Matters",ol:"Ordered List",ul:"Unordered List",tasklist:"Task List",strong:"Strong",em:"Emphasis",code:"Code",del:"Strike",highlight:"Highlight",inline_math:"Inline Math",superscript:"Superscript",subscript:"subscript",image:"Image",footnote:"Superscript",autolink:"Hyperlink",reflink:"Hyperlink",link:"Hyperlink",url:"Hyperlink",underline:"Underline"}};r.InsertQuery='[md-inline="'+r.InsertInline.join('"],[md-inline="')+'"]',r.getMenuBlockType=function(a){var b=a.get("type");switch(b){case i.line:return i.paragraph;case i.heading:return"header"+a.get("depth");case i.list:return a.get("style")}return b},q.CONST=r,c.exports=q}),define("app/editor/Selection",["app/document/StringUtils","jquery/jquery","rangy/rangy-core","codemirror/lib/codemirror","app/document/Node","exoskeleton-master/exoskeleton"],function(a,b,c){"use strict";function d(){return!1}function e(){f("content").on("DOMMouseScroll mousewheel",d),setTimeout(function(){f("content").off("DOMMouseScroll mousewheel",d)},500)}var f=(a("app/document/StringUtils"),a("jquery/jquery")),g=a("rangy/rangy-core.js"),h=a("codemirror/lib/codemirror"),i=a("app/document/Node"),j=i.Node,k=j.TYPE,l=function(a){this.rangy=g,g.init(),this.savedSel={},this.editor=a,f(document).on("selectionchange",function(){a.selection.selectWordTime&&new Date-a.selection.selectWordTime>200&&(a.selection.selectWordTime=null)}),this.updateMetrics()},m=!1,n=f.fn.scrollTop;f.fn.oldScrollTop=n,f.fn.scrollTop=function(a){return void 0!==a&&m?void 0:n.apply(this,arguments)},e(),g.rangePrototype.insertNodeAtEnd=function(a){var b=this.cloneRange();b.collapse(!1),b.insertNode(a),b.detach(),this.setEndAfter(a)};var o,p;f("window").on("resize",function(){o=document.querySelector("#write").clientHeight}),l.prototype={updateMetrics:function(){o=document.querySelector("#write").clientHeight,p=f("content").offset().top,this.editor.defaultTextHeight=parseInt(f(".md-line").css("line-height"))},jumpIntoElemBegin:function(a,b){var c=this,d=(this.editor,a.find(".CodeMirror")[0]),e=a.children("[mdtype]");if(!a.length)return window.getSelection().removeAllRanges(),!1;if(d)return d.CodeMirror.focus(),d.CodeMirror.execCommand("goDocStart");if(a.attr("mdtype")==i.TYPE.fences)return this.editor.fences.focus(a.attr("cid"));if(j.isType(a.attr("mdtype"),j.TYPE.image,j.TYPE.hr,j.TYPE.math_block))return this.selectNode(null,a);if(a.hasClass("footnotes"))return this.jumpIntoElemBegin(a.find(".md-def-name"));if(e.length)return this.jumpIntoElemBegin(f(e[0]),b);var h=g.createRange();return h.setStart(a[0],0),h.setEnd(a[0],0),this.deRange(h),b&&setTimeout(function(){c.setRange(h),c.editor.refocus()},20),c.setRange(h),!window.getSelection().anchorNode&&a.length&&(!function k(a){3==a.nodeType?(h.setStart(a,0),h.setEnd(a,0)):a.childNodes.length?k(a.childNodes[0]):(h.setStart(a,0),h.setEnd(a,0))}(a[0]),window.getSelection().addRange(h)),window.getSelection().anchorOffset},jumpIntoElemEnd:function(a,b){var c=a.find(".CodeMirror")[0];if(c)c.CodeMirror.execCommand("goDocEnd");else{if(a.attr("mdtype")==i.TYPE.fences)return this.editor.fences.jumpCmEnd(a.attr("cid"));if(j.isType(a.attr("mdtype"),j.TYPE.image,j.TYPE.hr,j.TYPE.math_block))return this.selectNode(null,a);if(a.children("[mdtype]").length)return this.jumpIntoElemEnd(f(a.children("[mdtype]")[0]),b);this.restoreSelection(a[0],a.text().length)}},jumpInto:function(a,b){return""==a.text()?this.jumpIntoElemBegin(a):void this.restoreSelection(a[0],b)},setRange:function(a){f(a.startContainer).closest(".math-jax-postprocess, .md-meta, .md-content").parent().addClass("md-expand"),f(a.endContainer).closest(".math-jax-postprocess, .md-meta, .md-content").parent().addClass("md-expand"),File.isTypeWriterMode&&File.option.scrollWithCursor&&this.typeWriterScroll(a.nativeRange||a),this.rangy.getSelection().setSingleRange(a)},getOffset:function(a,b){var b=b||this.getRangy();if(b)try{return b.getBookmark(a[0]).start}catch(c){}return 0},restoreEdge:function(a,b,c,d){function e(a){if(3==a.nodeType){var f=i+a.textContent.length;if(c){if(b>=i&&f>=b)throw d.setEnd(a,b-i),j}else if(h){if(b>=i&&f>b)throw d.setStart(a,b-i),j}else if(b>=i&&f>=b)throw d.setStart(a,b-i),j;i=f}else{a.childNodes.length||a.nodeType!==a.ELEMENT_NODE||a.appendChild(document.createTextNode(""));for(var g=0,k=a.childNodes.length;k>g;++g)e(a.childNodes[g])}}a.jquery&&(a=a.length?a[0]:null);var h,i=0,j={};if(!c){var k=f(a).closest("[mdtype='line'], [mdtype='heading']");h=k.length&&b<k.text().length}d=d||g.createRange();try{a&&e(a)}catch(l){if(l==j)return d;throw l}return d},saveSelection:function(a,b){if(a){a.jquery&&(a=a[0]);var b=b||this.getRangy();return b?(this.savedSel=b.getBookmark(a),this.savedSel):void 0}},restoreSelection:function(a,b){if(!a)return window.getSelection().removeAllRanges();a.jquery&&(a=a[0]);var c="false"===a.getAttribute("contenteditable");if(void 0===b||null===b||""===b?b=this.savedSel:"number"==typeof b&&(b={start:b,end:b}),"fences"===a.getAttribute("mdtype")){var d=this.editor.fences.getCm(a.getAttribute("cid"));return d.focus(),void d.setCursor(b.start)}var e=g.createRange();e.moveToBookmark({start:b.start,end:b.end,containerNode:a}),document.activeElement.hasAttribute("tabindex")&&this.editor.writingArea.focus(),e.collapsed&&this.deRange(e),c&&a.setAttribute("contenteditable","true"),this.setRange(e),c&&a.setAttribute("contenteditable","false")},getVeryFirstElem:function(a){return a.children("[cid]").length>0?this.getVeryFirstElem(a.children("[cid]").first()):a},getVeryLastElem:function(a){return a.children("[cid]").length>0?this.getVeryLastElem(a.children("[cid]").last()):a},getSelection:function(){return this.rangy.getSelection()},prepNode:function(a,b,c,d){var e,f=this.editor,h=this.getRangy(),l=this.editor.undo.UndoManager;try{if(h&&!c&&!h.collapsed){if(f.undo.completeSnap(!0),e=f.UserOp.surroundPair(f,a,h))return b&&b.preventDefault(),!c&&f.undo.register(e),e;e=f.UserOp.backspaceHandler(f,null,"delSelection",!0)}h=this.getRangy();var m,n,o=this.rangy.getSelection(),p=o.anchorOffset==g.dom.getNodeLength(o.anchorNode),q=f.getJQueryElem(window.getSelection().anchorNode),r=f.getMarkElem(window.getSelection().anchorNode),s=f.findNodeByElem(r),t=h.getBookmark(r[0]);if(e||c||f.undo.snap(s.cid,1,void 0,d),q.hasClass("md-def-url")&&a.match(/\s/g).length)return p&&this.jumpIntoElemBegin(r.find(".md-def-title")),b&&b.preventDefault();if(!c&&e&&f.undo.snap(r.attr("cid"),a.length||1,f.docMenu.getAttrByElem(q)),r.removeClass("unholdable").find(".md-math-after-sym").text(""),s.get("type")==k.paragraph?(0===s.get("children").length&&j.normalizeNode(s),0===r.children("[mdtype]").length&&(r.replaceWith(s.toHTML()),this.jumpIntoElemEnd(this.editor.findElemById(s.cid)))):s.get("type")==k.meta_block||s.get("type")==k.fences||(s.isBlock()&&s.canNotDirectEdit()?(window.getSelection().removeAllRanges(),b&&b.preventDefault()):q.hasClass("md-image")&&(1!=h.startOffset||q.prev().length||(q.before(""),h.setStartBefore(q.parent()),o.setSingleRange(h)))),s.get("children").length){console.debug("wrong cursor");var u=window.getSelection().anchorNode.childNodes,v=window.getSelection().anchorOffset,w=v>0?u[v-1]:null,x=v<u.length?u[v]:null,y=f.findNodeByElem(w?f.getMarkElem(w):[]),z=f.findNodeByElem(x?f.getMarkElem(x):[]);if(a=a.replace("",""),j.isType(z,i.TYPE.table)){f.undo.completeSnap(!0),e=e||l.makeEmptyCommand();var A=new j({type:i.TYPE.paragraph,text:a,"in":z.get("in")});z.insert(A,!0),l.addUndoForInsert(e,A),f.findElemById(z.id).before(A.toHTML()),f.selection.restoreSelection(f.findElemById(A.id)[0],a.length),m=A}else if(j.isType(y,i.TYPE.table)){f.undo.completeSnap(!0),e=e||l.makeEmptyCommand();var A=new j({type:i.TYPE.paragraph,text:a,"in":y.get("in")});y.insert(A),l.addUndoForInsert(e,A),f.findElemById(y.id).after(A.toHTML()),f.selection.restoreSelection(f.findElemById(A.id)[0],a.length),m=A}else z?(z=z.getVeryFirst(),f.undo.snap(z.cid,1),z.set("text",a+z.safeGetStrAttr("text",!0)),f.findElemById(z.id).replaceWith(z.toHTML()),z&&f.selection.jumpInto(f.findElemById(z.id),1),e=null):y&&(y=y.getVeryFirst(!0),f.undo.snap(y.cid,1),y.set("text",y.safeGetStrAttr("text",!0)+a),f.findElemById(y.id).replaceWith(y.toHTML()),f.selection.jumpIntoElemEnd(f.findElemById(y.id)),e=null);e&&e.redo.push(this.buildUndo()),!c&&f.refocus(m.id),b&&b.preventDefault()}else h.collapsed&&!File.isMac&&(n=f.UserOp.hanldePair(f,a,s,t,e))?("object"==typeof n&&(e=n),b&&b.preventDefault()):e&&(f.UserOp.insertInlineText(f,s,a,t.start,e,!0),l.append(e,f.undo.completeSnap(!0,!0)),b&&b.preventDefault());return!c&&e&&this.editor.undo.register(e),e}catch(B){}},getPosBookmark:function(){var a=editor.getMarkElem();if(a.length){var b=this.editor.fences.queue[a.attr("cid")];return b?{isCm:b,cid:b.cid,start:b.indexFromPos(b.getCursor())}:{isCm:!1,cid:a.attr("cid"),start:this.getRangy().getBookmark(a[0]).start}}},getRangy:function(a){var b=this.rangy.getSelection(),c=b.rangeCount?b.getRangeAt(0):null;return c&&a&&this.deRange(c),c},buildUndo:function(a){var b={};b.type="cursor";try{a=a||this.getRangy();var c=this.editor.getMarkElem(a?a.commonAncestorContainer:void 0);if(c.children(".CodeMirror").length){var d=c.children(".CodeMirror")[0].CodeMirror;b.id=d.cid,b.pos=d.getCursor(),b.selections=d.listSelections()}else if(c.attr("mdtype")&&c.children("[tabindex]").andSelf("[tabindex]").length)b.id=c.attr("cid"),b.focus=c.attr("mdtype");else{if(!a)return;var e=this.editor.getMarkElem(this.getDetailPos(a.startContainer,a.startOffset)[0]),f=this.editor.getMarkElem(this.getDetailPos(a.endContainer,a.endOffset)[0]),g=a.getBookmark(e[0]);e===f?(b.id=e.attr("cid"),b.start=g.start,b.end=g.end):(b.startId=e.attr("cid"),b.endId=f.attr("cid"),b.start=g.start,b.end=a.getBookmark(f[0]).end)}}catch(h){console.log(h.stack)}return b},selectNode:function(a,b){b=b||editor.findElemById(a.id),b.length&&void 0!==b.attr("tabindex")&&(window.getSelection().removeAllRanges(),b.addClass("onfocus"),b.focus())},moveLeftOrRight:function(a,b){function c(b){return f(a?b.startContainer:b.endContainer).closest(".md-inline-math").addClass("md-expand").length}var d=this.editor.getMarkElem()[0],e=this.getRangy();if("TEXTAREA"!=b.target.tagName&&"INPUT"!=b.target.tagName&&e&&d){var h=e.getBookmark(d),i=g.createRange();if(!(a&&0===h.start||!a&&h.end>=d.textContent.length))return a?(h.end=h.start,h.start--):(h.start=h.end,h.end++),i.moveToBookmark(h),/\u200b/g.exec(i.toString())?(i.collapse(a),this.setRange(i),!0):!c(i)||b.ctrlKey||b.metaKey||b.altKey?void 0:(i.collapse(a),this.setRange(i),b&&b.preventDefault(),!0)}},addUnholdable:function(a,b,c,d){var e=function(a,b){var c=k.paragraph;a.get("type")==k.list_item&&(c=k.list_item);var d=new j({type:c});return a.insert(d,b),j.normalizeNode(d),d};this.editor.undo.completeSnap(!0);var g=e(a,c),h=this.editor.findElemById(a.id),i=c?a:void 0,l=c?void 0:a;return c?h.before(g.toHTML()):h.after(g.toHTML()),b=b||this.editor.undo.UndoManager.makeEmptyCommand(),f(".unholdable").removeClass("unholdable"),this.editor.findElemById(g.id).addClass(d?"":"unholdable"),this.editor.undo.UndoManager.addUndoForInsert(b,g,l,i),g},moveUpOrDown:function(a,b){function c(a,b){return j.isType(a,j.TYPE.hr,j.TYPE.toc)&&(!b||b[0].hasAttribute("tabindex"))}function d(a,b){var c,d=a.closest("td"),e=d.prevAll().length+1;if(!d.length){if(b)return[];d=a.closest("th"),e=d.prevAll().length+1}return"TD"==d[0].tagName?(c=d.closest("tr")[b?"prev":"next"]().find("td:nth-child("+e+")>.td-span"),b&&!c.length&&(c=d.closest("tbody").prev().find("tr:last > th:nth-child("+e+") > .td-span")),c):b?[]:d.closest("thead").next().find("tr:first > td:nth-child("+e+")>.td-span")}function e(a,b){return b?j.isType(a,k.fences,k.table,k.math_block,k.hr,k.toc):j.isType(a,k.fences,k.table,k.math_block,k.hr,k.toc,k.def_footnote,k.def_link)}function g(a,b,c){var d=a.getVeryFirstBrotherIncludeTopBlock(b),f=s.editor.undo.UndoManager.makeEmptyCommand();return(!d&&!a.get(b?"before":"after")||e(a)&&e(d,!0))&&(b&&j.isType(a,a.TYPE.meta_block)||(d=s.addUnholdable(a,f,b))),f.undo.push(s.buildUndo()),c&&c(),b?s.jumpIntoElemEnd(s.editor.findElemById(d.id),!0):s.jumpIntoElemBegin(s.editor.findElemById(d.id),!0),f}function h(a,b,c){a.hasClass("unholdable")&&b&&(a.text().length||a.children(".md-line").length>1?a.removeClass("unholdable"):(s.editor.undo.UndoManager.addUndoForRemove(c,b),c.redo.push(s.buildUndo()),b.remove(),a.remove(),s.editor.undo.register(c)))}function l(a,c){x=g(a.getClosetBlock(),c),b&&b.preventDefault(),s.editor.undo.UndoManager.isEmptyCommand(x)||(x.redo.push(s.buildUndo()),s.editor.undo.register(x)),s.scrollAdjust()}function m(a){a&&(a.codemirrorIgnore=!0,a.preventDefault(),a.stopPropagation())}function n(a,c,d){var e=d||s.editor.fences.getCm(a.id),h=(e.doc.getCursor(),!d&&document.activeElement===u[0].querySelector("input.mode")),i=c&&0==e.doc.getCursor().line,j=!c&&e.doc.getCursor().line==e.lineCount()-1;(d||!f(".autoComplt-list").is(":visible"))&&(c&&h?s.editor.fences.jumpCmEnd(u.attr("cid")):!j||d||h?(i||j||!c&&h)&&(x=g(a,c,function(){e.getInputField().blur()}),m(b),c&&!s.editor.undo.UndoManager.isEmptyCommand(x)&&(x.redo.push(s.buildUndo()),s.editor.undo.register(x))):(e.getInputField().blur(),m(b),setTimeout(function(){u.find("input.mode").focus()},10)),b.stopPropagation())}function o(a){var b=a[0];return b.childElementCount>0&&function(){for(var a=0;a<b.childElementCount;a++)if(b.children[0].getAttribute("md-inline")!==k.image)return!1;return!0}()}function p(d,e,g){var i=s.editor.findElemById(d.id);if(h(e.closest(".unholdable"),w.getClosetParagraphLevel(),g),j.isType(d,k.fences)){var l=s.editor.fences.getCm(d.id);l.focus(),l.execCommand(a?"goDocEnd":"goDocStart"),s.editor.refocus()}else if(j.isType(d,k.table,k.table_row,k.table_cell))s.jumpIntoElemBegin(i);else if(j.isType(d,k.math_block)){var l=s.editor.mathBlock.startEditing(i,!0);l.focus(),l.execCommand(a?"goDocEnd":"goDocStart"),s.editor.refocus()}else if(c(d))m(b),window.getSelection().removeAllRanges(),editor.findElemById(d.id).focus();else if(o(i))m(b),i.find("img:first").trigger("click");else if(j.isType(d,k.line,k.paragraph,k.heading,k.def_link,k.def_footnote)&&!d.get("text"))s.jumpIntoElemBegin(i),b&&b.preventDefault();else if(j.isType(d,k.meta_block)&&a)s.jumpIntoElemEnd(i),b&&b.preventDefault();else if(i.length){var n,p=i[0].getBoundingClientRect();n=a?document.caretRangeFromPoint(p.right-1,p.bottom-parseInt(i.css("paddingBottom"))-1):document.caretRangeFromPoint(p.left+1,p.top+parseInt(i.css("paddingTop"))+1),n.commonAncestorContainer.parentElement.querySelector("[cid]")?a?s.jumpIntoElemEnd(i):s.jumpIntoElemBegin(i):s.setRange(n),File.isFocusMode&&(f(".md-focus").removeClass("md-focus"),i.addClass("md-focus")),m(b)}}var r,s=this,t=function(a,b,c){if(c=c||this.getRangy(),c.collapsed){if(r=q(c.nativeRange),!r||!a.length)return 0==a.text().length;var d=a[0].getBoundingClientRect();return b?d.bottom-r.bottom<parseInt(a.css("paddingBottom"))+10:r.top-d.top<parseInt(a.css("paddingTop"))+10}};try{var u=this.editor.getMarkElem(),v=u.attr("mdtype"),w=this.editor.findNodeByElem(u),x=s.editor.undo.UndoManager.makeEmptyCommand();if(!w)return;if(c(w,u)||u.hasClass("rawedit"))l(w,a);else if(v==i.TYPE.fences)n(w,a);else if(v==i.TYPE.math_block&&this.editor.mathBlock.currentCm)n(w,a,this.editor.mathBlock.currentCm);else if(u.closest(".td-span").length){var y=d(u.closest(".td-span"),a);y.length?(b&&b.preventDefault(),a?this.jumpIntoElemEnd(y):this.jumpIntoElemBegin(y)):l(w,a)}else if(u.closest(".md-meta-block").length&&!a)!u.text().substring(window.getSelection.focusOffset).match(/\S+\n+/)&&l(w,a);else{var z=w.getClosetBlock(!0).getVeryFirstBrotherIncludeTopBlock(a);if(x.undo.push(this.editor.lastCursor),t.call(this,u,!a))z?p(z,u,x):!a&&u.text().trim().length&&l(w,a);else if(File.isTypeWriterMode&&File.option.scrollWithCursor&&r&&r.left){var A=r.left,B=a?r.top-9:r.bottom+9,C=document.caretRangeFromPoint(A,B);this.editor.writingArea.contains(C.startContainer)&&q(C).top!=r.top&&(this.setRange(C),m(b))}}}catch(D){console.log(D.message)}},click:function(a,b,c){window.getSelection().removeAllRanges();var d=document.createEvent("MouseEvent"),e=document.elementFromPoint(a,b);c="click",d.initMouseEvent(c,!0,!0,window,null,a,b,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(d)},jumpSelection:function(){return this.scrollAdjust(null,20)},jumpTop:function(a){var b=this.editor;if(b.sourceView.inSourceMode)b.sourceView.cm.execCommand("goDocStart");else{var c=this.getRangy();a&&c?(c.setStart(b.writingArea,0),this.deRange(c),this.setRange(c)):this.jumpIntoElemBegin(this.editor.findElemById(this.editor.nodeMap.getFirst().cid)),File.isTypeWriterMode||f("content").animate({scrollTop:0},"100","swing",function(){b.docMenu.highlightVisibleHeader()})}},jumpBottom:function(a){var b=this.editor;if(b.sourceView.inSourceMode)b.sourceView.cm.execCommand("goDocEnd");else{var c=this.getRangy();a&&c?(c.setEnd(b.writingArea,b.writingArea.childNodes.length),this.setRange(c)):this.jumpIntoElemEnd(this.editor.findElemById(this.editor.nodeMap.getLast().cid)),File.isTypeWriterMode||f("content").animate({scrollTop:document.querySelector(this.editor.sessionStr).scrollHeight-window.innerHeight},"100","swing",function(){b.docMenu.highlightVisibleHeader()})}},lockScroll:function(){m=!0},typeWriterScroll:function(a,b,c){function d(a){return 0==a.top&&0==a.bottom?!1:(a=a.top-o/2+e.defaultTextHeight/2,Math.abs(a)>2&&(c?f("content").animate({scrollTop:f("content").scrollTop()+a},120,"swing",c):f("content").scrollTop(f("content").scrollTop()+a)),!0)}m=!1;var e=this.editor;if(File.isTypeWriterMode){var g;if(b)return g=a.jquery&&a.length&&a[0].getBoundingClientRect(),void(g&&(g=document.caretRangeFromPoint((g.left+g.right)/2,g.bottom-10),this.typeWriterScroll(g)));if(!a||a.getBoundingClientRect)return void((g=a||window.getSelection().rangeCount&&window.getSelection().getRangeAt(0))&&d(g.startContainer.nodeType==document.TEXT_NODE&&g.startContainer.parentElement.hasAttribute("cid")?g.startContainer.parentElement.getBoundingClientRect():q(g)));a.jquery&&a.length&&d(a[0].getBoundingClientRect())}},scrollAdjust:function(a,b,c,d){function g(a){d?f("content").animate({scrollTop:a},d):(f("content").scrollTop(a),e())}if(this.editor.sourceView&&this.editor.sourceView.inSourceMode)return void this.editor.sourceView.scrollAdjust();if(File.isTypeWriterMode)return this.typeWriterScroll(a);try{var h,i,j,k=window.innerHeight,l=f("content").scrollTop(),m=this.editor;if(a&&a.jquery){if(!a.length)return;h=a.offset().top+l}else if(a&&void 0!==a.startContainer)h=(a.nativeRange||a).getClientRects()[0].top+l;else{if(f(".CodeMirror-selected").length)return this.scrollAdjust(f(".CodeMirror-selectedtext"));i=window.getSelection().getRangeAt(0),i?(j=i.getClientRects()[0],j||(j=i.endContainer.nodeType===document.TEXT_NODE?i.endContainer.parentElement.getClientRects()[0]:i.endContainer.getClientRects()[0]),h=j.top+l):h=f(document.activeElement).offset().top}var n=(File.isNodeHtml?f("#top-titlebar").height():0)+(f("#md-searchpanel:visible").height()||0);void 0!=b?f("content").animate({scrollTop:h-b-n},"500","swing",function(){m.docMenu.highlightVisibleHeader()}):h>k+l-(c?70:200)+n?g(h-k+(c?70:200)):l-30>h&&g(h-30-n),this.editor.docMenu.highlightVisibleHeader()}catch(o){}},selectAllElem:function(a){if(this.editor.sourceView.inSourceMode)return void this.editor.sourceView.cm.execCommand("selectAll");if(f("body").hasClass("typora-sourceview-on"))return this.editor.sourceView.cm.execCommand("selectAll");f(".md-math-after-sym").text("");var b=g.createRange();a.children().length?(b.setStart(a.children()[0]),b.setEndAfter(a.children()[a.children().length-1])):b.selectNode(a[0]),this.deRange(b,!0)},selectAll:function(a){if(this.editor.sourceView.inSourceMode)return void this.editor.sourceView.cm.execCommand("selectAll");if(f(".md-math-after-sym").text(""),document.activeElement&&j.isType(document.activeElement.tagName,"INPUT"))return void document.activeElement.select();var b=this.editor.getMarkElem(),c=g.createRange();if(b.hasClass("rawedit"))a||(c.selectNode(b[0]),this.setRange(c));else if(b.hasClass("md-fences")){var d=b.attr("cid");a||this.editor.fences.getCm(d).execCommand("selectAll")}else{if(a&&"INPUT"==a.target.tagName)return!0;b.closest("table").length?(this.selectAllElem(b.closest("[mdtype='table_cell']")),a&&a.preventDefault()):b.closest(".md-meta-block").length?(this.selectAllElem(b.closest("[mdtype='meta_block']")),a&&a.preventDefault()):(f(this.editor.sessionStr).addClass("md-expand"),f(".footnotes, .md-fences, .task-list, .hr, .mathjax-block").attr("contenteditable",!0),c.setStart(f(this.editor.sessionStr).children()[0]),c.setEndAfter(f(this.editor.sessionStr).children().last()[0]),f(this.editor.sessionStr).removeClass("md-expand"),this.deRange(c,!0),a&&a.preventDefault(),setTimeout(function(){f(".footnotes, .md-fences, .task-list, .hr, .mathjax-block").attr("contenteditable",!1)},10))}this.editor.lastCursor=this.buildUndo()},getEndNode:function(a){return this.getDetailPos(a.endContainer,a.endOffset)[0]},getDetailPos:function(a,b,c){function d(a){1===a.nodeType&&0===a.childNodes.length&&a.appendChild(document.createTextNode(""))}function e(a){if(d(a),a.childNodes.length)return a.childNodes.length;if(3===a.nodeType)return a.textContent.length;if(void 0!==a.length)return a.length;throw f}var f={};if(1==a.nodeType){var g=a.childNodes;if(a.classList.contains("md-image")&&2===b&&(b=1),d(a),!g||!g.length)return[a,b];try{var h=g[b]&&g[b].getAttribute&&"checkbox"===g[b].getAttribute("type");return c?(h&&b++,b==g.length?this.getDetailPos(g[b-1],e(g[b-1])):this.getDetailPos(g[b],0,!0)):0==b?(h&&b++,this.getDetailPos(g[b],0)):this.getDetailPos(g[b-1],e(g[b-1]))}catch(i){return[a,b]}}return[a,b]},deRange:function(a,b){var c=this.getDetailPos(a.startContainer,a.startOffset,!0),d=this.getDetailPos(a.endContainer,a.endOffset,!1);return b&&c[0].parentElement&&"HR"==c[0].parentElement.tagName&&(c[0]=c[0].parentElement.parentElement),a.setStart.apply(a,c),a.setEnd.apply(a,d),b&&this.setRange(a),a},selectLine:function(){if(this.editor.sourceView.inSourceMode){var a=this.editor.sourceView.cm,b=a.getCursor();return void a.setSelection(h.Pos(b.line,0),h.Pos(b.line,a.getLine(b.line).length))}if(document.activeElement&&j.isType(document.activeElement.tagName,"INPUT"))return void document.activeElement.select();if(window.getSelection().rangeCount){var c=window.getSelection(),d=this.editor.getMarkElem(c.commonAncestorContainer),e=g.createRange();if(d.length)if(d.closest("tr[mdtype='table_row']").length){var f=d.closest("tr[mdtype='table_row']");e.selectNode(f[0]),f.closest("table").attr("contenteditable",!0),this.setRange(e),f.closest("table").attr("contenteditable",!1)}else{var i=d.hasClass("md-expand");d.addClass("md-expand"),window.getSelection().modify("move","backward","sentence"),window.getSelection().modify("extend","forward","sentence"),e=this.getRangy();var k=this.editor.getMarkElem(e.startContainer);k.length&&k[0]!==this.editor.getMarkElem(e.endContainer)[0]&&(e.setEndAfter(k[0]),this.deRange(e,!0)),i&&d.removeClass("md-expand")}}},selectWord:function(a,b){if(this.editor.sourceView.inSourceMode){var c=this.editor.sourceView.cm,d=c.findWordAt(c.getCursor());return void c.extendSelection(d.anchor,d.head)}if(this.selectWordTime=new Date,a){var e,g,h,i,j,k,l=this.getRangy();if(l){if(e=f(l.commonAncestorContainer),g=e.closest("[md-inline='url'], [md-inline='image'], [md-inline='refimg']"),g.length)return this.selectAllElem(g);if(g=e.closest("[md-inline='plain']"),j=l.getBookmark(g[0]),g.length)for(h="image"==a?/(([\w-_]+:\/\/)|(www\.)|\w*\/)?[\w-.\/?%&=:@]+(\.jpe?g|png|gif|webm|svg)/gi:/(([\w-_]+:\/\/)|(www\.)|\w*\/)[\w-.\/?%&=:@]*/gi,i=g.text();k=h.exec(i);)if(h.lastIndex-k[0].length<=j.start&&h.lastIndex>=j.end)return j.start=h.lastIndex-k[0].length,j.end=h.lastIndex,l.moveToBookmark(j),window.getSelection().removeAllRanges(),void this.rangy.getSelection().setSingleRange(l)}if("image"===a)return}if(File.isNodeHtml){editor.writingArea.setAttribute("contenteditable","false"),f(".md-focus").attr("contenteditable","true"),window.getSelection().modify("move","forward","word"),window.getSelection().modify("extend","backward","word");var l=this.getRangy(),m=/[\(\)\[\]\^&_\-+*#@!~`\\\/\{\}'":;<>,.?% ]+$/g.exec(l.toString());if(m&&l.toString()!=m[0]){var j=l.getBookmark(l.commonAncestorContainer.children?l.commonAncestorContainer:l.commonAncestorContainer.parentElement);j.end-=m[0].length,l.moveToBookmark(j),this.rangy.getSelection().setSingleRange(l)}editor.writingArea.setAttribute("contenteditable","true"),f(".md-focus").attr("contenteditable","")}else{var n=window.getSelection().toString();if(b){var l=this.getRangy();return void(/\S\s$/.exec(n)&&l.endContainer.nodeType==document.TEXT_NODE&&(l.setEnd(l.endContainer,Math.max(l.endOffset-1,0)),l.select()))}window.getSelection().modify("move","forward","word"),window.getSelection().modify("extend","backward","word")}},selectPhrase:function(){function a(b){return b?b.nodeType===b.ELEMENT_NODE?b.hasAttribute("md-inline")&&b.getAttribute("md-inline")!==k.plain?b:b.hasAttribute("md-type")?null:a(b.parentElement):b.nodeType===b.TEXT_NODE?a(b.parentElement):null:null}function b(a,b,c){var d=a.getAttribute("md-inline");d==k.image&&(c=!1,a=a.children[0]),c?b.selectNodeContents(a):b.selectNode(a)}function c(){return/md-def-(name|url|title)|/gi.exec(document.activeElement.className)}if(this.editor.sourceView.inSourceMode){var d=this.editor.sourceView.cm,e=d.findWordAt(d.getCursor());return void d.extendSelection(e.anchor,e.head)}if(document.activeElement&&j.isType(document.activeElement.tagName,"INPUT"))return void document.activeElement.select();var g,h=this.getRangy(!0),i=!1;if(h){if(this.editor.styleBookmark.style){var l=this.editor.styleBookmark.style.block;if(l.indexOf(k.def_footnote)>-1||l.indexOf(k.def_link)>-1?c()&&(i=!0,g=f(h.startContainer).closest(".md-def-name, .md-def-url, .md-def-title")[0]):l.indexOf(k.table)>-1&&(i=!0,g=f(h.startContainer).closest("[mdtype='table_cell']")[0]),g=g||a(h.startContainer))return b(g,h,i),this.setRange(h)}return this.selectWord()}},isCrossBlock:function(a){return a=a||this.getRangy(),a?a.collapsed?!1:this.editor.getJQueryElem(a.commonAncestorContainer).find("[mdtype]").length:a},getTextAround:function(){var a,b,c=this.getRangy();if(c&&c.collapsed){var d=f(c.startContainer).closest("[md-inline='plain'], .md-lang")[0],e=c.getBookmark(d);if(d)return c.setStartBefore(d),a=c.toString(),c.collapse(!1),c.setEndAfter(d),b=c.toString(),c.setStart(d,0),[a,b,e]}return[]},getCharCountInSelection:function(){var a=window.getSelection().toString();return a.length},getWordCountInSelection:function(){var a=window.getSelection().toString();return this.editor.EditHelper.getWordCount(a)}};var q=function(a){var b,c=a.getClientRects(),d=c.length&&c[c.length-1];return!d&&a.collapsed?(b=a.startContainer.nodeType==document.TEXT_NODE?a.startContainer.parentElement:a.startContainer,b.getBoundingClientRect()):d},r=function(a,b,c){function d(a){if(3==a.nodeType){var g=e+a.textContent.length;if(!h&&b>=e&&g>=b&&(f.setStart(a,b-e),h=!0),h&&c>=e&&g>=c)throw f.setEnd(a,c-e),i;e=g}else for(var j=0,k=a.childNodes.length;k>j;++j)d(a.childNodes[j])}if(!a)return window.getSelection().removeAllRanges();var e=0,f=g.createRange(),h=!1,i={};f.collapseToPoint(a,0);try{d(a)}catch(j){if(j==i)return f;throw j}};c.exports=l,c.exports.buildRange=r,c.exports.rangy=g}),define("app/editor/TableEdit",["jquery/jquery","exoskeleton-master/exoskeleton","app/document/Node","app/document/StringUtils","app/editor/UndoManager","app/editor/polyfill","app/editor/KeyMaster"],function(a,b,c){"use strict";var d=a("jquery/jquery"),e=a("exoskeleton-master/exoskeleton"),f=a("app/document/Node"),g=f.TYPE,h=f.Node,i=a("app/editor/UndoManager"),j=(a("app/editor/polyfill"),a("app/editor/KeyMaster").map),k=e.Model.extend({initialize:function(a){function b(b){var c,e,f=/md-align-\S+/g.exec(this.className)[0].substring(9),g=d(this).closest("th").prevAll().length-1,h=d(this).closest("table"),i=a.findNodeByElem(h);c=i.get("align")[g],e=c==f?null:f,i.attr("align_idx",[g,e],a),b.stopPropagation()}function c(b){function c(){var a=d(this).closest("td"),b=a.prevAll().length+1,c=a.closest("tr").prevAll().length+1;c=1===c?2:c,h.find("a.md-active").removeClass("md-active"),h.find("tr:nth-child(-n+"+c+")>td:nth-child(-n+"+b+")>a").addClass("md-active"),h.find("#md-grid-width").val(b),h.find("#md-grid-height").val(c),h.find("#md-resize-grid").hide()}function f(){d(this).val().trim().length||d(this).val(2);var a=h.find("#md-grid-width").val(),b=h.find("#md-grid-height").val();h.find("a.md-active").removeClass("md-active"),h.find("tr:nth-child(-n+"+b+")>td:nth-child(-n+"+a+")>a").addClass("md-active")}function g(){var b,c=h.find("#md-grid-width").val(),d=h.find("#md-grid-height").val(),f=m.getFirstChild(),g=m.get("align").length,i=0,j=a.undo.UndoManager.makeEmptyCommand();for(j.undo.push(a.undo.buildReplaceUndo(m));f||d>i;)d>i?(f?k.resizeRow(f,c,m):f=k.newEmptyRowAfter(b,c,m),b=f,f=b.get("after")):f&&(b=f,f=f.get("after"),b.delete()),i++;g>c?m.set("align",m.get("align").slice(0,c)):m.set("align",m.get("align").concat([].repeat(null,c-g))),l.replaceWith(m.toHTML()),e.showTableEdit(m),window.getSelection().removeAllRanges(),j.redo.push(a.undo.buildReplaceUndo(m)),a.undo.register(j)}var h,i='<div class="popover bottom md-table-resize-popover" style="display:block; bottom:auto; top:20px; margin-left:-10px;" contenteditable="false">					<div class="arrow" style="left:20px;"></div>					<div class="md-grid-board-wrap md-reset code-tooltip-content">						<table role="grid" class="md-grid-board md-reset">							<tbody>								<tr class="md-reset" row="1">									<td class="md-reset" col="1"><a href="#"></a></td>									<td class="md-reset" col="2"><a href="#"></a></td>									<td class="md-reset" col="3"><a href="#"></a></td>									<td class="md-reset" col="4"><a href="#"></a></td>									<td class="md-reset" col="5"><a href="#"></a></td>									<td class="md-reset" col="6"><a href="#"></a></td>								</tr>								<tr class="md-reset" row="2">									<td class="md-reset" col="1"><a href="#"></a></td>									<td class="md-reset" col="2"><a href="#"></a></td>									<td class="md-reset" col="3"><a href="#"></a></td>									<td class="md-reset" col="4"><a href="#"></a></td>									<td class="md-reset" col="5"><a href="#"></a></td>									<td class="md-reset" col="6"><a href="#"></a></td>								</tr>								<tr class="md-reset" row="3">									<td class="md-reset" col="1"><a href="#"></a></td>									<td class="md-reset" col="2"><a href="#"></a></td>									<td class="md-reset" col="3"><a href="#"></a></td>									<td class="md-reset" col="4"><a href="#"></a></td>									<td class="md-reset" col="5"><a href="#"></a></td>									<td class="md-reset" col="6"><a href="#"></a></td>								</tr>								<tr class="md-reset" row="4">									<td class="md-reset" col="1"><a href="#"></a></td>									<td class="md-reset" col="2"><a href="#"></a></td>									<td class="md-reset" col="3"><a href="#"></a></td>									<td class="md-reset" col="4"><a href="#"></a></td>									<td class="md-reset" col="5"><a href="#"></a></td>									<td class="md-reset" col="6"><a href="#"></a></td>								</tr>								<tr class="md-reset" row="5">									<td class="md-reset" col="1"><a href="#"></a></td>									<td class="md-reset" col="2"><a href="#"></a></td>									<td class="md-reset" col="3"><a href="#"></a></td>									<td class="md-reset" col="4"><a href="#"></a></td>									<td class="md-reset" col="5"><a href="#"></a></td>									<td class="md-reset" col="6"><a href="#"></a></td>								</tr>								<tr class="md-reset" row="6">									<td class="md-reset" col="1"><a href="#"></a></td>									<td class="md-reset" col="2"><a href="#"></a></td>									<td class="md-reset" col="3"><a href="#"></a></td>									<td class="md-reset" col="4"><a href="#"></a></td>									<td class="md-reset" col="5"><a href="#"></a></td>									<td class="md-reset" col="6"><a href="#"></a></td>								</tr>								<tr class="md-reset" row="7">									<td class="md-reset" col="1"><a href="#"></a></td>									<td class="md-reset" col="2"><a href="#"></a></td>									<td class="md-reset" col="3"><a href="#"></a></td>									<td class="md-reset" col="4"><a href="#"></a></td>									<td class="md-reset" col="5"><a href="#"></a></td>									<td class="md-reset" col="6"><a href="#"></a></td>								</tr>								<tr class="md-reset" row="8">									<td class="md-reset" col="1"><a href="#"></a></td>									<td class="md-reset" col="2"><a href="#"></a></td>									<td class="md-reset" col="3"><a href="#"></a></td>									<td class="md-reset" col="4"><a href="#"></a></td>									<td class="md-reset" col="5"><a href="#"></a></td>									<td class="md-reset" col="6"><a href="#"></a></td>								</tr>								<tr class="md-reset" row="9">									<td class="md-reset" col="1"><a href="#"></a></td>									<td class="md-reset" col="2"><a href="#"></a></td>									<td class="md-reset" col="3"><a href="#"></a></td>									<td class="md-reset" col="4"><a href="#"></a></td>									<td class="md-reset" col="5"><a href="#"></a></td>									<td class="md-reset" col="6"><a href="#"></a></td>								</tr>								<tr class="md-reset" row="10">									<td class="md-reset" col="1"><a href="#"></a></td>									<td class="md-reset" col="2"><a href="#"></a></td>									<td class="md-reset" col="3"><a href="#"></a></td>									<td class="md-reset" col="4"><a href="#"></a></td>									<td class="md-reset" col="5"><a href="#"></a></td>									<td class="md-reset" col="6"><a href="#"></a></td>								</tr>							</tbody>						</table>						<div class="popover-title">							<input id="md-grid-width" type="text"  max="20" size="2" min="1" value="0" /> x <input id="md-grid-height" maxlength="2" size="2" min="1" value="0"/><button id="md-resize-grid" class="btn btn-primary btn-xs">OK</button>						</div>					</div>				</div>',l=b.closest("table"),m=a.findNodeByElem(l),n=m.get("align").length,o=l.children("tbody").children("tr").length+1;
d(".md-table-resize-popover").remove(),b.append(i),h=b.find(".md-table-resize-popover"),h.find("tr:nth-child(-n+"+o+")>td:nth-child(-n+"+n+")").addClass("md-grid-ext"),h.find("#md-grid-width, #md-grid-height").off("keydown keypress").on("keypress",function(a){return/\d/.exec(String.fromCharCode(a.which))?void 0:!1}).on("keydown",function(a){var b=a.keyCode||a.which;return"Up"===j[b]?(this.value=this.value-0+1,this.value=Math.min(20,this.value),!1):"Down"===j[b]?(this.value=this.value-1,this.value=Math.max(2,this.value),!1):void 0}),h.find("#md-grid-width").val(n).off("blur focus").blur(f).focus(function(){h.find("#md-resize-grid").show()}).blur(function(){this.value>20?this.value=20:this.value<2&&(this.value=2)}).on("keydown",function(a){var b=a.keyCode||a.which;return"Tab"===j[b]?(h.find("#md-grid-height").focus(),!1):void 0}),h.find("#md-grid-height").val(o).off("blur focus").blur(f).focus(function(){h.find("#md-resize-grid").show()}).blur(function(){this.value>99?this.value=99:this.value<2&&(this.value=2)}).on("keydown",function(a){var b=a.keyCode||a.which;return"Tab"===j[b]?(h.find("#md-grid-width").focus(),!1):void 0}),h.find(".md-grid-board a").off("mouseenter mouseleave click").hover(c).click(function(a){a.stopPropagation(),a.preventDefault(),h.find("#md-resize-grid").click()}),h.find("#md-resize-grid").off("click").click(g)}var e=this;this.editor=a,this.TableEdit=k,d(a.sessionStr).on("click",".md-align-gp button",b).on("click",".md-delete-table",function(){a.tableEdit.deleteTable(d(this).closest("table"))}).on("click",".md-resize-table",function(a){d(this).next(".md-table-resize-popover").length?d(".md-table-resize-popover").remove():c(d(this).parent()),a.stopPropagation()}).on("click",".md-table-edit",function(a){d(a.target).closest(".md-table-resize-popover").length||d(".md-table-resize-popover").remove(),a.stopPropagation()}).on("refocus",".md-table",function(){console.debug("focuse on table"),d(document.activeElement).closest("[md-inline='image']").length||e.showTableEdit(d(this))}).on("mouseup",".md-table-edit",function(a){a.stopPropagation()}),function(){var b=d("#table-insert-dialog");b.find("#table-insert-col, #table-insert-row").off("keydown keypress").on("keypress",function(a){return/\d/.exec(String.fromCharCode(a.which))?void 0:!1}).on("keydown",function(a){var b=a.keyCode||a.which;return"Up"===j[b]?(this.value=this.value-0+1,this.value=Math.min(20,this.value),!1):"Down"===j[b]?(this.value=this.value-1,this.value=Math.max(2,this.value),!1):void 0}),b.find("#table-insert-col").blur(function(){0===d(this).val().trim().length&&d(this).val(2),this.value>20?this.value=20:this.value<1&&(this.value=1)}).on("keydown",function(a){var c=a.keyCode||a.which;return"Tab"===j[c]?(b.find("#table-insert-row").focus(),!1):void 0}),b.find("#table-insert-row").blur(function(){0===d(this).val().trim().length&&d(this).val(2),this.value>20?this.value=20:this.value<2&&(this.value=2)}).on("keydown",function(a){var c=a.keyCode||a.which;return"Tab"===j[c]?(b.find("#table-insert-col").focus(),!1):void 0}),b.find(".btn-primary").click(function(){b.modal("hide"),a.restoreLastCursor(),d(File.editor.sessionStr).trigger("cursorChange");var c=new h({type:h.TYPE.table,"in":a.nodeMap});k.valify(c,b.find("#table-insert-col").val(),b.find("#table-insert-row").val()),a.stylize.insertBlock(h.TYPE.table,c)})}(),function(){d(a.sessionStr).on("keydown",".md-table",function(a){var b=a.keyCode||a.which;return"Tab"===j[b]?(e.moveToNextCell(!0,a.shiftKey),!1):"Enter"===j[b]?(a.metaKey||a.ctrlKey||a.shiftKey?e.addRow(!1):e.moveToBeblowCell(!0),!1):!a.metaKey&&!a.ctrlKey||"Left"!==j[b]&&"Right"!==j[b]?void 0:(e.moveToNextCell(!1,"Left"===j[b],!0),!1)})}()},insertTable:function(){File.isLocked||(this.editor.lastCursor=this.editor.selection.buildUndo(),d("#table-insert-dialog").modal({keyboard:!0}))},resizeTableEdit:function(a,b,c){for(var d=d||this.editor,b=b||a.closest(".md-table"),e=(d.findNodeByElem(b),b.offset()),f=b.width(),g=[],h=b.find("thead:nth-child(2)>tr>th"),i=(f-b.parent().width(),b.find("thead:first>tr:first>th:first").outerWidth(!0),0);i<h.length;i++)g.push(h[i].offsetWidth),f-=g[i];h=a.find("th");for(var i=0;i<h.length;i++)0!==i&&i!=h.length-1?(h[i].width=g[i-1],c&&c(h[i],i)):f-=h[i].offsetWidth;e.top-=a.height(),e.left+=f/2,a.offset(e)},showTableEdit:function(a){function b(a){var b,c=a.get("align"),d=[],e='<div class="btn-group btn-group-xs md-align-gp"><button type="button" class="btn btn-default md-align-left"><span class="glyphicon glyphicon-align-left"></span></button><button type="button" class="btn btn-default md-align-center"><span class="glyphicon glyphicon-align-justify"></span></button><button type="button" class="btn btn-default md-align-right"><span class="glyphicon glyphicon-align-right"></span></button></div>';for(d.push("<thead class='md-table-edit md-tooltip-remove' contenteditable='false' ><tr>"),d.push('<th class="md-th-button btn-group-xs .md-resize-table-th"><button type="button" class="btn btn-default md-resize-table"><span class="glyphicon glyphicon-th"></span></button></th>'),b=0;b<c.length;b++)d.push("<th>"),d.push(e),d.push("</th>");return d.push('<th class="md-th-button btn-group-xs"><button type="button" class="btn btn-default md-delete-table"><span class="glyphicon glyphicon-trash"></span></button></th>'),d.push("</tr></thead>"),d.join("")}function c(a,b){("left"===a||"right"===a||"center"===a)&&b.find(".md-align-"+a).addClass("active")}var e,f,g,h=a,i=a;a.jquery?h=editor.findNodeByElem(a):i=editor.findElemById(h.id),i.children(".md-table-edit").length||(d(".md-table-edit").remove(),f=b(h),e=h.get("align"),i.children("thead").before(f),g=i.children(".md-table-edit"),this.resizeTableEdit(g,i,function(a,b){c(e[b-1],d(a))}))},moveToNextCell:function(a,b,c){try{var d,e=this.editor.getMarkElem(window.getSelection().anchorNode).closest("[mdtype='table_cell']").parent(),f=(b?e.prev():e.next()).children("[mdtype='table_cell']");if(c){var g=this.editor.selection.getRangy(),h=g.getBookmark(e[0]);if(b&&h.end>0)return this.editor.selection.jumpIntoElemBegin(e),this.editor.refocus();if(!b&&h.start<e.text().length)return this.editor.selection.jumpIntoElemEnd(e),this.editor.refocus()}!f.length&&e.length&&(d=e.parent(),f=(b?d.prev().children(":last"):d.next().children(":first")).children("[mdtype='table_cell']"),f.length||(b&&"TD"===e[0].tagName?f=d.closest("table").find("thead:not(.md-table-edit)>tr>th:last>[mdtype='table_cell']"):b||"TH"!==e[0].tagName||(f=d.closest("table").find("tbody>tr:first>td:first>[mdtype='table_cell']")))),f.focus(),f.length&&(a?this.editor.selection.selectAllElem(f):b?this.editor.selection.jumpIntoElemEnd(f):this.editor.selection.jumpIntoElemBegin(f)),this.editor.refocus()}catch(i){}},moveToBeblowCell:function(a,b){try{var c=this.editor.getMarkElem(window.getSelection().anchorNode).closest("[mdtype='table_cell']"),d=this.editor.findNodeByElem(c),e=k.getNextCellInColumn(d,b),f=e&&this.editor.findElemById(e.cid);e?f.length&&(a?this.editor.selection.selectAllElem(f):b?this.editor.selection.jumpIntoElemEnd(f):this.editor.selection.jumpIntoElemBegin(f)):this.editor.selection.moveUpOrDown()}catch(g){}},getSibling:function(a,b){return k.getSibling(a,b)},unfocusAll:function(){d(".md-table-edit").remove()},deleteRow:function(){k.deleteRow(this.editor)},addRow:function(a){k.addRow(this.editor,a)},deleteCol:function(){k.deleteCol(this.editor)},addCol:function(a){k.addCol(this.editor,a)},copyTable:function(a){a=a||this.editor.getMarkElem(window.getSelection().anchorNode).closest("table");var b=a[0].outerHTML;this.editor.UserOp.setClipboard(b,b,a.text())},deleteTable:function(a){a=a||editor.getMarkElem(window.getSelection().anchorNode).closest("table");var b=this.editor.getNode(a.attr("cid")),c=editor.undo.UndoManager.makeEmptyCommand(this.editor.selection.buildUndo()),d=b.get("after"),e=b.get("before");d||e?(i.addUndoForRemove(c,b),b.remove(),a.remove()):(c.undo.push(i.buildReplaceUndo(b)),b.set("type",g.paragraph),b.set("text",""),a.replaceWith(b.toHTML()),c.redo.push(i.buildReplaceUndo(b))),d?this.editor.selection.jumpIntoElemBegin(this.editor.findElemById(d.id)):this.editor.selection.jumpIntoElemEnd((e||b).id),c.redo.push(this.editor.selection.buildUndo()),this.editor.undo.register(c)}});k.deleteRow=function(a){var b,c,d,e,f,g=a.getMarkElem(window.getSelection().anchorNode).closest("td"),h=a.getMarkElem(window.getSelection().anchorNode).closest("tr[mdtype='table_row']"),i=h.prevAll().length;if(h.siblings().length){for(c=a.findNodeByElem(h).get("parent"),a.undo.completeSnap(!0),b=a.undo.UndoManager.makeEmptyCommand(),b.undo.push(a.selection.buildUndo()),b.undo.push(a.undo.UndoManager.buildReplaceUndo(c)),e=c.getNthChild(1),d=i;d;)e=e.get("after"),d--;e.remove(),b.redo.push(a.undo.UndoManager.buildReplaceUndo(c)),a.findElemById(c.id).replaceWith(c.toHTML()),i?i--:i++,f=document.createRange();try{f.setStart(a.findElemById(c.id).find("tbody>tr:nth-child("+i+")>td:nth-child("+(g.prevAll().length+1)+")>span")[0],0),window.getSelection().removeAllRanges(),window.getSelection().addRange(f),b.redo.push(a.selection.buildUndo())}catch(j){}a.undo.register(b),a.tableEdit.showTableEdit(c)}},k.addRow=function(a,b){var c,d,e,f=a.getMarkElem(window.getSelection().anchorNode).closest("tr[mdtype='table_row']"),g="TBODY"==f.parent()[0].tagName,h=g?f.prevAll().length+1:0;(!b||g)&&(d=a.findNodeByElem(f).get("parent"),a.undo.completeSnap(!0),c=a.undo.UndoManager.makeEmptyCommand(),c.undo.push(a.selection.buildUndo()),c.undo.push(a.undo.UndoManager.buildReplaceUndo(d)),e=d.getNthChild(h),e=k.newEmptyRowAfter(b?e.get("before"):e,e.get("children").length,d),g?f[b?"before":"after"](e.toHTML()):a.findElemById(d.id).replaceWith(d.toHTML()),a.selection.jumpIntoElemBegin(a.findElemById(e.id)),c.redo.push(a.undo.UndoManager.buildReplaceUndo(d)),c.redo.push(a.selection.buildUndo()),a.undo.register(c),a.tableEdit.showTableEdit(d))},k.addCol=function(a,b){var c,d,e=a.getMarkElem(window.getSelection().anchorNode).closest("td, th"),f=e.prevAll().length;d=a.findNodeByElem(e.children("[cid]")).get("parent").get("parent"),a.undo.completeSnap(!0),c=a.undo.UndoManager.makeEmptyCommand(),c.undo.push(a.selection.buildUndo()),c.undo.push(a.undo.UndoManager.buildReplaceUndo(d)),d.get("children").toArray().map(function(a){a.getNthChild(f).insert(new h({type:h.TYPE.table_cell,text:""}),b)}),d.get("align").splice(b?f:f+1,0,null),a.findElemById(d.id).replaceWith(d.toHTML()),a.selection.jumpIntoElemBegin(a.findElemById(d.id)),c.redo.push(a.undo.UndoManager.buildReplaceUndo(d)),a.undo.register(c),a.tableEdit.showTableEdit(d)},k.deleteCol=function(a){var b,c,d=a.getMarkElem(window.getSelection().anchorNode).closest("td, th"),e=d.prevAll().length,f=d.nextAll().length;(e||f)&&(c=a.findNodeByElem(d.children("[cid]")).get("parent").get("parent"),a.undo.completeSnap(!0),b=a.undo.UndoManager.makeEmptyCommand(),b.undo.push(a.selection.buildUndo()),b.undo.push(a.undo.UndoManager.buildReplaceUndo(c)),c.get("children").toArray().map(function(a){a.getNthChild(e).remove()}),c.get("align").splice(e,1),a.findElemById(c.id).replaceWith(c.toHTML()),a.selection.jumpIntoElemBegin(a.findElemById(c.id)),b.redo.push(a.undo.UndoManager.buildReplaceUndo(c)),a.undo.register(b),a.tableEdit.showTableEdit(c))},k.getSibling=function(a,b){if(h.isType(a,h.TYPE.table_cell)){var b=b||"after",c=a.get(b),d=a.get("parent"),e=d.get(b);return!c&&e&&(c="after"==b?e.getFirstChild():e.getLastChild()),c}},k.getColumnIndex=function(a,b){return b=b||0,b++,(a?k.getColumnIndex(a.get("before"),b):b)-2},k.getCellAt=function(a,b){if(h.isType(a,h.TYPE.table_row)){for(var c=a.getFirstChild();b>0;)b--,c=c.get("after");return c}},k.getNextCellInColumn=function(a,b,c){if(h.isType(a,h.TYPE.table_cell)){var c=c||k.getColumnIndex(a),b=b||"after",d=a.get("parent"),e=d.get(b);return e?k.getCellAt(e,c):void 0}},k.resizeRow=function(a,b){for(var c,d=a.getFirstChild(),e=0;d||b>e;)b>e?(d||(d=new h({type:h.TYPE.table_cell,"in":c.get("in"),parent:a,before:c})),c=d,d=c.get("after")):d&&(c=d,d=c.get("after"),c.delete()),e++},k.newEmptyRowAfter=function(a,b,c){{var d=new h({type:h.TYPE.table_row,"in":c.get("in"),parent:c,before:a,after:a?a.get("after"):null});new h({type:h.TYPE.table_cell,"in":c.get("in"),parent:d})}return k.resizeRow(d,b),d},k.valify=function(a,b,c,d){var e;if(c=c||2,void 0===b&&(b=a.get("children").at(0),b=b?b.get("children").length:1),d&&1==a.get("children").length&&1==b)d(a,a.get("children").at(0).get("children").at(0).get("text"));else{a.get("children").map(function(a){for(var c=a.get("children").length;b>c;c++)c===a.get("children").length&&(e=a.getLastChild()),e=new h({type:h.TYPE.table_cell,parent:a,"in":a.get("in"),before:e,text:""})});for(var f=a.get("children").length;c>f;f++)k.newEmptyRowAfter(a.get("children").at(f-1),b,a);a.get("align")||a.set("align",new Array(b-0))}},h.TableEdit=k,c.exports=k}),define("app/editor/ImageEdit",["jquery/jquery","exoskeleton-master/exoskeleton","app/document/Node","app/document/StringUtils","app/editor/UserOp","app/editor/UndoManager","rangy/rangy-core","app/document/MarkParser","app/editor/Inline","app/editor/Emoji","app/editor/TableEdit","app/editor/polyfill","app/editor/KeyMaster","app/editor/ConvertUtils","app/editor/Stylize","app/editor/EditHelper","app/editor/Inline","app/editor/Selection","codemirror/lib/codemirror","app/window/FileHelper"],function(a,b,c){"use strict";var d=a("jquery/jquery"),e=a("exoskeleton-master/exoskeleton"),f=a("app/document/Node"),g=(f.Node,a("app/editor/UserOp"),a("app/editor/Inline")),h=a("app/editor/Selection"),i=h.rangy,j=a("app/document/StringUtils"),k=a("app/window/FileHelper"),l=null,m={},n=null;window.imgLastModified=Math.floor((new Date-0)/1e3);var o=e.Model.extend({initialize:function(a){this.editor=a,d(a.sessionStr).on("mousemove",".md-image>.md-meta",function(){event.offsetX-event.target.offsetLeft<20&&event.offsetY<30?this.classList.add("md-show-hint"):this.classList.remove("md-show-hint")}).on("mouseleave",".md-image>.md-meta",function(){this.classList.remove("md-show-hint")}).on("click","img",function(b){var c=d(b.target).closest(".md-image").addClass("md-expand"),e=i.createRange();e.moveToBookmark({containerNode:c.children(".md-meta")[0],start:2,end:2+(b.target.getAttribute("alt")||"").length}),a.selection.setRange(e)})},getLocalRootUrlForInsert:function(){return this.editor.docMenu.getLocalRootUrl()||File.option.useRelativePathForImgInsert&&k.getCurrentFileFolderPath()||""},getRealSrc:function(a){function b(a,b){return"file://"+a.replace(/^file:\/\//,"").replace(/\/$/,"")+"/"+b.replace(/^\//gi,"")}if(!a)return a;if(/^data:/.exec(a))return a;try{var c=/^(file|ftp|https?):(\/\/|\\\\)/gi.exec(a);if(c)return a;if(File.isNode){var d=reqnode("path");return"file://"+d.resolve(this.editor.docMenu.getLocalRootUrl()||k.getCurrentFileFolderPath()||"",a)}return/^(\/)|(\/\/)|(\\\\)|([a-z]+\:\\\\)/gi.exec(a)?b(this.editor.docMenu.getLocalRootUrl()||"",a||""):b(k.getCurrentFileFolderPath()||"",a||"")}catch(e){}return a},updateImgRef:function(a){var b=this.editor.brush.inline;d("[data-ref='"+j.escape(a)+"']").each(function(){var a=(this.querySelector(".md-content")||{}).textContent;void 0!==a&&d(this).replaceWith(b.output(a))})},willUpdateImgRef:function(a){a&&(n&&clearTimeout(n),m[a]=!0,l=l||new Date,new Date-l>200?setTimeout(function(){Object.keys(m).map(this.updateImgRef,this)}.bind(this),10):n=setTimeout(function(){Object.keys(m).map(this.updateImgRef,this)}.bind(this),300))},refreshLocalImg:function(){var a=Math.floor((new Date-0)/1e3);d(".md-image img").each(function(){var b=File.editor.imgEdit.getRealSrc(this.parentElement.getAttribute("data-src")),c=b+"?lastModify="+imgLastModified;/^file:\/\//i.exec(b)&&(failImgCache.remove(c),loadedImgCache.remove(c),this.setAttribute("src",b+"?lastModify="+a),this.setAttribute("onload",g.onLoadEvaluate),this.setAttribute("onerror",g.onErrorEvaluate))}),imgLastModified=a},updateLocalRootUrl:function(){var a=this.editor.docMenu.getLocalRootUrl()||"";if(this.editor.localRootUrl!=a)for(var b=document.querySelectorAll("[md-inline='image']"),c=0;c<b.length;c++){var e=b[c],h=e.querySelector("img");if(e.getAttribute("data-src")!=h.getAttribute("src")){var i=d.parseHTML(g.decorate({type:f.TYPE.image,markdown:e.textContent,alt:h.getAttribute("alt"),href:e.getAttribute("data-src")}))[0];e.parentElement.replaceChild(i,e)}}}});c.exports=o}),define("app/editor/UserOp",["exoskeleton-master/exoskeleton","jquery/jquery","app/document/StringUtils","app/document/Node","app/editor/UndoManager","rangy/rangy-core","app/document/MarkParser","app/editor/Inline","app/editor/UndoManager","app/editor/Emoji","app/editor/TableEdit","app/editor/polyfill","app/editor/KeyMaster","app/editor/ConvertUtils","app/editor/TableEdit","app/editor/Stylize","app/editor/Emoji","app/editor/EditHelper"],function(a,b){"use strict";function c(a){var b=d(a,null,!0);return"string"==typeof b?b:n.convertToPlain(b)}function d(a,b,c){b||(z.reset(!0),b=z);var d,e,f=$($.parseHTML("<div>"+a+"</div>")[0]),g=[],h=f.children("[mdtype]");return h.length?(h.each(function(){e=j.reverse($(this),b,c),e.set("before",d),d=e,g.push(e)}),g):c?(f.find("[data-emoji]").text(function(){return this.getAttribute("data-emoji")}),f.find(".md-meta, .md-content").remove(),f.text()):f.textExcludeSVG()}function e(a,b){var c=d(a,b);if(j.isType(c[0],k.line)){var e=new j({type:k.paragraph,"in":c[0].get("in")});return c.map(function(a){e.append(a)}),[e]}return c}function f(a){var b=e(a);return"string"==typeof b?b:j.markFromArr(b)}var g=(a("exoskeleton-master/exoskeleton"),a("app/document/StringUtils")),h=a("app/document/Node"),i=a("app/editor/UndoManager"),j=h.Node,k=h.TYPE,l=(h.NodeCollectionUtils,a("rangy/rangy-core.js")),m=(a("app/document/MarkParser"),a("app/editor/TableEdit")),n=a("app/editor/ConvertUtils"),o=a("app/editor/Stylize"),p=a("app/editor/Emoji"),q=(a("app/editor/EditHelper"),window.reqnode?reqnode("electron").remote:null),r="skipCommand",s=function(a,b,c,d,e,f){console.debug("insertInlineText"),b=b||function(){return k=a.getMarkElem(),a.getNode(k.attr("cid"))}();var g=a.getJQueryElem(window.getSelection().anchorNode),h=null,k=a.findElemById(b.id);if(j.noChangeLine(b)&&(c=c.trim().split(/[\n\r]+/gi)[0]),"\n"==c&&k.text().length<=d&&(c="\n"),e&&e.undo.push(i.buildReplaceUndo(b,void 0)),g.hasClass("md-def-name"))k=g.closest("[cid]"),h=a.docMenu.getAttrByElem(g),a.selection.getRangy().insertNode(document.createTextNode(c)),b.set("ref",g.text());else if(g.hasClass("md-def-url"))k=g.closest("[cid]"),h=a.docMenu.getAttrByElem(g),c=c.replace(/\s/gi,""),a.selection.getRangy().insertNode(document.createTextNode(c)),b.set("href",g.text());else if(g.hasClass("md-def-title"))k=g.closest("[cid]"),h=a.docMenu.getAttrByElem(g),a.selection.getRangy().insertNode(document.createTextNode(c)),b.set("title",g.text());else{var l,m="",n=d;g.hasClass("md-meta-block")&&0==g.text().length&&"\n"==c?l="\n\n":(g.hasClass("md-meta-block")&&m.length==d&&"\n"==m[d-1]?d--:g.closest(".md-def-content").length?(n-=b.get("ref").length,m=g.closest(".md-def-content").textExcludeSVG()):m=k.textExcludeSVG(),l=void 0!==n?m.substring(0,n)+c+m.substring(n):m.text()+c),b.set("text",l.replace("","")),k.html($(b.toHTML()).html())}e&&(a.store(b,!0),e.redo.push(i.buildReplaceUndo(b,void 0))),f&&(a.undo.exeCommand({id:b.id,type:"cursor",start:d+c.length}),a.brush.addToQueue(b.id)),e&&e.redo.push(a.selection.buildUndo()),a.brush.addToQueue(b.id),k=a.findElemById(b.id),f&&k.addClass("md-focus")},t=function(a,b,c,d,e){if(File.isMac)setTimeout(function(){d&&app.clipboard.clearContents(),a&&app.clipboard.copyForType(a,"text/html"),app.clipboard.copyForType(b,"text/markhtml"),c&&app.clipboard.copyForType(c,"text/plain")},20);else if(File.isNode&&e){if("cut_before"===File._CopyContentFlag||a){if(!a)return setTimeout(q.getCurrentWindow().webContents.copy,30),void(File._CopyContentFlag="cut_after");J(File.editor,null,"delSelection"),File._CopyContentFlag=!1}else if("cut_after"===File._CopyContentFlag)File._CopyContentFlag=!1,a=q.clipboard.readHtml(),J(File.editor,null,"delSelection");else{if(!File._CopyContentFlag||a)return File._CopyContentFlag=!0,void(!a&&setTimeout(q.getCurrentWindow().webContents.copy,30));File._CopyContentFlag===!0&&(a=q.clipboard.readHtml()),File._CopyContentFlag=!1}c&&e.clipboardData.setData("text/plain",c),a&&e.clipboardData.setData("text/html",a),e.clipboardData.setData("text/markhtml",b),e.preventDefault()}else File.isNode&&(q.clipboard.writeHtml(a),q.clipboard.writeText(c))},u=function(a,b){b=b||File.editor;var c,d,e,f,g=$($.parseHTML("<div>"+a+"</div>"));return g.find(".md-fences").toArray().map(function(a){c=a.getAttribute("cid"),d=$(a),d.attr("lang",b.findNodeByElem(d).get("lang")),d.text(b.fences.getValue(c))}),g.find(".md-emoji").toArray().map(function(a){d=$(a),d.text(":"+d.attr("data-content")+":")}),g.find("[mdtype='math_block']").toArray().map(function(a){c=a.getAttribute("cid"),d=$(a),d.text(b.mathBlock.getTex(c))}),g.find(".md-math-after-sym").remove(),e=g.children("li[cid]"),e.length&&(f=$(document.querySelector("[cid='"+e[0].getAttribute("cid")+"']").parentElement).clone(),f.empty().append(e).wrap("div"),g=f.parent()),g},v=function(a,b){a=a||File.editor;var c=document.activeElement,d=a.selection.getRangy();if(a.sourceView.inSourceMode)t(null,null,File.editor.sourceView.cm.getSelection(),!0,b);else if("HR"==c.getAttribute("mdtype"))t(null,null,"---",!0,b);else if(c.getAttribute("mdtype")!==k.math_block||d&&!d.collapsed){if("INPUT"==c.tagName||"TEXTAREA"==c.tagName||0==c.childElementCount)t(null,null,c.value||c.innerText,!0,b);else if(window.getSelection().rangeCount){var e=u(d.toHtml(),a),g="";g=e.html(),t(null,g,f(g),!0,b)}}else t(null,null,"$$\n"+a.mathBlock.getTex(c.getAttribute("cid"))+"\n$$",!0,b);File._CopyContentFlag=!1},w=function(a,b){a=a||File.editor;var c=document.activeElement,d=a.selection.getRangy();if(a.sourceView.inSourceMode)t(null,null,File.editor.sourceView.cm.getSelection(),!0,b);else if("HR"==c.getAttribute("mdtype"))t(null,null,"<hr/>",!0,b);else if(c.getAttribute("mdtype")!==k.math_block||d&&!d.collapsed){if("INPUT"==c.tagName||"TEXTAREA"==c.tagName||0==c.childElementCount)t(null,null,c.value||c.innerText,!0,b);else if(window.getSelection().rangeCount){var f=u(d.toHtml(),a),h="";h=f.html();var i=e(h),j=a.export.exportCollection(i,null,!0,!0,!0);t(null,"<pre mdtype='fences' lang='HTML'>"+g.escape(j)+"</pre>",j,!0,b)}}else t(null,null,"$$\n"+a.mathBlock.getTex(c.getAttribute("cid"))+"\n$$",!0,b)},x=function(a){{var b=$.parseHTML(a),c="<!DOCTYPE html>",d="<!DOCTYPE html>";b.map(function(a){var b=$(a),e=b.find(".md-emoji").andSelf(".md-emoji");e.text(function(a){return $(e[a]).children("[data-emoji]").attr("data-emoji")}),b.find(".md-meta, .md-content").remove(),b.find(".CodeMirror").each(function(){this.innerHTML=this.querySelector(".CodeMirror-code").outerHTML}),c+=a.outerHTML,a.getAttribute&&a.getAttribute("mdtype")==k.toc||(b.find(".md-toc").remove(),b.find(".mathjax-block").andSelf(".mathjax-block").html(function(){try{return File.editor.findElemById(this.getAttribute("cid")).find("script").text()}catch(a){return""}}).css("font-size","1rem"),b.find(".md-fences").andSelf(".md-fences").html(function(){return this.innerHTML+"<br/><br/>"}).find(".CodeMirror-linenumber").remove(),b.find(".md-line").oldReplaceWith(function(){return this.innerHTML+(this.nextSibling?"\n":"")}),b.find("li p").oldReplaceWith(function(){return this.innerHTML+(this.nextSibling?"\n":"")}),b.find("ul, ol, .md-def-link, .md-def-footnoote, blockquote, .md-fences, .mathjax-block").after("<br/>"),b.find(".md-def-name").before("[").after("]   "),d+=a.outerHTML,j.isType(a.tagName,"UL","OL")&&(d+="<br/>"))})}return[c,d]},y=function(a,b){if("copyAsMarkdown"===File._CopyContentFlag)return v(a,b);if("copyAsHTMLSource"===File._CopyContentFlag)return w(a,b);var d=document.activeElement,e=a.selection.getRangy(),g=$(e.commonAncestorContainer);if(a.sourceView.inSourceMode&&t(null,null,File.editor.sourceView.cm.getSelection(),!0,b),"hr"==d.getAttribute("mdtype"))t(d.outerHTML,null,"---",!0,b);else if("toc"==d.getAttribute("mdtype"))t(d.outerHTML,"<div mdtype='toc'><div>","[toc]",!0,b);else if("IMG"==d.tagName)t(d.outerHTML,null,d.getAttribute("src"),!0,b);else if(d.getAttribute("mdtype")!==k.math_block||e&&!e.collapsed){if("INPUT"==d.tagName||"TEXTAREA"==d.tagName||0==d.childElementCount)return b||console.error("in copyHandler : should be here"),!0;if(window.getSelection().rangeCount){g.find(".md-emoji").text(function(){return p.data[this.getAttribute("data-content")]}),g.find(".math-jax-postprocess").text(function(){return this.querySelector("script").textContent.replace(/\u200B*/g,"")}).parent().addClass("md-expand");var h=u(e.toHtml(),a),i=h.html(),j=File.option.copyMarkdownByDefault?f(i):c(i).replace(/\u200B/gi,"");g.find(".md-emoji").html(function(){var a=this.getAttribute("data-content");return"<span data-emoji='"+p.data[a]+"' class='md-emoji-span'></span><span class='md-meta'>:"+a+":</span>"}),g.find(".math-jax-postprocess").html(function(){var a=$(this).textExcludeSVG().replace(/\u200B*/g,"");return svgCache["$"+a+"$"]||svgCache["$$"+a+"$$"]||a}).parent().removeClass("md-expand"),t(null,i,j,!1,b)}}else{var l=a.mathBlock.getTex(d.getAttribute("cid"));t(d.querySelector(".MathJax_Display").outerHTML,"<div mdtype='"+k.math_block+"'>"+l+"</div>",l,!0,b)}},z=new h.NodeMap,A=function(a,b,c){function d(a){return a.get("attr")&&a.get("attr").trim().length?a.get("attr"):void 0}function f(a){return j.isType(a,j.TYPE.line,j.TYPE.heading,j.TYPE.raw_edit,j.TYPE.fences,j.TYPE.table_cell)?a.get("text"):(!j.isType(a,k.def_footnote)||d(a,"ref")&&d(a,"text"))&&(!j.isType(a,k.def_link)||d(a,"ref")&&d(a,"href"))?a.get("children").reduce(function(a,b){return a+f(b)}," "):d(blocks[0],"ref")||d(blocks[0],"href")||d(blocks[0],"text")||d(blocks[0],"title")||""}function g(b,c,d,e){function g(a,b,c){a.set("text",a.safeGetStrAttr("text").substr(0,b)+f(c).split(/\r|\n|\r\n/)[0])}function h(a){for(var b=a.getFirstChild().getFirstChild(),c=[];b;)c.push(b),b=l.getSibling(b),c.last().detach();return a.remove(),c}var l=a.tableEdit.TableEdit,m=b.get("parent").get("parent"),n=b,o=n;e.undo.push(i.buildReplaceUndo(m));var p=[];d.forEach(function(a){a.get("type")==k.table?p=p.concat(h(a)):p.push(a)});for(var q=0;q<p.length;q++)g(n,0===q?c:0,p[q]),o=n,n=j.isType(p[q],k.table_cell)?l.getSibling(n):l.getNextCellInColumn(n);a.findElemById(m.id).replaceWith(m.toHTML()),e.redo.push(i.buildReplaceUndo(m)),a.selection.jumpIntoElemEnd(a.findElemById(o.id)),e.redo.push(a.selection.buildUndo())}function l(a){for(var b=[],c=-2,d=0;d<a.length;d++){var e=a[d];j.isType(e,k.table_cell)?(c!==d-1?(e.set("type",k.paragraph),b.push(e)):(b.last().set("text",b.last().get("text")+"  "+e.get("text")),e.remove()),c=d):b.push(e)}return b}function m(b,c,d,e,f){d.undo.push(a.selection.buildUndo());var h=f(e,a.nodeMap,a);if("string"==typeof h)return q(b,c,h,d);if(j.isType(b,k.table_cell))g(b,c,h,d);else if(j.isType(b,k.table_row,k.table));else{var i=b.getClosetBlock();d.undo.push(j.isType(i.get("parent"),k.list_item)?a.undo.buildReplaceUndo(i.get("parent")):a.undo.buildReplaceUndo(i));var l=b===a.nodeMap.getFirst()&&0===c,m=[];h.map(function(a,b){j.isType(a,k.meta_block)&&!(0==b&&l)&&m.push(a)}),m.map(function(a){h.remove(a)});var n=j.splitAt(b,c,a,j.genNormalSplitExitFunc(!1,!1,!0));r(n.prev,n.next,h,d,n.opt_prev,n.opt_next)}a.refresh(),a.undo.register(d)}function p(a,b,c){var d=a.canContainBlock()?a.getLastChild():a,e=b.canContainBlock()?b.getFirstChild():b,f=-1;if(!e.canContainBlock()){var g=e.getVeryFirst(),h=d.getVeryFirst(!0);f=h.get("text").length,h.set("text",h.get("text")+g.get("text")),0==f&&j.isType(d,k.paragraph)&&1==d.get("children").length&&!j.isType(g,k.line)&&(j.property.map(function(a){d.set(a,g.get(a))}),d.set("text",h.get("text")),h.remove()),g.remove(),e.isDeleted()||(0==e.get("children").length?e.remove():j.isType(e,k.paragraph)&&j.isType(d,k.paragraph)&&(d.getLastChild().insertTillEnd(e.getFirstChild()),e.remove())),e.isDeleted()||0!=e.get("children").length||e.remove()}return e.isDeleted()||(d.insert(e),j.isEmptyBlock(d)&&d.remove()),b.isDeleted()||(0==b.get("children").length?b.remove():j.isType(b,k.list_item)?(a.getLastChild().insertTillEnd(b.getFirstChild()),b.remove()):j.isType(b,k.paragraph)&&j.isType(a,k.paragraph)&&(a.getLastChild().insertTillEnd(b.getFirstChild()),b.remove())),c&&c.redo.push(i.buildReplaceUndo(a)),f}function q(b,c,d,e){console.debug("pasteText");var f=d.split(/\r?\n/g);if(f.length>1&&!f[0].trim().length&&f[1].trim().length&&(f=f.slice(1)),j.noChangeLine(b)&&(f=[f[0]]),f.length<=1||o.CONST.NoInline.indexOf(b.get("type"))>-1)s(a,b,f.join("\n"),c,e,!0),a.undo.register(e);else{e.undo.push(a.selection.buildUndo()),e.undo.push(i.buildReplaceUndo(b.getClosetParagraphLevel()));var g=j.splitAt(b,c,a,j.genNormalSplitExitFunc(!1,!1,!0)),h=j.parseFrom(f.join("\n"),g.prev.get("in"),{noTop:!g.prev.get("attachTo")||c,skips:{old_code:!1}},!0);r(g.prev,g.next,h[1],e,g.opt_prev,g.opt_next),a.undo.register(e)}}function r(b,c,d,e,f,g){function m(a){for(var b=1;b<a.length;b++)if(a[b].get("type")!=a[b-1].get("type"))return!1;return!0}function n(a){if(j.isType(a,k.list_item))o(a);else{e.redo.push(i.buildReplaceUndo(a)),1==d.length&&j.isType(d[0],k.blockquote)&&j.isType(a.get("parent"),k.blockquote)?(a.insert(d[0]),d=d[0].unwrap(),s=d.slice(0),s.unshift(a)):(a.insertArray(d,!1,!0),s=[a].concat(d));var b,h=a.get("after");j.isType(h,k.table)||(a.canContainBlock()||!h||h.canContainBlock()||(p(a,h,e),h.isDeleted()&&(d.remove(h),s.remove(h))),b=s.last().getVeryFirst(!0,!0),c.isDeleted()||c.canContainBlock()||b.canContainBlock()||(q=b.getVeryFirst(!0),t=p(b,c,e))),d.length&&i.addUndoForInsertArray(e,d),j.isEmptyBlock(a)&&!h.isDeleted()&&(i.addUndoForRemove(e,a),a.remove(),s.remove(a)),f&&s.unshift(f),!c.isDeleted()&&s.push(c),0>t&&(q=s.last()),g&&s.push(g)}}function o(a){var b=a.get("after"),h=a.get("parent");if(e.undo.push(i.buildReplaceUndo(a)),j.isType(d[0],k.list)?(r=a.id,a.insert(d[0]),s=d[0].unwrap().clone(),p(a,s.shift(),e),s.length&&i.addUndoForInsertArray(e,s),s.unshift(a),d.shift(),c.isDeleted()||(t=p(s.last().getVeryFirst(!0,!0),c,e))):m(d)&&j.isType(d[0],k.list_item)?(a.insertArray(d,!1,!0),p(a,d.shift(),e),s=d.clone(),s.length&&i.addUndoForInsertArray(e,s),s.unshift(a),c.isDeleted()||(t=p(s.last().getVeryFirst(!0,!0),c,e))):(b=new j({type:k.list_item}),a.insert(b),d.map(function(a){b.append(a)}),p(a,b,e),s=[a],d=[]),!c.isDeleted()&&s.push(c),d.length){var l;r=h.cid,h.insertArray(d,!1,!0),s=[h],s=s.concat(d),b&&(r=h.cid,e.undo.push(i.buildReplaceUndo(h)),h.unset("ahead"),h.unset("tail"),l=h.clone(),h.giveChildrenTo(l,b,null,!0),d.last().insert(l),s.push(l)),g=null,f=null}else q=s.last()}console.debug("pasteBlocks");var q,r=b.id,s=d.slice(0),t=-1;d=l(d),q=d.last().getVeryFirst(!0),(j.isEmptyBlock(c)||j.isType(c,k.list_item)&&1==c.get("children").length&&j.isEmptyBlock(c.getFirstChild()))&&c.remove(),j.isType(b,k.blockquote,k.list)||(n(b),c.isDeleted()||i.addUndoForInsert(e,c),f&&i.addUndoForInsert(e,f),g&&i.addUndoForInsert(e,g),a.findElemById(r).replaceWith(h.NodeCollectionUtils.toHTML(s)),t>=0?a.selection.jumpInto(a.findElemById(q.cid),t):q==c?a.selection.jumpIntoElemBegin(a.findElemById(c.cid)):a.selection.jumpIntoElemEnd(a.findElemById(q.getVeryFirst(!0).cid)),e.redo.push(a.selection.buildUndo()),setTimeout(function(){a.refresh()},100))}if(console.time("pasteHandler"),File._PasteContentFlag=!1,"INPUT"==document.activeElement.tagName||"TEXTAREA"==document.activeElement.tagName)return console.debug("pasteHandler: focused in input element"),!0;if(j.isType(z,k.hr))return!1;a.undo.completeSnap(!0);var t,u,v,w,x=a.selection.prepNode("",null,!0)||i.makeEmptyCommand(),y=a.getMarkElem(),z=a.findNodeByElem(y),A="string"!=typeof b||c?null:b,v="string"==typeof b&&c?b:null,B="object"==typeof b?b:null;B?(B.preventDefault(),v=B.clipboardData.getData("text/plain"),A=B.clipboardData.getData("text/html"),w=B.clipboardData.getData("text/markhtml")):v||File.isMac&&(v=app.clipboard.paste()),x.undo.push(a.selection.buildUndo()),x=i.append(x,J(a,B,"delSelection",!0)),z=a.findNodeByElem(a.getMarkElem()),t=a.selection.getRangy(),u=t.getBookmark(a.findElemById(z.id)[0]).start,c=c||t.startContainer&&$(a.getJQueryElem(t.startContainer)).closest(".md-def-url, .md-def-name, .md-def-title, pre, code").length,w&&!c?m(z,u,x,w,e):A&&!c?m(z,u,x,A,n.parseHTML):q(z,u,v,x),a.selection.scrollAdjust(),console.timeEnd("pasteHandler")
};j.wrapListItem=function(a){var b=a.get("children");if(!b.length){{new j({type:k.paragraph,"in":a.get("in"),parent:a,text:a.get("text")})}a.set("text","")}};var B=function(a,b,c){if(j.isType(b,k.line)&&!b.get("before")&&(b=b.get("parent")),j.isType(b.get("parent"),k.blockquote)&&(c||!b.get("before"))){var d=i.makeEmptyCommand(a.selection.buildUndo()),e=b.upStream();return i.append(d,e.command),a.findElemById(e.oldCid).replaceWith(e.newHtml),a.undo.exeCommand(d.undo[0]),d.redo.push(a.selection.buildUndo()),d}if(j.isType(b.get("parent"),k.list_item)&&(c||!b.get("parent").get("before")&&!b.get("before"))){var d=i.makeEmptyCommand(a.selection.buildUndo()),f=b.get("parent"),g=f.get("parent");d.undo.push(i.buildReplaceUndo(g)),f.set("parent",null),f.set("after",null),g.insert(f,!0);var l=f.unwrap();return i.addUndoForInsertArray(d,l),a.findElemById(g.id).before(h.NodeCollectionUtils.toHTML(l)),g.get("children").length?(a.findElemById(g.id).replaceWith(g.toHTML()),d.redo.push(i.buildReplaceUndo(g))):(i.addUndoForRemove(d,g),g.remove(),a.findElemById(g.id).remove()),a.selection.jumpIntoElemBegin(a.findElemById(l[0].id)),d.redo.push(a.selection.buildUndo()),d}},C=function(a,b,c,d){var e,f=a;if(a==b)return null;for(e=a.get(c);e;)d(e,f),f=e,e=f.get(c);return C(a.get("parent"),b,c,d),f},D=function(a,b){for(var c=a.get("parent").clone(),d=a,e=b?b.get("after"):null;d&&d!=e;){var f=d;d=d.get("after"),c.append(f)}return c},E=function(a,b){a.append(b),j.isType(b,k.list)&&j.isType(b.get("before"),k.list)&&(b.get("before").appendTillEnd(b.getFirstChild()),b.remove())},F=function(a){var b=a.selection.deRange(a.selection.getRangy()),c=a.getMarkElem(b.startContainer).closest("[mdtype='list_item']"),d=a.findNodeByElem(c);if(!d||!d.get("before"))return!1;a.undo.completeSnap(!0),a.brush.pause();var e=a.getMarkElem(b.endContainer),f=a.findNodeByElem(e),g=j.getTreePosition(d,f),h=i.makeEmptyCommand(a.selection.buildUndo()),k=d.get("before"),m=l.createRange();f=g[0]===d?d:g[0]===d.get("parent")?g[2]:d.get("parent").getLastChild(),e=a.findElemById(f.id),m.collapseAfter(e[0]),h.undo.push(i.buildReplaceUndo(d.get("parent"))),1==b.compareBoundaryPoints(Range.END_TO_END,m)&&b.setEnd(e[0],e[0].childNodes.length);var n=a.selection.buildUndo(b),o=D(d,f);return E(k,o),a.findElemById(k.get("parent").id).replaceWith(k.get("parent").toHTML()),h.redo.push(i.buildReplaceUndo(k.get("parent"))),h.redo.push(n),a.undo.exeCommand(n),a.undo.register(h),a.refresh(),a.brush.resume(),!0},G=function(a){try{var b,c,d,e=a.selection.deRange(a.selection.getRangy()),f=a.getMarkElem(e.startContainer),g=f.closest("[mdtype='list_item'], [mdtype='blockquote']>*"),h=a.findNodeByElem(f),m=i.makeEmptyCommand(a.selection.buildUndo()),n=l.createRange();if(!g.length)return!1;if(a.brush.pause(),a.undo.completeSnap(!0),h=a.findNodeByElem(g),b=a.getMarkElem(e.endContainer),c=a.findNodeByElem(b),d=j.getTreePosition(h,c),"list_item"===g.attr("mdtype")){if(g.parent().closest("[mdtype='list_item']").length){var o,p=h.get("parent"),q=p.get("parent"),r=q.get("parent");if(!p.get("before")&&!h.get("before"))return!1;c=d[0]===h?h:d[0]===p?d[2]:p.getLastChild(),b=a.findElemById(c.id),n.collapseAfter(b[0]);var s=p.get("after");m.undo.push(i.buildReplaceUndo(r)),1==e.compareBoundaryPoints(Range.END_TO_END,n)&&e.setEnd(b[0],b[0].childNodes.length);var t=a.selection.buildUndo(e),u=c.get("parent").get("after"),o=c.get("after")?D(c.get("after")):null,v=D(h,c),w=v.getLastChild();return q.insertTillEnd(v.getFirstChild()),v.remove(),u&&w.appendTillEnd(u),o&&(o.get("children").length?(o.insert(s),w.appendTillEnd(o)):(o.remove(),w.appendTillEnd(s))),p.get("children").length||p.remove(),m.redo.push(i.buildReplaceUndo(r)),a.findElemById(r.id).replaceWith(r.toHTML()),m.redo.push(t),a.undo.exeCommand(t),a.undo.register(m),a.refresh(),a.brush.resume(),!0}}else if(h===c&&j.isType(h.get("parent"),k.blockquote)&&(d[0]=h.get("parent")),h.get("parent")===d[0]&&c.get("parent")===d[0]){var x=d[0],y=[],z=h,A="",B=null,C=a.findElemById(x.id),t=a.selection.buildUndo(e);m.undo.push(i.buildReplaceUndo(x)),c.get("after")&&(B=D(c.get("after")));do y.push(z),z=z.get("after");while(z&&z!=c.get("after"));B&&y.push(B),z=x;for(var E=0;E<y.length;E++)z.insert(y[E]),A+=y[E].toHTML(),z=y[E];return m.redo.push(i.buildReplaceUndo(x)),i.addUndoForInsertArray(m,y),x.get("children").length?A=x.toHTML()+A:(i.addUndoForRemove(m,x),x.remove()),C.replaceWith(A),m.redo.push(t),a.undo.exeCommand(t),a.undo.register(m),a.refresh(),a.brush.resume(),!0}return a.brush.resume(),!1}catch(F){a.brush.resume(),console.debug(F.stack)}},H=function(a,b,c,d){var e=i.makeEmptyCommand(a.selection.buildUndo());return e.undo.push(i.buildReplaceUndo(b)),b.set("type",k.paragraph),b.clearChildren(),c?b.set("text",""):b.set("text",b.get("text").replace(/\u200B|(\r?\n)/g,"")),j.normalizeNode(b),e.redo.push(i.buildReplaceUndo(b)),a.findElemById(b.id).replaceWith(b.toHTML()),a.selection.jumpIntoElemBegin(a.findElemById(b.id)),e.redo.push(a.selection.buildUndo()),!d&&$(a.sessionStr).trigger("cursorChange"),e},I=function(a,b,c,d){if(b&&b.length){c&&c.preventDefault(),!d&&a.undo.completeSnap(!0);var e=a.findNodeByElem(b),f=i.makeEmptyCommand(a.selection.buildUndo());return e?(e.set("text",""),f=i.append(f,H(a,e))):(e=a.findNodeByElem(b.closest("[mdtype]")),f.undo.push(i.buildReplaceUndo(e)),a.selection.moveLeftOrRight(!0),b.remove(),a.store(e.id),f.redo.push(i.buildReplaceUndo(e)),f.redo.push(a.selection.buildUndo())),!d&&a.undo.register(f),f}},J=function(a,b,c,d){function e(a,b,c,d,e){var f,g=3!==c.commonAncestorContainer.nodeType,h=a.getNode(d.attr("cid"));if(e||(a.undo.snap(h.cid,M?-2:-1),a.brush.pause(!0)),F=i.makeEmptyCommand(a.selection.buildUndo(J)),F.undo.push(i.buildReplaceUndo(h)),f=c.extractContents(),a.store(h.cid),F.redo.push(i.buildReplaceUndo(h)),F.redo.push(a.selection.buildUndo()),f.querySelector("img"),c.collapse(!1),g){var j=d.attr("cid");g=a.selection.saveSelection(d,c),a.store(j,!0),d.replaceWith(a.nodeMap.allNodes.get(j).toHTML()),a.selection.restoreSelection(a.findElemById(j),g),a.focusCid=null,a.refocus()}return a.brush.addToQueue(d.attr("cid")),!e&&a.brush.resume(!0),b&&b.preventDefault(),F}function f(a,b,c){var d,e=a;if(a==b)return null;for(d=a.get(c);d;)$("[cid='"+d.id+"']").remove(),d.remove(),d=a.get(c);return f(a.get("parent"),b,c),e}function g(a,b,c,d,e){var g,h,k,l=b.cloneRange(),m=a.findElemById(c.id);return l.setEndAfter(m[0]),a.selection.deRange(l),h=a.findNodeByElem(a.getMarkElem(l.startContainer)),!e&&$(l.startContainer).closest("table").length?(i.append(d,x(a,l,!0)),h=a.findNodeByElem($(l.startContainer).closest("table")),c.contains(h)&&(f(h,c,"after"),0===h.getText().length)?(i.append(d,H(a,h)),"abortAndSkipCursor"):"abort"):(d.undo.push(i.buildReplaceUndo(c)),g=$(l.extractContents()),j.isType.apply(null,[c].concat(o.CONST.Selectable))&&i.append(d,H(a,c,!0,!0)),a.store(h,!0),k=f(h,c,"after"),g.text().length||g.find("img").length||k?(d.redo.push(i.buildReplaceUndo(c)),h):!1)}function l(a,b,c,d,e){var g,h,j,k=b.cloneRange(),l=a.findElemById(c.id);return k.setStartBefore(l[0]),a.selection.deRange(k),!e&&$(k.endContainer).closest("table").length?(i.append(d,x(a,k,!0)),h=a.findNodeByElem($(k.endContainer).closest("table")),c.contains(h)&&(f(h,c,"before"),0===h.getText().length&&i.append(d,H(a,h))),"abort"):(d.undo.push(i.buildReplaceUndo(c)),h=a.findNodeByElem(a.getMarkElem(a.selection.getEndNode(k))),g=$(k.extractContents()),a.store(h,!0),j=f(h,c,"before"),g.text().length||g.find("img").length||j?(d.redo.push(i.buildReplaceUndo(c)),h):!1)}function n(a,b,c){var d=a.selection.getDetailPos(b.startContainer,b.startOffset),e=a.selection.getDetailPos(b.endContainer,b.endOffset),f=a.getMarkElem(d[0]),h=a.getMarkElem(e[0]),k=a.findNodeByElem(f),m=a.findNodeByElem(h),n=j.getTreePosition(k,m),o=n[1],q=n[2],r=i.makeEmptyCommand(a.selection.buildUndo()),s=b.cloneRange();if(f[0]==h[0])return r;if(s.collapse(!0),s=a.selection.buildUndo(s),b.setStart(d[0],d[1]),b.setEnd(e[0],e[1]),$(b.commonAncestorContainer).closest("table").length)return i.append(r,x(a,b));for(var t=g(a,b,o,r),u=l(a,b,q,r),v=o.get("after"),y=[];v&&v!=q;)y.push(v),v=v.get("after");return i.addUndoForRemoveArray(r,y,o,q),y.map(function(b){a.findElemById(b.id).remove(),b.remove()}),"abort"==t||"abort"==u||"abortAndSkipCursor"==t?(console.debug("abort, before/after is table"),"abortAndSkipCursor"!=t&&(b.collapse(!0),r.redo.push(s),a.undo.exeCommand(s)),u===!1&&0==m.getText().length&&(i.addUndoForRemove(r,m),a.findElemById(m.id).remove(),m.remove())):t||u||y.length||c?p(a,t||k,u||m,o,q,r,t):(console.log("less indent"),r=w(a,m,q,k,o)),a.refresh(),r}function p(a,b,c,d,e,f,g){function h(a,b){return a==b||a.get("before")||a.get("after")?a:h(a.get("parent"),b)}console.debug("spliceStartAndEnd");var l,m,n,o,p=j.isEmptyBlock(d);if(!p||d==e||j.isEmptyBlock(e)&&!g)if(p&&d==e&&e.isBlock())e.set("type",k.paragraph),e.clearChildren(),a.findElemById(e.id).replaceWith(e.toHTML()),a.selection.jumpIntoElemBegin(a.findElemById(e.id)),f.redo.push(a.selection.buildUndo());else{if(console.assert(b!=c,"Error on spliceStartAndEnd"),b!=c){if(l=c.safeGetStrAttr("text"),o=h(c,e),i.addUndoForRemove(f,o),a.findElemById(o.id).remove(),o.remove(),m=b.safeGetStrAttr("text").length,j.isType(b,k.def_footnote,k.def_link)&&(m=b.get("ref").length+(b.get("type")==k.def_footnote?m:(b.get("title")||"").length+b.get("href").length)),f.undo.push(i.buildReplaceUndo(d)),b.set("text",b.safeGetStrAttr("text")+l),o!=e&&e!==c&&e.get("before")==d&&j.isType(d,k.list_item)){var q=e.getFirstChild();q.set("before",d.getLastChild()),e.giveChildrenTo(d,q),i.addUndoForRemove(f,e),a.findElemById(e.id).remove(),e.remove()}f.redo.push(i.buildReplaceUndo(d)),a.findElemById(d.id).replaceWith(d.toHTML()),n=a.findElemById(b.id)}n=a.findElemById(b.id),a.selection.restoreSelection(n,m),f.redo.push(a.selection.buildUndo())}else a.findElemById(d.id).remove(),i.addUndoForRemove(f,d),d.remove(),o=h(c,e),a.findElemById(o.id).replaceWith(o.toHTML()),a.selection.jumpIntoElemBegin(a.findElemById(o.id))}function q(a,b){var c,d=i.makeEmptyCommand(a.selection.buildUndo()),e=b.get("before"),f=e.get("children").at(e.get("children").length-1).getLastBrother();return d.undo.push(i.buildReplaceUndo(e.get("parent"))),a.findElemById(b.id).remove(),f.insert(b),c=b.unwrap(),d.redo.push(i.buildReplaceUndo(e.get("parent"))),a.findElemById(f.id).after(h.NodeCollectionUtils.toHTML(c)),a.selection.jumpIntoElemBegin(a.findElemById(c[0].id)),d.redo.push(a.selection.buildUndo()),d}function s(a,b){function c(b){var c=i.makeEmptyCommand(a.selection.buildUndo());return i.addUndoForRemove(c,b),a.findElemById(b.id).remove(),b.remove(),c.redo.push(a.selection.buildUndo()),c}j.isType(b,k.line)&&!b.get("before")&&(b=b.get("parent"));var d=b.get("before");return d&&!j.isEmptyBlock(b)&&(j.isEmptyBlock(d)||j.isType(d,k.hr))?c(d):!d&&j.isType(b.get("parent"),k.list_item)&&(d=b.get("parent").get("before"),d&&1==d.get("children").length&&j.isEmptyBlock(d.get("children").at(0)))?c(d):void 0}function t(a,b){if(j.isType(b,k.table_cell)){var c=m.getSibling(b,"before");return c&&(F=i.makeEmptyCommand(a.selection.buildUndo()),a.selection.jumpIntoElemEnd(a.findElemById(c.id)),F.redo.push(a.selection.buildUndo())),F}}function u(a,b){return j.isType(b,k.line)&&!b.get("before")&&(b=b.get("parent")),j.isType(b.get("parent"),k.list_item)&&b.get("parent").get("before")&&!b.get("before")?q(a,b.get("parent")):void 0}function v(a,b){return j.isType(b,j.backToParagraphBeforeDelete)?(a.stylize.changeBlock(k.paragraph,b),r):void 0}function w(a,b,c,d,e){for(var f=[t,s,B,u,v],g=null,h=0;h<f.length;h++)if(g=f[h](a,b))return g;if(c=j.isType(b,k.line)&&!b.get("before")?c||b.get("parent"):c||b,e=e||c.get("before"),d=d||e&&e.getVeryFirst(!0),!g&&d&&(g=i.makeEmptyCommand(a.selection.buildUndo()),p(a,d,b,e,c,g)),!g&&!d&&j.isType(b,k.paragraph)&&j.isEmptyBlock(b)&&b.get("after")){console.debug("delete empty node and promise after node"),g=i.makeEmptyCommand(a.selection.buildUndo());var l=b.get("after").cid;i.addUndoForRemove(g,b),b.remove(),a.findElemById(b.cid).remove(),a.selection.jumpIntoElemBegin(a.findElemById(l)),g.redo.push(a.selection.buildUndo())}return g}function x(a,b,c){console.debug("backspaceOnTableHandler");var d,e=a.selection.getDetailPos(b.startContainer,b.startOffset),f=a.selection.getDetailPos(b.endContainer,b.endOffset),h=i.makeEmptyCommand(),j=a.getMarkElem(e[0]),k=a.getMarkElem(f[0]),m=j.closest("table"),n=a.findNodeByElem(m),o=a.findNodeByElem(j),p=a.findNodeByElem(k);if(c||(d=b.cloneRange(),d.collapse(!0),d=a.selection.buildUndo(d)),b.setStart(e[0],e[1]),b.setEnd(f[0],f[1]),o==p)return h;var q,r,s=g(a,b,o,h,!0),t=l(a,b,p,h,!0);for(h.undo.push(i.buildReplaceUndo(n)),q=a.tableEdit.getSibling(o,"after");q&&q!=p;)q.set("text",""),r=!0,q=a.tableEdit.getSibling(q,"after");return s||t||r?(a.findElemById(n.id).replaceWith(n.toHTML()),h.redo.push(i.buildReplaceUndo(n))):h.undo.pop(),c||(h.redo.push(d),a.undo.exeCommand(d)),h}function y(){var d=b&&!b.metaKey&&!b.ctrlKey&&b.altKey;if(c){if("Delete"==c){d=b&&(File.isMac?b.altKey:b.ctrlKey),window.getSelection().modify("extend","forward",d?"word":"character");var e=a.selection.getRangy();/^\u200b$/g.exec(e.toString())&&window.getSelection().modify("extend","backward","character")}else if("delSelection"==c)return}else{window.getSelection().modify("extend","backward",d?"word":"character");var e=a.selection.getRangy();if(!d&&/^\u200b|\007F$/g.exec(e.toString()))return window.getSelection().modify("extend","backward","character"),z(e)}}function z(b){return a.selection.deRange(b),D=a.getMarkElem(b.commonAncestorContainer),E=a.nodeMap.allNodes.get(D.attr("cid")),G=b.getBookmark(D[0]),D.length&&!E.get("children").length&&0==G.start&&!c}function A(){var c=null;j.isType(E.get("before"),j.TYPE.hr,j.TYPE.toc)&&(c=E.get("before")),!d&&a.undo.completeSnap(!0),b&&b.preventDefault(),$(".md-tooltip-remove").remove(),D.prev("[cid]").addClass("md-expand"),F=w(a,E),F===r||d||(c&&(a.selection.selectNode(c),F.redo.push(a.selection.buildUndo())),a.undo.register(F),a.refresh(),c||a.findElemById(E.cid).trigger("refocus"),a.refocus())}function C(b){if(a.selection.selectWordTime&&File.isMac)if(c){if("Delete"==c&&b.endContainer.nodeType===document.TEXT_NODE){var d=b.endContainer.textContent,e=d.charAt(b.endOffset);/\s/.exec(e)&&(b.endOffset++,J=b.cloneRange())}}else if(b.startOffset>0&&b.startContainer.nodeType===document.TEXT_NODE){var d=b.startContainer.textContent,e=d.charAt(b.startOffset-1);/\s/.exec(e)&&(b.startOffset--,J=b.cloneRange())}}var D,E,F,G,J,K=a.selection.getRangy(),L=K,M=K&&!K.collapsed,N=document.activeElement;if(j.isType(N.getAttribute("mdtype"),j.TYPE.hr,j.TYPE.toc)){var P=$(N).closest("[mdtype]");return I(a,P,b,d)}if(N.getAttribute("mdtype")==k.math_block)return b&&b.preventDefault(),a.mathBlock.remove(N.getAttribute("cid")),F;if(c&&"Backspace"!=c?c===!0&&(c="Delete"):c=!1,K){if(K.collapsed){if(z(K))return A();if(y())return A();!c&&(K=O(a))||(K=a.selection.getRangy())}else C(K);if(a.selection.selectWordTime=null,a.selection.deRange(K),D=a.getMarkElem(K.commonAncestorContainer),E=a.nodeMap.allNodes.get(D.attr("cid")),window.getSelection().removeAllRanges(),window.getSelection().addRange(L.nativeRange),D.length&&!E.get("children").length){if(D.get("type")!==k.fences)return e(a,b,K,D,d);!d&&a.undo.completeSnap(!0),F=I(a,D,b,d)}else console.debug("handle block change"),!d&&a.undo.completeSnap(!0),b&&b.preventDefault(),$(".md-tooltip-remove").remove(),F=n(a,K,c),d||(a.undo.register(F),a.refocus());return F}},K={"[mdtype='hr']":J,"tr[mdtype='table_row']":m.deleteRow,".md-toc":I},L=function(a){var b,c=a.getMarkElem();if(c&&c.length){for(b in K)if(c.closest(b).length)return void K[b](a,c.closest(b));!function(b){var c=b.hasClass("md-expand");b.addClass("md-expand"),window.getSelection().modify("move","backward","sentence"),window.getSelection().modify("extend","forward","sentence"),c&&b.removeClass("md-expand"),J(a,null,"delSelection")}(c)}},M=function(a,b){b=b||File.editor;var c=b.getMarkElem(),d=b.findNodeByElem(c).getClosetBlock(),e=new j({type:k.paragraph,text:""}),f=i.makeEmptyCommand(b.selection.buildUndo());d.insert(e,a),i.addUndoForInsert(f,e),a?b.findElemById(d.cid).before(e.toHTML()):b.findElemById(d.cid).after(e.toHTML()),b.selection.jumpIntoElemBegin(b.findElemById(e.cid)),f.redo.push(b.selection.buildUndo()),b.undo.register(f),b.refocus()},N={"(":")","[":"]","{":"}",'"':'"',"'":"'"},O=function(a){var b=window.getSelection().toString();if(/[\[\(\{"']/.exec(b)&&!File.option.noPairingMatch){var c=a.selection.getRangy(),d=$(c.commonAncestorContainer).closest("[cid]"),e=d.text(),f=c.getBookmark(d[0]);if(N[b]==e.substring(f.end,f.end+1))return f.end++,c.moveToBookmark(f),c}},P=function(a,b,c){if(!File.option.noPairingMatch){var d,e,f,g,h=$(c.commonAncestorContainer).closest("[cid]"),j=$(c.commonAncestorContainer).closest(".md-def-content:not(.md-def-url)");return(h.length&&!h.find("[cid], .md-def-name").length||j.length)&&/^[\{\(\["']$/.exec(b)?(e=a.findNodeByElem(h),h=j.length?j:h,d=c.getBookmark(h[0]),g=i.makeEmptyCommand(a.selection.buildUndo()),a.store(e,!0),g.undo.push(i.buildReplaceUndo(e)),f=e.get("text"),e.set("text",f.substring(0,d.start)+b+f.substring(d.start,d.end)+N[b]+f.substring(d.end)),g.redo.push(i.buildReplaceUndo(e)),c=a.selection.rangy.createRange(),c.moveToBookmark(d),a.selection.deRange(c),c.insertNodeAtEnd(document.createTextNode(N[b])),c.insertNode(document.createTextNode(b)),d.start++,d.end++,c.moveToBookmark(d),c.select(),g.redo.push(a.selection.buildUndo()),g):void 0}},Q={'"':/^.*(?:^|,)[^",]*"(?:[^",]*(?:"[^",]*")?)+(?:$|,.*)/,"'":/^.*(?:^|,)[^',]*'(?:[^',]*(?:'[^',]*')?)+(?:$|,.*)/},R=function(a,b,c,d,e){function f(){var b=a.selection.rangy.createRange();d.end++,d.start++,b.moveToBookmark(d),b.select(),e&&e.redo.push(a.selection.buildUndo())}function g(){var d=a.selection.getRangy(),g=document.createTextNode(b+N[b]);return a.undo.completeSnap(!0),a.undo.snap(c.cid,1),e=e||i.makeEmptyCommand(a.selection.buildUndo()),d.insertNode(g),g.parentElement.normalize(),f(),e}if(!File.option.noPairingMatch){var h,j,k;if(/^[\]\)\}'"]$/.exec(b)){if(h=a.findElemById(c.cid).textExcludeSVG(),b===h.substring(d.start,d.start+1))return f(),e||!0;if("'"==b||'"'==b){if(""==h)return g();var l=h.substring(0,d.start);if(j=l.slice(-1),b!=j&&"\\"!=j&&!/\w/.exec(h.substring(Math.max(0,d.start-1),d.start+1))&&!Q[b].exec(l))return g()}}else if(/^[\[\(\{]$/.exec(b)&&(h=a.findElemById(c.cid).textExcludeSVG(),k=h.substring(d.start,d.start+1),!/[^\[\]{}()"'\s`>$]/.exec(k)))return g();return!1}};b.getMarkdownSourceFrom=f,b.copyAsMarkdown=v,b.copyAsHTMLSource=w,b.copyHandler=y,b.insertInlineText=s,b.pasteHandler=A,b.backspaceHandler=J,b.deleteSelectable=I,b.deleteLineProcessor=K,b.deleteLine=L,b.decorateOneSide=C,b.setClipboard=t,b.moreIndent=F,b.lessIndent=G,b.insertParagraph=M,b.backToParagraph=H,b.processClipboardHTML=x,b.hanldePair=R,b.surroundPair=P}),define("app/editor/ConvertUtils",["exoskeleton-master/exoskeleton","jquery/jquery","app/document/StringUtils","app/document/Node","app/editor/TableEdit","app/editor/UndoManager","app/editor/polyfill","app/editor/KeyMaster","app/document/MarkParser","app/editor/Inline","app/editor/Emoji"],function(a,b){"use strict";var c=(a("exoskeleton-master/exoskeleton"),a("app/document/StringUtils")),d=a("app/document/Node"),e=d.Node,f=d.TYPE,c=(d.NodeCollectionUtils,a("app/document/StringUtils")),g=a("app/editor/TableEdit"),h=a("app/document/MarkParser"),i=a("jquery/jquery"),j=["CONTENT","HEADER","FOOTER","ARTICLE","SECTION","DIV","P","BLOCKQUOTE","PRE","UL","OL","TABLE","HR","H1","H2","H3","H4","H5","H6","DL","DT","DD","TBODY","THEAD","TFOOT","ASID","LI","HTML","BODY","IFRAME","STYLE","SCRIPT"],k=["INPUT","BUTTON","SELECT","SCRIPT","CANVAS","META","PROGRESS","VIDEO","HEAD","EMBED","STYLE","TEMPLATE"],l=function(a,b){function d(a){try{var b=/(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)/,c=/\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)/;return(a.match(/\n\s*(\!?\[|#{1,5}|>|```)/g)||"").length>3||a.match(c)||a.match(b)?a:null}catch(d){}return null}function l(a,b){var c,d;return a.find("img").each(function(){c=i(this),c.replaceWith("!["+(c.attr("alt")||c.attr("title")||"img").replace(/\r|\n/gi,"")+"]("+(c.attr("src")||"")+")")}),a.find("strong, b").each(function(){c=i(this),c.replaceWith("**"+c.text().replace(/([^\\])\*/,"$1\\*")+"**")}),a.find("em, i").each(function(){c=i(this),c.replaceWith("*"+c.text().replace(/([^\\])\*/,"$1\\*")+"*")}),a.find("code, pre").each(function(){c=i(this),c.replaceWith("`"+c.text()+"`")}),a.find("del, strike").each(function(){c=i(this),c.replaceWith("~~"+c.text()+"~~")}),a.find("br").each(function(){c=i(this),c.replaceWith("\n")}),a.find("a:not(:empty)").each(function(){c=i(this),d=c.attr("href"),c.replaceWith("["+c.text().replace(/([^\\])]([^(]|$)/,"$1\\]$2").replace(/\r|\n/gi,"")+"]("+d+")")}),File.option.highlight&&a.find("mark").each(function(){c=i(this),c.replaceWith("=="+c.text().replace(/([^\\])\=/,"\\=")+"==")}),b?a[0].innerText.split(/(\r|\n)+/):a.text().replace(/\r|\n/gi,"")}function m(a,b,c,d){var g,h=b,i=[];if(b&&b!==c){for(;h&&h!==c;)e.isType(h,f.paragraph)&&e.isEmptyBlock(h)?(g=h,h=h.get("after"),g.remove(),d&&d.splice(d.indexOf(g),1)):h=h.get("after");for(b=h.get("before")||h,h=c;h&&h!==b;)e.isType(h,f.paragraph)&&e.isEmptyBlock(h)?(g=h,h=h.get("before"),g.remove(),d&&d.splice(d.indexOf(g),1)):h=h.get("before")}for(h=b;h;){var j=null;if(e.isType(h,f.blockquote,f.list_item))m(h,h.getFirstChild(),h.getLastChild());else if(e.isType(h,f.fences)&&e.isType(h.get("before"),f.fences))i.push(h),h.head=h.get("before").head||h.get("before"),h.head.set("text",h.head.get("text")+"\n"+h.get("text"));else if(e.isType(h,f.list)&&0===h.get("children").length)h.set("type",f.paragraph);else if(e.isType(h,f.paragraph)&&(j=/^(`+)([\s\S]*?[^`])\1(?!`)\s*$/g.exec(h.get("text")))){h.set("type",f.fences),h.set("text",j[2]);continue}h=h.get("after")}i.map(function(a){d&&d.splice(d.indexOf(a),1),a.remove()})}function n(a,c,d){a.in=b,a.parent=c,a.before=d.last();var f=new e(a);return d.push(f),f}function o(a,b,c){var d=[];if(b)for(var g=0;g<a[0].childNodes.length;g++)s(i(a[0].childNodes[g]),c,d);else e.isType(c,f.blockquote,f.list_item)?q(a,c,d):c.set("text",l(a))}function p(a,b,d){for(var e,g,i=[],j=null,k=0;k<a.length;k++)e=a[k],(i=h.reDefLink.exec(e))?(j=null,n({type:f.def_link,ref:i[1],href:i[2],title:i[3]},b,d)):(i=h.reDefLink.exec(e))?(j=null,n({type:f.def_footnote,ref:i[1],text:(i[2]||"").trim()},b,d)):(null==j&&(j=n({type:f.paragraph},b,d),g=[]),n({type:f.line,text:c.escapeHead(e)},j,g))}function q(a,b,c){if(a.find("br").length){for(var d=l(a,!0),e=[],f=0;f<d.length;f++)d[f].trim().length&&e.push(d[f]);p(e,b,c)}else{if(3==a[0].nodeType&&!a.text().trim().length)return;p([l(a)],b,c)}}function r(a,b){for(var c,d=[],e=0;e<a.length;e++)"DT"==a[e].tagName&&(c=n({type:f.list_item},b,d),c.itemList=[],n({type:f.paragraph,text:l(i(a[e]))},c,c.itemList)),"DD"==a[e].tagName&&c&&n({type:f.paragraph,text:l(i(a[e]))},c,c.itemList)}function s(a,b,c){var h,m,p=a.children(":not(:empty), hr")[0],t=p&&(j.indexOf(p.tagName)>-1||"BLOCK"==p.style.display),u=a[0].tagName;if(!(a.data("skip")||k.indexOf(u)>-1||a[0].nodeType===document.COMMENT_NODE)){if("BLOCKQUOTE"===u)h=n({type:f.blockquote},b,c),o(a,t,h);else if("LI"===u&&e.isType(b,f.list))h=n({type:f.list_item},b,c),o(a,t,h);else if("UL"===u||"OL"===u)h=n({type:f.list,style:u.toLowerCase()},b,c),o(a,t,h);else if("DL"===u)h=n({type:f.list,style:"ul"},b,c),r(a.children(),h);else if("TABLE"===u)m=a.children().children("tr").add(a.children("tr")),m.length&&(h=n({type:f.table},b,c),c=[],h.cols=1,m.toArray().map(function(a){s(i(a),h,c)}),h.set("align",new Array(h.cols-0)),g.valify(h,h.cols,2,function(a,d){var e=d.split(/(\r|\n)+/);a.set("type",f.paragraph),a.set("text",e[0]);for(var g=1;g<e.length;g++)e[g].trim().length&&n({type:f.paragraph,text:e[g]},b,c)}));else if("THEAD"===u||"TBODY"===u||"TFOOTER"===u){for(var v=[a],w=$elem.next();w.length&&e.isType(w[0].tagName,"THEAD","TBODY","TFOOTER");)v.push(w),w.data("skip",!0);a.wrap("<table></table>"),s(a.parent(),b,c)}else if("TR"===u&&e.isType(b,f.table)){var x;m=a.children("th"),x=m.length,m=m.add(a.children("td")),b.cols=m.length>b.cols?m.length:b.cols,h=n({type:f.table_row,isHeader:x},b,c),c=[],m.toArray().map(function(a){s(i(a),h,c)})}else if("TD"!==u&&"TH"!==u||!e.isType(b,f.table_row))if("HR"===u)n({type:f.hr},b,c);else if(/H[1-6]/g.exec(u))n({type:f.heading,text:l(a),depth:a[0].tagName[1]},b,c);else if("CODE"===u||"PRE"===u||"FIGURE"==u&&a.hasClass("highlight"))a.find("div").each(function(){i(this).before("<br/>")}),n({type:f.fences,text:a[0].innerText.replace(/^\s*\n+/,"")},b,c);else if(t)for(var y=0;y<a[0].childNodes.length;y++)s(i(a[0].childNodes[y]),b,c);else{var z=d(a[0].innerText||"");if(z)return z;q(a,b,c)}else h=n({type:f.table_cell,text:l(a)},b,c);return null}}var t=i(i.parseHTML("<div>"+a+"</div>")[0]),u=[];t.find("meta, script, css, .gutter, style").remove();var v=s(t,null,u);if(v)return v;if(u.length&&(m(null,u[0],u.last(),u),1===u.length&&e.isType(u[0],f.paragraph))){var w=t.text();return u[0].delete(),e.parseFrom(w,b,{noTop:!0,skips:{old_code:!0}},!0)[1]}return u},m=function(a){function b(a,b){for(var d=(a instanceof Array?a[0]:a.at(0)).getLastBrother(!0),e=[],f=0;f<a.length;f++)e=e.concat(c(d,b)),d=d.get("after");return e}function c(a,d){function g(a){return d?[a]:[a,""]}var h,i=[],j=a.get("type");switch(j){case f.fences:i=a.get("text").replace(/\u200B/g,"").split("\n");for(var k=0;k<i.length;k++)i[k]="    "+i[k];return d||i.push(""),i;case f.list:var l=a.get("style"),m=a.get("children").length;if(m)for(var n=a.getFirstChild(),o=n,k=0;o;){var p=c(o,!0),q=e.getIndentPrefix(l,k,o,void 0,(m+"").length);p.map(function(a,b){p[b]=(b?" ".repeat(q.length):q)+p[b],i.push(p[b])}),k++,o=o.get("after")}return d||i.push(""),i;case f.table:for(var r,s,t,u,v,w,x=[],y=[],z=0,A=a.getFirstChild();A;){for(r=A.getFirstChild(),y[z]=[],s=0;r;)y[z][s]=r.toMark().trim(),r=r.get("after"),0===z&&(x[s]=4),x[s]=Math.max(y[z][s].length,x[s]),x[s]=Math.min(x[s],40),s++;A=A.get("after"),z++}for(z=0;z<y.length;z++){for(t="  ",s=0;s<x.length;s++)u=Math.max(x[s]-y[z][s].length,0),v=a.get("align")[s],"right"==v?t+=" ".repeat(u)+y[z][s]:"center"==v?(w=~~(u/2),t+=" ".repeat(w)+y[z][s]+" ".repeat(u-w)):t+=y[z][s]+" ".repeat(u),t+="	";i.push(t.replace(/\s$/,""))}return d||i.push(""),i;case f.hr:return g("---");case f.def_link:return h="["+a.get("ref")+"]: "+a.safeGetStrAttr("href")+(a.safeGetStrAttr("title").length?'	"'+a.get("title")+'"':""),e.isType(a.get("after"),f.def_link)?[h]:g(h);case f.def_footnote:return h="["+a.get("ref")+"]: "+a.get("text"),e.isType(a.get("after"),f.def_footnote)?[h]:g(h);default:return a.get("children")&&a.get("children").length>0?b(a.get("children"),d):g(a.get("text"))}}return b(a).join("\n")};b.convertToPlain=m,b.parseHTML=l}),define("app/editor/DocMenu",["app/document/StringUtils","exoskeleton-master/exoskeleton","jquery/jquery","app/document/Node","app/document/MarkParser","app/editor/Inline","app/editor/UndoManager","app/editor/Emoji","app/window/FileHelper","app/editor/EditHelper"],function(a,b,c){"use strict";function d(){return e||(e=new l.InlineLexer(null,n)),e}var e,f=a("app/document/StringUtils"),g=a("exoskeleton-master/exoskeleton"),h=a("app/document/Node"),i=h.Node,j=h.TYPE,k=a("jquery/jquery"),l=a("app/document/MarkParser"),m=(a("app/window/FileHelper"),g.Collection.extend({model:i,getNodeByRef:function(a){for(var b in this.models)if(this.models.hasOwnProperty(b)){var c=this.models[b];if(f.escape(c.get("ref")).toLowerCase()==f.escape(a).toLowerCase())return c}},getFootHTMLByRef:function(a,b){var c=this.getNodeByRef(a);return c?(b&&File.editor.store(c.cid,!0),"<div class='code-tooltip md-tooltip-remove md-hover-tip md-f-tooltip' contenteditable='false'><div class='md-arrow' /><div class='code-tooltip-content'>"+editor.brush.inline.output(c.get("text"))+"</div></div>"):null},getHrefByRef:function(a,b){var c=this.getNodeByRef(a);return c&&b&&File.editor.store(c.cid,!0),c?f.escape(c.get("href")):void 0}})),n=function(a){switch(a.type){case j.strong:return"<strong>"+a.inner+"</strong>";case j.em:return"<em>"+a.inner+"</em>";case j.plain:return a.text;case j.del:return"<del>"+a.inner+"</del>";case j.footnote:return"";case j.escape:return a.text;default:return a.inner||a.text||""}},o=g.Model.extend({initialize:function(a){this.nodeMap=a,this.refresh(),this.delay=200,this.refreshTimeout=null},remove:function(a){var b=this.headers.indexOf(a);b>-1&&this.headers.splice(b,1)},refresh:function(a){function b(){var a=this.nodeMap.getFirst();for(this.headers=[];a;)i.isType(a,i.TYPE.heading)&&this.headers.push(a),a=a.get("after");this.updateHTML(),this.refreshTimeout=null}this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(b.bind(this),a?0:this.delay)},updateHTML:function(){var a=function(a){return"<span class='md-toc-item md-toc-h"+a.get("depth")+"' data-ref='"+a.cid+"'><a class='md-toc-inner'>"+e.output(a.get("text"))+"</a></span>"},b="",c=0,d=document.querySelectorAll(".md-toc-content");if(d.length>0)for(this.headers.map(function(c){b+=a(c)}),c=0;c<d.length;c++)d[c].innerHTML!=b&&(d[c].innerHTML=b);this.updateOutlineHtml()},updateOutlineHtml:function(){if(document.body.classList.contains("pin-outline")){var a=document.querySelector("#outline-content"),b=a.scrollTop;a.innerHTML=q(this),a.scrollTop=b,File.editor.docMenu.highlightVisibleHeader()}}}),p=null,q=function(a){function b(a){f+="<li class='outline-item-wrapper outline-h"+a.get("depth")+"'><div class='outline-item'><span class='outline-expander'></span><span class='outline-label' data-ref='"+a.cid+"'>"+h.output(a.get("text"))+"</span></div><ul class='outline-children'>",g.push(a.get("depth"))}function c(){f+="</ul></li>",g.pop()}function e(a){for(var d=0;d<a.length;d++){b(a[d]);var e=a[d+1]?a[d+1].get("depth"):1;if(e<=a[d].get("depth"))for(;g.last()&&g.last()>=e;)c()}}var f="",g=[],h=d();try{e(a.headers)}catch(i){console.warn(i.stack),f=""}return f},r=g.Model.extend({initialize:function(a){function b(){k(document).on("mousedown",".md-toc-inner",function(b){if(1===b.which){var c=this.parentElement.getAttribute("data-ref"),d=a.findElemById(c);return a.store(),a.undo.completeSnap(!0),a.selection.jumpIntoElemEnd(d),a.selection.scrollAdjust(d,10),!1}}).on("mousedown",".md-delete-toc",function(b){1===b.which&&a.UserOp.deleteSelectable(a,k(this).closest(".md-toc"))}).on("click","#md-notification .close-btn",function(){k("#md-notification").hide()})}function c(){{var a;f.editor}setTimeout(function(){f.need_def_foot_msg=k("#need_def_foot").html(),k(document).on("mouseenter",".md-footnote",function(){if(console.log("hover"),!a){if(!window.getSelection().anchorNode||window.getSelection().anchorNode.parentElement==this)return;a=!0,f.showTooltipForSup(k(this))}}).on("mouseleave",".md-footnote",function(){console.log("leave"),a=!1;k(this);setTimeout(function(){},1e3)})},300)}function e(){k(document).on("click",".outline-expander",function(){this.parentElement.parentElement.classList.toggle("outline-item-open")}).on("click",".outline-label",function(){var b=this.getAttribute("data-ref"),c=a.findElemById(b);a.undo.completeSnap(!0),a.selection.scrollAdjust(c,10),File.isFocusMode&&a.updateFocusMode(!1),f.autoHideOutline()}).on("mousewheel","#sidebar-content",function(){p&&clearTimeout(p)}).on("mousewheel","content",function(){if(document.querySelector(".dropdown-menu.open")&&!File.editor.sourceView.inSourceMode){var a=document.querySelectorAll(f.headerStr);a.length>100?(p&&clearTimeout(p),p=setTimeout(f.highlightVisibleHeader.bind(f),30)):(f.highlightVisibleHeader(a),p&&clearTimeout(p),p=setTimeout(f.highlightVisibleHeader.bind(f),100))}}).on("click","#close-outline-btn",function(){f.hideOutline()}).on("click","#pin-outline-btn",function(){document.body.classList.add("pin-outline"),f.pinOutline=!0
}).on("click","#unpin-outline-btn",function(){document.body.classList.remove("pin-outline"),f.pinOutline=!1})}var f=this;d(),this.headerStr=a.sessionStr+">h1, "+a.sessionStr+">h2, "+a.sessionStr+">h3, "+a.sessionStr+">h4, "+a.sessionStr+">h5, "+a.sessionStr+">h6",this.expandedOutlineItem=[],a.nodeMap.foot_list=new m,a.nodeMap.link_list=new m,a.nodeMap.toc=new o(a.nodeMap),this.editor=a,c(),b(),e()},highlightVisibleHeader:function(a,b){function c(a){var b=k("content").scrollTop(),c=a.offsetTop;return b>c?-1:c>b+window.innerHeight?1:0}function d(a){for(a--;h[a]&&0==c(h[a]);)a--;return a+1}function e(a){if(g.pinOutline&&a.length){var b,c,d=k("#outline-content:visible")[0];d&&(File.isNodeHtml||(d=d.parentElement),b=a.offset().top-k(d).offset().top,0>b?c=b-200+d.scrollTop:b>d.offsetHeight-20&&(c=b+200-d.offsetHeight+d.scrollTop),void 0!==c&&(d.scrollTop=c))}}if(document.querySelector("#outline-dropmenu").classList.contains("open")){var f,g=this,h=(this.editor,a||document.querySelectorAll(this.headerStr)),i=0,j=h.length-1,l=void 0===b?null:b;if(h.length){for(i=1===c(h[h.length-1])?0:h.length-1;j-i>1&&null==l;){var m=Math.floor((i+j)/2),n=c(h[m]);1==n?j=m:-1==n?i=m:l=d(m)}null==l&&(l=i),l<h.length&&(f=k("#outline-content .outline-label").removeClass("outline-active").filter("[data-ref='"+h[l].getAttribute("cid")+"']").addClass("outline-active"),e(f))}p=null}},getAttrByElem:function(a){return a.hasClass("md-def-name")?"ref":a.hasClass("md-def-content")?a.hasClass("md-def-url")?"href":"text":a.hasClass("md-def-title")?"title":void 0},addEmptyDef:function(a,b){function c(c){var e=d.findNodeByElem(c),f=d.undo.UndoManager.makeEmptyCommand();e.insert(new i({type:b,ref:a,url:"",text:""})),d.undo.UndoManager.addUndoForInsert(f,e.get("after")),c.after(e.get("after").toHTML()),d.selection.jumpIntoElemBegin(c.next().find(".md-def-content")),f.redo.push(d.selection.buildUndo()),d.undo.register(f),d.refocus()}var d=this.editor,e=k(d.sessionStr).find(b==i.TYPE.def_link?".md-def-link":".md-def-footnote").last();c(!e.length||e.nextAll(":not(.footnotes)").length?k(d.sessionStr).children().last():e)},showTooltipForSup:function(a){var b,c,d=this.editor;if(a.length){var e=a.find(".md-text").text();b=d.nodeMap.foot_list.getFootHTMLByRef(e,!0),k(".md-tooltip-remove").remove(),b?(c=k(k.parseHTML(b)[0]),k("body").append(c)):File.isLocked||(b="<div class='code-tooltip md-tooltip-remove md-hover-tip md-f-tooltip' contenteditable='false'><div class='md-arrow' /><div class='code-tooltip-content'><span class='fa text-warning fa-exclamation-triangle' title='warning' aria-hidden='true' /> "+this.need_def_foot_msg.format(e,e).trim()+" </div></div>",c=k(k.parseHTML(b)[0]),k("body").append(c),c.find(".code-tooltip-content a").unbind("click").click(function(){d.docMenu.addEmptyDef(e,h.TYPE.def_footnote)})),this.editor.EditHelper.fixPopoverPosition(a,c)}},getLocalRootUrl:function(){var a=this.getMetaNode();if(a){var b=/^\s*typora-root-url\s*:\s*(.*)$/im,c=(b.exec(a.get("text"))||[])[1];if(c){var d=File.isMac?app.document.currentFilePath():File.filePath;if(d)return File.isMac?app.path.resolvePathRelateTo(c,d):reqnode("path").resolve(c,d)}}return null},buildMetaMap:function(){var a,b,c,d=this.getMetaNode(),e=/^\s*([^:]+)\s*:\s*(.*)$/,f=/^\s#/,g={};return d&&(a=(d.get("text")||"").split(/\r|\n|\r\n/g),a.forEach(function(a){a.match(f)||((c=e.exec(a))?(b=c[1],g[b]=c[2].replace(/^\s*[|>]\s*/,"")):b&&(g[b]+="\n"+a.trim()))}),Object.keys(g).forEach(function(a){g[a].match(/^\s*-/)&&(g[a]=g[a].split(/(^|\n+)\s*-/g).filter(function(a){return a.match(/\S/)}).map(function(a){return a.trim()}))})),g},getMetaNode:function(){this.editor.undo&&this.editor.undo.completeSnap(!0);var a=this.editor.nodeMap.getFirst();return i.isType(a,j.meta_block)?a:null},getValueInMeta:function(a,b){if(b=b||this.getMetaNode()){var c=new RegExp("^s*"+a+"s*:s*(.*)$","mi");return(c.exec(b.get("text"))||[])[1]}return null},showOutline:function(a){var b=q(this.editor.nodeMap.toc),c=document.querySelector("#outline-content");c.innerHTML=b,a?this.pinOutline=a:k(".dropdown-menu.open, .dropdown-menu.show").removeClass("open").removeClass("show"),document.querySelector("#outline-dropmenu").classList.add("open"),function(){for(var a=c.querySelectorAll(".outline-item-wrapper"),b=0;b<a.length;b++)a[b].querySelector(".outline-item-wrapper")?a[b].classList.contains("outline-h1")&&a[b].classList.add("outline-item-open"):a[b].classList.add("outline-item-signle")}(),this.expandedOutlineItem&&this.expandedOutlineItem.forEach(function(a){try{c.querySelector("[data-ref='"+a+"']").parentElement.parentElement.classList.add("outline-item-open")}catch(b){}}),this.pinOutline&&document.body.classList.add("pin-outline")},hideOutline:function(){this.expandedOutlineItem=[],document.querySelector("#outline-dropmenu").classList.remove("open");for(var a=document.querySelectorAll(".outline-item-open:not(.outline-h1)>.outline-item>.outline-label"),b=0;b<a.length;b++)this.expandedOutlineItem.push(a[b].getAttribute("data-ref"));document.body.classList.remove("pin-outline")},autoHideOutline:function(){!this.pinOutline&&document.querySelector("#outline-dropmenu").classList.contains("open")&&this.hideOutline()},toggleOutline:function(a){document.querySelector("#outline-dropmenu").classList.contains("open")?this.hideOutline():this.showOutline(a)},getHeaderMatrix:function(){var a=[];return this.editor.nodeMap.toc.headers.map(function(b){a.push([b.get("depth")-0,e.output(b.get("text")),b.cid])}),a}});c.exports=r}),define("app/editor/SearchPanel",["exoskeleton-master/exoskeleton","jquery/jquery","app/document/StringUtils","rangy/rangy-core","app/editor/KeyMaster","codemirror/lib/codemirror","app/document/Node","rangy/rangy-classapplier"],function(a,b,c){"use strict";function d(a){return!a.match(/^([a-z]|\s)?$/gi)}function e(a,b){return new RegExp(i.escapeRegExp(a)+(b.wholeWord?"(?![A-Za-z_\\u00C0-\\u024f])":""),b.caseSensitive?"g":"gi")}function f(a){q&&clearTimeout(q),$("#md-searchpanel.searchpanel-replace-mode").addClass("searchpanel-msg-mode").find("#searchpanel-msg-content").text(a),q=setTimeout(function(){$("#md-searchpanel").removeClass("searchpanel-msg-mode")},5e3)}function g(a){return"Replaced "+a+" occurrence(s)"}var h=a("exoskeleton-master/exoskeleton"),i=a("app/document/StringUtils"),j=a("rangy/rangy-core.js"),k=a("app/editor/KeyMaster"),l=(a("codemirror/lib/codemirror"),a("app/document/Node")),m=window.Node,n=l.Node,o=l.TYPE,p=(a("rangy/rangy-classapplier"),/[A-Za-z_\\u00C0-\\u024f]/i),q=null,r=h.Model.extend({initialize:function(a){this.editor=a,this.bindEvents(),this.curSel=null,this.searchTimer,this.applier=j.createClassApplier("md-search-hit"),this.selectApplier=j.createClassApplier("md-search-select")},bindEvents:function(){var a,b=this,c=!1,d=k.map;!File.isMac&&!File.isNode&&k("command+f, ctrl+f",function(a){b.showPanel(),a.preventDefault()}),!File.isMac&&!File.isNode&&k("command+h, ctrl+h",function(a){b.showPanel(!0),a.preventDefault()}),$("#md-searchpanel").on("blur",function(){b.closePanel()}).on("click",".close-btn .glyphicon-remove",function(){b.closePanel()}).on("keydown","#search-panel-input, #search-panel-replace-input",function(){var a=event.keyCode||event.which;return(c=229==a)?void 0:"Esc"==d[a]?(b.closePanel(),!1):"E"==d[a]&&(event.metaKey||event.ctrlKey)?(b.replaceSelection(),!1):void 0}).on("keydown","#search-panel-input",function(){var a=event.keyCode||event.which;return c=229==a,"Enter"==d[a]?(b.highlightNext(),!1):"Tab"!=d[a]||$("#md-searchpanel.searchpanel-replace-mode").length?void 0:(this.value+="	",!1)}).on("keyup","#search-panel-input",function(){var e=event.keyCode||event.which;c=c&&!(String.fromCharCode(e).match(/\s|[0-9]/g)||"Enter"==d[e]),c||a==$(this).val()||(a=$(this).val(),b.doSearch(a))}).on("keydown","#search-panel-replace-input",function(){var a=event.keyCode||event.which;c=229==a,c||"Enter"!=d[a]||b.replaceSelection()}).on("mousedown","#search-panel-prev",function(){b.highlightNext(!0)}).on("mousedown","#search-panel-next",function(){b.highlightNext()}).on("click","#md-search-type-label",function(){$("#md-searchpanel").addClass("searchpanel-replace-mode"),$("#search-panel-replace-input").focus(),$("content").addClass("on-replace-panel-open")}).on("click","#md-replace-type-label",function(){$("#md-searchpanel").removeClass("searchpanel-replace-mode").removeClass("searchpanel-msg-mode"),$("#search-panel-input").focus(),$("content").removeClass("on-replace-panel-open")}).on("click","#search-panel-replace-btn",function(){b.replaceSelection(),$("#md-searchpanel").removeClass("searchpanel-msg-mode")}).on("click","#search-panel-replaceall-btn",function(){$("#md-searchpanel").removeClass("searchpanel-msg-mode"),b.replaceAll()}).on("click","#searchpanel-msg-close-btn",function(){$("#md-searchpanel").removeClass("searchpanel-msg-mode")}).on("click","#searchpanel-msg-undo-btn",function(){b.editor.undo.undo(),$("#md-searchpanel").removeClass("searchpanel-msg-mode"),!b.editor.sourceView.inSourceMode&&b.doSearch($("#search-panel-input").val())}).on("mousedown","#searchpanel-case-option-btn",function(){return this.classList.toggle("active"),b.doSearch(),!1}).on("mousedown","#searchpanel-word-option-btn",function(){return this.classList.toggle("active"),b.doSearch(),!1})},replaceAll:function(){function a(a,b){var c=a.get(b);c&&a.set(b,c.replace(e(d,q),function(a,b,c){return q.wholeWord&&b>0&&p.exec(c.substr(b-1,1))?a:i}))}function b(b){var c=this.editor.getNode(b.cid);o.undo.push(n.buildReplaceUndo(c)),a(c,"text"),a(c,"title"),a(c,"ref"),o.redo.push(n.buildReplaceUndo(c)),this.editor.findElemById(c.cid).replaceWith(c.toHTML())}if(this.searchStatus&&this.searchStatus.hits.length){var c,d=this.searchStatus.searchText,i=$("#search-panel-replace-input").val(),j=this.searchStatus.hits;if(f.call(this,g(this.searchStatus.hits.length,this.searchStatus.searchText)),this.editor.sourceView.inSourceMode){var k="",l=0,m=j.length;for(c=0,d=this.editor.sourceView.cm.getValue();m>l;l++)k=k+d.substring(c,j[l].start-0)+i,c=j[l].end-0;return k+=d.substring(c),this.editor.sourceView.cm.setValue(k),void this.clearSearch()}var n=this.editor.undo.UndoManager,o=n.makeEmptyCommand(h.utils.extend(this.searchStatus.curSelection,{type:"cursor"})),q=this.searchStatus,r=null;this.clearSearch();for(var l=0;l<j.length;l++)c=j[l],r!=c.cid&&(r=c.cid,b.call(this,c));this.editor.undo.register(o)}},replaceSelection:function(){function a(a){for(var b=a.curPos+1;b<a.hits.length;b++){var c=a.hits[b];c.cid==a.curSelection.cid&&(c.start+=d,c.end+=d)}}if(this.editor.sourceView.inSourceMode&&!this.searchStatus.curSelection&&this.highlightNext(),this.searchStatus.curSelection&&this.searchStatus.hits.length&&$("#md-searchpanel.searchpanel-replace-mode").length){var b,c,d,e=$("#search-panel-replace-input").val(),f=e.length-this.searchStatus.searchText.length,g=this.searchStatus.curPos,h=this.editor.undo.UndoManager,i=h.makeEmptyCommand(),j=this.searchStatus.curSelection,k=j.isCm;d=f,this.searchStatus.lastRange?(b=this.editor.nodeMap.allNodes.get(j.cid),i.undo.push({type:"cursor",id:b.cid,start:j.start,end:j.end}),this.selectApplier.undoToRange(this.searchStatus.lastRange),this.applier.undoToRange(this.searchStatus.lastRange),d=e.length-(this.searchStatus.curSelection.end-this.searchStatus.curSelection.start),this.searchStatus.lastRange.deleteContents(),this.searchStatus.lastRange.insertNode(document.createTextNode(e)),this.searchStatus.lastRange=null,i.undo.push(h.buildReplaceUndo(b)),this.editor.store(b.cid),i.redo.push(h.buildReplaceUndo(b))):k&&k.doc.replaceSelection(e,"start","+findReplace"),a(this.searchStatus,f),this.highlightNext(),this.searchStatus.hits.splice(g,1),this.searchStatus.curPos--,this.searchStatus.curPos<0&&(this.searchStatus.curPos=this.searchStatus.hits.length-1),this.searchStatus.hits.length||this.clearSearch(),c=this.searchStatus.curSelection||this.searchStatus.initRange,this.editor.sourceView.inSourceMode||(c&&i.redo.push({type:"cursor",id:c.cid,start:c.start,end:c.end}),this.editor.undo.register(i))}},showPanel:function(a){$("#md-searchpanel").is(":visible")||(editor.lastCursor=editor.selection.buildUndo(),this.editor.undo.completeSnap(!0),this.clearSearch(),this.searchStatus.initPos=editor.selection.getPosBookmark(),$("#md-searchpanel").show().find("#search-panel-input").focus()[0].select(),$("#search-panel-input").val()&&this.doSearch($("#search-panel-input").val()),$("content").addClass("on-search-panel-open")),a?($("#md-searchpanel").addClass("searchpanel-replace-mode"),$("content").addClass("on-replace-panel-open")):($("#md-searchpanel").removeClass("searchpanel-replace-mode"),$("content").removeClass("on-replace-panel-open"))},closePanel:function(){var a=$(".md-search-select"),b=this.editor.getMarkElem().length;return $("content").removeClass("on-replace-panel-open").removeClass("on-search-panel-open"),$("#md-searchpanel").removeClass("searchpanel-msg-mode").hide(),this.editor.sourceView.inSourceMode?(this.searchStatus&&this.searchStatus.hits.length&&(this.editor.fences.clearSearchAll(),this.editor.sourceView.cm.focus()),void this.resetSearchStatus()):(a.length?(this.editor.selection.selectAllElem(a),this.editor.lastCursor=this.editor.selection.buildUndo()):this.searchStatus&&this.searchStatus.curCmCursor&&(this.searchStatus.curCmCursor.doc.cm.focus(),this.editor.lastCursor=this.editor.selection.buildUndo(),b=!0),this.clearSearch(),$(".md-search-hit").removeClass("md-search-hit"),!b&&this.editor.restoreLastCursor(),void this.editor.refocus())},doSearch:function(a){function b(a){var b=a.containerNode||document.querySelector("[cid='"+a.cid+"']");return q?q.compareDocumentPosition(b)==m.DOCUMENT_POSITION_PRECEDING?!0:q==b?a.start<l.start:!1:!1}function c(a,c){for(var d=e(c,k),f=a.getValue(),g=null,i=!1,j=null;g=d.exec(f);)i=!0,j={isCm:a,cid:a.cid,start:d.lastIndex-c.length,end:d.lastIndex},k.wholeWord&&j.start>0&&p.exec(f.substr(j.start-1,1))||(k.hits.push(j),b(j)&&k.curPos++);i&&h.fences.searchOn(a,c,k)}function f(a,c){for(var d,f,g,i=e(c,k),l=h.findElemById(a.cid)[0],m=l.textContent;d=i.exec(m);)g={cid:a.cid,containerNode:l,start:i.lastIndex-c.length,end:i.lastIndex},k.wholeWord&&g.start>0&&p.exec(m.substr(g.start-1,1))||(f=f||j.createRange(),f.moveToBookmark(g),r.applyToRange(f),k.hits.push(g),b(g)&&k.curPos++)}function g(a,b,d){a.get("children").length?a.get("children").toArray().map(function(a){g(a,b)}):h.fences.queue[a.cid]?c(h.fences.queue[a.cid],b):n.isType(a,o.math_block)?(h.mathBlock.currentCm||{}).cid===a.cid&&(h.fences.clearSearchOn(h.mathBlock.currentCm),c(h.mathBlock.currentCm,b)):f(a,b,d)}this.clearSearch();var h=this.editor,i=this,k=this.searchStatus,l=k&&k.initPos,q=l&&document.querySelector("[cid='"+l.cid+"']");if(k.searchText=void 0===a?$("#search-panel-input").val():a,k.caseSensitive=$("#searchpanel-case-option-btn.active").length,k.wholeWord=$("#searchpanel-word-option-btn.active").length,d(k.searchText)){var i=this,r=this.applier;if(this.editor.sourceView.inSourceMode)return void c(this.editor.sourceView.cm,k.searchText);this.searchTimer=setTimeout(function(){for(var a=h.nodeMap.getFirst();a;)g(a,k.searchText,r),a=a.get("after");i.highlightNext()},50)}},highlightNext:function(a){function b(){e.curSelection&&((d=e.curSelection.isCm)?d.execCommand(a?"goDocStart":"goDocEnd"):e.lastRange&&this.selectApplier.undoToRange(this.searchStatus.lastRange))}function c(){b.call(this),e.curSelection=e.hits[e.curPos],(d=e.curSelection.isCm)?(e.lastRange=null,d.doc.setSelection(d.posFromIndex(e.curSelection.start),d.posFromIndex(e.curSelection.end)),f.selection.scrollAdjust($(".CodeMirror-selectedtext"),null,window.innerHeight-200)):(e.lastRange=e.lastRange||j.createRange(),e.lastRange.moveToBookmark({containerNode:document.querySelector("[cid='"+e.curSelection.cid+"']"),start:e.curSelection.start,end:e.curSelection.end}),this.selectApplier.applyToRange(e.lastRange),f.selection.scrollAdjust(e.lastRange,null,window.innerHeight-200))}if(!$("#md-searchpanel").is(":visible"))return this.showPanel();$("#md-searchpanel").removeClass("searchpanel-msg-mode");var d,e=this.searchStatus,f=this.editor;e&&e.hits.length&&(e.curSelection&&(e.curPos+=a?-1:1),e.curPos>=e.hits.length?e.curPos=0:e.curPos<0&&(e.curPos=e.hits.length-1),c.call(this,e.curPos))},clearSearch:function(){if(this.editor.sourceView.inSourceMode)return this.editor.fences.clearSearchAll(),void this.resetSearchStatus(this.searchStatus&&(this.searchStatus.curSelection||this.searchStatus.initPos));if(this.searchStatus){try{this.searchStatus.lastRange&&this.selectApplier.undoToRange(this.searchStatus.lastRange)}catch(a){console.dir(a)}for(var b,c=j.createRange(),d=0;d<this.searchStatus.hits.length;d++){var e=this.searchStatus.hits[d];e.isCm||(c.moveToBookmark({containerNode:document.querySelector("[cid='"+e.cid+"']"),start:e.start,end:e.end}),this.applier.undoToRange(c))}(b=this.searchStatus.curSelection&&this.searchStatus.curSelection.isCm)&&(b.doc.setSelection(b.posFromIndex(this.searchStatus.curSelection.start)),$(b.display.input).blur())}this.editor.fences.clearSearchAll(),clearTimeout(this.searchTimer);var f=this.searchStatus&&(this.searchStatus.curSelection||this.searchStatus.initPos);this.resetSearchStatus(f)},resetSearchStatus:function(a){this.searchStatus={hits:[],curPos:0,searchText:null,lastRange:null,initPos:a,curSelection:null}}});c.exports=r}),define("app/editor/Word",["jquery/jquery","exoskeleton-master/exoskeleton"],function(a,b,c){"use strict";var d=a("jquery/jquery"),e=a("exoskeleton-master/exoskeleton"),f=e.Model.extend({initialize:function(a){this.editor=a,this.$container=d("#word-auto-suggest")},search:function(a,b,c,d){var e=a.substring(b,b+c);if(!e)return[];var f=[];return File.isMac?(f=app.word.getSpellSuggestionInContext(a,b,c),d.type="word",d.token=e,d.match=f,d.found=f.length,d.pageNo=0,d.pageCnt=Math.floor((f.length-1)/5+1)):d.found=!1,f},showAutoSuggest:function(a,b,c,e){if(e.token===a.substring(b,b+c))return!1;var f=this.search(a,b,c,e),g="";if(!e.found)return this.$container.hide(),!1;for(var h=0;h<f.length&&40>h;h++)h%5==0&&(g+=(h>0?"</ul>":"")+"<ul data-page='"+h/5+"' style='display:none'>"),g+=d("<li/>").attr("data-content",f[h]).text(f[h])[0].outerHTML;return g+="</ul>",this.$container.html(g),this.$container}});c.exports=f}),define("app/document/Export",["exoskeleton-master/exoskeleton","jquery/jquery","app/document/Node","app/document/StringUtils","app/document/StringUtils","app/document/MarkParser","app/editor/Inline","app/editor/UndoManager","app/editor/Emoji","app/document/Node2Native","app/document/MarkParser","app/editor/polyfill"],function(a,b,c){"use strict";var d,e=a("exoskeleton-master/exoskeleton"),f=a("app/document/Node"),g=f.Node,h=f.TYPE,i=(f.NodeCollectionUtils,a("app/document/StringUtils")),j=a("app/document/MarkParser"),k=a("app/editor/Inline"),l=(a("app/document/Node2Native"),a("app/editor/polyfill"),e.Model.extend({initialize:function(b){this.editor=b,window.debugMode&&a.async("FileSaver.min",function(a){d=a})},exportToNative:function(a){return this.editor.nodeMap.exportToNative(a)},exportAndSaveHTML:function(a){var b=new Blob([this.exportToHTML(a)],{type:"text/html;charset=utf-8"});d(b,"export.html")},exportCollection:function(a,b,c,d,e,f){function l(a){if("string"==typeof a)return f.output(a,k.decorateAsExport);var i=a.get("children");return g.isType(a,h.paragraph)?i.toArray().map(function(a){return f.output(a.get("text"),k.decorateAsExport)}).join("\n"):i&&i.length>0?s.exportCollection(i,b,c,d,e,f):f.output(a.get("text"),k.decorateAsExport)}function m(a){function b(a){return l(a.get("parent").get("loose")===!1?a.getFirstChild():a)}function e(){if(d)return"<div>[TOC]</div>";if(!f){var a=$(document.querySelector(".md-toc-content")).clone();a.find("[data-ref]").each(function(){this.querySelector("a").setAttribute("href",(c&&File.isMac?"anchor-to://":"#header-")+this.getAttribute("data-ref")),c&&File.isNode&&File.option.printPDFByPhantom&&this.querySelector("a").setAttribute("href","")}),f="<div class='md-toc' mdtype='toc'>"+a[0].outerHTML+"</div>"}return f}var f=null;switch(a.get("type")){case h.paragraph:return"<p>"+l(a)+"</p>";case h.heading:var j="";return c&&1==a.get("depth")&&!a.get("parent")&&a.get("before")&&(j=" data-breakpage"),"<h"+a.get("depth")+j+">"+(d?"":"<a name='header-"+a.cid+"' class='md-header-anchor "+(c?"md-print-anchor' href='anchor-from://"+a.cid+"'> ":"'>")+"</a>")+l(a)+"</h"+a.get("depth")+">";case h.blockquote:return"<blockquote>"+l(a)+"</blockquote>";case h.list:var k=a.get("style"),n=function(){for(var b=a.get("children").toArray(),c=!1,d=0;d<b.length;d++){var e=b[d].getFirstChild();if(!g.isType(e,h.paragraph)||e.get("after"))return!0}return c}();return a.set("loose",n),k==g.ListType.task?"<ul "+(d?"":"class='task-list'")+">"+r+l(a)+"</ul>":"<"+k+">"+l(a)+"</"+k+">";case h.list_item:var o=a.get("parent").get("style")===g.ListType.task;return o?"<li "+(d?"":"class='task-list-item'")+" ><input type='checkbox' disabled='disabled' "+(a.get("checked")?"checked":"")+"></input>"+l(a)+"</li>":"<li>"+r+b(a)+"</li>";case h.fences:if(d)return"<pre>"+r+i.escape(a.get("text"))+r+"</pre>";if(a.get("lang")){var q=p.findElemById(a.id).clone();return q.removeAttr("cid").removeAttr("contenteditable").removeAttr("mdtype").find("input, textarea, .code-tooltip, .CodeMirror-cursors").remove(),q[0].outerHTML}return"<pre class='md-fences mock-cm' style='display:block;position:relative'>"+i.escape(a.get("text"))+"</pre>";case h.math_block:var s=p.findElemById(a.id),t=s.width(),u=s.find(".MathJax_SVG").width();return u-10>t&&(s=s.clone().find(".MathJax_SVG").css("zoom",t/u)),c&&File.isNode&&File.option.printPDFByPhantom&&(s=s.clone().css("zoom",1/.9*1.25+"")),s[0].outerHTML.replace("xlink=","xmlns:xlink=").replace(/NS\d+:href/gi,"xlink:href");case h.hr:return"<hr />";case h.def_footnote:return"";case h.def_link:return"";case h.table:for(var v=(a.get("align").length,"<table>"+r),w=a.getFirstChild();w;)v+=w.get("before")?m(w):"<thead>"+r+m(w)+"</thead>"+r+"<tbody>",w=w.get("after"),w||(v+="</tbody>"+r);return v+="</table>";case h.table_row:for(var x,v="<tr>",w=a.getFirstChild(),y=a.get("parent").get("align"),z=0,A=a.get("before")?"td":"th";w;)x=y[z],x=x?" style='text-align:"+x+";' ":"",v+="<"+A+x+">"+m(w)+"</"+A+">",w=w.get("after"),z++;return v+="</tr>";case h.table_cell:return l(a);case h.meta_block:return"";case h.toc:return e();default:return"<p>"+l(a)+"</p>"}}function n(a,c){var d=a.get("ref")+c.count,e=f.output(a.get("text"),k.decorateAsExport,null,null,{footnote:1});b.push("<div class='footnote-line'><span class='md-fn-count'>"+c.count+"</span> "+e+"<a name='dfref-"+d+"' href='#ref-"+d+"' title='back to document' class='reversefootnote' ></a></div>")}var o=this.editor.nodeMap,p=this.editor,f=f||new j.InlineLexer({nodeMap:o,count:1,appendFootnote:n,noStyle:d,forPrint:c},k.decorateAsExport),q="",r=d?"\n":"",s=this;if(b=b||[],"string"==typeof a)return l(a);if(a.length){var t=a instanceof Array,u=t?a[0]:a.at(0);if(!t)for(;u.get("before");)u=u.get("before");do q+=m(u)+r,u=u.get("after");while(u&&(!t||a.indexOf(u)>-1))}return q+(e?b.join("\n"):"")},exportToHTML:function(a,b){function c(c,e){if(e=i.escape(e)||"Typora Writings",j.length){{window.app&&app.setting.get("split_pages")}c+="<div class='footnotes-area' "+(a?"data-breakpage":"")+" ><hr/>"+j.join("")+"</div>"}var g=a?"<script> window.setBreakPage = function(b){var node = document.querySelectorAll('[data-breakpage]'); for(var i=0;i<node.length;i++){node[i].style.pageBreakBefore = b ? 'always':'' }}; setBreakPage("+(window.app&&app.setting.get("split_pages")?"true":"false")+");</script>":"",h=File.isMac?"is-mac":"is-node",k=document.body.parentElement.style.fontSize||"";return k&&(k=" style='font-size:"+k+"'"),b?"<!doctype html>\n<html>\n<head>\n<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>\n<title>"+e+"</title></head>\n<body>"+c+"</body>\n</html>":"<!doctype html>\n<html"+k+(a&&!File.option.printPDFByPhantom&&" class='blink-to-pdf' "||"")+">\n<head>\n<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>\n<title>"+e+"</title>"+(a?"":d())+"<style type='text/css'>html, body {overflow-x: initial !important;}"+f()+"\n</style>\n</head>\n<body class='typora-export ' >\n<div  id='write' "+(a?"style='top:auto'":"")+" class = '"+h+"'>"+c+"</div>\n"+g+"</body>\n</html>"}function d(){function a(a){return"<link href='"+a+"' rel='stylesheet' type='text/css'>"}var b,c,d=new XMLHttpRequest,e="",f=/^\s*@include-when-export\s+url\(([^\)]+)\)/gim;try{d.open("GET",document.getElementById("theme_css").href,!1),d.send(),4==d.readyState&&(b=d.responseText.match(f),b&&b.map(function(b){c=/^\s*@include-when-export\s+url\(([^\)]+)\)/gim.exec(b),e+=a(c[1])}))}catch(g){}return e}function e(a,b){var c=/^["']/;return a.replace(/url\([^:)]+\)/gi,function(a){a=a.substring(4,a.length-1);var d=(a.match(c)||[""])[0];return a=decodeURI(d.length?a.substring(1,a.length-1):a),File.isMac?a="file://"+app.path.getCssResourcePath(a):File.isNode&&(a="file:///"+reqnode("path").resolve(b,a)),"url("+d+encodeURI(a)+d+")"})}function f(){var a,b,c,d,f=[];File.isMac?(d=$("#theme_css").attr("href"),c=e(app.path.readText(d))):File.colorBrightness<.5&&File.isNode&&(d=reqnode("electron").app.getPath("userData")+"/themes/github.css",c=e(reqnode("fs").readFileSync(d,"utf-8"),d));for(var g=0;g<document.styleSheets.length;g++)if(a=document.styleSheets[g],b=c?Object.keys(File.editor.fences.queue).length?/(base\.css)|(codemirror)/gi:/base\.css/gi:Object.keys(File.editor.fences.queue).length?/(theme)|(base\.css)|(codemirror)/gi:/(theme)|(base\.css)/gi,b.exec(a.href))for(var h in a.cssRules)f.push((a.cssRules[h].cssText||"").replace(/content: ([^;]{1});/g,"content: '$1';"));return c&&f.push(c),f.join("\n")}var g=this.editor.nodeMap,h=this.editor,j=[],k=File.getFileName();return File.option.showLineNumbersForFence&&h.fences.refreshEditor(!0),c(this.exportCollection(g.blocks,j,a,b),k)}}));c.exports=l}),define("app/document/Node2Native",["exoskeleton-master/exoskeleton","jquery/jquery","app/document/Node","app/document/StringUtils","app/document/MarkParser","app/editor/Inline","app/editor/UndoManager","app/editor/Emoji"],function(a){"use strict";var b,c=(a("exoskeleton-master/exoskeleton"),a("app/document/Node")),d=c.Node,e=c.NodeMap,f=c.TYPE,g=a("app/document/StringUtils"),h=a("app/document/MarkParser"),i={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j=function(a){return a.replace(/["\\\b\t\n\f\r]/g,function(a){return i[a]}).replace(/\u200b/g,"")},k={left:"AlignLeft",right:"AlignRight",center:"AlignCenter"},l=function(a,b,c,d){b=void 0===b?",":b,d=d||v;for(var e,f=[],g=c||a.getFirstChild();g;)e=o(g,d),e&&f.push(e),g=g.get("after");return f.join(b)},m=function(a,b){function c(a){return'Str "'+"\\t".repeat(a.get("depth")-1)+'", Link ("", [], []) ['+n(a)+'] ("#header-'+a.cid+'","")'}function d(a){return'Str "'+"".repeat(a.get("depth")-1)+'", Link ("", [], []) ['+n(a)+'] ("#header-'+a.cid+'","")'}var e=[];try{return e=a.toc.headers.map(b?d:c),'Div ("toc", [], []) [Para ['+e.join(",LineBreak,")+"]]"}catch(f){return console.warn(f.stack),""}},n=function(a,c){return c=c||a.get("text"),b.output(c,null,a).replace(/, $/,"")||'Str ""'},o=function(a,b){var c;switch(a.get("type")){case f.meta_block:return"";case f.heading:return"Header "+a.get("depth")+' ("header-'+a.cid+'", [], []) ['+n(a)+"]";case f.line:return n(a);case f.paragraph:return c=l(a,",Space,"),"Para ["+c+"]";case f.blockquote:return c=l(a),"BlockQuote ["+c+"]";case f.list:var e=a.get("style");return c=l(a),e==d.ListType.ol?"OrderedList (1,Decimal,Period) ["+c+"]":"BulletList ["+c+"]";case f.list_item:return c=l(a),"["+c+"]";case f.fences:return'CodeBlock ("",["'+j(a.get("lang")||"")+'"],[]) "'+j(a.get("text"))+'"';case f.math_block:return'Plain [Math DisplayMath "'+j(a.get("text").trim())+'"]';case f.hr:return"HorizontalRule";case f.def_footnote:case f.def_link:return"";case f.toc:return"latex"==b.target?'RawBlock (Format "latex") "\\\\tableofcontents"':"wiki"==b.target?'RawBlock (Format "mediawiki") "__TOC__", RawBlock (Format "mediawiki") ""':m(a.get("in"),"epub"==b.target);case f.table:var g=a.get("align").map(function(a){return k[a]||"AlignDefault"}),h=g.map(function(){return"0.0"}),i=a.getFirstChild();return"Table [] ["+g.join(",")+"] ["+h.join(",")+"] ["+l(i)+"] ["+l(a,",",i.get("after"))+"]";case f.table_row:return"["+l(a)+"]";case f.table_cell:return"[Plain ["+n(a)+"]]";default:return""}},p=[];p[f.strong]="Strong",p[f.em]="Emph",p[f.del]="Strikeout",p[f.subscript]="Subscript",p[f.superscript]="Superscript";var q,r={html:'RawInline (Format "html") "<u>", $0, RawInline (Format "html") "</u>", ',docx:'RawInline (Format "openxml") "<w:r><w:rPr><w:u w:val=\\"single\\" /></w:rPr><w:t>$0</w:t></w:r>", ',rtf:'RawInline (Format "rtf") "{\\\\ul ", $0, RawInline (Format "rtf") " }", ',latex:'RawInline (Format "latex") "\\\\underline{", $0, RawInline (Format "latex") "}", '},s={html:'RawInline (Format "html") "<mark>", $0, RawInline (Format "html") "</mark>", ',docx:'RawInline (Format "openxml") "<w:r><w:rPr><w:shd w:val=\\"clear\\" w:fill=\\"ffff00\\" /></w:rPr><w:t>$0</w:t></w:r>", ',rtf:'RawInline (Format "rtf") "{{\\\\colortbl;\\\\red255\\\\green255\\\\blue0;} \\\\cb1 ", $0, RawInline (Format "rtf") "}", ',latex:'RawInline (Format "latex") "\\\\hl{", $0, RawInline (Format "latex") "}", '},t=function(a){var b=function(a){if(d.isType(a.type,f.plain,f.escape,f.emoji))return a.inner||a.text;throw Error("caught styles")};q||(q=new h.InlineLexer({},b));try{return q.output(a.text,b,null,!0)}catch(c){return!1}},u=function(a,b){var c,d,e,h,i,k=/^(\S*)(\s*)/,l=function(a){for(var b,c="";a.length&&(b=k.exec(a));)a=a.substring(b[0].length),b[1]&&(c+='Str "'+j(b[1])+'", '),b[2]&&(c+="Space, ");return c};a.inner&&(a.inner=a.inner.replace(/, $/,""));var m=/^file:[\\\/]{0,2}/i;switch(a.type){case f.strong:case f.em:case f.del:case f.subscript:case f.superscript:return p[a.type]+" ["+a.inner+"], ";case f.plain:case f.escape:return l(a.text);case f.code:return'Code ("", [], []) "'+j(a.text.trim())+'", ';case f.autolink:case f.url:return'Link ("", [], []) [Str "'+j(a.text)+'"] ("'+j(a.href)+'", ""), ';case f.tag:return'RawInline (Format "html") "'+j(a.text)+'", ';case f.link:if("#"==(a.href||"").trim()[0]){var e=a.href.substr(1),o=$("h1, h2, h3, h4, h5, h6").filter(function(){return $(this).text().toLowerCase().trim()==e.toLowerCase().trim()});o.length&&(a.href="#header-"+o.attr("cid"))}return'Link ("", [], []) ['+a.inner+'] ("'+j(a.href)+'", "'+j(a.title||"")+'"), ';case f.image:return'Image ("",[],[]) [Str "'+j(a.title||"")+'"] ("'+j(File.editor.imgEdit.getRealSrc(a.href).replace(m,""))+'","fig:"), ';case f.refimg:h="Image";case f.reflink:return c=b.nodeMap.link_list.getNodeByRef(a.ref||a.text),d=c?j(c.get("href").replace(m,"")):"",e=j(c&&c.get("title")||""),h=h||"Link","Image"==h&&(a.inner='Str "'+j(e||"")+'"'),h+' ("", [], []) ['+a.inner+'] ("'+d+'", "'+e+'"), ';case f.footnote:var q=b.nodeMap.foot_list.getNodeByRef(a.text);return q?"Note [Para ["+n(q)+"]], ":l(a.text);case f.attr:return l(a.text);case f.emoji:return'Str "'+j(a.inner)+'", ';case f.inline_math:return'Math InlineMath "'+j(a.text.replace(/(^\s*\$+)|(\$+\s*$)/g,""))+'", ';case f.linebreak:return"LineBreak, ";case f.highlight:"latex"==b.target&&(w.push("\\usepackage{color}"),w.push("\\usepackage{soulutf8}")),i=s;case f.underline:i=i||r;var u=t(a);return"docx"==b.target&&u!==!1?i[b.target].replace("$0",j(g.escape(u))):(i[b.target]||i.html).replace("$0",a.inner);default:return""}},v={},w=[],x=function(a){function c(a,c){return c instanceof Array?'("'+j(a)+'", MetaList ['+c.map(function(a){return"MetaInlines ["+(b.output(a).replace(/, $/,"")||'Str ""')+"]"}).join(", ")+"])":'("'+j(a)+'", MetaInlines [ '+(b.output(c).replace(/, $/,"")||'Str ""')+"])"}function e(a,b){return'("'+j(a)+'", MetaList ['+b.map(function(a){return'MetaInlines [RawInline (Format "tex") "'+j(a)+'"]'}).join(", ")+"])"
}var f=[];a["header-includes"]&&a["header-includes"]instanceof Array?a["header-includes"]=a["header-includes"].concat(w):w.length&&(a["header-includes"]=w);for(var g in a)d.isType(g,"title","author","abstract","rights","language","header","footer","geometry","date")?f.push(c(g,a[g])):"header-includes"==g&&f.push(e(g,a[g]));return f.join(", ")};e.prototype.exportToNative=function(a){w=[],v.target=a,b&&b.options.nodeMap===this||(v.nodeMap=this,b=new h.InlineLexer(v,u));var c=l(null,"\n ,",this.getFirst(),v);return"Pandoc (Meta {unMeta = fromList ["+x(File.editor.docMenu.buildMetaMap())+"]})\n ["+c+"]"}}),define("app/editor/SourceView",["codemirror/lib/codemirror","codemirror/addon/selection/active-line","codemirror/addon/edit/visiblespace","jquery/jquery","exoskeleton-master/exoskeleton","app/document/Node","app/document/StringUtils"],function(a,b,c){"use strict";function d(a,b){var c="number"==typeof a?a:a.get("tail");return void 0===c?void 0===b?a.get("after")?1:0:b:c}function e(a){return m.isType(a,n.table_row,n.line)?0:d(a)}function f(a){function b(a){return a.get("children").toArray().reduce(function(a,b){return a+f(b)},0)}function c(a){return m.isType(a.get("parent"),n.list_item)&&a.get("parent").get("tight")!==!1}switch(a.get("type")){case n.meta_block:return 2+a.get("text").match(/(\n|$)/g).length+d(a);case n.heading:return(a.get("ahead")||0)+((a.get("pattern")||(!m.isType(a.get("parent"),n.list_item)&&File.option.headingStyle&&a.get("depth")<=2?"===":"#")).match(/[-=]/)?2:1)+d(a);case n.paragraph:var e=a.get("tail");return void 0===e&&a.get("after")&&m.isType(a.get("parent"),n.list_item)&&(e=c(a)?0:1),m.isType(a.get("after"),n.paragraph)&&1>e&&(a.unset("tail"),e=1),void 0!==e||!m.isType(a.get("after"),n.math_block)&&a.get("after")||(e=0),(a.get("ahead")||0)+(a.get("children").length||1)+d(void 0===e?a:e,e);case n.line:return 1;case n.blockquote:return(a.get("ahead")||0)+b(a)+d(a);case n.list:var g=a.get("ahead")||0;return a.isLoose(!0),g+=b(a),m.isType(a.get("after"),n.list)&&(!a.get("tail")||a.get("tail"))<2&&a.get("pattern")==a.get("after").get("pattern")&&a.get("style")==a.get("after").get("style")&&(a.unset("tail"),g++,c(a)&&g++),g+=d(a,c(a)?0:1);case n.list_item:var e=a.get("tail");return void 0==e&&!a.get("tight")&&a.get("after")&&(e=1),b(a)+(e||0);case n.fences:var h=/`|~/.exec(a.get("pattern")||"```");return(a.get("ahead")||0)+(h?3:1)+(a.get("text").match(/\n/g)||[]).length+d(a);case n.math_block:return(a.get("ahead")||0)+3+(a.get("text").match(/\n/g)||[]).length+d(a,m.isType(a.get("before"),n.paragraph)&&m.isType(a.get("after"),n.paragraph)?0:1);case n.hr:return d(a)+1;case n.toc:return(a.get("ahead")||0)+1+d(a);case n.def_footnote:case n.def_link:return(a.get("ahead")||0)+1+d(a,!a.get("after")||m.isType(a.get("after"),m.TYPE.def_link)?0:1);case n.table:return(a.get("ahead")||0)+a.get("children").length+1+d(a);case n.table_row:return a.get("before")?0:1;case n.table_cell:return 0;default:return 1}}function g(a,b){return b=b||0,a?a.get("before")?g(a.get("before"),b+f(a.get("before"))):a.get("parent")?g(a.get("parent"),b+(a.get("parent").get("ahead")||0)):b:b}function h(){var a=q.lineText.substring(0,q.ch);q.inRef=a.match(t)&&!a.match(u),q.cellsBefore=(a.match(/\|/g)||[]).length,q.cellsOffset=/(\|\s*)[^|]*$/.exec(a),q.cellsOffset&&(q.cellsOffset=q.cellsOffset.index+q.cellsOffset[1].length)}var i=a("codemirror/lib/codemirror"),j=(a("codemirror/addon/selection/active-line"),a("codemirror/addon/edit/visiblespace"),a("jquery/jquery")),k=(a("exoskeleton-master/exoskeleton"),a("app/document/Node")),l=a("app/document/StringUtils"),m=k.Node,n=k.TYPE,o=j("#typora-source"),p=(j("#toggle-sourceview-btn"),!1),q=null,r=function(a){this.editor=a,this.cm=null,this.inSourceMode=!1,this.renderedHTML=""};r.prototype.prep=function(){if(!this.cm){var a=document.querySelector("#typora-source-input"),b=this;this.cm=i.fromTextArea(a,{lineWrapping:!0,mode:"gfm",theme:"typora-default",styleSelectedText:!0,maxHighlightLength:1/0,styleActiveLine:!0,visibleSpace:!0,viewportMargin:100,autoCloseBrackets:!0,autoCloseTags:!0,resetSelectionOnContextMenu:!1,extraKeys:{Enter:"newlineAndIndentContinueMarkdownList"},lineNumbers:!0},this.editor),o.css("z-index","2");var c=null,d=(this.cm,this.editor);File.isMac?c=app.menu.getItem("Edit").submenu():File.isNode&&(c=reqnode("electron").remote.Menu.getApplicationMenu().getItem("Edit").submenu),this.cm.on("changes",function(a,d){if(b.inSourceMode){if(p=!0,document.querySelector("content.on-search-panel-open")&&"+findReplace"!==d[0].origin&&"setValue"!==d[0].origin&&b.editor.searchPanel.closePanel(),c){var e=File.editor.sourceView.cm.doc.historySize();c.getItem("Undo").setEnabled(!File.isLocked&&e.undo>0),c.getItem("Redo").setEnabled(!File.isLocked&&e.redo>0)}"begin"!==d[0].origin&&File.updateChangeCount(File.ChangeType.NSChangeDone)}}),this.cm.on("contextmenu",function(a){if(b.inSourceMode){var c=a.getCursor("from"),d=a.getCursor("to");setTimeout(function(){a.setSelection(c,d,{scroll:!1})},180)}}),this.cm.on("cursorActivity",function(a){if(b.inSourceMode&&(File.isFocusMode&&d.updateFocusMode(!0),File.isTypeWriterMode)){var c=a.cursorCoords(!0,"window"),e=c.top-(s+c.bottom-c.top)/2;Math.abs(e)>2&&a.scrollTo(null,a.getScrollInfo().top+e)}}),this.cm.display.scroller.addEventListener("wheel",function(a){Math.abs(a.deltaY)<4||File.isFocusMode&&d.updateFocusMode(!1)})}},r.prototype.show=function(){File.sync();var a=this.editor.getMarkdown();try{q=z.call(this)}catch(b){q=null,console.error(b.stack)}this.editor.cleanTooltip(),this.editor.searchPanel.closePanel(),this.inSourceMode=!0,j("body").addClass("typora-sourceview-on"),this.renderedHTML="",this.prep(),this.cm.setValue(a,"begin"),p=!1,o.show(),A.call(this),this.cm.refresh(),this.cm.focus(),this.cm.getDoc().clearHistory(),this.cm.readOnly=File.isLocked,this.enableTypeWriterMode(File.isTypeWriterMode),this.scrollAdjust()};var s;r.prototype.enableTypeWriterMode=function(a){if(a){var b=this.cm.defaultTextHeight();s=document.querySelector("content").clientHeight,this.cm.display.lineSpace.parentNode.style.paddingTop=(s-b)/2+"px",this.cm.display.lineSpace.parentNode.style.paddingBottom=(s-b)/2+"px"}else this.cm.display.lineSpace.parentNode.style.paddingTop="",this.cm.display.lineSpace.parentNode.style.paddingBottom=""},r.prototype.hide=function(){var a=this.editor;if(j("body").removeClass("typora-sourceview-on"),this.inSourceMode=!1,q=this.cm.getCursor(),q.lineText=this.cm.getLine(q.line),h(),p)if(File.isMac&&!app.document.isDocumentEdited())j(File.editor.sessionStr).html(this.renderedHTML),setTimeout(function(){File.editor.refresh()},500);else{var b=File.isNode&&File.changeCounter.curState;File.reloadContent(this.cm.getValue(),!1,!0),b&&File.updateChangeCount(File.ChangeType.NSChangeAutosaved)}o.hide(),x.call(this),a.selection.scrollAdjust()},r.prototype.scrollAdjust=function(){if(!File.isTypeWriterMode){var a=this.cm.charCoords(this.cm.getCursor(),"local").top,b=this.cm.getScrollerElement().offsetHeight/2;this.cm.scrollTo(null,a-b-5)}};var t=/\[/,u=/\]/,v=function(a,b,c){function d(a,b,c){return void 0===c&&(c=b?q.lineText.indexOf(a):q.lineText.lastIndexOf(a),c=0>c?0:c),Math.max(0,q.ch-c)}var e=null;switch(b.get("type")){case n.line:case n.heading:a.undo.exeCommand({type:"cursor",id:b.cid,start:d(b.get("text"))});break;case n.hr:case n.toc:b.get("after")?a.selection.jumpIntoElemBegin(a.findElemById(b.get("after").getVeryFirst().cid)):a.selection.selectNode(b);break;case n.math_block:e=a.mathBlock.startEditing(b.cid,!0),c--;break;case n.fences:(b.get("pattern")||"```").match(/`/)&&c--,e=a.fences.getCm(b.cid);break;case n.def_link:case n.def_footnote:if(q.inRef)a.undo.exeCommand({type:"cursor",id:b.cid,start:d(b.get("ref"),!0)});else{var f=new RegExp("(]:\\s*)"+l.escapeRegExp(b.get("href")||b.get("text"))).exec(q.lineText),g=f?f.index+f[1].length:0;a.undo.exeCommand({type:"cursor",id:b.cid,start:b.get("ref").length+d(void 0,void 0,g)})}break;case n.meta_block:for(var h=b.get("text").split(/\n/),g=q.ch,i=0;c-1>i;i++)g+=(h[i]||"").length+1;a.undo.exeCommand({type:"cursor",id:b.cid,start:g});break;case n.table_row:a.undo.exeCommand({type:"cursor",id:b.getNthChild(Math.max(0,q.cellsBefore-1)).cid,start:q.ch-q.cellsOffset});break;default:a.selection.jumpIntoElemEnd(a.findElemById(b.getVeryFirst(!0).cid))}e&&(e.focus(),c>=e.lineCount()?e.execCommand("goDocEnd"):e.setCursor({line:c,ch:d(e.getLine(c))}))},w=function(a,b,c){var d=0;for(c+(b.get("ahead")||0)>q.line&&a.selection.jumpIntoElemBegin(a.findElemById(b.getVeryFirst().cid)),d=f(b);b.get("after")&&c+d<=q.line;)c+=d,b=b.get("after"),d=f(b);b.get("children").length&&!m.isType(b,n.table_row)?w(a,b.getFirstChild(),c+(b.get("ahead")||0)):c+d-e(b)>q.line?v(a,b,q.line-c-(b.get("ahead")||0)):a.selection.jumpIntoElemEnd(a.findElemById(b.getVeryFirst(!0).cid))},x=function(){var a=this.editor;try{w(a,a.nodeMap.getFirst(),0)}catch(b){console.error(b.stack)}a.refocus()},y=function(a){return a.get("after")?!1:a.get("parent")?y(a.get("parent")):!0},z=function(){if(this.editor.focusCid){var a=this.editor.findElemById(this.editor.focusCid),b=this.editor.getNode(this.editor.focusCid),c=0,d="",e="",f=this.editor.selection.getRangy();if(b){if(c=y(b)?-1:g(b)+(b.get("ahead")||0),m.isType(b,n.fences)){var h=!/`|~/.exec(b.get("pattern")||"```");return!h&&c++,q=document.activeElement.classList.contains("mode")?{line:-1,before:b.get("pattern")||"```"}:this.editor.fences.getCm(b.cid).doc.getCursor(),q.before=(h?b.get("pattern"):"")+this.editor.fences.getCm(b.cid).getLine(q.line).substring(0,q.ch),q.line=q.line+c,q.ch=void 0,q}if(m.isType(b,n.math_block))return this.editor.mathBlock.currentCm?(q=this.editor.mathBlock.currentCm.doc.getCursor(),q.line=q.line+c+1,q):{line:c,ch:-1};if(m.isType(b,n.toc))return{line:c,before:"]"};if(m.isType(b,n.hr))return{line:c,before:this.get("pattern")||"------"};if(m.isType(b,n.def_link,n.def_footnote)){var i,j=this.editor.getJQueryElem(f.startContainer);if(i=j.closest(".md-def-content"),i.length)return f.setStartBefore(i[0]),d="]: "+f.toString(),{line:c,before:d};if(i=j.closest(".md-def-title"),i.length&&j.text().length)return f.setStartBefore(i[0]),d='"'+f.toString(),{line:c,before:d}}if(m.isType(b,n.table,n.table_row))return{line:c,ch:-1};if(f.setStartBefore(a[0]),d=f.toString().replace(/(\u200B*):(\u200B*)/g,":").replace(/\200B\$/,"$"),m.isType(b,n.table_cell)){for(e="",b=b.get("before");b;)e="\\|[^|]*"+e,b=b.get("before");return d=e+"\\|\\s*"+l.escapeRegExp(d),{line:c,beforeRegExp:d}}return m.isType(b,n.meta_block)&&(d=d.replace(/^---/gm,"---").replace(/\n$/g,""),c=(d.match(/\n/g)||[]).length+1,d=d.substring(d.lastIndexOf("\\n"))),{line:c,before:d}}}},A=function(){if(q)try{var a=q.ch;if(q.line<0&&(q.line=this.cm.doc.lineCount()-1),void 0===a){var b=this.cm.doc.getLine(q.line);if(q.before)a=b.indexOf(q.before)+q.before.length;else if(q.beforeRegExp){var c=new RegExp(q.beforeRegExp,"g");c.exec(b),a=c.lastIndex}}this.cm.doc.setCursor({line:q.line,ch:0>a?0:a}),0>a&&this.cm.execCommand("goLineEnd")}catch(d){console.error(d.stack)}};c.exports=r}),define("codemirror/addon/selection/active-line.js",[],function(a){"use strict";function b(a){for(var b=0;b<a.state.activeLines.length;b++)a.removeLineClass(a.state.activeLines[b],"wrap",g),a.removeLineClass(a.state.activeLines[b],"background",h)}function c(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0}function d(a,d){for(var e=[],f=0;f<d.length;f++){var i=d[f];if(i.empty()){var j=a.getLineHandleVisualStart(i.head.line);e[e.length-1]!=j&&e.push(j)}}c(a.state.activeLines,e)||a.operation(function(){b(a);for(var c=0;c<e.length;c++)a.addLineClass(e[c],"wrap",g),a.addLineClass(e[c],"background",h);a.state.activeLines=e})}function e(a,b){d(a,b.ranges)}var f=a("codemirror/lib/codemirror"),g="CodeMirror-activeline",h="CodeMirror-activeline-background";f.defineOption("styleActiveLine",!1,function(a,c,g){var h=g&&g!=f.Init;c&&!h?(a.state.activeLines=[],d(a,a.listSelections()),a.on("beforeSelectionChange",e)):!c&&h&&(a.off("beforeSelectionChange",e),b(a),delete a.state.activeLines)})}),define("codemirror/addon/edit/visiblespace.js",[],function(a){"use strict";var b=a("codemirror/lib/codemirror");b.defineOption("visibleSpace",!1,function(a,c,d){d==b.Init&&(d=!1),d&&!c?a.removeOverlay("visiblespace"):!d&&c&&a.addOverlay({token:function(a,b){if(b.atBlockStart&&a.pos<b.atBlockStart)return a.eat(" ")?"startspace startspace-"+(a.pos-1):a.eat("	")?"starttab startspace-"+(a.pos-1):(a.pos++,null);{var c=/(^[ \t]+)|(\s+$)/.exec(a.string),d=a.string.length,e=c&&c[1]?c[1].length:-1;c&&c[2]?d-c[2].length:d}return e>0&&e>a.pos?(a.pos++,"startspace-"+(a.pos-1)+("	"==a.string.charAt(a.pos-1)?" starttab":" startspace")):(a.pos=d,null)},name:"visiblespace"})})}),define("app/editor/QuickOpenPanel",["jquery/jquery","app/document/StringUtils","app/editor/KeyMaster"],function(a,b,c){"use strict";function d(a){if(v.length){H=-1==H?0:(H+a)%v.length,l(".typora-quick-open-item.active").removeClass("active"),l(".typora-quick-open-item[data-index='"+H+"']").addClass("active");var b=H*A,c=s.scrollTop();(c>b||b>c+A*B-10)&&s.scrollTop(Math.min(b,(v.length-B)*A))}}function e(){function a(a,b,c){var d=/[^\\\/]+$/.exec(a),e=d[0],g=a.substring(0,d.index);z.length&&(e=m.escape(e).replace(new RegExp("(("+z.join(")|(")+"))","gi"),"<b>$1</b>")),b.append(q.find(".typora-quick-open-item-title").html(e).end().find(".typora-quick-open-item-path").text(f(g)).end().clone().attr("data-original",a).attr("data-index",c+"").addClass(H==c?"active":""))}function b(a,b){b.append(r.clone().find(".typora-quick-open-info").text(a?"Gathering more results":"Searching").end())}function c(c){if(!(0>c)){var e=l("<div>").css("position","absolute").css("top",c*d*40+"px").css("width","100%"),f=v.length;k=Math.min(f+F,c*d+d);for(var g=c*d;k>g;g++)g==f?b(f,e):a(v[g],e,g);t.append(e)}}var d=20,e=s.scrollTop(),g=Math.floor(e/40),h=Math.floor(g/d);h!=C&&(C=h,c(C-1),c(C),c(C+1))}function f(a){return a=a.replace(E,"~"),a.length>60?a.substring(0,30)+"..."+a.substring(a.length-30,a.length):a}function g(){C=-1,t.html("").height(A*(v.length+F)),e()}function h(a){z=a.split(/\s+/).filter(m.isNotNullOrEmpty).map(function(a){return a.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace("*",".*")});var b=[],c=z.map(function(a){return new RegExp("(.)?"+a+"(.)?","i")}),d=[];z.length?(w.forEach(function(a){for(var d,e=0,f=0;f<c.length;f++){if(d=i(a.n,c[f]),!d)return;e+=d}a.s=e,b.push(a)}),b.sort(function(a,b){var c=b.s-a.s;return c?c:b.d-a.d}),b=x.filter(function(a){for(var b=0;b<c.length;b++)if(!i(a.n,c[b]))return!1;return!0}).concat(b)):b=w.clone().concat(x),b.forEach(function(a){-1==d.indexOf(a.p)&&d.push(a.p)}),this.initResult(d)}function i(a,b){a=m.removeDiacritics(a);var c=b.exec(a);return c?(c[1]=c[1]||"",c[3]=c[3]||"",4-c[1].length-(/\w/.test(c[1])?1:0)-(/\w/.test(c[3])?1:0)):0}function j(a){D=(v[H]||{}).p,G&&(this.setSearchState(1),File.isMac&&app.document.quickOpen().query(a)),h.call(this,a),File.isMac&&app.document.quickOpen().reindexFolderIfNeeded()}var k,l=a("jquery/jquery"),m=a("app/document/StringUtils"),n=a("app/editor/KeyMaster"),o=n.map,p=function(a){this.editor=a},q=l(l("#typora-quick-open-item-templ").html()),r=l(l("#typora-quick-loading-item-templ").html()),s=l(".typora-quick-open-list"),t=l(".typora-quick-open-list-inner"),u=l("#typora-quick-open-input input"),v=[],w=[],x=[],y="",z=[],A=40,B=5,C=-1,D=null,E=window.app&&new RegExp("^"+m.escapeRegExp(app.path.home)),F=0,G=!0,H=-1;p.prototype.init=function(){var a=this;u.on("input",function(){var b=l(this).val();b!=y&&(v=[],y=b.replace(/[()'"%\\\/.?]/," "),j.call(a,y))}).on("keydown",function(b){var c=b.keyCode||b.which;return"Esc"==o[c]||"o"==o[c]&&b.shiftKey&&b.metaKey?(a.close(),!1):"Tab"==o[c]?!1:"Up"==o[c]?(d(-1),!1):"Down"==o[c]?(d(1),!1):"Enter"==o[c]&&File.isMac&&l(".typora-quick-open-item.active").length?(app.path.openURL(v[H],void 0,!0),!1):void b.stopPropagation()}).on("blur",function(){setTimeout(a.close,200)}),s.on("mousedown",".typora-quick-open-item",function(){File.isMac&&app.path.openURL(this.getAttribute("data-original"),void 0,!0)}).on("scroll",e),File.isMac&&app.document.quickOpen().cacheRecentFiles()},p.prototype.show=function(){var a=l("#typora-quick-open:not(:visible)").show();a.length&&(l("content").css("overflowY","hidden"),u[0].select(),j.call(this,""),H=-1)},p.prototype.close=function(){l("#typora-quick-open:visible").hide().length&&(l("content").css("overflowY",""),File.isMac&&app.document.quickOpen().stopQuery()),H=-1},p.prototype.updateResult=function(a){a=a.filter(function(a){return-1==v.indexOf(a)}),a.length&&(v=v.concat(a),File.isMac&&v.remove(app.document.currentFilePath()),g.call(this))},p.prototype.initResult=function(a){H=D?v.indexOf(D):-1,v=a,File.isMac&&v.remove(app.document.currentFilePath()),g.call(this)},p.prototype.initFileCache=function(a,b,c,d,e){w=a.map(function(a,d){return{n:b[d],p:a,d:c[d]}}),x=e.map(function(a){return{n:(/[^\\\/]+$/.exec(a)||[])[0]||"",p:a}}),G=d>a.length},p.prototype.setRecentFiles=function(a){x=a.map(function(a){return{n:(/[^\\\/]+$/.exec(a)||[])[0]||"",p:a}})},p.prototype.setSearchState=function(a){F!==a&&(a&&k==v.length?(l(".typora-quick-open-item:last").after(r.clone().find(".typora-quick-open-info").text(k?"Gathering more results":"Searching").end()),k++):a||(l(".typora-quick-open-info-item").remove().length&&t.height(t.height()-40),k==v.length+1&&k--),F=a)},c.exports=p});